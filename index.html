<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ì„¼í‹°ë¸Œ ì‹œë®¬ë ˆì´í„° (v9) - Tier 6 System</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Inter í°íŠ¸ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
        }
        .card {
            background-color: white;
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* shadow-md */
            margin-bottom: 1.5rem; /* mb-6 */
            overflow: hidden;
        }
        .step-title {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            padding: 1rem 1.5rem; /* p-4 sm:p-6 */
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
        }
        .card-content {
            padding: 1.5rem; /* p-6 */
        }
        .section-title {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #111827; /* gray-900 */
            margin-bottom: 1rem; /* mb-4 */
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
            padding-bottom: 0.5rem; /* pb-2 */
        }
        
        /* ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ í˜¸ë²„ íš¨ê³¼ */
        .insight-card {
            transition: all 0.3s ease;
        }
        .insight-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #insightModal {
            backdrop-filter: blur(4px);
        }
        
        /* í‘œì¤€ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .input-base {
            width: 100%;
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #d1d5db; /* border-gray-300 */
            padding: 0.5rem 0.75rem; /* px-3 py-2 */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            transition: all 0.15s ease-in-out;
        }
        .input-base:focus {
            outline: none;
            border-color: #4f46e5; /* focus:border-indigo-500 */
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2); /* focus:ring-indigo-200 */
        }
        
        /* íŠ¹ì • ë„ˆë¹„ ì…ë ¥ì°½ */
        .level-count-input {
            width: 4rem; /* w-16 */
            text-align: right;
        }
        .weight-input {
            width: 6rem; /* w-24 */
            text-align: right;
        }
        .rate-input {
            width: 5rem; /* w-20 */
            text-align: right;
        }

        /* ê³„ì‚° ê²°ê³¼ ì¶œë ¥ */
        .calc-output {
            font-weight: 600; /* font-semibold */
            color: #2563eb; /* text-blue-600 */
            display: block; /* ë°°ìˆ˜ í‘œì‹œë¥¼ ìœ„í•´ blockìœ¼ë¡œ ë³€ê²½ */
        }
        .calc-output-lg {
            font-weight: 700; /* font-bold */
            color: #1d4ed8; /* text-blue-700 */
            font-size: 1.125rem; /* text-lg */
        }
        
        /* KPI ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .kpi-box {
            background-color: #f9fafb; /* gray-50 */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem; /* p-4 */
        }
        .kpi-title {
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #6b7280; /* text-gray-500 */
            margin-bottom: 0.25rem; /* mb-1 */
        }
        .kpi-value {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #1f2937; /* text-gray-900 */
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem; /* text-sm */
        }
        th, td {
            border: 1px solid #e5e7eb; /* border-gray-200 */
            padding: 0.75rem; /* p-3 */
            text-align: right;
            white-space: nowrap;
        }
        th {
            background-color: #f9fafb; /* gray-50 */
            font-weight: 600; /* font-semibold */
            color: #374151; /* text-gray-700 */
        }
        td:first-child, th:first-child {
            text-align: left;
            font-weight: 500; /* font-medium */
            background-color: #f9fafb; /* gray-50 */
        }
        tfoot td {
            font-weight: 700; /* font-bold */
            background-color: #f3f4f6; /* gray-100 */
        }
        /* P&L í…Œì´ë¸” ì…ë ¥/ì¶œë ¥ */
        .pl-table-input {
            width: 100%;
            min-width: 6rem; /* w-24 */
            text-align: right;
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.25rem 0.5rem; /* px-2 py-1 */
        }
        .pl-table-input:disabled {
            background-color: #e5e7eb; /* bg-gray-200 */
            color: #4b5563; /* text-gray-600 */
            font-weight: 500; /* font-medium */
            border: none;
        }
        .pl-table-output {
            display: block;
            min-height: 1.5rem; /* h-6 */
            padding-right: 0.5rem; /* pr-2 */
            font-weight: 500; /* font-medium */
            color: #111827; /* text-gray-900 */
        }
        .relative-multiplier {
            font-size: 0.75rem; /* text-xs (ê¸°ì¡´ í°íŠ¸ë³´ë‹¤ 20% ì‘ì€ ê¸€ì) */
            color: #1f2937; /* text-gray-800 (ê²€ì •ìƒ‰) */
            font-weight: 500;
            display: block; /* í•­ìƒ ìƒˆ ì¤„ì— í‘œì‹œ */
        }
        
        /* Tab2 ì§ì› í…Œì´ë¸” Tier ì»¬ëŸ¼ ìŠ¤íƒ€ì¼ */
        #employeeTableBody td:nth-child(4) {
            min-width: 90px; /* Tier ì»¬ëŸ¼ ìµœì†Œ ë„ˆë¹„ */
            padding: 0.5rem; /* íŒ¨ë”© ì¡°ì • */
        }
        
        /* Tab2 í…Œì´ë¸” ë‚´ select ìŠ¤íƒ€ì¼ ê°œì„  */
        #employeeTableBody select.input-base {
            min-width: 75px; /* ìµœì†Œ ë„ˆë¹„ */
            width: 100%; /* ì…€ ë„ˆë¹„ì— ë§ì¶¤ */
            padding: 0.375rem 0.5rem; /* íŒ¨ë”© */
            font-size: 0.875rem; /* í°íŠ¸ í¬ê¸° */
            text-align: center; /* ì¤‘ì•™ ì •ë ¬ */
            font-weight: 500; /* í°íŠ¸ ë‘ê»˜ */
        }

        /* T5 ì¸ì›ìˆ˜ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ (í…Œì´ë¸” ì…€ì— ì§ì ‘ ì ìš©) */
        .t5-input-in-table {
            width: 100%;
            min-width: 4rem; /* level-count-inputê³¼ ìœ ì‚¬í•˜ê²Œ ì„¤ì • */
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.25rem 0.5rem;
            text-align: right;
            /* ë°°ê²½ìƒ‰ì„ í°ìƒ‰ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì…ë ¥ ê°€ëŠ¥í•œ í•„ë“œì²˜ëŸ¼ ë³´ì´ê²Œ í•¨ */
            background-color: white; 
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .t5-input-in-table:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        
        /* ë¦¬ë” ë·° ìŠ¤íƒ€ì¼ */
        .leader-view .detailed-section {
            display: none;
        }
        
        .leader-view .kpi-box {
            transform: scale(1.1);
            margin: 1.5rem 0;
        }
        
        .collapsible-section {
            transition: all 0.3s ease;
        }
        
        .collapse-toggle {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
        }
        
        .collapse-toggle:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .collapse-toggle .arrow {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
        }
        
        .collapse-toggle.collapsed .arrow {
            transform: rotate(-90deg);
        }
        
        .collapsible-content {
            max-height: 5000px;
            overflow: hidden;
            transition: max-height 0.5s ease, opacity 0.3s ease, margin 0.3s ease;
            opacity: 1;
        }
        
        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin: 0;
        }
        
        /* ë¦¬ë” ë·° ì „ìš© KPI ê°•ì¡° */
        .leader-kpi-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
        }
        
    </style>
</head>
<body class="bg-gray-100">

    <div class="container max-w-5xl mx-auto p-4 md:p-8">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-3xl font-bold text-gray-800">
                ì¸ì„¼í‹°ë¸Œ ì‹œë®¬ë ˆì´í„° (v9)
            </h1>
            <div class="flex items-center gap-3">
                <span class="text-sm text-gray-600">ë·° ëª¨ë“œ:</span>
                <button id="toggleViewMode" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm">
                    ğŸ“Š ë¦¬ë” ë·°
                </button>
            </div>
        </div>
        <p class="text-center text-sm text-gray-500 mb-6">
            <span id="viewModeDescription">ë¦¬ë” í”„ë ˆì  í…Œì´ì…˜ ìµœì í™” ë·° - í•µì‹¬ ê²°ê³¼ ì¤‘ì‹¬</span>
        </p>

        <!-- Tab Navigation -->
        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="flex -mb-px" aria-label="Tabs">
                    <button id="tab1-button" 
                            class="tab-button w-1/4 py-4 px-1 text-center border-b-2 font-medium text-sm cursor-pointer transition-colors duration-200 border-indigo-500 text-indigo-600">
                        ì¸ì„¼í‹°ë¸Œ ì‹œë®¬ë ˆì´í„° (Step 1-3)
                    </button>
                    <button id="tab2-button"
                            class="tab-button w-1/4 py-4 px-1 text-center border-b-2 font-medium text-sm cursor-pointer transition-colors duration-200 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        ìŠˆí¼ìº£ ì¸ì› ê´€ë¦¬
                    </button>
                    <button id="tab3-button"
                            class="tab-button w-1/4 py-4 px-1 text-center border-b-2 font-medium text-sm cursor-pointer transition-colors duration-200 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        ë°ì´í„° ê²€ì¦
                    </button>
                    <button id="tab4-button"
                            class="tab-button w-1/4 py-4 px-1 text-center border-b-2 font-medium text-sm cursor-pointer transition-colors duration-200 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        HR ì¸ì‚¬ì´íŠ¸
                    </button>
                </nav>
            </div>
        </div>

        <!-- Tab Content -->
        <div id="tab1-content">
            <!-- #################### -->
            <!-- STEP 1: P&L ì¬ì› ì„¤ì • -->
        <!-- #################### -->
        <div class="card">
            <h2 class="step-title">Step 1: P&L ì¬ì› ì„¤ì • ë° ì¶”ì •</h2>
            <div class="card-content space-y-6">
                
                <!-- ë¦¬ë” ë·°: í•µì‹¬ ì§€í‘œ ìš”ì•½ (í•­ìƒ í‘œì‹œ) -->
                <div class="leader-kpi-highlight leader-view-only" style="display:none;">
                    <h3 class="text-2xl font-bold mb-4">ğŸ“Š í•µì‹¬ ì¬ë¬´ ì§€í‘œ</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-sm opacity-90">ì´ íˆ¬ìë¹„</div>
                            <div id="leader_total_investment" class="text-3xl font-bold mt-1">-</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm opacity-90">ì˜ì—…ì´ìµ (ê¸°ì¤€ ê¸°ê°„)</div>
                            <div id="leader_operating_profit" class="text-3xl font-bold mt-1">-</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm opacity-90">ROI</div>
                            <div id="leader_roi" class="text-3xl font-bold mt-1">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- ìƒì„¸ ì„¤ì • í† ê¸€ -->
                <div class="collapse-toggle collapsed detailed-section" onclick="toggleCollapse(this)">
                    <div>
                        <span class="font-semibold text-gray-700">ğŸ”§ ìƒì„¸ P&L ì„¤ì •</span>
                        <span class="text-sm text-gray-500 ml-2">(í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°/ì ‘ê¸°)</span>
                    </div>
                    <span class="arrow">â–¼</span>
                </div>
                
                <!-- P&L ì„¤ì • (ì…ë ¥) -->
                <section class="collapsible-content collapsed detailed-section">
                    <h3 class="section-title">P&L ì„¤ì •</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ -->
                        <div>
                            <label for="revenueScenario" class="block text-sm font-medium text-gray-700 mb-1">ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤</label>
                            <select id="revenueScenario" class="input-base">
                                <option value="base">Base (ê¸°ë³¸)</option>
                                <option value="best" selected>Best</option>
                                <option value="worst">Worst</option>
                            </select>
                        </div>
                        <!-- ì´ íˆ¬ìë¹„ -->
                        <div>
                            <label for="total_investment_slider" class="block text-sm font-medium text-gray-700 mb-1">
                                ì´ íˆ¬ìë¹„ (ê°œë°œë¹„+ë³´ë„ˆìŠ¤): <span id="total_investment_display" class="font-bold text-indigo-600">397ì–µì›</span>
                            </label>
                            <input type="range" id="total_investment_slider" min="0" max="377" value="377" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <!-- MG (ì„ ìˆ˜ê¸ˆ) -->
                        <div>
                            <label for="mg_slider" class="block text-sm font-medium text-gray-700 mb-1">
                                MG ì„ ìˆ˜ê¸ˆ (ìƒí™˜ í•„ìš”): <span id="mg_display" class="font-bold text-orange-600">100ì–µì›</span>
                            </label>
                            <input type="range" id="mg_slider" min="0" max="100" value="100" step="5" class="w-full h-2 bg-orange-200 rounded-lg appearance-none cursor-pointer">
                            <p class="text-xs text-gray-500 mt-1">â€» ìˆœë§¤ì¶œì—ì„œ ìš°ì„  ìƒí™˜ë˜ëŠ” ì„ ìˆ˜ê¸ˆ ê¸ˆì•¡ (0~100ì–µì›)</p>
                        </div>
                        <!-- ìƒê° ê¸°ê°„ -->
                        <div>
                            <label for="amortization_periods" class="block text-sm font-medium text-gray-700 mb-1">ìƒê° ê¸°ê°„ (Period)</label>
                            <select id="amortization_periods" class="input-base">
                                <option value="1">1 Period</option>
                                <option value="2" selected>2 Period</option>
                                <option value="3">3 Period</option>
                                <option value="4">4 Period</option>
                                <option value="5">5 Period</option>
                                <option value="6">6 Period</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ë¡œì§ -->
                <section>
                    <h3 class="section-title">ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ë¡œì§ (ìˆ˜ì • ê°€ëŠ¥)</h3>
                    <p class="text-sm text-gray-600 mb-4 -mt-3">
                        ì—¬ê¸°ì„œ ì„¤ì •í•œ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ 'Base', 'Best', 'Worst' ì‹œë‚˜ë¦¬ì˜¤ê°€ ìë™ ìƒì„±ë˜ë©°, 'P&L ì„¤ì •'ì˜ ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒí•œ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì•„ë˜ P&L ì¶”ì • í…Œì´ë¸”ì— ë°˜ì˜ë©ë‹ˆë‹¤.
                    </p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                        <!-- Base P1 -->
                        <div>
                            <label for="base_p1_revenue" class="block text-sm font-medium text-gray-700 mb-1">Base P1 ë§¤ì¶œ (ì–µì›)</label>
                            <input type="number" id="base_p1_revenue" value="1000" class="input-base">
                        </div>
                        <!-- Best Multiplier -->
                        <div>
                            <label for="best_multiplier" class="block text-sm font-medium text-gray-700 mb-1">Best ë°°ìœ¨ (Base ëŒ€ë¹„ %)</label>
                            <input type="number" id="best_multiplier" value="150" class="input-base">
                        </div>
                        <!-- Worst Multiplier -->
                        <div>
                            <label for="worst_multiplier" class="block text-sm font-medium text-gray-700 mb-1">Worst ë°°ìœ¨ (Base ëŒ€ë¹„ %)</label>
                            <input type="number" id="worst_multiplier" value="50" class="input-base">
                        </div>
                        <!-- P2 Retention -->
                        <div>
                            <label for="p2_retention" class="block text-sm font-medium text-gray-700 mb-1">P2 ë§¤ì¶œ ìœ ì§€ìœ¨ (%)</label>
                            <input type="number" id="p2_retention" value="60" class="input-base">
                        </div>
                        <!-- P3 Retention -->
                        <div>
                            <label for="p3_retention" class="block text-sm font-medium text-gray-700 mb-1">P3 ë§¤ì¶œ ìœ ì§€ìœ¨ (%)</label>
                            <input type="number" id="p3_retention" value="85" class="input-base">
                        </div>
                        <!-- P4 Retention -->
                        <div>
                            <label for="p4_retention" class="block text-sm font-medium text-gray-700 mb-1">P4 ë§¤ì¶œ ìœ ì§€ìœ¨ (%)</label>
                            <input type="number" id="p4_retention" value="85" class="input-base">
                        </div>
                    </div>
                </section>
                
                <!-- P&L ì¶”ì • í…Œì´ë¸” -->
                <section>
                    <h3 class="section-title">P&L ì¶”ì • (ë‹¨ìœ„: ì–µì›)</h3>
                    <!-- ì„¤ëª… í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ -->
                    <p id="amortization_desc" class="text-sm text-gray-600 mb-3 p-3 bg-gray-50 rounded-md">
                        -
                    </p>
                    <p class="text-sm text-gray-600 mb-3 p-3 bg-indigo-50 border border-indigo-200 rounded-md">
                        â€» **ìˆœë§¤ì¶œ ë°°ë¶„ìœ¨ ì ìš©:** 'ë°°ë¶„ ì „ ìˆœë§¤ì¶œ(ë§¤ì¶œ G * 70%)'ì— **'ëˆ„ì  ë§¤ì¶œ(G)'**ì„ ê¸°ì¤€ìœ¼ë¡œ í•œ ë°°ë¶„ìœ¨ì´ **êµ¬ê°„ë³„ë¡œ ì°¨ë“± ì ìš©**ë©ë‹ˆë‹¤: <br>
                        - <span class="font-bold">ëˆ„ì  ë§¤ì¶œ(G) 3,000ì–µì› ì´í•˜ êµ¬ê°„ë¶„: 45%</span> <br>
                        - <span class="font-bold">ëˆ„ì  ë§¤ì¶œ(G) 3,000ì–µì› ì´ˆê³¼ ~ 5,000ì–µì› ì´í•˜ êµ¬ê°„ë¶„: 50%</span> <br>
                        - <span class="font-bold">ëˆ„ì  ë§¤ì¶œ(G) 5,000ì–µì› ì´ˆê³¼ êµ¬ê°„ë¶„: 55%</span>
                    </p>
                    <p class="text-sm text-gray-600 mb-3 p-3 bg-yellow-50 border border-yellow-300 rounded-md">
                        âš ï¸ **ì¸ì„¼í‹°ë¸Œ ê³„ì‚° ë°©ì‹ (ROI êµ¬ê°„ë³„ ì°¨ë“±):**<br>
                        - <span class="font-bold text-red-600">ROI < 100% (BEP ë¯¸ë‹¬):</span> ìˆœë§¤ì¶œ(S)ì˜ 2% (ìµœì†Œ ë³´ì¥)<br>
                        - <span class="font-bold text-green-600">ROI â‰¥ 100% (BEP ë‹¬ì„±):</span> ì˜ì—…ì´ìµ * ì¸ì„¼ ë¹„ìœ¨ (ROI êµ¬ê°„ë³„ ì°¨ë“± ì ìš©)
                    </p>
                    <p class="text-sm text-gray-600 mb-3 p-3 bg-red-50 border border-red-300 rounded-md">
                        ğŸ’° **MG(Minimum Guarantee) ìƒí™˜ ë¡œì§:**<br>
                        - <span class="font-bold">ì„ ìˆ˜ê¸ˆ 100ì–µì›</span>ì„ ì‚¬ì „ì— ë°›ì•˜ìœ¼ë©°, ì´ëŠ” ìˆœë§¤ì¶œì—ì„œ ìš°ì„  ìƒí™˜ë©ë‹ˆë‹¤.<br>
                        - ê° Periodì˜ ìˆœë§¤ì¶œ(S)ì€ <span class="font-bold text-red-600">MG ì”ì•¡ì´ 0ì´ ë  ë•Œê¹Œì§€ ìš°ì„  ìƒí™˜</span>ì— ì‚¬ìš©ë©ë‹ˆë‹¤.<br>
                        - MGê°€ ì™„ì „íˆ ìƒí™˜ëœ í›„ë¶€í„° ìˆœë§¤ì¶œì´ ì‹¤ì œ ì´ìµìœ¼ë¡œ ì¸ì •ë©ë‹ˆë‹¤.<br>
                        - ì˜ˆ: P1 ìˆœë§¤ì¶œ 50ì–µ â†’ MG ìƒí™˜ 50ì–µ, ì‹¤ì œ ìˆœë§¤ì¶œ 0ì–µ (MG ì”ì•¡ 50ì–µ)
                    </p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th>ê¸°ê°„</th>
                                    <th>ë§¤ì¶œ(G)</th>
                                    <th>ë°°ë¶„ ì „</th>
                                    <th>ìˆœë§¤ì¶œ(S)</th>
                                    <th>ì´ íˆ¬ìë¹„ ìƒê°</th>
                                    <th>ìš´ì˜ë¹„</th>
                                    <th>ë¹„ìš© í•©ê³„</th>
                                    <th>ì˜ì—…ì´ìµ</th>
                                    <th>ëˆ„ì ë¹„ìš©</th>
                                    <th>ëˆ„ì ì˜ì—…ìµ</th>
                                    <th>ROI(%)</th>
                                    <th>ì¸ì„¼ ë¹„ìœ¨(%)</th>
                                    <th class="bg-yellow-50">ì¸ì„¼í‹°ë¸Œ</th>
                                    <th class="bg-green-50">OQìˆœì´ìµ</th>
                                    <th class="bg-blue-50">OQì™¸ ë¹„ìš©</th>
                                    <th class="bg-purple-50 font-bold">ë‹¹ê¸°ìˆœì´ìµ</th>
                                    <th class="bg-purple-100 font-bold">ëˆ„ì  ë‹¹ê¸°ìˆœì´ìµ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Period 1 -->
                                <tr>
                                    <td>Period 1</td>
                                    <td><input type="text" id="p1_revenue" class="pl-table-input" disabled></td>
                                    <td><span id="p1_pre_dist" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p1_supercat_net" class="pl-table-output calc-output">-</span></td>
                                    <td><input type="text" id="p1_amortization" class="pl-table-input" disabled></td>
                                    <td><input type="number" id="p1_op_cost" class="pl-table-input" value="67"></td>
                                    <td><span id="p1_total_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p1_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p1_cum_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p1_cum_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p1_roi" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p1_incentive_rate" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-yellow-50"><span id="p1_incentive_amount" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-green-50 font-semibold"><span id="p1_oq_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-blue-50"><input type="number" id="p1_non_oq_cost" class="pl-table-input" value="42.5"></td>
                                    <td class="bg-purple-50 font-bold"><span id="p1_net_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-purple-100 font-bold"><span id="p1_cum_net_profit" class="pl-table-output calc-output">-</span></td>
                                </tr>
                                <!-- Period 2 -->
                                <tr>
                                    <td>Period 2</td>
                                    <td><input type="text" id="p2_revenue" class="pl-table-input" disabled></td>
                                    <td><span id="p2_pre_dist" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p2_supercat_net" class="pl-table-output calc-output">-</span></td>
                                    <td><input type="text" id="p2_amortization" class="pl-table-input" disabled></td>
                                    <td><input type="number" id="p2_op_cost" class="pl-table-input" value="67"></td>
                                    <td><span id="p2_total_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p2_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p2_cum_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p2_cum_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p2_roi" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p2_incentive_rate" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-yellow-50"><span id="p2_incentive_amount" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-green-50 font-semibold"><span id="p2_oq_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-blue-50"><input type="number" id="p2_non_oq_cost" class="pl-table-input" value="37.5"></td>
                                    <td class="bg-purple-50 font-bold"><span id="p2_net_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-purple-100 font-bold"><span id="p2_cum_net_profit" class="pl-table-output calc-output">-</span></td>
                                </tr>
                                <!-- Period 3 -->
                                <tr>
                                    <td>Period 3</td>
                                    <td><input type="text" id="p3_revenue" class="pl-table-input" disabled></td>
                                    <td><span id="p3_pre_dist" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p3_supercat_net" class="pl-table-output calc-output">-</span></td>
                                    <td><input type="text" id="p3_amortization" class="pl-table-input" disabled></td>
                                    <td><input type="number" id="p3_op_cost" class="pl-table-input" value="67"></td>
                                    <td><span id="p3_total_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p3_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p3_cum_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p3_cum_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p3_roi" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p3_incentive_rate" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-yellow-50"><span id="p3_incentive_amount" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-green-50 font-semibold"><span id="p3_oq_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-blue-50"><input type="number" id="p3_non_oq_cost" class="pl-table-input" value="37.5"></td>
                                    <td class="bg-purple-50 font-bold"><span id="p3_net_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-purple-100 font-bold"><span id="p3_cum_net_profit" class="pl-table-output calc-output">-</span></td>
                                </tr>
                                <!-- Period 4 -->
                                <tr>
                                    <td>Period 4</td>
                                    <td><input type="text" id="p4_revenue" class="pl-table-input" disabled></td>
                                    <td><span id="p4_pre_dist" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p4_supercat_net" class="pl-table-output calc-output">-</span></td>
                                    <td><input type="text" id="p4_amortization" class="pl-table-input" disabled></td>
                                    <td><input type="number" id="p4_op_cost" class="pl-table-input" value="67"></td>
                                    <td><span id="p4_total_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p4_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p4_cum_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p4_cum_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p4_roi" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p4_incentive_rate" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-yellow-50"><span id="p4_incentive_amount" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-green-50 font-semibold"><span id="p4_oq_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-blue-50"><input type="number" id="p4_non_oq_cost" class="pl-table-input" value="37.5"></td>
                                    <td class="bg-purple-50 font-bold"><span id="p4_net_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-purple-100 font-bold"><span id="p4_cum_net_profit" class="pl-table-output calc-output">-</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- ROI êµ¬ê°„ë³„ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ì„¤ì • -->
                <section>
                    <h3 class="section-title">ROI êµ¬ê°„ë³„ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ì„¤ì •</h3>
                    <p class="text-sm text-gray-600 mb-4 -mt-3 p-3 bg-indigo-50 border border-indigo-200 rounded-md">
                        â€» ROI(ëˆ„ì  ìˆœë§¤ì¶œ / ì´ ëˆ„ì  ë¹„ìš©) êµ¬ê°„ì— ë”°ë¼ ì ìš©ë˜ëŠ” ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ì„ ì„¤ì •í•©ë‹ˆë‹¤.<br>
                        â€» ìµœì¢… ì¸ì„¼í‹°ë¸Œ ì¬ì› = <strong>ëˆ„ì  ì˜ì—…ì´ìµ Ã— ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨(%)</strong>
                    </p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th>ROI êµ¬ê°„ (%)</th>
                                    <th>ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ (%)</th>
                                    <th>ì„¤ëª…</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>0% ~ 100%</td>
                                    <td><input type="number" id="roi_rate_0_100" value="2" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 100% ì´í•˜</td>
                                </tr>
                                <tr>
                                    <td>100% ì´ˆê³¼ ~ 150%</td>
                                    <td><input type="number" id="roi_rate_100_150" value="10" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 100% ì´ˆê³¼ 150% ì´í•˜</td>
                                </tr>
                                <tr>
                                    <td>150% ì´ˆê³¼ ~ 200%</td>
                                    <td><input type="number" id="roi_rate_150_200" value="20" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 150% ì´ˆê³¼ 200% ì´í•˜</td>
                                </tr>
                                <tr>
                                    <td>200% ì´ˆê³¼ ~ 300%</td>
                                    <td><input type="number" id="roi_rate_200_300" value="25" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 200% ì´ˆê³¼ 300% ì´í•˜</td>
                                </tr>
                                <tr>
                                    <td>300% ì´ˆê³¼</td>
                                    <td><input type="number" id="roi_rate_300_plus" value="30" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 300% ì´ˆê³¼</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                </section>
                <!-- collapsible-content ë‹«ê¸° -->
            </div>
        </div>

        <!-- ######################### -->
        <!-- STEP 2: ì¸ì„¼í‹°ë¸Œ ë° ë³´ë„ˆìŠ¤ ì„¤ì • -->
        <!-- ######################### -->
        <div class="card">
            <h2 class="step-title">Step 2: ì¸ì„¼í‹°ë¸Œ ë° ë³´ë„ˆìŠ¤ ì„¤ì •</h2>
            <div class="card-content space-y-6">
                
                <!-- ë¦¬ë” ë·°: í•µì‹¬ ì„¤ì • ìš”ì•½ -->
                <div class="leader-kpi-highlight leader-view-only" style="display:none;">
                    <h3 class="text-2xl font-bold mb-4">ğŸ¯ ì¸ì„¼í‹°ë¸Œ ë°°ë¶„ ì „ëµ</h3>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <div class="text-sm opacity-90 mb-2">ì´ ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ì¬ì›</div>
                            <div id="leader_incentive_pool" class="text-3xl font-bold">-</div>
                        </div>
                        <div>
                            <div class="text-sm opacity-90 mb-2">ì´ ëŸ°ì¹­ ë³´ë„ˆìŠ¤</div>
                            <div id="leader_launch_bonus" class="text-3xl font-bold">-</div>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/20">
                        <div class="text-sm opacity-90">Tier ë°°ìœ¨ ë¡œì§ì„ í†µí•œ ì •êµí•œ ë°°ë¶„ ì‹œìŠ¤í…œ ì ìš©</div>
                        <div class="text-xs opacity-75 mt-1">â€¢ Level ê°€ì¤‘ì¹˜ ë°˜ì˜ â€¢ ì—­ì „ í˜„ìƒ ë°©ì§€ â€¢ ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡ ë¶„ë¦¬</div>
                    </div>
                </div>
                
                <!-- ìƒì„¸ ì„¤ì • í† ê¸€ -->
                <div class="collapse-toggle collapsed detailed-section" onclick="toggleCollapse(this)">
                    <div>
                        <span class="font-semibold text-gray-700">ğŸ”§ ìƒì„¸ ë°°ë¶„ ì„¤ì •</span>
                        <span class="text-sm text-gray-500 ml-2">(ê°€ì¤‘ì¹˜, Tier ë°°ìœ¨, ì¸ì› í…Œì´ë¸”)</span>
                    </div>
                    <span class="arrow">â–¼</span>
                </div>
                
                <!-- ê°€ì¤‘ì¹˜ ì„¤ì • -->
                <section class="collapsible-content collapsed detailed-section">
                    <h3 class="section-title">Levelë³„ ê°€ì¤‘ì¹˜ ì„¤ì •</h3>
                    <p class="text-sm text-gray-600 mb-4 -mt-3">â€» Level: í•´ë‹¹ í”„ë¡œì íŠ¸ì— ì¢…ì‚¬í•œ ê¸°ê°„ì— ë”°ë¥¸ êµ¬ë¶„</p>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                        <div>
                            <label for="w1" class="block text-sm font-medium text-gray-700 mb-1">
                                L1 <span class="font-normal text-gray-500">(6ê°œì›” ë¯¸ë§Œ)</span>
                            </label>
                            <input type="number" id="w1" value="0.2" step="0.1" class="input-base weight-input">
                        </div>
                        <div>
                            <label for="w2" class="block text-sm font-medium text-gray-700 mb-1">
                                L2 <span class="font-normal text-gray-500">(6-12ê°œì›”)</span>
                            </label>
                            <input type="number" id="w2" value="0.6" step="0.1" class="input-base weight-input">
                        </div>
                        <div>
                            <label for="w3" class="block text-sm font-medium text-gray-700 mb-1">
                                L3 <span class="font-normal text-gray-500">(1ë…„ ì´ìƒ)</span>
                            </label>
                            <input type="number" id="w3" value="1.0" step="0.1" class="input-base weight-input">
                        </div>
                    </div>
                </section>

                <!-- ì„±ê³¼ë³´ìƒ ëŒ€ìƒ ì¸ì› -->
                <section>
                    <h3 class="section-title">ì„±ê³¼ë³´ìƒ ëŒ€ìƒ ì¸ì› (T1-T6)</h3>
                    
                    <p class="text-sm text-gray-600 mb-4 -mt-3 p-3 bg-blue-50 rounded-md border border-blue-200">
                        <strong class="text-blue-800">ğŸ“Š ìë™ ê³„ì‚°:</strong> ì•„ë˜ ì¸ì›ì€ <strong>Tab 2 (ìŠˆí¼ìº£ ì¸ì› ê´€ë¦¬)</strong>ì˜ ì‹¤ì œ ì‚¬ì› ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
                        â€» Tab 2ì—ì„œ ì‚¬ì›ì„ ì¶”ê°€/ì‚­ì œ/ìˆ˜ì •í•˜ë©´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.<br>
                        â€» TierëŠ” ì—­ëŸ‰ì— ë”°ë¥¸ 6ë‹¨ê³„ êµ¬ë¶„ì´ë©°, ì´ ì¸ì› ëŒ€ë¹„ ë¹„ìœ¨ ì œí•œì´ ìˆìŠµë‹ˆë‹¤.<br>
                        - <span class="font-semibold">T1 (ìµœìƒìœ„):</span> ì´ ì¸ì›ì˜ 5% ë¯¸ë§Œ<br>
                        - <span class="font-semibold">T2 (ìƒìœ„):</span> ì´ ì¸ì›ì˜ 10% ë¯¸ë§Œ<br>
                        - <span class="font-semibold">T3 (ì¤‘ìƒìœ„):</span> ì´ ì¸ì›ì˜ 20% ë¯¸ë§Œ<br>
                        - <span class="font-semibold">T1+T2+T3 í•©ê³„:</span> ì´ ì¸ì›ì˜ 35% ì´í•˜
                    </p>
                    
                    <div id="headcountWarning" class="text-red-600 font-semibold my-3 p-3 bg-red-50 border border-red-200 rounded-md text-sm hidden">
                        <!-- ê²½ê³  ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤. -->
                    </div>

                    <div class="overflow-x-auto">
                        <table>
                            <thead>
                                <tr>
                                    <th>êµ¬ë¶„</th>
                                    <th>L1 <span class="font-normal text-gray-500">(6ê°œì›” ë¯¸ë§Œ)</span></th>
                                    <th>L2 <span class="font-normal text-gray-500">(6-12ê°œì›”)</span></th>
                                    <th>L3 <span class="font-normal text-gray-500">(1ë…„ ì´ìƒ)</span></th>
                                    <th class="bg-indigo-50">Tierë³„ ì´ ì¸ì›</th>
                                    <th class="bg-blue-50">ì¸ì› ë¹„ìœ¨ ë° ê²€ì¦</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- T1 -->
                                <tr>
                                    <td>T1 (1st Tier)</td>
                                    <td><input type="number" id="t1_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t1_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t1_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t1_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t1_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T2 -->
                                <tr>
                                    <td>T2 (2nd Tier)</td>
                                    <td><input type="number" id="t2_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t2_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t2_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t2_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t2_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T3 -->
                                <tr>
                                    <td>T3 (3rd Tier)</td>
                                    <td><input type="number" id="t3_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t3_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t3_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t3_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t3_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T4 -->
                                <tr>
                                    <td>T4 (ì¤‘í•˜ìœ„)</td>
                                    <td><input type="number" id="t4_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t4_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t4_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t4_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t4_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T5 -->
                                <tr>
                                    <td>T5 (í•˜ìœ„)</td>
                                    <td><input type="number" id="t5_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t5_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t5_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t5_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t5_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T6 -->
                                <tr>
                                    <td>T6 (ìµœí•˜ìœ„)</td>
                                    <td><input type="number" id="t6_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t6_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t6_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t6_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t6_validation" class="font-semibold">-</span></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="bg-gray-100 font-bold">
                                    <td>Levelë³„ ì´ ì¸ì›</td>
                                    <td class="text-gray-700"><span id="level_l1_total">0</span></td>
                                    <td class="text-gray-700"><span id="level_l2_total">0</span></td>
                                    <td class="text-gray-700"><span id="level_l3_total">0</span></td>
                                    <td class="bg-indigo-100 text-indigo-800 text-lg"><span id="headcount_grand_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t123_validation" class="font-semibold">-</span></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </section>

                <!-- ì‹œë®¬ë ˆì´ì…˜ ê¸°ì¤€ -->
                <section>
                    <h3 class="section-title">ì‹œë®¬ë ˆì´ì…˜ ê¸°ì¤€</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="periodSelect" class="block text-sm font-medium text-gray-700 mb-1">ê¸°ì¤€ ê¸°ê°„ ì„ íƒ</label>
                            <select id="periodSelect" class="input-base">
                                <option value="p1">Period 1</option>
                                <option value="p2">Period 2</option>
                                <option value="p3" selected>Period 3</option>
                                <option value="p4">Period 4</option>
                            </select>
                        </div>
                        <div>
                            <label for="launchBonusSlider" class="block text-sm font-medium text-gray-700 mb-1">
                                ì´ ëŸ°ì¹­ ë³´ë„ˆìŠ¤: <span id="launchBonusDisplay" class="font-bold text-indigo-600">8ì–µì›</span>
                            </label>
                            <input type="range" id="launchBonusSlider" min="1" max="50" value="8" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>
                    <div class="mt-6 p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡ ì„¤ì •</h4>
                        <div class="space-y-2">
                            <label for="leaderDiscretionSlider" class="block text-sm font-medium text-gray-700">
                                ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡: <span id="leaderDiscretionDisplay" class="font-bold text-yellow-600">0%</span> (ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ í’€ì˜ ë¹„ìœ¨)
                            </label>
                            <input type="range" id="leaderDiscretionSlider" min="0" max="15" value="0" step="0.5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <p class="text-sm text-gray-600 mt-2">
                                * ë¦¬ë”ê°€ ì¬ëŸ‰ìœ¼ë¡œ ë°°ë¶„í•  ìˆ˜ ìˆëŠ” ê¸ˆì•¡ì…ë‹ˆë‹¤. ì „ì²´ ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ í’€ì—ì„œ í•´ë‹¹ ë¹„ìœ¨ë§Œí¼ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ë¥¼ ìë™ ë°°ë¶„í•©ë‹ˆë‹¤.<br>
                                * ì˜ˆ: ì´ ì¸ì„¼í‹°ë¸Œ 100ì–µì›, ë¦¬ë” ì¬ëŸ‰ 10% â†’ 10ì–µì›ì€ ë¦¬ë” ì¬ëŸ‰, 90ì–µì›ì„ ìë™ ë°°ë¶„
                            </p>
                        </div>
                    </div>
                </section>

                <!-- ğŸ†• ë°°ë¶„ìœ¨ ì„¤ì • (ë¡œì§ ìˆ˜ì •) -->
                <section>
                    <h3 class="section-title">ë°°ë¶„ ì„¤ì •</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë°°ìœ¨ -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3 text-indigo-700">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ Tierê°„ ë°°ìœ¨ ì„¤ì •</h4>
                            <p class="text-sm text-gray-600 mb-4 -mt-1 p-3 bg-indigo-50 rounded-md">
                                â€» T6 ëŒ€ë¹„ ê° Tierì˜ í‰ê·  ë³´ìƒ ìˆ˜ì¤€(%)ì„ ì„¤ì •í•©ë‹ˆë‹¤. (L3 ê¸°ì¤€)<br>
                                â€» <strong class="text-indigo-600">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë°°ë¶„</strong>ì— ì ìš©ë©ë‹ˆë‹¤.<br>
                                â€» T7ì€ ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¹„ì°¸ì—¬ìì…ë‹ˆë‹¤.
                            </p>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t6_t5_rate" class="block text-sm font-medium text-gray-700 w-24">T6 â†’ T5</label>
                                    <input type="number" id="pi_t6_t5_rate" value="500" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t5_t4_rate" class="block text-sm font-medium text-gray-700 w-24">T5 â†’ T4</label>
                                    <input type="number" id="pi_t5_t4_rate" value="20" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t4_t3_rate" class="block text-sm font-medium text-gray-700 w-24">T4 â†’ T3</label>
                                    <input type="number" id="pi_t4_t3_rate" value="30" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t3_t2_rate" class="block text-sm font-medium text-gray-700 w-24">T3 â†’ T2</label>
                                    <input type="number" id="pi_t3_t2_rate" value="100" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t2_t1_rate" class="block text-sm font-medium text-gray-700 w-24">T2 â†’ T1</label>
                                    <input type="number" id="pi_t2_t1_rate" value="200" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë°°ìœ¨ -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3 text-green-700">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ Tierê°„ ë°°ìœ¨ ì„¤ì •</h4>
                            <p class="text-sm text-gray-600 mb-4 -mt-1 p-3 bg-green-50 rounded-md">
                                â€» T6 ëŒ€ë¹„ ê° Tierì˜ í‰ê·  ë³´ìƒ ìˆ˜ì¤€(%)ì„ ì„¤ì •í•©ë‹ˆë‹¤. (L3 ê¸°ì¤€)<br>
                                â€» <strong class="text-green-600">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë°°ë¶„(T1-T6)</strong>ì— ì ìš©ë©ë‹ˆë‹¤.<br>
                                â€» ì„±ê³¼ ì¸ì„¼í‹°ë¸Œë³´ë‹¤ ì™„ë§Œí•œ ë°°ìœ¨ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
                            </p>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t6_t5_rate" class="block text-sm font-medium text-gray-700 w-24">T6 â†’ T5</label>
                                    <input type="number" id="lb_t6_t5_rate" value="500" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t5_t4_rate" class="block text-sm font-medium text-gray-700 w-24">T5 â†’ T4</label>
                                    <input type="number" id="lb_t5_t4_rate" value="20" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t4_t3_rate" class="block text-sm font-medium text-gray-700 w-24">T4 â†’ T3</label>
                                    <input type="number" id="lb_t4_t3_rate" value="30" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t3_t2_rate" class="block text-sm font-medium text-gray-700 w-24">T3 â†’ T2</label>
                                    <input type="number" id="lb_t3_t2_rate" value="40" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t2_t1_rate" class="block text-sm font-medium text-gray-700 w-24">T2 â†’ T1</label>
                                    <input type="number" id="lb_t2_t1_rate" value="50" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                </section>
                <!-- collapsible-content ë‹«ê¸° -->
            </div>
        </div>

        <!-- ################### -->
        <!-- STEP 3: ìµœì¢… ë°°ë¶„ ê²°ê³¼ -->
        <!-- ################### -->
        <div class="card">
            <h2 class="step-title">Step 3: ìµœì¢… ë°°ë¶„ ê²°ê³¼</h2>
            <div class="card-content space-y-6">
                <!-- í•µì‹¬ ìš”ì•½ -->
                <section>
                    <h3 class="section-title">í•µì‹¬ ìš”ì•½ (KPI)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div class="kpi-box">
                            <div class="kpi-title">ì´ ì¸ì„¼í‹°ë¸Œ ì¬ì›</div>
                            <div id="totalIncentivePool" class="kpi-value">-</div>
                        </div>
                        <div class="kpi-box bg-yellow-50">
                            <div class="kpi-title">ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡</div>
                            <div id="leaderDiscretionAmountDisplay" class="kpi-value text-yellow-700">-</div>
                        </div>
                        <div class="kpi-box bg-green-50">
                            <div class="kpi-title">ìë™ ë°°ë¶„ ê¸ˆì•¡</div>
                            <div id="distributionIncentivePoolDisplay" class="kpi-value text-green-700">-</div>
                        </div>
                        <div class="kpi-box">
                            <div class="kpi-title">ëˆ„ì  ROI (ê¸°ì¤€ ê¸°ê°„)</div>
                            <div id="calculatedROI" class="kpi-value">-</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="kpi-box">
                            <div class="kpi-title">ì¸ì„¼ ë¹„ìœ¨ (ê¸°ì¤€ ê¸°ê°„)</div>
                            <div id="calculatedIncentiveRate" class="kpi-value">-</div>
                        </div>
                        <div class="kpi-box">
                            <div class="kpi-title">ì´ ëŸ°ì¹­ ë³´ë„ˆìŠ¤</div>
                            <div id="lb_total_incentive_distributed" class="kpi-value">-</div>
                        </div>
                    </div>
                    
                    <!-- ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¶„í•  ì§€ê¸‰ -->
                    <div class="mt-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-3 text-center">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¶„í•  ì§€ê¸‰ ê³„íš</h4>
                        <p class="text-sm text-gray-600 mb-3 text-center">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ëŠ” 2íšŒì— ê±¸ì³ ë¶„í•  ì§€ê¸‰ë©ë‹ˆë‹¤ (1ì°¨ 66.67%, 2ì°¨ 33.33%)</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="kpi-box bg-white">
                                <div class="kpi-title text-sm">1ì°¨: 12ì›”ë§ + IBT í›„ ì§€ê¸‰ (66.67%)</div>
                                <div id="lb_payment_1" class="kpi-value text-lg">-</div>
                            </div>
                            <div class="kpi-box bg-white">
                                <div class="kpi-title text-sm">2ì°¨: ëŸ°ì¹­ì‹œ ì§€ê¸‰ (33.33%)</div>
                                <div id="lb_payment_2" class="kpi-value text-lg">-</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ìš”ì•½ í…ìŠ¤íŠ¸ ë° ë¹„ì°¸ì—¬ì -->
                <section>
                    <h3 class="section-title">ì¸ì› ìš”ì•½</h3>
                    <div class="p-4 bg-gray-50 rounded-lg mb-4 grid grid-cols-2 gap-4">
                        <p class="text-sm font-medium text-gray-700">
                            ì´ ì°¸ì—¬ì¸ì› (T1-T6): 
                            <span id="dynamic_total_headcount" class="font-bold text-lg text-indigo-600">0</span>ëª…
                        </p>
                        <p class="text-sm font-medium text-gray-700">
                            ì„±ê³¼ë³´ìƒ + ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ëŒ€ìƒ (T1-T6): 
                            <span id="dynamic_target_count" class="font-bold text-lg text-indigo-600">0</span>ëª…
                        </p>
                    </div>
                </section>

                <!-- ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë°°ë¶„ ê²°ê³¼ -->
                <section>
                    <h3 class="section-title">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë°°ë¶„ ê²°ê³¼ (T1-T6)</h3>
                    
                    <p class="text-sm text-gray-600 mb-4 -mt-3 p-3 bg-gray-50 rounded-md">
                        â€» <strong>Tier ë°°ìœ¨ ë¡œì§ ì ìš©:</strong> ì´ ì¬ì›ì„ T6-L3(ê¸°ì¤€ 1.0) ëŒ€ë¹„ Tierë³„ ì„¤ì •ëœ ë°°ìœ¨(ì˜ˆ: T5ëŠ” T6ë³´ë‹¤ 300% ë” ë°›ìŒ)ê³¼ Level ê°€ì¤‘ì¹˜ë¥¼ í•©ì‚°í•œ 'ì´ ë³´ìƒ ìœ ë‹›'ìœ¼ë¡œ ë‚˜ëˆˆ "ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡"ì„ ì‚°ì •í•©ë‹ˆë‹¤. ê°œì¸ë³„ ì§€ê¸‰ì•¡ì€ (ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡ * Tierë°°ìœ¨ * Levelê°€ì¤‘ì¹˜)ë¡œ ê³„ì‚°ë˜ì–´ "ì—­ì „ í˜„ìƒ"ì„ ë°©ì§€í•©ë‹ˆë‹¤.<br>
                        â€» <strong>[v5.1.3b] L2 ìµœì†Œ ë³´ìƒ ë³´ì •:</strong> `í•˜ìœ„ Tier L3` ì§€ê¸‰ì•¡ ëŒ€ë¹„ `í˜„ì¬ Tier L2` ì§€ê¸‰ì•¡ì´ 10% ì´ìƒì´ ë˜ë„ë¡ ë³´ìƒ ìœ ë‹›ì„ ìƒí–¥ ë³´ì •í•©ë‹ˆë‹¤.<br>
                        â€» <strong>ë¹„ìœ¨ í‘œì‹œ:</strong> ê° ì…€ì˜ ê´„í˜¸ ì•ˆ ë¹„ìœ¨ì€ <span class="font-bold text-indigo-600">T6-L3ë¥¼ 100%ë¡œ í•˜ëŠ” ì ˆëŒ€ ë°°ìœ¨</span>ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì˜ˆ: (400%) = T6-L3 ëŒ€ë¹„ 400% ìˆ˜ì¤€ (T5-L3), (100%) = T6-L3 ê¸°ì¤€
                    </p>

                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th>êµ¬ë¶„</th>
                                    <th>ì´ ì¸ì›</th>
                                    <th>ì´ì•¡ (ì›)</th>
                                    <th>L1 (1ì¸ë‹¹)</th>
                                    <th>L2 (1ì¸ë‹¹)</th>
                                    <th>L3 (1ì¸ë‹¹)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>T1 (1st Tier)</td>
                                    <td><span id="t1_total_count">-</span></td>
                                    <td><span id="t1_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t1_l1_value" class="calc-output">-</span><span id="t1_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t1_l2_value" class="calc-output">-</span><span id="t1_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t1_l3_value" class="calc-output">-</span><span id="t1_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T2 (2nd Tier)</td>
                                    <td><span id="t2_total_count">-</span></td>
                                    <td><span id="t2_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t2_l1_value" class="calc-output">-</span><span id="t2_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t2_l2_value" class="calc-output">-</span><span id="t2_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t2_l3_value" class="calc-output">-</span><span id="t2_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T3 (3rd Tier)</td>
                                    <td><span id="t3_total_count">-</span></td>
                                    <td><span id="t3_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t3_l1_value" class="calc-output">-</span><span id="t3_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t3_l2_value" class="calc-output">-</span><span id="t3_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t3_l3_value" class="calc-output">-</span><span id="t3_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T4 (ì¼ë°˜ íŒ€ì›)</td>
                                    <td><span id="t4_total_count">-</span></td>
                                    <td><span id="t4_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t4_l1_value" class="calc-output">-</span><span id="t4_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t4_l2_value" class="calc-output">-</span><span id="t4_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t4_l3_value" class="calc-output">-</span><span id="t4_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T5 (Base)</td>
                                    <td><span id="t5_total_count">-</span></td>
                                    <td><span id="t5_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t5_l1_value" class="calc-output">-</span><span id="t5_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t5_l2_value" class="calc-output">-</span><span id="t5_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t5_l3_value" class="calc-output">-</span><span id="t5_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T6 (ìµœí•˜ìœ„)</td>
                                    <td><span id="t6_total_count">-</span></td>
                                    <td><span id="t6_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t6_l1_value" class="calc-output">-</span><span id="t6_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t6_l2_value" class="calc-output">-</span><span id="t6_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t6_l3_value" class="calc-output">-</span><span id="t6_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="bg-gray-100">
                                    <td>T1+T2 í•©ê³„</td>
                                    <td><span id="total_ppl_t1_t2">-</span></td>
                                    <td>
                                        <span id="total_incentive_t1_t2" class="calc-output-lg">-</span>
                                        (<span id="total_incentive_t1_t2_perc" class="font-bold text-indigo-600">-</span>)
                                    </td>
                                    <td colspan="3" class="text-gray-500 font-normal text-right">T1+T2 ì¬ì› ì ìœ ìœ¨</td>
                                </tr>
                                <tr class="bg-gray-200">
                                    <td>ì „ì²´ í•©ê³„ (T1-T6)</td>
                                    <td><span id="total_ppl_incentive">-</span></td>
                                    <td><span id="total_incentive_distributed" class="calc-output-lg">-</span></td>
                                    <td colspan="3" class="text-gray-500 font-normal text-right">ì´ ë°°ë¶„ì•¡ (100%)</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </section>
                
                <!-- ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë°°ë¶„ ê²°ê³¼ -->
                <section>
                    <h3 class="section-title">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë°°ë¶„ ê²°ê³¼</h3>
                    <div class="space-y-8">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">ì°¸ì—¬ì ë°°ë¶„ (T1-T6)</h4>
                            <p class="text-sm text-gray-600 mb-4 p-3 bg-gray-50 rounded-md">
                                â€» <strong>Tier ë°°ìœ¨ ë¡œì§ ë™ì¼ ì ìš©:</strong> ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë˜í•œ ì„±ê³¼ ì¸ì„¼í‹°ë¸Œì™€ ë™ì¼í•œ Tier ë°°ìœ¨ ë¡œì§ì„ ë”°ë¦…ë‹ˆë‹¤.<br>
                                â€» <strong>ë¹„ìœ¨ í‘œì‹œ:</strong> ê° ì…€ì˜ ê´„í˜¸ ì•ˆ ë¹„ìœ¨ì€ <span class="font-bold text-indigo-600">T6-L3ë¥¼ 100%ë¡œ í•˜ëŠ” ì ˆëŒ€ ë°°ìœ¨</span>ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
                            </p>
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr>
                                            <th>êµ¬ë¶„</th>
                                            <th>ì´ ì¸ì›</th>
                                            <th>ì´ì•¡ (ì›)</th>
                                            <th>L1 (1ì¸ë‹¹)</th>
                                            <th>L2 (1ì¸ë‹¹)</th>
                                            <th>L3 (1ì¸ë‹¹)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>T1 (1st Tier)</td>
                                            <td><span id="lb_t1_total_count">-</span></td>
                                            <td><span id="lb_t1_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t1_l1_value" class="calc-output">-</span><span id="lb_t1_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t1_l2_value" class="calc-output">-</span><span id="lb_t1_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t1_l3_value" class="calc-output">-</span><span id="lb_t1_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T2 (2nd Tier)</td>
                                            <td><span id="lb_t2_total_count">-</span></td>
                                            <td><span id="lb_t2_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t2_l1_value" class="calc-output">-</span><span id="lb_t2_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t2_l2_value" class="calc-output">-</span><span id="lb_t2_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t2_l3_value" class="calc-output">-</span><span id="lb_t2_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T3 (3rd Tier)</td>
                                            <td><span id="lb_t3_total_count">-</span></td>
                                            <td><span id="lb_t3_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t3_l1_value" class="calc-output">-</span><span id="lb_t3_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t3_l2_value" class="calc-output">-</span><span id="lb_t3_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t3_l3_value" class="calc-output">-</span><span id="lb_t3_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T4 (ì¼ë°˜ íŒ€ì›)</td>
                                            <td><span id="lb_t4_total_count">-</span></td>
                                            <td><span id="lb_t4_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t4_l1_value" class="calc-output">-</span><span id="lb_t4_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t4_l2_value" class="calc-output">-</span><span id="lb_t4_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t4_l3_value" class="calc-output">-</span><span id="lb_t4_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T5 (Base)</td>
                                            <td><span id="lb_t5_total_count">-</span></td>
                                            <td><span id="lb_t5_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t5_l1_value" class="calc-output">-</span><span id="lb_t5_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t5_l2_value" class="calc-output">-</span><span id="lb_t5_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t5_l3_value" class="calc-output">-</span><span id="lb_t5_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T6 (ìµœí•˜ìœ„)</td>
                                            <td><span id="lb_t6_total_count">-</span></td>
                                            <td><span id="lb_t6_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t6_l1_value" class="calc-output">-</span><span id="lb_t6_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t6_l2_value" class="calc-output">-</span><span id="lb_t6_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t6_l3_value" class="calc-output">-</span><span id="lb_t6_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr class="bg-gray-100">
                                            <td>T1+T2 í•©ê³„</td>
                                            <td><span id="lb_total_ppl_t1_t2">-</span></td>
                                            <td>
                                                <span id="lb_total_incentive_t1_t2" class="calc-output-lg">-</span>
                                                (<span id="lb_total_incentive_t1_t2_perc" class="font-bold text-indigo-600">-</span>)
                                            </td>
                                            <td colspan="3" class="text-gray-500 font-normal text-right">T1+T2 ì¬ì› ì ìœ ìœ¨</td>
                                        </tr>
                                        <tr class="bg-gray-200">
                                            <td>ì „ì²´ í•©ê³„ (T1-T6)</td>
                                            <td><span id="lb_total_ppl_incentive">-</span></td>
                                            <td><span id="lb_total_distributed" class="calc-output-lg">-</span></td>
                                            <td colspan="3" class="text-gray-500 font-normal text-right">ì´ ë°°ë¶„ì•¡ (100%)</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>

                        <!-- T7 (ë¹„ì°¸ì—¬ì) - ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¹„ì°¸ì—¬ -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">ë¹„ì°¸ì—¬ì ë°°ë¶„ (T7) - <span class="text-red-600">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¯¸ì§€ê¸‰ ëŒ€ìƒ</span></h4>
                            <div class="mb-4 space-y-3 p-3 bg-red-50 rounded-md border border-red-200">
                                <!-- ìŠ¬ë¼ì´ë” ë° ì„¤ëª… í…ìŠ¤íŠ¸ ì¶”ê°€ -->
                                <div>
                                    <label for="lb_t7_pool_rate_slider" class="block text-sm font-medium text-gray-700 mb-1">
                                        T7 í• ë‹¹ ë¹„ìœ¨: <span id="lb_t7_pool_rate_display" class="font-bold text-indigo-600">0%</span> (0% ~ 30%)
                                    </label>
                                    <input type="range" id="lb_t7_pool_rate_slider" min="0" max="30" value="0" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" disabled>
                                </div>
                                <p class="text-sm text-gray-600">
                                    * <strong class="text-red-600">T7ì€ ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¹„ì°¸ì—¬ìì…ë‹ˆë‹¤. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ê°€ ì§€ê¸‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong><br>
                                    * ì°¸ê³ : ì´ì „ ë²„ì „ì˜ T5 ë¹„ì°¸ì—¬ì ì„¤ì •ì€ í˜„ì¬ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                                </p>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Level</th>
                                            <th>ë°°ë¶„ ëŒ€ìƒ ì¸ì›</th>
                                            <th>1ì¸ë‹¹ ì§€ê¸‰ì•¡ (ì›)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>L1 <span class="font-normal text-gray-500">(6ê°œì›” ë¯¸ë§Œ)</span></td>
                                            <td><input type="number" id="lb_t7_l1" value="0" class="t5-input-in-table" readonly disabled></td>
                                            <td><span id="lb_t7_l1_value" class="calc-output">â‚©0</span><span id="lb_t7_l1_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>L2 <span class="font-normal text-gray-500">(6-12ê°œì›”)</span></td>
                                            <td><input type="number" id="lb_t7_l2" value="0" class="t5-input-in-table" readonly disabled></td>
                                            <td><span id="lb_t7_l2_value" class="calc-output">â‚©0</span><span id="lb_t7_l2_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>L3 <span class="font-normal text-gray-500">(1ë…„ ì´ìƒ)</span></td>
                                            <td><input type="number" id="lb_t7_l3" value="0" class="t5-input-in-table" readonly disabled></td>
                                            <td><span id="lb_t7_l3_value" class="calc-output">â‚©0</span><span id="lb_t7_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td>ë¹„ì°¸ì—¬ì í•©ê³„</td>
                                            <td><span id="lb_t7_total_ppl">0</span></td> 
                                            <td><span id="lb_t7_total" class="calc-output-lg">â‚©0</span></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
        </div><!-- End of tab1-content -->

        <!-- Tab 2 Content -->
        <div id="tab2-content" class="hidden">
            <div class="card">
                <h2 class="step-title">ì¸ì› ê´€ë¦¬</h2>
                <div class="card-content space-y-6">
                    <!-- ë‚ ì§œ ì„ íƒ -->
                    <section>
                        <h3 class="section-title">ê¸°ì¤€ ì¼ì ì„¤ì •</h3>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label for="baseYear" class="block text-sm font-medium text-gray-700 mb-1">ë…„ë„</label>
                                <select id="baseYear" class="input-base">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div>
                                <label for="baseMonth" class="block text-sm font-medium text-gray-700 mb-1">ì›”</label>
                                <select id="baseMonth" class="input-base">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div>
                                <label for="baseDay" class="block text-sm font-medium text-gray-700 mb-1">ì¼</label>
                                <select id="baseDay" class="input-base">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </section>

                    <!-- CSV íŒŒì¼ ì—…ë¡œë“œ -->
                    <section>
                        <h3 class="section-title">CSV íŒŒì¼ë¡œ ì¸ì› ì¼ê´„ ì¶”ê°€</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="csvFile" class="block text-sm font-medium text-gray-700 mb-1">CSV íŒŒì¼ ì„ íƒ</label>
                                <input type="file" id="csvFile" accept=".csv" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-md file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-indigo-50 file:text-indigo-600
                                    hover:file:bg-indigo-100">
                            </div>
                            <div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-md">
                                <p class="font-semibold mb-2">CSV íŒŒì¼ í˜•ì‹:</p>
                                <p>NO,ì‚¬ë²ˆ,ì´ë¦„,Tier,ê·¸ë£¹ì…ì‚¬ì¼,OQ í•©ë¥˜ì¼,ì—°ë´‰,ì›”ê¸‰</p>
                                <p class="mt-2">â€» ì²« ë‘ ì¤„ì€ ì œëª©/í—¤ë”ë¡œ ìë™ ê±´ë„ˆëœë‹ˆë‹¤.</p>
                                <p class="mt-1">â€» ì—°ë´‰ê³¼ ì›”ê¸‰ì€ ì‰¼í‘œë¥¼ í¬í•¨í•œ ìˆ«ì(ì˜ˆ: "61,400,000") ë˜ëŠ” ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                            </div>
                            <div class="flex gap-4">
                                <button id="importCSV" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors">
                                    CSV íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
                                </button>
                                <button id="exportCSV" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors">
                                    CSV íŒŒì¼ ë‚´ë³´ë‚´ê¸°
                                </button>
                            </div>
                        </div>
                    </section>

                    <!-- ì¸ì› ì¶”ê°€ -->
                    <section>
                        <h3 class="section-title">ì‹ ê·œ ì¸ì› ì¶”ê°€</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label for="newEmpId" class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ë²ˆ</label>
                                <input type="text" id="newEmpId" class="input-base" placeholder="SP000">
                            </div>
                            <div>
                                <label for="newEmpName" class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„</label>
                                <input type="text" id="newEmpName" class="input-base" placeholder="í™ê¸¸ë™">
                            </div>
                            <div>
                                <label for="newEmpTier" class="block text-sm font-medium text-gray-700 mb-1">Tier</label>
                                <select id="newEmpTier" class="input-base">
                                    <option value="1">T1</option>
                                    <option value="2">T2</option>
                                    <option value="3">T3</option>
                                    <option value="4">T4</option>
                                </select>
                            </div>
                            <div>
                                <label for="newEmpJoinDate" class="block text-sm font-medium text-gray-700 mb-1">í•©ë¥˜ì¼</label>
                                <input type="date" id="newEmpJoinDate" class="input-base">
                            </div>
                        </div>
                        <div class="mt-4">
                            <button id="addEmployee" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors">
                                ì¸ì› ì¶”ê°€
                            </button>
                        </div>
                    </section>

                    <!-- ì¸ì› ëª©ë¡ -->
                    <section>
                        <h3 class="section-title">ì¸ì› ëª©ë¡</h3>
                        
                        <!-- ê²€ìƒ‰ ë° ì •ë ¬ ì˜µì…˜ -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label for="searchName" class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„ ê²€ìƒ‰</label>
                                <input type="text" id="searchName" class="input-base" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                            <div>
                                <label for="tierFilter" class="block text-sm font-medium text-gray-700 mb-1">Tier í•„í„°</label>
                                <select id="tierFilter" class="input-base">
                                    <option value="all">ì „ì²´</option>
                                    <option value="1">T1ë§Œ ë³´ê¸°</option>
                                    <option value="2">T2ë§Œ ë³´ê¸°</option>
                                    <option value="3">T3ë§Œ ë³´ê¸°</option>
                                    <option value="4">T4ë§Œ ë³´ê¸°</option>
                                    <option value="5">T5ë§Œ ë³´ê¸°</option>
                                    <option value="6">T6ë§Œ ë³´ê¸°</option>
                                </select>
                            </div>
                            <div>
                                <label for="teamFilter" class="block text-sm font-medium text-gray-700 mb-1">íŒ€ í•„í„°</label>
                                <select id="teamFilter" class="input-base">
                                    <option value="all">ì „ì²´</option>
                                </select>
                            </div>
                            <div>
                                <label for="partFilter" class="block text-sm font-medium text-gray-700 mb-1">íŒŒíŠ¸ í•„í„°</label>
                                <select id="partFilter" class="input-base">
                                    <option value="all">ì „ì²´</option>
                                </select>
                            </div>
                            <div>
                                <label for="positionFilter" class="block text-sm font-medium text-gray-700 mb-1">ì§ì±… í•„í„°</label>
                                <select id="positionFilter" class="input-base">
                                    <option value="all">ì „ì²´</option>
                                </select>
                            </div>
                            <div>
                                <label for="detailRoleFilter" class="block text-sm font-medium text-gray-700 mb-1">ìƒì„¸ì§êµ° í•„í„°</label>
                                <select id="detailRoleFilter" class="input-base">
                                    <option value="all">ì „ì²´</option>
                                </select>
                            </div>
                            <div>
                                <label for="sortOrder" class="block text-sm font-medium text-gray-700 mb-1">Tier ì •ë ¬</label>
                                <select id="sortOrder" class="input-base">
                                    <option value="none">ì •ë ¬ ì•ˆí•¨</option>
                                    <option value="asc">ì˜¤ë¦„ì°¨ìˆœ (T1 â†’ T6)</option>
                                    <option value="desc">ë‚´ë¦¼ì°¨ìˆœ (T6 â†’ T1)</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button id="resetFilters" class="w-full bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors">
                                    ì´ˆê¸°í™”
                                </button>
                            </div>
                        </div>
                        
                        <!-- ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ -->
                        <div id="searchResults" class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md text-sm text-gray-700 hidden">
                            <span id="searchResultText"></span>
                        </div>

                        <!-- ì¸ì„¼í‹°ë¸Œ í™•ì • ë° CSV ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ -->
                        <div class="mb-4 flex gap-3">
                            <button id="lockIncentives" class="bg-indigo-600 text-white px-6 py-2.5 rounded-md hover:bg-indigo-700 transition-colors font-semibold shadow-md">
                                ğŸ’ ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ í™•ì •
                            </button>
                            <button id="exportLaunchBonusCSV" class="bg-green-600 text-white px-6 py-2.5 rounded-md hover:bg-green-700 transition-colors font-semibold shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                                ğŸ“Š CSV ë‚´ë³´ë‚´ê¸°
                            </button>
                            <div id="lockStatus" class="flex items-center text-sm text-gray-600 ml-2 hidden">
                                <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤
                            </div>
                        </div>

                        <!-- CSV ë‚´ë³´ë‚¼ ë°ì´í„° ì„ íƒ -->
                        <div id="csvExportOptions" class="mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200 hidden">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">ğŸ“‹ ë‚´ë³´ë‚¼ ë°ì´í„° ì„ íƒ</h4>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_id" class="csv-export-checkbox" checked>
                                    <span class="text-sm text-gray-700">ì‚¬ë²ˆ</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_name" class="csv-export-checkbox" checked>
                                    <span class="text-sm text-gray-700">ì´ë¦„</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_tier" class="csv-export-checkbox" checked>
                                    <span class="text-sm text-gray-700">Tier</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_team" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">íŒ€</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_part" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">íŒŒíŠ¸</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_position" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">ì§ì±…</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_detailRole" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">ìƒì„¸ì§êµ°</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_launchBonusTotal" class="csv-export-checkbox" checked>
                                    <span class="text-sm text-gray-700">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ì´ì•¡</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_launchBonusPayment1" class="csv-export-checkbox" checked>
                                    <span class="text-sm text-gray-700">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 1ì°¨ ì§€ê¸‰</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_launchBonusPayment2" class="csv-export-checkbox" checked>
                                    <span class="text-sm text-gray-700">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 2ì°¨ ì§€ê¸‰</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_level" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">Level</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_joinDate" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">í”„ë¡œì íŠ¸ í•©ë¥˜ì¼</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_salary" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">ì—°ë´‰</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_monthlySalary" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">ì›”ê¸‰</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_incentive" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_incentiveRatio" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_launchBonusRatio" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¹„ìœ¨</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_launchBonusPayment1Ratio" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 1ì°¨ ì§€ê¸‰ ë¹„ìœ¨</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="csv_export_launchBonusPayment2Ratio" class="csv-export-checkbox">
                                    <span class="text-sm text-gray-700">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 2ì°¨ ì§€ê¸‰ ë¹„ìœ¨</span>
                                </label>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th class="text-center" rowspan="2">ìˆœë²ˆ</th>
                                        <th class="text-center" rowspan="2">ì‚¬ë²ˆ</th>
                                        <th class="text-center" rowspan="2">ì´ë¦„</th>
                                        <th class="text-center" rowspan="2">íŒ€</th>
                                        <th class="text-center" rowspan="2">íŒŒíŠ¸</th>
                                        <th class="text-center" rowspan="2">ì§ì±…</th>
                                        <th class="text-center" rowspan="2">ìƒì„¸ì§êµ°</th>
                                        <th class="text-center" rowspan="2">Tier</th>
                                        <th class="text-center" rowspan="2">í”„ë¡œì íŠ¸ í•©ë¥˜ì¼</th>
                                        <th class="text-center" rowspan="2">Level</th>
                                        <th class="text-right" rowspan="2">ì—°ë´‰</th>
                                        <th class="text-right" rowspan="2">ì›”ê¸‰</th>
                                        <th class="text-right" rowspan="2">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ</th>
                                        <th class="text-right" rowspan="2">ì›”ê¸‰ ëŒ€ë¹„<br>ì„±ê³¼ê¸‰ ë°°ìˆ˜</th>
                                        <th class="text-right" colspan="6">ëŸ°ì¹­ ë³´ë„ˆìŠ¤</th>
                                        <th class="text-center" rowspan="2">ê´€ë¦¬</th>
                                    </tr>
                                    <tr>
                                        <th class="text-right bg-blue-50">ì´ì•¡</th>
                                        <th class="text-right bg-blue-50">ë°°ìˆ˜</th>
                                        <th class="text-right bg-blue-50">1ì°¨(66.67%)</th>
                                        <th class="text-right bg-blue-50">1ì°¨ ë°°ìˆ˜</th>
                                        <th class="text-right bg-blue-50">2ì°¨(33.33%)</th>
                                        <th class="text-right bg-blue-50">2ì°¨ ë°°ìˆ˜</th>
                                    </tr>
                                </thead>
                                <tbody id="employeeTableBody">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                                <tfoot>
                                    <tr class="bg-gray-100">
                                        <td colspan="10" class="text-right font-bold">í•©ê³„:</td>
                                        <td class="text-right font-bold" id="total_salary">-</td>
                                        <td class="text-right font-bold" id="total_monthly">-</td>
                                        <td class="text-right font-bold" id="total_incentive">-</td>
                                        <td class="text-right font-bold" id="total_ratio">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus_ratio">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus_payment1">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus_payment1_ratio">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus_payment2">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus_payment2_ratio">-</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            ì´ <span id="displayedCount" class="font-bold text-indigo-600">0</span>ëª… í‘œì‹œ ì¤‘
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- Tab 3 Content: ë°ì´í„° ê²€ì¦ -->
        <div id="tab3-content" class="hidden">
            <!-- ë°ì´í„° ì—†ìŒ íŒì—… ëª¨ë‹¬ -->
            <div id="noDataModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm" onclick="closeNoDataModal()">
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all" onclick="event.stopPropagation()">
                    <div class="p-8">
                        <!-- ì•„ì´ì½˜ -->
                        <div class="flex justify-center mb-6">
                            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center">
                                <svg class="w-12 h-12 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                            </div>
                        </div>
                        
                        <!-- ë©”ì‹œì§€ -->
                        <div class="text-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-900 mb-3">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p class="text-gray-600 leading-relaxed">
                                ë°ì´í„° ê²€ì¦ì„ í•˜ê¸° ìœ„í•´ì„œëŠ”<br>
                                <span class="font-bold text-indigo-600">[ìŠˆí¼ìº£ ì¸ì›ê´€ë¦¬]</span> íƒ­ì—ì„œ<br>
                                <span class="font-bold text-indigo-600">[ì¸ì„¼í‹°ë¸Œ ì¸ì› í™•ì •]</span> ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼<br>
                                ë°ì´í„° ê²€ì¦ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                            </p>
                        </div>
                        
                        <!-- ë²„íŠ¼ -->
                        <div class="flex justify-center">
                            <button onclick="closeNoDataModal()" class="bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-semibold shadow-md">
                                í™•ì¸
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìƒë‹¨ í—¤ë” -->
            <div class="bg-white border-b border-gray-200 shadow-sm mb-6">
                <div class="px-8 py-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">ğŸ” ë°ì´í„° ê²€ì¦</h1>
                            <p class="text-gray-600 mt-1">í™•ì •ëœ ì¸ì„¼í‹°ë¸Œ ë°ì´í„°ì˜ ì •í•©ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <span id="verificationStatus" class="px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-600">
                                ë¯¸ê²€ì¦
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê²€ì¦ ê¸°ì¤€ ì •ë³´ -->
            <div class="card">
                <h2 class="step-title">ğŸ“Š ê²€ì¦ ê¸°ì¤€ ì •ë³´</h2>
                <div class="card-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Level ë°°ìˆ˜ -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-semibold text-gray-700 mb-3">Level ë°°ìˆ˜ (ê·¼ì† ê¸°ê°„ ê¸°ì¤€)</h3>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="bg-white p-3 rounded border text-center">
                                    <div class="text-xs text-gray-500">L1 (6ê°œì›” ë¯¸ë§Œ)</div>
                                    <div id="verify_weight_l1" class="text-xl font-bold text-indigo-600">0.2</div>
                                </div>
                                <div class="bg-white p-3 rounded border text-center">
                                    <div class="text-xs text-gray-500">L2 (6-12ê°œì›”)</div>
                                    <div id="verify_weight_l2" class="text-xl font-bold text-indigo-600">0.6</div>
                                </div>
                                <div class="bg-white p-3 rounded border text-center">
                                    <div class="text-xs text-gray-500">L3 (1ë…„ ì´ìƒ)</div>
                                    <div id="verify_weight_l3" class="text-xl font-bold text-indigo-600">1.0</div>
                                </div>
                            </div>
                        </div>

                        <!-- Tier ê°„ ì¦ê°€ìœ¨ (%) -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-semibold text-gray-700 mb-3">Tier ê°„ ì¦ê°€ìœ¨ (%)</h3>
                            <div class="grid grid-cols-5 gap-2">
                                <div class="bg-white p-2 rounded border text-center">
                                    <div class="text-xs text-gray-500">T6â†’T5</div>
                                    <div id="verify_rate_t6_t5" class="text-lg font-bold text-indigo-600">-</div>
                                </div>
                                <div class="bg-white p-2 rounded border text-center">
                                    <div class="text-xs text-gray-500">T5â†’T4</div>
                                    <div id="verify_rate_t5_t4" class="text-lg font-bold text-indigo-600">-</div>
                                </div>
                                <div class="bg-white p-2 rounded border text-center">
                                    <div class="text-xs text-gray-500">T4â†’T3</div>
                                    <div id="verify_rate_t4_t3" class="text-lg font-bold text-indigo-600">-</div>
                                </div>
                                <div class="bg-white p-2 rounded border text-center">
                                    <div class="text-xs text-gray-500">T3â†’T2</div>
                                    <div id="verify_rate_t3_t2" class="text-lg font-bold text-indigo-600">-</div>
                                </div>
                                <div class="bg-white p-2 rounded border text-center">
                                    <div class="text-xs text-gray-500">T2â†’T1</div>
                                    <div id="verify_rate_t2_t1" class="text-lg font-bold text-indigo-600">-</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- í™•ì • ì´ì•¡ -->
                    <div class="mt-6 bg-indigo-50 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-sm text-indigo-700">í™•ì •ëœ ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ì´ì•¡</span>
                                <div id="verify_total_bonus" class="text-2xl font-bold text-indigo-900">-</div>
                            </div>
                            <div>
                                <span class="text-sm text-indigo-700">í™•ì • ì¸ì›</span>
                                <div id="verify_total_count" class="text-2xl font-bold text-indigo-900">-ëª…</div>
                            </div>
                            <div>
                                <span class="text-sm text-indigo-700">ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡</span>
                                <div id="verify_master_base" class="text-2xl font-bold text-indigo-900">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê²€ì¦ ê²°ê³¼ ìš”ì•½ -->
            <div class="card">
                <h2 class="step-title">âœ… ê²€ì¦ ê²°ê³¼ ìš”ì•½</h2>
                <div class="card-content">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- ì´ì•¡ ì¼ì¹˜ ê²€ì¦ -->
                        <div id="verifyCard_total" class="bg-gray-50 rounded-lg p-4 border-2 border-gray-200">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold text-gray-700">ì´ì•¡ ì¼ì¹˜ ê²€ì¦</span>
                                <span id="verify_total_status" class="px-2 py-1 rounded text-xs font-semibold bg-gray-200 text-gray-600">ëŒ€ê¸°</span>
                            </div>
                            <div class="space-y-1 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">ì˜ˆìƒ ì´ì•¡:</span>
                                    <span id="verify_expected_total" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">ì‹¤ì œ ì´ì•¡:</span>
                                    <span id="verify_actual_total" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">ì°¨ì´:</span>
                                    <span id="verify_total_diff" class="font-medium">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- ë°°ìˆ˜ ì ìš© ê²€ì¦ -->
                        <div id="verifyCard_multiplier" class="bg-gray-50 rounded-lg p-4 border-2 border-gray-200">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold text-gray-700">ë°°ìˆ˜ ì ìš© ê²€ì¦</span>
                                <span id="verify_multiplier_status" class="px-2 py-1 rounded text-xs font-semibold bg-gray-200 text-gray-600">ëŒ€ê¸°</span>
                            </div>
                            <div class="space-y-1 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">ê²€ì¦ ëŒ€ìƒ:</span>
                                    <span id="verify_multiplier_count" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">í†µê³¼:</span>
                                    <span id="verify_multiplier_pass" class="font-medium text-green-600">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">ì‹¤íŒ¨:</span>
                                    <span id="verify_multiplier_fail" class="font-medium text-red-600">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- ì „ì²´ í†µê³¼ìœ¨ -->
                        <div id="verifyCard_overall" class="bg-gray-50 rounded-lg p-4 border-2 border-gray-200">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold text-gray-700">ì „ì²´ ê²€ì¦ ê²°ê³¼</span>
                                <span id="verify_overall_status" class="px-2 py-1 rounded text-xs font-semibold bg-gray-200 text-gray-600">ëŒ€ê¸°</span>
                            </div>
                            <div class="text-center py-2">
                                <div id="verify_overall_rate" class="text-4xl font-bold text-gray-400">-</div>
                                <div class="text-sm text-gray-500">ê²€ì¦ í†µê³¼ìœ¨</div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 flex justify-center">
                        <button id="runVerificationBtn" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-semibold shadow-md">
                            ğŸ” ì „ì²´ ê²€ì¦ ì‹¤í–‰
                        </button>
                    </div>
                </div>
            </div>

            <!-- ëœë¤ ìƒ˜í”Œë§ ê²€ì¦ -->
            <div class="card">
                <h2 class="step-title">ğŸ² ëœë¤ ìƒ˜í”Œë§ êµì°¨ ê²€ì¦</h2>
                <div class="card-content">
                    <div class="mb-4 flex items-center gap-4">
                        <button id="randomSampleBtn" class="bg-purple-600 text-white px-5 py-2.5 rounded-lg hover:bg-purple-700 transition-colors font-semibold shadow-md">
                            ğŸ² 10ëª… ëœë¤ ìƒ˜í”Œë§
                        </button>
                        <span class="text-sm text-gray-500">ë‹¤ì–‘í•œ Tier/Levelì˜ 10ëª…ì„ ì„ íƒí•˜ì—¬ ìŒë³„ êµì°¨ ê²€ì¦ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤</span>
                    </div>

                    <!-- ìƒ˜í”Œë§ëœ ì¸ì› ëª©ë¡ -->
                    <div id="sampledEmployeesList" class="mb-6 hidden">
                        <h4 class="font-semibold text-gray-700 mb-3">ğŸ“‹ ìƒ˜í”Œë§ëœ ì¸ì› (10ëª… - ë‹¤ì–‘í•œ Tier/Level)</h4>
                        <div id="sampledEmployeesGrid" class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                        </div>
                    </div>

                    <!-- êµì°¨ ê²€ì¦ ê²°ê³¼ (ìŒë³„ ë¹„êµ) -->
                    <div id="crossVerificationSection" class="hidden">
                        <h4 class="font-semibold text-gray-700 mb-3">ğŸ”„ ìŒë³„ êµì°¨ ê²€ì¦ ê²°ê³¼</h4>
                        <div class="bg-blue-50 p-3 rounded-lg mb-4 text-sm text-blue-800">
                            <strong>ê²€ì¦ ë°©ë²•:</strong> ë‘ ì§ì›ì„ ë¹„êµí•˜ì—¬ Tier ê°„ / Level ê°„ ì„¤ì •ëœ ë¹„ìœ¨(%)ì´ ì‹¤ì œë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.<br>
                            ì˜ˆ: T3 ì§ì›ê³¼ T4 ì§ì› ë¹„êµ â†’ T4â†’T3 ì¦ê°€ìœ¨ì´ ì„¤ì •ê°’ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì¦
                        </div>
                        
                        <!-- ìŒë³„ ê²€ì¦ ì¹´ë“œë“¤ -->
                        <div id="pairVerificationResults" class="space-y-4">
                            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                        </div>
                        
                        <div class="mt-4 flex items-center gap-4 text-sm">
                            <span class="flex items-center gap-1"><span class="w-4 h-4 bg-green-200 rounded"></span> í†µê³¼ (ì˜¤ì°¨ 1% ì´ë‚´)</span>
                            <span class="flex items-center gap-1"><span class="w-4 h-4 bg-yellow-200 rounded"></span> ê²½ê³  (ì˜¤ì°¨ 1-5%)</span>
                            <span class="flex items-center gap-1"><span class="w-4 h-4 bg-red-200 rounded"></span> ì‹¤íŒ¨ (ì˜¤ì°¨ 5% ì´ˆê³¼)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì „ì²´ ì¸ì› ë°ì´í„° í…Œì´ë¸” -->
            <div class="card">
                <h2 class="step-title">ğŸ“‹ í™•ì •ëœ ì¸ì„¼í‹°ë¸Œ ë°ì´í„°</h2>
                <div class="card-content">
                    <div id="noDataMessage" class="text-center py-8 text-gray-500">
                        <p class="text-lg">âš ï¸ í™•ì •ëœ ì¸ì„¼í‹°ë¸Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p class="text-sm mt-2">Tab 2 (ìŠˆí¼ìº£ ì¸ì› ê´€ë¦¬)ì—ì„œ ì¸ì„¼í‹°ë¸Œë¥¼ í™•ì •í•´ì£¼ì„¸ìš”.</p>
                    </div>
                    <div id="verificationTableContainer" class="hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="text-center py-2 px-3">ìˆœë²ˆ</th>
                                        <th class="text-center py-2 px-3">ì‚¬ë²ˆ</th>
                                        <th class="text-center py-2 px-3">ì´ë¦„</th>
                                        <th class="text-center py-2 px-3">Tier</th>
                                        <th class="text-center py-2 px-3">Level</th>
                                        <th class="text-right py-2 px-3">ëŸ°ì¹­ë³´ë„ˆìŠ¤ ì´ì•¡</th>
                                        <th class="text-right py-2 px-3">1ì°¨ ì§€ê¸‰</th>
                                        <th class="text-right py-2 px-3">2ì°¨ ì§€ê¸‰</th>
                                        <th class="text-center py-2 px-3">ê²€ì¦</th>
                                    </tr>
                                </thead>
                                <tbody id="verificationTableBody">
                                    <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 4 Content: HR ì¸ì‚¬ì´íŠ¸ -->
        <div id="tab4-content" class="hidden">
            <!-- ìƒë‹¨ í—¤ë” -->
            <div class="bg-white border-b border-gray-200 shadow-sm mb-6">
                <div class="px-8 py-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800">HR ì¸ì‚¬ì´íŠ¸</h2>
                            <p class="text-sm text-gray-500 mt-1">ì¸ì‚¬ ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ</p>
                        </div>
                        <div class="flex items-center gap-4">
                            <select id="insightSegment" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                                <option value="team">íŒ€</option>
                                <option value="part">íŒŒíŠ¸</option>
                                <option value="position">ì§ì±…</option>
                            </select>
                            <button id="updateAllInsights" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm">
                                ì „ì²´ ì—…ë°ì´íŠ¸
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="px-8 pb-8">
                <!-- ë“±ê¸‰ ê¸°ì¤€ ì•ˆë‚´ -->
                <div class="mb-4 bg-gray-50 border border-gray-200 rounded-lg p-3">
                    <div class="flex items-center justify-between text-xs mb-2">
                        <span class="font-medium text-gray-600">ğŸ“Š ì ìˆ˜ ë“±ê¸‰ ê¸°ì¤€ (100ì  ë§Œì ):</span>
                        <div class="flex gap-4">
                            <span class="px-2 py-1 bg-green-100 text-green-700 rounded">80ì  ì´ìƒ: ìš°ìˆ˜</span>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded">60-79ì : ì–‘í˜¸</span>
                            <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded">40-59ì : ì£¼ì˜</span>
                            <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded">20-39ì : ê²½ê³ </span>
                            <span class="px-2 py-1 bg-red-100 text-red-700 rounded">20ì  ë¯¸ë§Œ: ì‹¬ê°</span>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500 space-y-1">
                        <p>â€¢ <strong>ì—°ë´‰ íš¨ìœ¨ì„±:</strong> Tier 5-6ì¸ë° í‰ê·  ì—°ë´‰ë³´ë‹¤ ë†’ì€ ì¸ì› ë¹„ìœ¨ ê¸°ë°˜ (ë¹„íš¨ìœ¨ 0% = 100ì , 50% = 0ì )</p>
                        <p>â€¢ <strong>ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­:</strong> 24ê°œì›” ì´ìƒ ê·¼ë¬´í–ˆëŠ”ë° Tier 5-6ì¸ ì¸ì› ë¹„ìœ¨ ê¸°ë°˜ (ë¯¸ìŠ¤ë§¤ì¹˜ 0% = 100ì , 40% = 0ì )</p>
                        <p>â€¢ <strong>ì„±ì¥ ì ì¬ë ¥ / í•µì‹¬ ì¸ì¬:</strong> íŒ€/íŒŒíŠ¸ë³„ 1ìˆœìœ„ë§Œ í‘œì‹œ (ì¢…í•© ì ìˆ˜ì— ë¯¸í¬í•¨, ìˆœìœ„ ë¹„êµìš©)</p>
                    </div>
                </div>

                <!-- ì¡°ì§ ê±´ê°•ë„ ìš”ì•½ -->
                <div class="mb-8">
                    <div class="bg-white rounded-2xl shadow-md border border-gray-200 p-6">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-6">
                                <div class="w-28 h-28 relative">
                                    <canvas id="healthGaugeChart" width="100" height="100"></canvas>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">ì¡°ì§ ê±´ê°•ë„ ì¢…í•© ì ìˆ˜</p>
                                    <div class="flex items-baseline gap-2">
                                        <p class="text-5xl font-bold" id="overallHealthScore">-</p>
                                        <span class="text-lg text-gray-400">/100</span>
                                        <span id="overallHealthGrade" class="ml-2 px-3 py-1 text-sm font-semibold rounded-full">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ê°œë³„ ì§€í‘œ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
                        <div class="grid grid-cols-5 gap-4">
                            <div id="tierDistributionCard" class="p-4 rounded-xl border-2 transition-all">
                                <p class="text-xs text-gray-500 mb-1">Tier ë¶„í¬</p>
                                <div class="flex items-baseline gap-1">
                                    <span class="text-2xl font-bold" id="tierDistributionScore">-</span>
                                    <span class="text-xs text-gray-400">/100</span>
                                </div>
                                <span id="tierDistributionGrade" class="text-xs font-medium px-2 py-0.5 rounded mt-1 inline-block">-</span>
                            </div>
                            <div id="salaryEfficiencyCard" class="p-4 rounded-xl border-2 transition-all">
                                <p class="text-xs text-gray-500 mb-1">ì—°ë´‰ íš¨ìœ¨ì„±</p>
                                <div class="flex items-baseline gap-1">
                                    <span class="text-2xl font-bold" id="salaryEfficiencyScore">-</span>
                                    <span class="text-xs text-gray-400">/100</span>
                                </div>
                                <span id="salaryEfficiencyGrade" class="text-xs font-medium px-2 py-0.5 rounded mt-1 inline-block">-</span>
                                <p class="text-xs text-gray-400 mt-1" id="salaryEfficiencyDetail">-</p>
                            </div>
                            <div id="growthPotentialCard" class="p-4 rounded-xl border-2 transition-all bg-purple-50 border-purple-200">
                                <p class="text-xs text-gray-500 mb-1">ì„±ì¥ ì ì¬ë ¥ 1ìˆœìœ„</p>
                                <div class="flex items-baseline gap-1">
                                    <span class="text-lg font-bold text-purple-700" id="growthPotentialScore">-</span>
                                </div>
                                <span id="growthPotentialGrade" class="text-xs font-medium px-2 py-0.5 rounded mt-1 inline-block bg-purple-100 text-purple-700">ìˆœìœ„ ë¹„êµ</span>
                            </div>
                            <div id="experienceMatchCard" class="p-4 rounded-xl border-2 transition-all">
                                <p class="text-xs text-gray-500 mb-1">ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­</p>
                                <div class="flex items-baseline gap-1">
                                    <span class="text-2xl font-bold" id="experienceMatchScore">-</span>
                                    <span class="text-xs text-gray-400">/100</span>
                                </div>
                                <span id="experienceMatchGrade" class="text-xs font-medium px-2 py-0.5 rounded mt-1 inline-block">-</span>
                                <p class="text-xs text-gray-400 mt-1" id="experienceMatchDetail">-</p>
                            </div>
                            <div id="keyTalentCard" class="p-4 rounded-xl border-2 transition-all bg-orange-50 border-orange-200">
                                <p class="text-xs text-gray-500 mb-1">í•µì‹¬ ì¸ì¬ 1ìˆœìœ„</p>
                                <div class="flex items-baseline gap-1">
                                    <span class="text-lg font-bold text-orange-700" id="keyTalentScore">-</span>
                                </div>
                                <span id="keyTalentGrade" class="text-xs font-medium px-2 py-0.5 rounded mt-1 inline-block bg-orange-100 text-orange-700">ìˆœìœ„ ë¹„êµ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alert ìš”ì•½ -->
                <div id="alertSummarySection" class="mb-8 bg-red-50 border border-red-200 rounded-xl p-4 hidden">
                    <div class="flex items-center">
                        <span class="text-2xl mr-3">âš ï¸</span>
                        <div id="alertSummary" class="flex-1">
                            <p class="font-semibold text-red-900">ì£¼ìš” Alert ë¡œë”© ì¤‘...</p>
                        </div>
                    </div>
                </div>

                <!-- ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="insightCardsGrid">
                    <!-- ì¹´ë“œë“¤ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- ëª¨ë‹¬ -->
            <div id="insightModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4" style="display: none;">
                <div class="bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                    <!-- ëª¨ë‹¬ í—¤ë” -->
                    <div class="sticky top-0 bg-white border-b border-gray-200 px-8 py-6 flex items-center justify-between z-10 shadow-sm">
                        <div>
                            <h2 id="modalTitle" class="text-2xl font-bold text-gray-800">ì¸ì‚¬ì´íŠ¸ ë¶„ì„</h2>
                            <p id="modalSubtitle" class="text-sm text-gray-500 mt-1">ìƒì„¸ ë¶„ì„ ë° ë°ì´í„°</p>
                        </div>
                        <div class="flex items-center gap-4">
                            <button id="updateModalInsight" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm font-medium">
                                ë¶„ì„ ì—…ë°ì´íŠ¸
                            </button>
                            <button onclick="closeInsightModal()" class="w-10 h-10 rounded-lg hover:bg-gray-100 flex items-center justify-center transition-colors">
                                <span class="text-2xl text-gray-500">Ã—</span>
                            </button>
                        </div>
                    </div>

                    <!-- ëª¨ë‹¬ ì½˜í…ì¸  -->
                    <div id="modalContent" class="p-8">
                        <!-- ì½˜í…ì¸ ëŠ” JavaScriptë¡œ ë™ì  ë¡œë“œ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¸ì‚¬ì´íŠ¸ ì½˜í…ì¸  (ëª¨ë‹¬ ë‚´ë¶€ì—ì„œ ì‚¬ìš©) -->
    <div id="insight-content-wrapper" style="display: none;">

                        <!-- ì—°ë´‰-ëŠ¥ë ¥ ê´´ë¦¬ ë¶„ì„ íƒ­ (ëª¨ë‹¬ì—ì„œ ì‚¬ìš©) -->
                        <div id="insight-capability" class="insight-tab-content hidden">
                            <h4 class="section-title">Segmentë³„ ì—°ë´‰-ëŠ¥ë ¥ ê´´ë¦¬ ë¶„ì„</h4>
                            
                            <!-- Segment ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
                            <div class="mb-4 flex items-center gap-4">
                                <label for="capabilitySegmentSelect" class="text-sm font-medium text-gray-700">ë¶„ì„ ê¸°ì¤€:</label>
                                <select id="capabilitySegmentSelect" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                                    <option value="team">íŒ€</option>
                                    <option value="part">íŒŒíŠ¸</option>
                                    <option value="position">ì§ì±…</option>
                                </select>
                                <label for="capabilityDetailSelect" class="text-sm font-medium text-gray-700 ml-4">ìƒì„¸ ì„ íƒ:</label>
                                <select id="capabilityDetailSelect" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                                    <option value="">ì „ì²´</option>
                                </select>
                            </div>
                            
                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <h5 class="font-semibold text-blue-900 mb-2">ğŸ“Š ë¶„ì„ ë°©ë²• ë° í•´ì„ ê°€ì´ë“œ</h5>
                                <div class="text-sm text-blue-800 space-y-2">
                                    <p><strong>ê³„ì‚°ì‹:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>Tier ê°€ì¤‘ì¹˜:</strong> T1=6ì , T2=5ì , T3=4ì , T4=3ì , T5=2ì , T6=1ì </li>
                                        <li><strong>Tier ê°€ì¤‘ í‰ê· :</strong> (ê° ì§ì›ì˜ Tier ê°€ì¤‘ì¹˜ í•©ê³„) Ã· ì¸ì›ìˆ˜</li>
                                        <li><strong>ì—­ëŸ‰ ì ìˆ˜:</strong> (í‰ê·  ì—°ë´‰ Ã— Tier ê°€ì¤‘ í‰ê· ) Ã· 1,000,000 (ë°±ë§Œì› ë‹¨ìœ„ ì •ê·œí™”)</li>
                                    </ul>
                                    <p class="mt-2"><strong>í•´ì„ ë°©ë²•:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ì—­ëŸ‰ ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡</strong> í•´ë‹¹ Segmentì˜ ì—­ëŸ‰ì´ ë†’ê³  ì—°ë´‰ ëŒ€ë¹„ ì„±ê³¼ê°€ ìš°ìˆ˜í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
                                        <li><strong>Tier ê°€ì¤‘ í‰ê· </strong>ì´ ë†’ìœ¼ë©´ ê³ Tier ì¸ì›ì´ ë§ì•„ ì—­ëŸ‰ì´ ì§‘ì¤‘ë˜ì–´ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
                                        <li>ë§‰ëŒ€ ê·¸ë˜í”„ëŠ” í‰ê·  ì—°ë´‰ê³¼ ì—­ëŸ‰ ì ìˆ˜ë¥¼ ë¹„êµí•˜ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤.</li>
                                        <li>íŒŒì´ ì°¨íŠ¸ëŠ” ì„ íƒëœ Segmentì˜ Tier ë¶„í¬ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-white p-4 rounded-lg border" style="height: 300px;">
                                    <canvas id="capabilityBarChart"></canvas>
                                </div>
                                <div class="bg-white p-4 rounded-lg border" style="height: 300px;">
                                    <canvas id="capabilityPieChart"></canvas>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg border">
                                <table class="min-w-full text-sm">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="text-left p-2 cursor-pointer hover:bg-gray-200 transition-colors" data-sort="rank" data-order="asc">
                                                ìˆœìœ„ <span class="sort-indicator">â†•</span>
                                            </th>
                                            <th class="text-left p-2 cursor-pointer hover:bg-gray-200 transition-colors" data-sort="segment" data-order="asc">
                                                Segment <span class="sort-indicator">â†•</span>
                                            </th>
                                            <th class="text-right p-2 cursor-pointer hover:bg-gray-200 transition-colors" data-sort="salary" data-order="asc">
                                                í‰ê·  ì—°ë´‰ <span class="sort-indicator">â†•</span>
                                            </th>
                                            <th class="text-right p-2 cursor-pointer hover:bg-gray-200 transition-colors" data-sort="tier" data-order="asc">
                                                Tier ê°€ì¤‘ í‰ê·  <span class="sort-indicator">â†•</span>
                                            </th>
                                            <th class="text-right p-2 cursor-pointer hover:bg-gray-200 transition-colors" data-sort="score" data-order="desc">
                                                ì—­ëŸ‰ ì ìˆ˜ <span class="sort-indicator">â†“</span>
                                            </th>
                                            <th class="text-right p-2 cursor-pointer hover:bg-gray-200 transition-colors" data-sort="count" data-order="asc">
                                                ì¸ì›ìˆ˜ <span class="sort-indicator">â†•</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="capabilityTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- ë¦¬ë” ëŠ¥ë ¥ ì·¨ì•½ë„ ë¶„ì„ íƒ­ -->
                        <div id="insight-mismatch" class="insight-tab-content hidden">
                            <h4 class="section-title">ë¦¬ë” ëŠ¥ë ¥ ì·¨ì•½ë„ ë¶„ì„</h4>
                            
                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                                <h5 class="font-semibold text-red-900 mb-2">âš ï¸ ë¶„ì„ ë°©ë²• ë° í•´ì„ ê°€ì´ë“œ</h5>
                                <div class="text-sm text-red-800 space-y-2">
                                    <p><strong>ë¶„ì„ ëª©ì :</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li>ë¦¬ë”, íŒŒíŠ¸ì¥, AD, TD ë“± ì§ì±…ìë“¤ì˜ Tier ì ì •ì„±ì„ ì ê²€í•©ë‹ˆë‹¤.</li>
                                        <li>ì§ì±…ìì¸ë° Tierê°€ ë‚®ì€(T4-T6) ì¸ì›ì´ ì§‘ì¤‘ëœ íŒ€/íŒŒíŠ¸ë¥¼ ìš°ì„ ìˆœìœ„ë¡œ ì§„ë‹¨í•©ë‹ˆë‹¤.</li>
                                    </ul>
                                    <p class="mt-2"><strong>ë¶„ì„ ê¸°ì¤€:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ì‹¬ê° (T5-T6):</strong> ì§ì±… ì—­í•  ìˆ˜í–‰ì— ì—­ëŸ‰ ë¶€ì¡± ìš°ë ¤ê°€ ë†’ìŒ</li>
                                        <li><strong>ì£¼ì˜ (T4):</strong> ì—­ëŸ‰ ê°•í™” ë˜ëŠ” ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•¨</li>
                                        <li><strong>ì •ìƒ (T1-T3):</strong> ì§ì±… ì—­í• ì— ì í•©í•œ ì—­ëŸ‰ ë³´ìœ </li>
                                    </ul>
                                    <p class="mt-2"><strong>ê·¸ë˜í”„ í•´ì„:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li>ê°€ì¥ ë¬¸ì œê°€ ì‹¬ê°í•œ íŒ€/íŒŒíŠ¸ ìˆœìœ¼ë¡œ ì •ë ¬ë©ë‹ˆë‹¤.</li>
                                        <li><strong>ë¹¨ê°„ìƒ‰:</strong> Tier 5-6 ì§ì±…ì (ì‹¬ê°)</li>
                                        <li><strong>ë…¸ë€ìƒ‰:</strong> Tier 4 ì§ì±…ì (ì£¼ì˜)</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg border mb-4" style="height: 350px;">
                                <canvas id="mismatchHeatmapChart"></canvas>
                            </div>
                            <div class="bg-white p-4 rounded-lg border">
                                <div class="text-sm font-semibold mb-2">ğŸ“‹ íŒ€/íŒŒíŠ¸ë³„ ë¬¸ì œ ì§ì±…ì ìƒì„¸</div>
                                <div id="mismatchAlertList" class="space-y-2 max-h-96 overflow-y-auto"></div>
                            </div>
                        </div>

                        <!-- ì—­ëŸ‰ ì§‘ì¤‘ë„ íƒ­ -->
                        <div id="insight-concentration" class="insight-tab-content hidden">
                            <h4 class="section-title">ì—­ëŸ‰ ì§‘ì¤‘ë„ ë¶„ì„</h4>
                            
                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                <h5 class="font-semibold text-yellow-900 mb-2">ğŸ“Š ë¶„ì„ ë°©ë²• ë° í•´ì„ ê°€ì´ë“œ</h5>
                                <div class="text-sm text-yellow-800 space-y-2">
                                    <p><strong>ê³„ì‚°ì‹:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>T1-T3 ë¹„ìœ¨:</strong> (T1 ì¸ì›ìˆ˜ + T2 ì¸ì›ìˆ˜ + T3 ì¸ì›ìˆ˜) Ã· ì „ì²´ ì¸ì›ìˆ˜ Ã— 100</li>
                                        <li><strong>T4-T6 ë¹„ìœ¨:</strong> (T4 ì¸ì›ìˆ˜ + T5 ì¸ì›ìˆ˜ + T6 ì¸ì›ìˆ˜) Ã· ì „ì²´ ì¸ì›ìˆ˜ Ã— 100</li>
                                        <li><strong>í‘œì¤€í¸ì°¨:</strong> ê° Tierë³„ ì¸ì›ìˆ˜ì˜ ë¶„ì‚°ì„ ê³„ì‚°í•˜ì—¬ ì—­ëŸ‰ ì§‘ì¤‘ë„ë¥¼ ì¸¡ì •</li>
                                        <li><strong>ë³€ë™ê³„ìˆ˜:</strong> í‘œì¤€í¸ì°¨ Ã· í‰ê·  (ì§‘ì¤‘ë„ê°€ ë†’ì„ìˆ˜ë¡ ê°’ì´ í¼)</li>
                                    </ul>
                                    <p class="mt-2"><strong>í•´ì„ ë°©ë²•:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ë ˆì´ë” ì°¨íŠ¸ì˜ ìˆ«ì</strong>ëŠ” ê° Tier(T1~T6)ë³„ ì¸ì›ìˆ˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</li>
                                        <li>ì˜ˆ: "4"ëŠ” í•´ë‹¹ Segmentì— T1 ì¸ì›ì´ 4ëª…, "6"ì€ T2 ì¸ì›ì´ 6ëª…ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
                                        <li><strong>T1-T3 ë¹„ìœ¨ì´ 50% ì´ìƒ</strong>ì´ë©´ ì—­ëŸ‰ì´ ê³¼ë„í•˜ê²Œ ì§‘ì¤‘ë˜ì–´ ìˆì–´ ë¦¬ìŠ¤í¬ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.</li>
                                        <li><strong>T1-T3 ë¹„ìœ¨ì´ 15% ë¯¸ë§Œ</strong>ì´ë©´ ì—­ëŸ‰ ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ ì—…ë¬´ ê³¼ë¶€í•˜ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.</li>
                                        <li>ì´ìƒì ì¸ ë¶„í¬ëŠ” T1-T3 ë¹„ìœ¨ì´ 20-30% ì •ë„ë¡œ ê· í˜•ì¡íŒ ì—­ëŸ‰ ë¶„ì‚°ì…ë‹ˆë‹¤.</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg border mb-4" style="height: 900px;">
                                <canvas id="concentrationRadarChart"></canvas>
                            </div>
                            <div class="bg-white p-4 rounded-lg border">
                                <div id="concentrationAlertList" class="space-y-2"></div>
                            </div>
                        </div>

                        <!-- ì—°ë´‰ íš¨ìœ¨ì„± íƒ­ -->
                        <div id="insight-efficiency" class="insight-tab-content hidden">
                            <h4 class="section-title">ì—°ë´‰ íš¨ìœ¨ì„± ë¶„ì„</h4>
                            
                            <!-- íŒŒíŠ¸ í•„í„° ë° ì •ë ¬ -->
                            <div class="mb-4 flex items-center gap-4">
                                <label for="efficiencyPartFilter" class="text-sm font-medium text-gray-700">íŒŒíŠ¸ í•„í„°:</label>
                                <select id="efficiencyPartFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                                    <option value="">ì „ì²´</option>
                                </select>
                            </div>
                            
                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                                <h5 class="font-semibold text-red-900 mb-2">âš ï¸ ë¶„ì„ ë°©ë²• ë° í•´ì„ ê°€ì´ë“œ</h5>
                                <div class="text-sm text-red-800 space-y-2">
                                    <p><strong>ë¶„ì„ ëª©ì :</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li>Tierê°€ ë‚®ì€ë° ì—°ë´‰ì´ ë†’ê²Œ ì±…ì •ëœ ì¸ì›ì„ ì°¾ì•„ ë³´ìƒ ì²´ê³„ì˜ ê³µì •ì„±ì„ ì ê²€í•©ë‹ˆë‹¤.</li>
                                        <li>ì—­ëŸ‰ ëŒ€ë¹„ ê³¼ë„í•œ ë³´ìƒì´ ë°œìƒí•˜ëŠ” ê²½ìš°ë¥¼ ê°ì§€í•˜ì—¬ ì¡°ì§ì˜ ë³´ìƒ íš¨ìœ¨ì„±ì„ ê°œì„ í•©ë‹ˆë‹¤.</li>
                                    </ul>
                                    <p class="mt-2"><strong>ê³„ì‚°ì‹:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>Tier ê°€ì¤‘ì¹˜:</strong> T1=6ì , T2=5ì , T3=4ì , T4=3ì , T5=2ì , T6=1ì </li>
                                        <li><strong>Segmentë³„ í‰ê·  ì—°ë´‰:</strong> ê° Segmentì˜ ëª¨ë“  ì§ì› ì—°ë´‰ í•©ê³„ Ã· ì¸ì›ìˆ˜</li>
                                        <li><strong>Segmentë³„ í‰ê·  Tier ê°€ì¤‘ì¹˜:</strong> ê° ì§ì›ì˜ Tier ê°€ì¤‘ì¹˜ í•©ê³„ Ã· ì¸ì›ìˆ˜</li>
                                        <li><strong>ë¹„ì •ìƒ ë³´ìƒ ê¸°ì¤€:</strong> Tier 5-6ì¸ë° í•´ë‹¹ Segment í‰ê·  ì—°ë´‰ë³´ë‹¤ ë†’ê±°ë‚˜, ì „ì²´ í‰ê·  ì—°ë´‰ë³´ë‹¤ ë†’ì€ ê²½ìš°</li>
                                    </ul>
                                    <p class="mt-2"><strong>í•´ì„ ë°©ë²•:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ë²„ë¸” ì°¨íŠ¸:</strong> Xì¶•ì€ Tier ê°€ì¤‘ì¹˜, Yì¶•ì€ í‰ê·  ì—°ë´‰, ë²„ë¸” í¬ê¸°ëŠ” ì¸ì›ìˆ˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</li>
                                        <li><strong>ë¹¨ê°„ìƒ‰ ë²„ë¸”:</strong> Tier ê°€ì¤‘ì¹˜ê°€ ë‚®ì€ë° í‰ê·  ì—°ë´‰ì´ ë†’ì€ Segment (ì£¼ì˜ í•„ìš”)</li>
                                        <li><strong>ë…¸ë€ìƒ‰ ë²„ë¸”:</strong> ë³´í†µ ìˆ˜ì¤€ì˜ Segment</li>
                                        <li><strong>ì´ˆë¡ìƒ‰ ë²„ë¸”:</strong> Tier ëŒ€ë¹„ ì—°ë´‰ì´ ì ì •í•œ Segment</li>
                                        <li><strong>âš ï¸ Red Alert ì¸ì›:</strong> Tier 5-6ì¸ë° ì—°ë´‰ì´ ë†’ê²Œ ì±…ì •ëœ ì¸ì›ìœ¼ë¡œ, ë‹¤ìŒì„ ì˜ë¯¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
                                            <ul class="list-disc list-inside ml-4 mt-1">
                                                <li><strong>ë³´ìƒ ì²´ê³„ ë¬¸ì œ:</strong> Tier í‰ê°€ì™€ ë³´ìƒì´ ë¶ˆì¼ì¹˜í•˜ì—¬ ì—­ëŸ‰ ëŒ€ë¹„ ê³¼ë„í•œ ë³´ìƒ</li>
                                                <li><strong>Tier í‰ê°€ ë¬¸ì œ:</strong> ì‹¤ì œ ì—­ëŸ‰ë³´ë‹¤ Tierê°€ ë‚®ê²Œ í‰ê°€ë˜ì—ˆì„ ê°€ëŠ¥ì„±</li>
                                                <li><strong>ë³´ìƒ ê³µì •ì„± ë¬¸ì œ:</strong> ë™ì¼ Tier ë‚´ì—ì„œë„ ì—°ë´‰ í¸ì°¨ê°€ ì»¤ì„œ ê³µì •ì„± ì €í•´</li>
                                            </ul>
                                        </li>
                                        <li><strong>ê°œì„  ë°©ì•ˆ:</strong>
                                            <ul class="list-disc list-inside ml-4 mt-1">
                                                <li>í•´ë‹¹ ì¸ì›ì˜ Tier ì¬í‰ê°€ ê²€í† </li>
                                                <li>ë³´ìƒ ì²´ê³„ì˜ ê³µì •ì„± ë° ì¼ê´€ì„± ì ê²€</li>
                                                <li>ë™ì¼ Tier ë‚´ ì—°ë´‰ í¸ì°¨ ìµœì†Œí™” ë°©ì•ˆ ê²€í† </li>
                                                <li>ì—­ëŸ‰ ëŒ€ë¹„ ë³´ìƒì´ ì ì •í•œì§€ ì¬ê²€í† </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg border mb-4" style="height: 300px;">
                                <canvas id="efficiencyBubbleChart"></canvas>
                            </div>
                            <div class="bg-white p-4 rounded-lg border mb-4">
                                <table class="min-w-full text-sm">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="text-left p-2">Segment</th>
                                            <th class="text-right p-2">í‰ê·  ì—°ë´‰</th>
                                            <th class="text-right p-2">í‰ê·  Tier ê°€ì¤‘ì¹˜</th>
                                            <th class="text-right p-2">Alert ì¸ì›ìˆ˜</th>
                                        </tr>
                                    </thead>
                                    <tbody id="efficiencyTableBody">
                                    </tbody>
                                </table>
                            </div>
                            <div class="bg-white p-4 rounded-lg border">
                                <div class="mb-3 flex items-center justify-between">
                                    <div class="text-sm font-semibold text-red-600">âš ï¸ Tierê°€ ë‚®ì€ë° ì—°ë´‰ì´ ë†’ì€ ì¸ì› (Red Alert)</div>
                                    <div class="flex items-center gap-2">
                                        <label for="efficiencySortOrder" class="text-xs text-gray-600">ì •ë ¬:</label>
                                        <select id="efficiencySortOrder" class="px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                                            <option value="desc">ê´´ë¦¬ í° ìˆœ (ë‚´ë¦¼ì°¨ìˆœ)</option>
                                            <option value="asc">ê´´ë¦¬ ì‘ì€ ìˆœ (ì˜¬ë¦¼ì°¨ìˆœ)</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="efficiencyAlertList"></div>
                            </div>
                        </div>

                        <!-- ì„±ì¥ ì ì¬ë ¥ íƒ­ -->
                        <div id="insight-growth" class="insight-tab-content hidden">
                            <h4 class="section-title">ì„±ì¥ ì ì¬ë ¥ ë¶„ì„</h4>
                            
                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4">
                                <h5 class="font-semibold text-purple-900 mb-2">ğŸŒ± ë¶„ì„ ë°©ë²• ë° í•´ì„ ê°€ì´ë“œ</h5>
                                <div class="text-sm text-purple-800 space-y-2">
                                    <p><strong>ê³„ì‚°ì‹:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ì‹ ê·œ ì¸ì›:</strong> ì…ì‚¬ì¼ ê¸°ì¤€ 12ê°œì›” ì´ë‚´ ì¸ì›</li>
                                        <li><strong>ê³ Tier ì‹ ê·œ ì¸ì›:</strong> ì‹ ê·œ ì¸ì› ì¤‘ Tier 1-3ì¸ ì¸ì›</li>
                                        <li><strong>ì„±ì¥ ì ì¬ë ¥:</strong> (ê³ Tier ì‹ ê·œ ì¸ì›ìˆ˜ Ã· ì „ì²´ ì¸ì›ìˆ˜) Ã— 100</li>
                                        <li><strong>Level ë¶„ë¥˜:</strong> L1(6ê°œì›” ë¯¸ë§Œ), L2(6-12ê°œì›”), L3(12ê°œì›” ì´ìƒ)</li>
                                    </ul>
                                    <p class="mt-2"><strong>í•´ì„ ë°©ë²•:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ì„±ì¥ ì ì¬ë ¥ì´ ë†’ì„ìˆ˜ë¡</strong> ì‹ ê·œ ì¸ì› ì¤‘ ì—­ëŸ‰ì´ ë†’ì€ ì¸ì›ì´ ë§ì•„ ë¹ ë¥¸ ì„±ì¥ì´ ê¸°ëŒ€ë©ë‹ˆë‹¤.</li>
                                        <li><strong>ìŠ¤íƒ ë°” ì°¨íŠ¸:</strong> ê° Segmentë³„ Level(L1/L2/L3) ë¶„í¬ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</li>
                                        <li><strong>íŒŒë€ìƒ‰(L1):</strong> 6ê°œì›” ë¯¸ë§Œ ì‹ ê·œ ì¸ì› - ì´ˆê¸° ì ì‘ ë‹¨ê³„</li>
                                        <li><strong>ì´ˆë¡ìƒ‰(L2):</strong> 6-12ê°œì›” ì¸ì› - ì„±ì¥ ë‹¨ê³„</li>
                                        <li><strong>ë…¸ë€ìƒ‰(L3):</strong> 12ê°œì›” ì´ìƒ ì¸ì› - ì•ˆì • ë‹¨ê³„</li>
                                        <li>ì„±ì¥ ì ì¬ë ¥ì´ ë†’ì€ SegmentëŠ” ë©˜í† ë§ ì²´ê³„ êµ¬ì¶•ê³¼ ë¹ ë¥¸ ì±…ì„ ë¶€ì—¬ë¥¼ í†µí•´ ì„±ì¥ì„ ê°€ì†í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg border mb-4" style="height: 300px;">
                                <canvas id="growthStackChart"></canvas>
                            </div>
                            <div class="bg-white p-4 rounded-lg border">
                                <div class="text-sm font-semibold mb-2">ğŸ’¡ ì„±ì¥ ì ì¬ë ¥ ë†’ì€ Segment</div>
                                <div id="growthPotentialList" class="space-y-2"></div>
                            </div>
                        </div>

                        <!-- ëª©í‘œ-ì‹¤ì œ ì—­ëŸ‰ ê´´ë¦¬ ë¶„ì„ íƒ­ -->
                        <div id="insight-gap" class="insight-tab-content hidden">
                            <h4 class="section-title">ëª©í‘œ-ì‹¤ì œ ì—­ëŸ‰ ê´´ë¦¬ ë¶„ì„</h4>
                            
                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-4">
                                <h5 class="font-semibold text-indigo-900 mb-2">ğŸ“ˆ ë¶„ì„ ë°©ë²• ë° í•´ì„ ê°€ì´ë“œ</h5>
                                <div class="text-sm text-indigo-800 space-y-2">
                                    <p><strong>ê³„ì‚°ì‹:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ëª©í‘œ T1-T3 ë¹„ìœ¨:</strong> ì‚¬ìš©ìê°€ ì„¤ì •í•œ ëª©í‘œ ë¹„ìœ¨ (ê¸°ë³¸ê°’: 30%)</li>
                                        <li><strong>ì‹¤ì œ T1-T3 ë¹„ìœ¨:</strong> (T1+T2+T3 ì¸ì›ìˆ˜) Ã· ì „ì²´ ì¸ì›ìˆ˜ Ã— 100</li>
                                        <li><strong>ì—­ëŸ‰ ê´´ë¦¬:</strong> ì‹¤ì œ T1-T3 ë¹„ìœ¨ - ëª©í‘œ T1-T3 ë¹„ìœ¨</li>
                                    </ul>
                                    <p class="mt-2"><strong>í•´ì„ ë°©ë²•:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ë§‰ëŒ€ ê·¸ë˜í”„:</strong> íŒŒë€ìƒ‰ì€ ëª©í‘œ ë¹„ìœ¨, ì´ˆë¡/ë¹¨ê°•ì€ ì‹¤ì œ ë¹„ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</li>
                                        <li><strong>ì´ˆë¡ìƒ‰ ë§‰ëŒ€:</strong> ëª©í‘œ ëŒ€ë¹„ ì‹¤ì œ ë¹„ìœ¨ì´ ë†’ê±°ë‚˜ ê°™ìŒ (ì–‘í˜¸)</li>
                                        <li><strong>ë¹¨ê°„ìƒ‰ ë§‰ëŒ€:</strong> ëª©í‘œ ëŒ€ë¹„ ì‹¤ì œ ë¹„ìœ¨ì´ ë‚®ìŒ (ê°œì„  í•„ìš”)</li>
                                        <li><strong>ê²©ì°¨ê°€ -5%p ì´ìƒ</strong>ì´ë©´ ì—­ëŸ‰ ê°•í™” í”„ë¡œê·¸ë¨ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
                                        <li>ìŠ¬ë¼ì´ë”ë¡œ ëª©í‘œ ë¹„ìœ¨ì„ ì¡°ì •í•˜ì—¬ ì¡°ì§ì˜ ì—­ëŸ‰ ëª©í‘œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                        <li>ì´ ë¶„ì„ì„ í†µí•´ ì—­ëŸ‰ ê°•í™”ê°€ í•„ìš”í•œ Segmentë¥¼ ìš°ì„ ìˆœìœ„í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ëª©í‘œ T1-T3 ë¹„ìœ¨ ì¡°ì •</label>
                                <input type="range" id="targetRatioSlider" min="0" max="100" value="30" class="w-full">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>0%</span>
                                    <span id="targetRatioValue" class="font-semibold">30%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg border mb-4" style="height: 300px;">
                                <canvas id="gapComparisonChart"></canvas>
                            </div>
                            <div class="bg-white p-4 rounded-lg border">
                                <div id="gapRecommendations" class="space-y-2"></div>
                            </div>
                        </div>

                        <!-- í•µì‹¬ ì¸ì¬ ë¶„í¬ íƒ­ -->
                        <div id="insight-talent" class="insight-tab-content hidden">
                            <h4 class="section-title">í•µì‹¬ ì¸ì¬ ë¶„í¬ ë¶„ì„</h4>
                            
                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                                <h5 class="font-semibold text-orange-900 mb-2">â­ ë¶„ì„ ë°©ë²• ë° í•´ì„ ê°€ì´ë“œ</h5>
                                <div class="text-sm text-orange-800 space-y-2">
                                    <p><strong>ê³„ì‚°ì‹:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>í•µì‹¬ ì¸ì¬ (T1-T2):</strong> Tier 1-2 ì¸ì› (ìµœê³  ì—­ëŸ‰ ì¸ì¬)</li>
                                        <li><strong>í•µì‹¬ ì¸ì¬ (T1-T3):</strong> Tier 1-3 ì¸ì› (ê³ ì—­ëŸ‰ ì¸ì¬ í¬í•¨)</li>
                                        <li><strong>í•µì‹¬ ì¸ì¬ ìˆ˜:</strong> ê° Segmentë³„ í•´ë‹¹ Tier ë²”ìœ„ì˜ ì¸ì›ìˆ˜ í•©ê³„</li>
                                        <li><strong>ìˆœìœ„:</strong> í•µì‹¬ ì¸ì¬ ìˆ˜ê°€ ë§ì€ ìˆœì„œëŒ€ë¡œ ì •ë ¬</li>
                                    </ul>
                                    <p class="mt-2"><strong>í•´ì„ ë°©ë²•:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>T1-T2 ê¸°ì¤€:</strong> ìµœê³  ì—­ëŸ‰ ì¸ì¬ë§Œ ì§‘ì¤‘ ë¶„ì„í•˜ì—¬ í•µì‹¬ ì¸ì¬ì˜ ë¶„í¬ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.</li>
                                        <li><strong>T1-T3 ê¸°ì¤€:</strong> ê³ ì—­ëŸ‰ ì¸ì¬ê¹Œì§€ í¬í•¨í•˜ì—¬ ë” ë„“ì€ ë²”ìœ„ì˜ ì—­ëŸ‰ ë¶„í¬ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.</li>
                                        <li><strong>ë§‰ëŒ€ ê·¸ë˜í”„:</strong> ê° Segmentë³„ í•µì‹¬ ì¸ì¬ ì ˆëŒ€ ìˆ˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</li>
                                        <li><strong>ìˆœìœ„ë³„ ì •ë ¬:</strong> í•µì‹¬ ì¸ì¬ ìˆ˜ê°€ ë§ì€ Segmentë¶€í„° ìˆœì„œëŒ€ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</li>
                                        <li><strong>í•µì‹¬ ì¸ì¬ê°€ ë§ì€ Segment:</strong> ì—­ëŸ‰ì´ ì§‘ì¤‘ëœ Segmentë¡œ, ì¡°ì§ì˜ í•µì‹¬ ì—­ëŸ‰ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.</li>
                                        <li><strong>í•µì‹¬ ì¸ì¬ê°€ ì ì€ Segment:</strong> ì—­ëŸ‰ ê°•í™”ê°€ í•„ìš”í•˜ë©°, í•µì‹¬ ì¸ì¬ ì±„ìš© ë˜ëŠ” ì¬ë°°ì¹˜ë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.</li>
                                        <li>í•µì‹¬ ì¸ì¬ê°€ íŠ¹ì • Segmentì— ê³¼ë„í•˜ê²Œ ì§‘ì¤‘ë˜ë©´ ì¡°ì§ì˜ ë¦¬ìŠ¤í¬ê°€ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Tier ë²”ìœ„ ì„ íƒ ë²„íŠ¼ -->
                            <div class="mb-4 flex gap-2">
                                <button id="talentRangeT12" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors font-medium">
                                    T1-T2 ê¸°ì¤€
                                </button>
                                <button id="talentRangeT13" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors font-medium">
                                    T1-T3 ê¸°ì¤€
                                </button>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg border mb-4" style="height: 300px;">
                                <canvas id="talentTreemapChart"></canvas>
                            </div>
                            <div class="bg-white p-4 rounded-lg border">
                                <div id="talentRecommendations" class="space-y-2"></div>
                            </div>
                        </div>

                        <!-- ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­ íƒ­ -->
                        <div id="insight-experience" class="insight-tab-content hidden">
                            <h4 class="section-title">ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­ë„ ë¶„ì„</h4>
                            
                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div class="bg-teal-50 border border-teal-200 rounded-lg p-4 mb-4">
                                <h5 class="font-semibold text-teal-900 mb-2">ğŸ‘¥ ë¶„ì„ ë°©ë²• ë° í•´ì„ ê°€ì´ë“œ</h5>
                                <div class="text-sm text-teal-800 space-y-2">
                                    <p><strong>ê³„ì‚°ì‹:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ê²½ë ¥ ê³„ì‚°:</strong> ê¸°ì¤€ì¼ - í”„ë¡œì íŠ¸ í•©ë¥˜ì¼ (OQ í•©ë¥˜ì¼ ê¸°ì¤€)</li>
                                        <li><strong>ê²½ë ¥ êµ¬ê°„ ë¶„ë¥˜:</strong>
                                            <ul class="list-disc list-inside ml-4 mt-1">
                                                <li>0-6ê°œì›” ë¯¸ë§Œ</li>
                                                <li>6-12ê°œì›” ë¯¸ë§Œ</li>
                                                <li>12-18ê°œì›” ë¯¸ë§Œ</li>
                                                <li>18-24ê°œì›” ë¯¸ë§Œ</li>
                                                <li>24ê°œì›” ì´ìƒ</li>
                                            </ul>
                                        </li>
                                        <li><strong>ë¶ˆì¼ì¹˜ ê¸°ì¤€:</strong> ê²½ë ¥ 24ê°œì›” ì´ìƒì¸ë° Tier 5-6ì¸ ê²½ìš°</li>
                                        <li><strong>ë§¤ì¹­ë„:</strong> ê²½ë ¥ êµ¬ê°„ë³„ Tier 1-6 ì¸ì›ìˆ˜ ë¶„í¬</li>
                                    </ul>
                                    <p class="mt-2"><strong>í•´ì„ ë°©ë²•:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ëˆ„ì  ë§‰ëŒ€ ê·¸ë˜í”„:</strong> ê° ê²½ë ¥ êµ¬ê°„ë³„ Tier 1-6 ì¸ì› ë¶„í¬ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</li>
                                        <li><strong>ì´ˆë¡ìƒ‰ ì˜ì—­:</strong> ì ì • Tier (T1-T3) - ê²½ë ¥ê³¼ ì—­ëŸ‰ì´ ì ì ˆíˆ ë§¤ì¹­ë¨</li>
                                        <li><strong>ë¹¨ê°„ìƒ‰ ì˜ì—­:</strong> ë‚®ì€ Tier (T4-T6) - ê²½ë ¥ ëŒ€ë¹„ ì—­ëŸ‰ ë¶€ì¡±</li>
                                        <li><strong>ê²½ë ¥ì´ ì¦ê°€í• ìˆ˜ë¡</strong> ë†’ì€ Tier ë¹„ìœ¨ì´ ì¦ê°€í•˜ëŠ” ê²ƒì´ ì´ìƒì ì…ë‹ˆë‹¤.</li>
                                        <li><strong>24ê°œì›” ì´ìƒ ê²½ë ¥ì¸ë° Tier 5-6ì¸ ê²½ìš°</strong>ëŠ” ì¸ì‚¬ í‰ê°€ ì²´ê³„ ì¬ê²€í†  ë˜ëŠ” ì—­ëŸ‰ ê°•í™” í”„ë¡œê·¸ë¨ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
                                        <li>íŠ¹ì • ê²½ë ¥ êµ¬ê°„ì—ì„œ ë‚®ì€ Tier ë¹„ìœ¨ì´ ë†’ìœ¼ë©´ í•´ë‹¹ ê²½ë ¥ëŒ€ì˜ ì—­ëŸ‰ ê°œë°œì´ í•„ìš”í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg border mb-4" style="height: 300px;">
                                <canvas id="experienceHeatmapChart"></canvas>
                            </div>
                            <div class="bg-white p-4 rounded-lg border">
                                <div id="experienceAlerts" class="space-y-2"></div>
                            </div>
                        </div>

                        <!-- ì¢…í•© ë¶„ì„ íƒ­ -->
                        <div id="insight-comprehensive" class="insight-tab-content hidden">
                            <h4 class="section-title">ì¢…í•© ë¶„ì„</h4>
                            
                            <!-- ì„¤ëª… ì„¹ì…˜ -->
                            <div class="bg-gray-50 border border-gray-300 rounded-lg p-4 mb-4">
                                <h5 class="font-semibold text-gray-900 mb-2">ğŸ¯ ë¶„ì„ ë°©ë²• ë° í•´ì„ ê°€ì´ë“œ</h5>
                                <div class="text-sm text-gray-800 space-y-2">
                                    <p><strong>ê³„ì‚°ì‹:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>Tier ë¶„í¬ ì ìˆ˜:</strong> (ì‹¤ì œ T1-T3 ë¹„ìœ¨ Ã· 30%) Ã— 100 (ìµœëŒ€ 100ì )</li>
                                        <li><strong>ì—°ë´‰ íš¨ìœ¨ì„± ì ìˆ˜:</strong> (ì—°ë´‰ íš¨ìœ¨ì„± Ã· 2ì²œë§Œì›) Ã— 100 (ìµœëŒ€ 100ì )</li>
                                        <li><strong>ì¢…í•© ì ìˆ˜:</strong> Tier ë¶„í¬ ì ìˆ˜(40%) + ì—°ë´‰ íš¨ìœ¨ì„± ì ìˆ˜(30%) + ë³´ë„ˆìŠ¤ ì ìˆ˜(30%)</li>
                                        <li><strong>ë³´ë„ˆìŠ¤ ì ìˆ˜:</strong> T1-T3 ë¹„ìœ¨ì´ 20% ì´ìƒì´ë©´ 30ì , ì•„ë‹ˆë©´ 0ì </li>
                                    </ul>
                                    <p class="mt-2"><strong>í•´ì„ ë°©ë²•:</strong></p>
                                    <ul class="list-disc list-inside ml-2 space-y-1">
                                        <li><strong>ê°€ë¡œ ë§‰ëŒ€ ê·¸ë˜í”„:</strong> ê° Segmentë³„ ì¢…í•© ì ìˆ˜ë¥¼ ìˆœìœ„ëŒ€ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.</li>
                                        <li><strong>ì´ˆë¡ìƒ‰ ë§‰ëŒ€:</strong> ì¢…í•© ì ìˆ˜ 70ì  ì´ìƒ (ìš°ìˆ˜)</li>
                                        <li><strong>ë…¸ë€ìƒ‰ ë§‰ëŒ€:</strong> ì¢…í•© ì ìˆ˜ 50-70ì  (ë³´í†µ)</li>
                                        <li><strong>ë¹¨ê°„ìƒ‰ ë§‰ëŒ€:</strong> ì¢…í•© ì ìˆ˜ 50ì  ë¯¸ë§Œ (ê°œì„  í•„ìš”)</li>
                                        <li>ì¢…í•© ì ìˆ˜ê°€ ë‚®ì€ Segmentë¶€í„° ìš°ì„ ìˆœìœ„ë¥¼ ë§¤ê²¨ ì—­ëŸ‰ ê°•í™” í”„ë¡œê·¸ë¨ì„ ì§„í–‰í•©ë‹ˆë‹¤.</li>
                                        <li>ì´ ë¶„ì„ì„ í†µí•´ ì¡°ì§ ì „ë°˜ì˜ ê±´ê°•ë„ë¥¼ íŒŒì•…í•˜ê³  ê°œì„  ìš°ì„ ìˆœìœ„ë¥¼ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg border mb-4" style="height: 300px;">
                                <canvas id="comprehensiveRankingChart"></canvas>
                            </div>
                            <div class="bg-white p-4 rounded-lg border">
                                <div class="text-sm font-semibold mb-2">ğŸ“ˆ ì¡°ì§ ê±´ê°•ë„ ê°œì„  ìš°ì„ ìˆœìœ„</div>
                                <div id="improvementPriority" class="space-y-2"></div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë¦¬ë” ë·° ì „ì—­ ë³€ìˆ˜
        let isLeaderView = true; // ê¸°ë³¸ê°’: ë¦¬ë” ë·°
        
        // ë¦¬ë” ë·° í† ê¸€ í•¨ìˆ˜
        function toggleViewMode() {
            isLeaderView = !isLeaderView;
            const body = document.body;
            const button = document.getElementById('toggleViewMode');
            const description = document.getElementById('viewModeDescription');
            const leaderViewElements = document.querySelectorAll('.leader-view-only');
            const detailedElements = document.querySelectorAll('.detailed-section');
            
            if (isLeaderView) {
                // ë¦¬ë” ë·° í™œì„±í™”
                body.classList.add('leader-view');
                button.innerHTML = 'ğŸ“Š ë¦¬ë” ë·°';
                button.classList.remove('bg-gray-600');
                button.classList.add('bg-indigo-600');
                description.textContent = 'ë¦¬ë” í”„ë ˆì  í…Œì´ì…˜ ìµœì í™” ë·° - í•µì‹¬ ê²°ê³¼ ì¤‘ì‹¬';
                
                // ë¦¬ë” ë·° ì „ìš© ìš”ì†Œ í‘œì‹œ
                leaderViewElements.forEach(el => el.style.display = '');
                // ìƒì„¸ ìš”ì†Œ ìˆ¨ê¸°ê¸°
                detailedElements.forEach(el => el.style.display = 'none');
            } else {
                // ìƒì„¸ ë·° í™œì„±í™”
                body.classList.remove('leader-view');
                button.innerHTML = 'ğŸ”§ ìƒì„¸ ë·°';
                button.classList.remove('bg-indigo-600');
                button.classList.add('bg-gray-600');
                description.textContent = 'ì „ì²´ ì„¤ì • ë° ìƒì„¸ ë°ì´í„° ë·°';
                
                // ë¦¬ë” ë·° ì „ìš© ìš”ì†Œ ìˆ¨ê¸°ê¸°
                leaderViewElements.forEach(el => el.style.display = 'none');
                // ìƒì„¸ ìš”ì†Œ í‘œì‹œ
                detailedElements.forEach(el => el.style.display = '');
            }
            
            // ë¦¬ë” ë·° KPI ì—…ë°ì´íŠ¸
            if (isLeaderView) {
                updateLeaderViewKPIs();
            }
        }
        
        // Collapsible ì„¹ì…˜ í† ê¸€ í•¨ìˆ˜
        function toggleCollapse(element) {
            element.classList.toggle('collapsed');
            const content = element.nextElementSibling;
            if (content && content.classList.contains('collapsible-content')) {
                content.classList.toggle('collapsed');
            }
        }
        
        // ë¦¬ë” ë·° KPI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLeaderViewKPIs() {
            // Step 1 KPIs
            const totalInvestment = document.getElementById('total_investment_display')?.textContent || '-';
            const roi = document.getElementById('calculatedROI')?.textContent || '-';
            
            document.getElementById('leader_total_investment').textContent = totalInvestment;
            document.getElementById('leader_roi').textContent = roi;
            
            // ì˜ì—…ì´ìµì€ ì„ íƒëœ ê¸°ì¤€ ê¸°ê°„ì˜ ê°’
            const selectedPeriod = document.getElementById('incentive_base_period')?.value || 'p2';
            const profit = document.getElementById(`${selectedPeriod}_profit`)?.textContent || '-';
            document.getElementById('leader_operating_profit').textContent = profit + ' ì–µì›';
            
            // Step 2 KPIs
            const incentivePool = document.getElementById('totalIncentivePool')?.textContent || '-';
            const launchBonus = document.getElementById('lb_total_incentive_distributed')?.textContent || '-';
            
            document.getElementById('leader_incentive_pool').textContent = incentivePool;
            document.getElementById('leader_launch_bonus').textContent = launchBonus;
        }
        
        // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.getElementById('toggleViewMode')?.addEventListener('click', toggleViewMode);
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¦¬ë” ë·°ë¡œ ì‹œì‘
        window.addEventListener('load', () => {
            toggleViewMode(); // ë¦¬ë” ë·° í™œì„±í™”
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // ####################
            // 5.1. ìƒìˆ˜ ë° í—¬í¼ í•¨ìˆ˜
            // ####################

            const shareConfig = {
                threshold_1: 300000000000, // 3000ì–µ
                threshold_2: 500000000000, // 5000ì–µ
                rate_1: 0.45, rate_2: 0.50, rate_3: 0.55
            };

            let projectedProfits = {};
            const periods = ['p1', 'p2', 'p3', 'p4']; // L3 ì¶•ì†Œ ì‹œ ì‹¤ìˆ˜ë¡œ p4ê°€ ì‚­ì œë˜ì—ˆë˜ ê²ƒ ë³µì›
            
            // Step 2 ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜ (Tab 3ì—ì„œ ì°¸ì¡°)
            let calculatedIncentiveValues = {
                t1: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t2: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t3: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t4: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t5: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t6: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t7: { l1: 0, l2: 0, l3: 0, l4: 0 }
            };
            let calculatedBonusValues = {
                t1: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t2: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t3: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t4: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t5: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t6: { l1: 0, l2: 0, l3: 0, l4: 0 },
                t7: { l1: 0, l2: 0, l3: 0, l4: 0 }
            };

            function formatCurrency(num) {
                if (isNaN(num) || num === null || num === undefined) return '-';
                return new Intl.NumberFormat('ko-KR').format(Math.round(num)); 
            }
            function formatCurrencyDisplay(num) {
                if (isNaN(num) || num === null || num === undefined) return '-';
                return new Intl.NumberFormat('ko-KR').format(Math.round(num)) + 'ì›';
            }
            function formatBillion(num) {
                if (isNaN(num) || num === null || num === undefined) return '-';
                return (num / 100000000).toFixed(2);
            }
            function formatCurrencyBillion(num) {
                if (isNaN(num) || num === null || num === undefined) return '-';
                return (num / 100000000).toFixed(2) + 'ì–µì›';
            }
            /**
             * ROIì— ë”°ë¥¸ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
             * @param {number} roi - ROI ê°’ (ë°±ë¶„ìœ¨, ì˜ˆ: 178.5)
             * @returns {number} ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ (ì†Œìˆ˜, ì˜ˆ: 0.20 = 20%)
             */
            function getIncentiveRateByROI(roi) {
                // 1. ROI ìœ íš¨ì„± ê²€ì¦
                const validROI = (typeof roi === 'number' && !isNaN(roi) && isFinite(roi)) ? roi : 0;
                
                // 2. ì…ë ¥ í•„ë“œì—ì„œ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ì½ê¸° (ì•ˆì „í•˜ê²Œ)
                const readRate = (id, fallback) => {
                    const elem = document.getElementById(id);
                    if (!elem) return fallback;
                    
                    const rawValue = elem.value;
                    if (rawValue === '' || rawValue == null) return fallback;
                    
                    const parsed = parseFloat(rawValue);
                    if (isNaN(parsed) || !isFinite(parsed) || parsed < 0 || parsed > 100) {
                        return fallback;
                    }
                    
                    return parsed;
                };
                
                // ê° ROI êµ¬ê°„ë³„ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ (%)
                const rates = {
                    r0: readRate('roi_rate_0_100', 2),      // 0~100%
                    r1: readRate('roi_rate_100_150', 10),   // 100~150%
                    r2: readRate('roi_rate_150_200', 20),   // 150~200%
                    r3: readRate('roi_rate_200_300', 25),   // 200~300%
                    r4: readRate('roi_rate_300_plus', 30)   // 300%+
                };
                
                // 3. ROI êµ¬ê°„ì— ë”°ë¼ ì ìš©í•  ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨(%) ì„ íƒ
                let ratePercent;
                if (validROI <= 100) {
                    ratePercent = rates.r0;
                } else if (validROI <= 150) {
                    ratePercent = rates.r1;
                } else if (validROI <= 200) {
                    ratePercent = rates.r2;
                } else if (validROI <= 300) {
                    ratePercent = rates.r3;
                } else {
                    ratePercent = rates.r4;
                }
                
                // 4. í¼ì„¼íŠ¸ â†’ ì†Œìˆ˜ ë³€í™˜ (20% â†’ 0.20)
                const decimal = ratePercent / 100;
                
                // 5. ìµœì¢… ê²€ì¦
                return (decimal >= 0 && decimal <= 1 && isFinite(decimal)) ? decimal : 0.02;
            }
            function getTotalWeight(counts, weights) {
                // L3ê¹Œì§€ë§Œ ê³„ì‚°í•˜ë„ë¡ ìˆ˜ì •
                return (counts[0] * weights[0]) + (counts[1] * weights[1]) + (counts[2] * weights[2]);
            }
            function getValue(id, isFloat = false) {
                const el = document.getElementById(id);
                if (!el) return 0;
                const value = isFloat ? parseFloat(el.value) : parseInt(el.value, 10);
                return isNaN(value) ? 0 : value;
            }
            function getText(id) {
                const el = document.getElementById(id);
                if (el && el.type === 'range') return Number(el.value);
                return el ? el.value : '';
            }
            function setValue(id, value) {
                const el = document.getElementById(id);
                if (el) el.value = value;
            }
            function setText(id, value) {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            }

            // P&L ìƒì„¸ ë¡œì§
            // [MODIFIED] roiMethodì— ë”°ë¼ ë¶„ìë§Œ ë°”ê¾¸ê³  ë¶„ëª¨ëŠ” cumulativeCostë¡œ í†µì¼
            function calculatePAndL(total_investment, periodAmortizedCost, amortization_periods, revenues, op_costs, mgAmount) {
                projectedProfits = {}; 
                let cumulativeRevenueG = 0; 
                let cumulativeCost = 0;
                let cumulativeProfit = 0;
                let cumulativeSupercatNetRevenue = 0; // ëˆ„ì  ìˆœë§¤ì¶œ(S) ì¶”ì 
                let cumulativeNetProfit = 0; // ëˆ„ì  ë‹¹ê¸°ìˆœì´ìµ ì¶”ì 
                
                // MG(Minimum Guarantee) ìƒí™˜ ì¶”ì  ë³€ìˆ˜
                let mgRemaining = mgAmount; // ë‚¨ì€ MG ì”ì•¡ (ìŠ¬ë¼ì´ë”ì—ì„œ ì…ë ¥ë°›ìŒ)

                periods.forEach((p, index) => {
                    const revenue = revenues[p] || 0;
                    // Note: total_investmentëŠ” (ê°œë°œë¹„+ë³´ë„ˆìŠ¤) í•©ê³„
                    const amortization = (index < amortization_periods) ? periodAmortizedCost : 0;
                    const operating_cost = op_costs[p] || 0;
                    
                    // --- ìˆœë§¤ì¶œ(S) ê³„ì‚° (êµ¬ê°„ë³„ ëˆ„ì§„ ì ìš©) ---
                    const initialNetRevenue = revenue * 0.70; // (ì°¸ê³ ìš©: ë°°ë¶„ ì „)
                    let supercatNetRevenue = 0; // (ìµœì¢… ìˆœë§¤ì¶œS)
                    const newCumulativeG = cumulativeRevenueG + revenue;
                    
                    // 55% êµ¬ê°„ (5000ì–µ ì´ˆê³¼)
                    const revIn55 = Math.max(0, newCumulativeG - shareConfig.threshold_2) - Math.max(0, cumulativeRevenueG - shareConfig.threshold_2);
                    supercatNetRevenue += (revIn55 * 0.70) * shareConfig.rate_3; // (ë§¤ì¶œG * 70%) * 55%
                    // 50% êµ¬ê°„ (3000ì–µ ì´ˆê³¼ 5000ì–µ ì´í•˜)
                    const revIn50 = Math.max(0, Math.min(newCumulativeG, shareConfig.threshold_2) - shareConfig.threshold_1) - Math.max(0, Math.min(cumulativeRevenueG, shareConfig.threshold_2) - shareConfig.threshold_1);
                    supercatNetRevenue += (revIn50 * 0.70) * shareConfig.rate_2; // (ë§¤ì¶œG * 70%) * 50%
                    // 45% êµ¬ê°„ (3000ì–µ ì´í•˜)
                    const revIn45 = Math.max(0, Math.min(newCumulativeG, shareConfig.threshold_1)) - Math.max(0, Math.min(cumulativeRevenueG, shareConfig.threshold_1));
                    supercatNetRevenue += (revIn45 * 0.70) * shareConfig.rate_1; // (ë§¤ì¶œG * 70%) * 45%

                    cumulativeRevenueG = newCumulativeG; // ë‹¤ìŒ ê¸°ê°„ì„ ìœ„í•´ ëˆ„ì (G)
                    
                    // --- MG ìƒí™˜ ë¡œì§ ---
                    let actualSupercatNetRevenue = supercatNetRevenue; // ì‹¤ì œ ìˆœë§¤ì¶œ (MG ìƒí™˜ í›„)
                    let mgRepayment = 0; // ì´ë²ˆ ê¸°ê°„ MG ìƒí™˜ì•¡
                    
                    if (mgRemaining > 0) {
                        // MG ì”ì•¡ì´ ë‚¨ì•„ìˆìœ¼ë©´ ìˆœë§¤ì¶œì—ì„œ ìš°ì„  ìƒí™˜
                        mgRepayment = Math.min(supercatNetRevenue, mgRemaining);
                        mgRemaining -= mgRepayment;
                        actualSupercatNetRevenue = supercatNetRevenue - mgRepayment;
                        
                        console.log(`[${p}] MG ìƒí™˜: ${formatCurrencyBillion(mgRepayment)}, MG ì”ì•¡: ${formatCurrencyBillion(mgRemaining)}, ì‹¤ì œ ìˆœë§¤ì¶œ: ${formatCurrencyBillion(actualSupercatNetRevenue)}`);
                    }
                    
                    cumulativeSupercatNetRevenue += actualSupercatNetRevenue; // ì‹¤ì œ ìˆœë§¤ì¶œë§Œ ëˆ„ì 
                    // --- ---

                    const total_cost = amortization + operating_cost;
                    const profit = actualSupercatNetRevenue - total_cost; // MG ìƒí™˜ í›„ ìˆœë§¤ì¶œë¡œ ê³„ì‚°
                    
                    cumulativeCost += total_cost;
                    cumulativeProfit += profit;

                    // ========================================
                    // ROI ë° ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ê³„ì‚° (ì™„ì „ ìƒˆë¡œ ì‘ì„±)
                    // ========================================
                    
                    // 1. ROI ê³„ì‚°: ëˆ„ì  ìˆœë§¤ì¶œ(S) / ì´ ëˆ„ì  ë¹„ìš©
                    let periodROI = 0;
                    if (cumulativeCost > 0) {
                        periodROI = (cumulativeSupercatNetRevenue / cumulativeCost) * 100;
                    }
                    
                    // 2. ROI ê°’ ê²€ì¦ ë° ì •ë¦¬
                    if (!isFinite(periodROI) || isNaN(periodROI)) {
                        periodROI = 0;
                    }
                    
                    // 3. ROIì— ë”°ë¥¸ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ê²°ì •
                    const incentiveRate = getIncentiveRateByROI(periodROI);
                    
                    // 4. ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ê²€ì¦
                    const validIncentiveRate = (!isNaN(incentiveRate) && isFinite(incentiveRate) && incentiveRate >= 0) 
                        ? incentiveRate 
                        : 0.02;

                    // 5. ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ ê³„ì‚° (ROI êµ¬ê°„ë³„ ì°¨ë“± ì ìš©, MG ìƒí™˜ í›„ ì‹¤ì œ ìˆœë§¤ì¶œ ê¸°ì¤€)
                    let incentiveAmount = 0;
                    if (periodROI < 100) {
                        // ROI < 100%: ì‹¤ì œ ìˆœë§¤ì¶œì˜ 2% (BEP ë¯¸ë‹¬ êµ¬ê°„, MG ìƒí™˜ í›„)
                        incentiveAmount = actualSupercatNetRevenue * 0.02;
                        console.log(`[${p}] ROI < 100% â†’ ì‹¤ì œ ìˆœë§¤ì¶œ ê¸°ì¤€: ${formatCurrencyBillion(actualSupercatNetRevenue)} * 2% = ${formatCurrencyBillion(incentiveAmount)}`);
                    } else {
                        // ROI >= 100%: ì˜ì—…ì´ìµ * ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ (ì´ë¯¸ MG ìƒí™˜ í›„ ìˆœë§¤ì¶œë¡œ ê³„ì‚°ëœ profit ì‚¬ìš©)
                        incentiveAmount = (profit > 0) ? (profit * validIncentiveRate) : 0;
                        console.log(`[${p}] ROI â‰¥ 100% â†’ ì˜ì—…ì´ìµ ê¸°ì¤€: ${formatCurrencyBillion(profit)} * ${(validIncentiveRate*100).toFixed(0)}% = ${formatCurrencyBillion(incentiveAmount)}`);
                    }

                    // 6. P&L ê³„ì‚° ê²°ê³¼ë¥¼ ì „ì—­ ê°ì²´ì— ì €ì¥
                    projectedProfits[p] = { 
                        profit: profit,
                        cumulativeProfit: cumulativeProfit,
                        periodROI: periodROI,
                        incentiveRate: validIncentiveRate,
                        supercatNetRevenue: actualSupercatNetRevenue, // MG ìƒí™˜ í›„ ì‹¤ì œ ìˆœë§¤ì¶œ
                        cumulativeSupercatNetRevenue: cumulativeSupercatNetRevenue,
                        cumulativeCost: cumulativeCost,
                        incentiveAmount: incentiveAmount,  // ê³„ì‚°ëœ ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ ì €ì¥
                        mgRepayment: mgRepayment, // MG ìƒí™˜ì•¡ (ì¶”ì ìš©)
                        mgRemaining: mgRemaining  // MG ì”ì•¡ (ì¶”ì ìš©)
                    };

                    // 6. P&L í…Œì´ë¸” UI ì—…ë°ì´íŠ¸ (ë‹¨ìœ„: ì–µì›)
                    setValue(`${p}_revenue`, formatBillion(revenue));
                    setText(`${p}_pre_dist`, formatCurrencyBillion(initialNetRevenue));
                    // ìˆœë§¤ì¶œ(S)ì€ MG ìƒí™˜ í›„ ì‹¤ì œ ìˆœë§¤ì¶œ í‘œì‹œ
                    setText(`${p}_supercat_net`, formatCurrencyBillion(actualSupercatNetRevenue));
                    setValue(`${p}_amortization`, formatBillion(amortization));
                    setText(`${p}_total_cost`, formatCurrencyBillion(total_cost));
                    setText(`${p}_profit`, formatCurrencyBillion(profit));
                    setText(`${p}_cum_cost`, formatCurrencyBillion(cumulativeCost));
                    setText(`${p}_cum_profit`, formatCurrencyBillion(cumulativeProfit));
                    
                    // ROI í‘œì‹œ (ì†Œìˆ˜ì  1ìë¦¬)
                    const roiText = periodROI.toFixed(1) + '%';
                    setText(`${p}_roi`, roiText);
                    
                    // ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ í‘œì‹œ (ì •ìˆ˜)
                    const incentiveRatePercent = Math.round(validIncentiveRate * 100);
                    const incentiveRateText = incentiveRatePercent + '%';
                    setText(`${p}_incentive_rate`, incentiveRateText);
                    
                    // ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ í‘œì‹œ (ì´ë¯¸ ê³„ì‚°ëœ ê°’ ì‚¬ìš©)
                    setText(`${p}_incentive_amount`, formatCurrencyBillion(incentiveAmount));
                    
                    // OQìˆœì´ìµ ê³„ì‚° (ì˜ì—…ì´ìµ - ì¸ì„¼í‹°ë¸Œ)
                    const oqProfit = profit - incentiveAmount;
                    const oqProfitColor = oqProfit >= 0 ? 'text-green-600' : 'text-red-600';
                    const oqProfitEl = document.getElementById(`${p}_oq_profit`);
                    if (oqProfitEl) {
                        oqProfitEl.textContent = formatCurrencyBillion(oqProfit);
                        oqProfitEl.className = `pl-table-output calc-output ${oqProfitColor}`;
                    }
                    
                    // OQì™¸ ë¹„ìš© (input í•„ë“œì—ì„œ ì½ì–´ì˜´, ë‹¨ìœ„: ì–µì›)
                    const nonOqCostBillion = getValue(`${p}_non_oq_cost`) || 0;
                    const nonOqCost = nonOqCostBillion * 100000000; // ì–µì› -> ì› ë‹¨ìœ„ë¡œ ë³€í™˜
                    
                    // ë‹¹ê¸°ìˆœì´ìµ ê³„ì‚° (OQìˆœì´ìµ - OQì™¸ ë¹„ìš©)
                    const netProfit = oqProfit - nonOqCost;
                    cumulativeNetProfit += netProfit;
                    
                    const netProfitColor = netProfit >= 0 ? 'text-green-600' : 'text-red-600';
                    const netProfitEl = document.getElementById(`${p}_net_profit`);
                    if (netProfitEl) {
                        netProfitEl.textContent = formatCurrencyBillion(netProfit);
                        netProfitEl.className = `pl-table-output calc-output ${netProfitColor}`;
                    }
                    
                    // ëˆ„ì  ë‹¹ê¸°ìˆœì´ìµ í‘œì‹œ
                    const cumNetProfitColor = cumulativeNetProfit >= 0 ? 'text-green-600' : 'text-red-600';
                    const cumNetProfitEl = document.getElementById(`${p}_cum_net_profit`);
                    if (cumNetProfitEl) {
                        cumNetProfitEl.textContent = formatCurrencyBillion(cumulativeNetProfit);
                        cumNetProfitEl.className = `pl-table-output calc-output ${cumNetProfitColor}`;
                    }
                });
            }


            // ####################
            // 5.2. calculateAll í•¨ìˆ˜ (ë©”ì¸ ë¡œì§)
            // ####################
            function calculateAll() {
                
                // ---------------------
                // Phase 1: ì…ë ¥ê°’ ì½ê¸° (Read)
                // ---------------------
                
                const revenueScenarioKey = getText('revenueScenario');

                const total_investment_slider = getValue('total_investment_slider'); // ì¶œì‹œì „ ê°œë°œë¹„ (ìŠ¬ë¼ì´ë”)
                const launchBonusSlider = getValue('launchBonusSlider'); // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ (ìŠ¬ë¼ì´ë”)
                const totalLaunchBonusPool = launchBonusSlider * 100000000; // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ (ì›)
                
                // [MODIFIED] ì´ íˆ¬ìë¹„ = ê°œë°œë¹„ + ëŸ°ì¹­ ë³´ë„ˆìŠ¤
                const total_investment = (total_investment_slider + launchBonusSlider) * 100000000; 
                
                const amortization_periods = getValue('amortization_periods');
                const op_costs = {
                    p1: getValue('p1_op_cost') * 100000000, // ì–µì› -> ì›
                    p2: getValue('p2_op_cost') * 100000000,
                    p3: getValue('p3_op_cost') * 100000000,
                    p4: getValue('p4_op_cost') * 100000000
                };

                // Step 1 - ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ë¡œì§
                const base_p1_revenue_b = getValue('base_p1_revenue'); // 1000 (ì–µì›)
                const base_p1_revenue_w = base_p1_revenue_b * 100000000; // ì›
                const best_multiplier = getValue('best_multiplier') / 100; // 1.5
                const worst_multiplier = getValue('worst_multiplier') / 100; // 0.5
                const p2_retention = getValue('p2_retention') / 100; // 0.6
                const p3_retention = getValue('p3_retention') / 100; // 0.85
                const p4_retention = getValue('p4_retention') / 100; // 0.85

                // Step 2 (L1~L3ë¡œ ì¶•ì†Œ)
                const weights = {
                    l1: getValue('w1', true), l2: getValue('w2', true), l3: getValue('w3', true)
                };
                const weightsArr = [weights.l1, weights.l2, weights.l3]; // T5 ê³„ì‚°ìš©

                const t_counts = {
                    t1: { l1: getValue('t1_l1'), l2: getValue('t1_l2'), l3: getValue('t1_l3') },
                    t2: { l1: getValue('t2_l1'), l2: getValue('t2_l2'), l3: getValue('t2_l3') },
                    t3: { l1: getValue('t3_l1'), l2: getValue('t3_l2'), l3: getValue('t3_l3') },
                    t4: { l1: getValue('t4_l1'), l2: getValue('t4_l2'), l3: getValue('t4_l3') },
                    t5: { l1: getValue('t5_l1'), l2: getValue('t5_l2'), l3: getValue('t5_l3') },
                    t6: { l1: getValue('t6_l1'), l2: getValue('t6_l2'), l3: getValue('t6_l3') }
                };

                const selectedPeriod = getText('periodSelect'); // 'p1', 'p2', 'p3', 'p4'

                // ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ Tier ë°°ìœ¨ ë¡œì§ ì…ë ¥ê°’ (T6 ê¸°ì¤€)
                const pi_t6_t5_rate = getValue('pi_t6_t5_rate') / 100; // 5.0 (ê¸°ë³¸ê°’, 500% ì¦ê°€)
                const pi_t5_t4_rate = getValue('pi_t5_t4_rate') / 100; // 0.2
                const pi_t4_t3_rate = getValue('pi_t4_t3_rate') / 100; // 0.3
                const pi_t3_t2_rate = getValue('pi_t3_t2_rate') / 100; // 1.0
                const pi_t2_t1_rate = getValue('pi_t2_t1_rate') / 100; // 2.0 (200% ì¦ê°€)
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ Tier ë°°ìœ¨ ë¡œì§ ì…ë ¥ê°’ (T6 ê¸°ì¤€, ì™„ë§Œí•œ ë°°ìœ¨)
                const lb_t6_t5_rate_mult = getValue('lb_t6_t5_rate') / 100; // 5.0 (ê¸°ë³¸ê°’, 500% ì¦ê°€)
                const lb_t5_t4_rate_mult = getValue('lb_t5_t4_rate') / 100; // 0.15
                const lb_t4_t3_rate_mult = getValue('lb_t4_t3_rate') / 100; // 0.2
                const lb_t3_t2_rate_mult = getValue('lb_t3_t2_rate') / 100; // 0.5
                const lb_t2_t1_rate_mult = getValue('lb_t2_t1_rate') / 100; // 1.0 (100% ì¦ê°€)
                
                // T7 í’€ í• ë‹¹ ë¹„ìœ¨ (ë¹„ì°¸ì—¬ì - 0%)
                const lb_t7_pool_rate_slider_el = document.getElementById('lb_t7_pool_rate_slider');
                const lb_t7_rate_percent = 0; // T7ì€ ë¹„ì°¸ì—¬ì, í•­ìƒ 0%
                const lb_t7_rate = 0; // 0%
                
                // Step 3 (T7 ì¸ì› ì…ë ¥, L1~L3ë¡œ ì¶•ì†Œ) - ë¹„ì°¸ì—¬ìì´ë¯€ë¡œ í•­ìƒ 0
                const lb_t7_counts = {
                    l1: getValue('lb_t7_l1') || 0, l2: getValue('lb_t7_l2') || 0, l3: getValue('lb_t7_l3') || 0
                };
                const lb_t7_countsArr = [lb_t7_counts.l1, lb_t7_counts.l2, lb_t7_counts.l3];

                
                // ---------------------
                // Phase 1.5: ë™ì  ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±
                // ---------------------
                const revenueScenarios = { base: {}, best: {}, worst: {} };
                // 1. Base ì‹œë‚˜ë¦¬ì˜¤ ê³„ì‚°
                revenueScenarios.base.p1 = base_p1_revenue_w;
                revenueScenarios.base.p2 = revenueScenarios.base.p1 * p2_retention;
                revenueScenarios.base.p3 = revenueScenarios.base.p2 * p3_retention;
                revenueScenarios.base.p4 = revenueScenarios.base.p3 * p4_retention;
                // 2. Best/Worst ì‹œë‚˜ë¦¬ì˜¤ ê³„ì‚°
                periods.forEach(p => {
                    revenueScenarios.best[p] = revenueScenarios.base[p] * best_multiplier;
                    revenueScenarios.worst[p] = revenueScenarios.base[p] * worst_multiplier;
                });


                // ---------------------
                // Phase 1: P&L ê³„ì‚° (ë™ì  ì‹œë‚˜ë¦¬ì˜¤ ì ìš©)
                // ---------------------
                
                // [MODIFIED] ê¸°ê°„ë‹¹ ìƒê°ë¹„ ê³„ì‚° (ì´ íˆ¬ìë¹„ / ê¸°ê°„)
                const periodAmortizedCost = (amortization_periods > 0) ? total_investment / amortization_periods : 0;

                // Step 1 ìƒë‹¨ UI ì—…ë°ì´íŠ¸
                // [MODIFIED] ì´ íˆ¬ìë¹„ í‘œì‹œ (ê°œë°œë¹„ + ë³´ë„ˆìŠ¤)
                const total_investment_display_value = total_investment_slider + launchBonusSlider;
                setText('total_investment_display', `${total_investment_display_value}ì–µì›`); 
                setText('launchBonusDisplay', `${launchBonusSlider}ì–µì›`);
                
                // MG ìŠ¬ë¼ì´ë” ê°’ ì½ê¸° ë° í‘œì‹œ
                const mgSliderValue = getValue('mg_slider'); // ì–µì› ë‹¨ìœ„
                const mgAmount = mgSliderValue * 100000000; // ì› ë‹¨ìœ„ë¡œ ë³€í™˜
                setText('mg_display', `${mgSliderValue}ì–µì›`);
                
                // P&L ì¶”ì • ì„¤ëª… í…ìŠ¤íŠ¸ ë³€ê²½
                const preLaunchCostOnly = total_investment_slider * 100000000;
                setText('amortization_desc', 
                    `ì´ íˆ¬ìë¹„ ${formatCurrencyBillion(total_investment)} (ì¶œì‹œì „ ê°œë°œë¹„ ${formatCurrencyBillion(preLaunchCostOnly)} + ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ${formatCurrencyBillion(totalLaunchBonusPool)})ì„ ${amortization_periods} Period ìƒê° (ê¸°ê°„ë‹¹ ${formatCurrencyBillion(periodAmortizedCost)})`
                );
                
                // P&L ìƒì„¸ ê³„ì‚° í•¨ìˆ˜ í˜¸ì¶œ (MG ê¸ˆì•¡ ì „ë‹¬)
                calculatePAndL(total_investment, periodAmortizedCost, amortization_periods, revenueScenarios[revenueScenarioKey], op_costs, mgAmount);


                // ---------------------
                // Phase 2: ì¸ì„¼í‹°ë¸Œ ì¬ì› ê³„ì‚°
                // ---------------------

                // P&L ê³„ì‚° í•¨ìˆ˜ì—ì„œ ì €ì¥ëœ, 'selectedPeriod'ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
                const operatingProfit = projectedProfits[selectedPeriod]?.profit || 0;
                
                // [MODIFIED] ROIì™€ ì¸ì„¼ ë¹„ìœ¨ì„ P&L ê³„ì‚° ê²°ê³¼ì—ì„œ ì§ì ‘ ê°€ì ¸ì˜´
                const calculatedROI_pct = projectedProfits[selectedPeriod]?.periodROI || 0;
                const incentiveRate = projectedProfits[selectedPeriod]?.incentiveRate || 0; 
                
                // [FIXED] P&Lì—ì„œ ê³„ì‚°ëœ ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ì„ ì§ì ‘ ì‚¬ìš© (ROI êµ¬ê°„ë³„ ë¡œì§ ë°˜ì˜ë¨)
                const totalIncentivePool = projectedProfits[selectedPeriod]?.incentiveAmount || 0;
                
                // ê²€ì¦ ë¡œê·¸
                console.log('=== Step 3 ì¸ì„¼í‹°ë¸Œ ì¬ì› ê²€ì¦ ===');
                console.log(`ì„ íƒëœ ê¸°ê°„: ${selectedPeriod}`);
                console.log(`ì˜ì—…ì´ìµ: ${formatCurrencyBillion(operatingProfit)}`);
                console.log(`ROI: ${calculatedROI_pct.toFixed(1)}%`);
                console.log(`ì¸ì„¼ ë¹„ìœ¨: ${(incentiveRate * 100).toFixed(0)}%`);
                console.log(`ì´ ì¸ì„¼í‹°ë¸Œ ì¬ì› (P&Lì—ì„œ ê³„ì‚°ë¨): ${formatCurrencyBillion(totalIncentivePool)}`);
                console.log('================================');
                
                // ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡ ê³„ì‚°
                const leaderDiscretionRate = getValue('leaderDiscretionSlider') / 100; // 0 ~ 0.15
                const leaderDiscretionAmount = totalIncentivePool * leaderDiscretionRate;
                const distributionIncentivePool = totalIncentivePool - leaderDiscretionAmount; // ì‹¤ì œ ë°°ë¶„í•  ê¸ˆì•¡

                // Tierë³„ í‰ê·  ì›”ê¸‰ ê³„ì‚° (Step 3ì˜ employees ë°ì´í„° í™œìš©)
                const tierAverageMonthlySalary = {
                    t1: 0, t2: 0, t3: 0, t4: 0
                };
                const tierSalarySums = { t1: 0, t2: 0, t3: 0, t4: 0 };
                const tierCounts = { t1: 0, t2: 0, t3: 0, t4: 0 };
                
                employees.forEach(emp => {
                    const tierKey = 't' + emp.tier;
                    if (tierKey in tierSalarySums) {
                        tierSalarySums[tierKey] += emp.salary;
                        tierCounts[tierKey]++;
                    }
                });
                
                // í‰ê·  ì—°ë´‰ ê³„ì‚° í›„ ì›”ê¸‰ìœ¼ë¡œ ë³€í™˜
                ['t1', 't2', 't3', 't4'].forEach(tier => {
                    if (tierCounts[tier] > 0) {
                        const avgYearlySalary = tierSalarySums[tier] / tierCounts[tier];
                        tierAverageMonthlySalary[tier] = avgYearlySalary / 12;
                    }
                });


                
                // ---------------------
                // Phase 3: ë°°ë¶„ ê³„ì‚° (Tier ë°°ìœ¨ ë¡œì§)
                // ---------------------
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ í’€ ë¶„í•  (T7ì€ ë¹„ì°¸ì—¬ì, ë³„ë„ í’€ í• ë‹¹í•˜ì§€ ì•ŠìŒ - 0%)
                const lb_t7_pool = 0; // T7: ë¹„ì°¸ì—¬ì, ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¯¸ì§€ê¸‰
                const totalLaunchBonus_t1_t6 = totalLaunchBonusPool; // T1-T6: 100% í• ë‹¹

                // 1. ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ Tierë³„ ìŠ¹ìˆ˜(Multiplier) ê³„ì‚° (T6 ê¸°ì¤€ 1.0)
                const pi_multipliers = {
                    t6: 1.0, // T6 Base (ìµœí•˜ìœ„)
                    t5: 1.0 * (1 + pi_t6_t5_rate), // T6ì˜ 500% ì¦ê°€ = 6.0
                    t4: 1.0 * (1 + pi_t6_t5_rate) * (1 + pi_t5_t4_rate),
                    t3: 1.0 * (1 + pi_t6_t5_rate) * (1 + pi_t5_t4_rate) * (1 + pi_t4_t3_rate), 
                    t2: 1.0 * (1 + pi_t6_t5_rate) * (1 + pi_t5_t4_rate) * (1 + pi_t4_t3_rate) * (1 + pi_t3_t2_rate), 
                    t1: 1.0 * (1 + pi_t6_t5_rate) * (1 + pi_t5_t4_rate) * (1 + pi_t4_t3_rate) * (1 + pi_t3_t2_rate) * (1 + pi_t2_t1_rate) 
                };
                
                // 2. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ Tierë³„ ìŠ¹ìˆ˜(Multiplier) ê³„ì‚° (T6 ê¸°ì¤€ 1.0, ì™„ë§Œí•œ ë°°ìœ¨)
                const lb_multipliers = {
                    t6: 1.0, // T6 Base (ìµœí•˜ìœ„)
                    t5: 1.0 * (1 + lb_t6_t5_rate_mult), // T6ì˜ 500% ì¦ê°€ = 6.0
                    t4: 1.0 * (1 + lb_t6_t5_rate_mult) * (1 + lb_t5_t4_rate_mult),
                    t3: 1.0 * (1 + lb_t6_t5_rate_mult) * (1 + lb_t5_t4_rate_mult) * (1 + lb_t4_t3_rate_mult), 
                    t2: 1.0 * (1 + lb_t6_t5_rate_mult) * (1 + lb_t5_t4_rate_mult) * (1 + lb_t4_t3_rate_mult) * (1 + lb_t3_t2_rate_mult), 
                    t1: 1.0 * (1 + lb_t6_t5_rate_mult) * (1 + lb_t5_t4_rate_mult) * (1 + lb_t4_t3_rate_mult) * (1 + lb_t3_t2_rate_mult) * (1 + lb_t2_t1_rate_mult) 
                };

                // [v5.1.3b] L2 ìµœì†Œ ë³´ìƒ ë³´ì • ë¡œì§ (L3ê¹Œì§€ë§Œ ê³„ì‚°)
                // 1-1. ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ê¸°ì¤€ L3 ìœ ë‹› ê³„ì‚° (T1-T6 ì „ì²´ ì°¸ì—¬)
                const pi_unit_values_l3 = {
                    t6: pi_multipliers.t6 * weights.l3, // T6_L3 (ìµœí•˜ìœ„)
                    t5: pi_multipliers.t5 * weights.l3, // T5_L3
                    t4: pi_multipliers.t4 * weights.l3, // T4_L3
                    t3: pi_multipliers.t3 * weights.l3, // T3_L3
                    t2: pi_multipliers.t2 * weights.l3, // T2_L3
                    t1: pi_multipliers.t1 * weights.l3  // T1_L3
                };
                
                // 1-2. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ê¸°ì¤€ L3 ìœ ë‹› ê³„ì‚° (T1-T6 ì „ì²´ ì°¸ì—¬)
                const lb_unit_values_l3 = {
                    t6: lb_multipliers.t6 * weights.l3, // T6_L3 (ìµœí•˜ìœ„)
                    t5: lb_multipliers.t5 * weights.l3, // T5_L3
                    t4: lb_multipliers.t4 * weights.l3, // T4_L3
                    t3: lb_multipliers.t3 * weights.l3, // T3_L3
                    t2: lb_multipliers.t2 * weights.l3, // T2_L3
                    t1: lb_multipliers.t1 * weights.l3  // T1_L3
                };

                // 2-1. ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë³´ì • ìœ ë‹› ê³„ì‚° (L1, L2, L3) - T1-T6 ì „ì²´ ì°¸ì—¬
                const pi_final_reward_units_per_person = {
                    t6: {
                        l1: pi_multipliers.t6 * weights.l1,
                        l2: pi_multipliers.t6 * weights.l2, // T6ì€ ìµœí•˜ìœ„ì´ë¯€ë¡œ ë³´ì • ì—†ìŒ
                        l3: pi_unit_values_l3.t6
                    },
                    t5: {
                        l1: pi_multipliers.t5 * weights.l1,
                        l2: Math.max(pi_multipliers.t5 * weights.l2, pi_unit_values_l3.t6 * 1.1 / weights.l3 * weights.l2), // T5_L2 vs (T6_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: pi_unit_values_l3.t5
                    },
                    t4: {
                        l1: pi_multipliers.t4 * weights.l1,
                        l2: Math.max(pi_multipliers.t4 * weights.l2, pi_unit_values_l3.t5 * 1.1 / weights.l3 * weights.l2), // T4_L2 vs (T5_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: pi_unit_values_l3.t4
                    },
                    t3: {
                        l1: pi_multipliers.t3 * weights.l1,
                        l2: Math.max(pi_multipliers.t3 * weights.l2, pi_unit_values_l3.t4 * 1.1 / weights.l3 * weights.l2), // T3_L2 vs (T4_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: pi_unit_values_l3.t3
                    },
                    t2: {
                        l1: pi_multipliers.t2 * weights.l1,
                        l2: Math.max(pi_multipliers.t2 * weights.l2, pi_unit_values_l3.t3 * 1.1 / weights.l3 * weights.l2), // T2_L2 vs (T3_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: pi_unit_values_l3.t2
                    },
                    t1: {
                        l1: pi_multipliers.t1 * weights.l1,
                        l2: Math.max(pi_multipliers.t1 * weights.l2, pi_unit_values_l3.t2 * 1.1 / weights.l3 * weights.l2), // T1_L2 vs (T2_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: pi_unit_values_l3.t1
                    }
                };
                
                // 2-2. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë³´ì • ìœ ë‹› ê³„ì‚° (L1, L2, L3) - T1-T6 ì „ì²´ ì°¸ì—¬
                const lb_final_reward_units_per_person = {
                    t6: {
                        l1: lb_multipliers.t6 * weights.l1,
                        l2: lb_multipliers.t6 * weights.l2, // T6ì€ ìµœí•˜ìœ„ì´ë¯€ë¡œ ë³´ì • ì—†ìŒ
                        l3: lb_unit_values_l3.t6
                    },
                    t5: {
                        l1: lb_multipliers.t5 * weights.l1,
                        l2: Math.max(lb_multipliers.t5 * weights.l2, lb_unit_values_l3.t6 * 1.1 / weights.l3 * weights.l2), // T5_L2 vs (T6_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: lb_unit_values_l3.t5
                    },
                    t4: {
                        l1: lb_multipliers.t4 * weights.l1,
                        l2: Math.max(lb_multipliers.t4 * weights.l2, lb_unit_values_l3.t5 * 1.1 / weights.l3 * weights.l2), // T4_L2 vs (T5_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: lb_unit_values_l3.t4
                    },
                    t3: {
                        l1: lb_multipliers.t3 * weights.l1,
                        l2: Math.max(lb_multipliers.t3 * weights.l2, lb_unit_values_l3.t4 * 1.1 / weights.l3 * weights.l2), // T3_L2 vs (T4_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: lb_unit_values_l3.t3
                    },
                    t2: {
                        l1: lb_multipliers.t2 * weights.l1,
                        l2: Math.max(lb_multipliers.t2 * weights.l2, lb_unit_values_l3.t3 * 1.1 / weights.l3 * weights.l2), // T2_L2 vs (T3_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: lb_unit_values_l3.t2
                    },
                    t1: {
                        l1: lb_multipliers.t1 * weights.l1,
                        l2: Math.max(lb_multipliers.t1 * weights.l2, lb_unit_values_l3.t2 * 1.1 / weights.l3 * weights.l2), // T1_L2 vs (T2_L3 * 1.1)ì„ L2 ê°€ì¤‘ì¹˜ ë¹„ìœ¨ë¡œ ë³€í™˜
                        l3: lb_unit_values_l3.t1
                    }
                };
                // --- ---

                // 2. "ì´ ë³´ìƒ ìœ ë‹›" ê³„ì‚° (T1-T6 í•´ë‹¹) - L3ê¹Œì§€ë§Œ ê³„ì‚°
                let total_reward_units_t1_t6 = 0;
                const tiers = ['t1', 't2', 't3', 't4', 't5', 't6'];
                let tier_details = {}; // ì¤‘ê°„ ë°ì´í„° ì €ì¥

                tiers.forEach(tier => {
                    const tier_counts_l1 = t_counts[tier].l1;
                    const tier_counts_l2 = t_counts[tier].l2;
                    const tier_counts_l3 = t_counts[tier].l3;
                    const tier_total_count = tier_counts_l1 + tier_counts_l2 + tier_counts_l3;
                    
                    let tier_reward_units = 0;
                    // [MODIFIED] ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë³´ì • ìœ ë‹›(pi_final_reward_units_per_person)ì„ ì‚¬ìš©
                    tier_reward_units += tier_counts_l1 * pi_final_reward_units_per_person[tier].l1;
                    tier_reward_units += tier_counts_l2 * pi_final_reward_units_per_person[tier].l2;
                    tier_reward_units += tier_counts_l3 * pi_final_reward_units_per_person[tier].l3;
                    
                    total_reward_units_t1_t6 += tier_reward_units;
                    
                    tier_details[tier] = {
                        tier_total_count: tier_total_count,
                        tier_reward_units: tier_reward_units
                    };
                });
                
                // 3-1. ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ "ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡" ê³„ì‚° (ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡ ì œì™¸ í›„ ë°°ë¶„)
                const master_base_value = (total_reward_units_t1_t6 > 0) ? (distributionIncentivePool / total_reward_units_t1_t6) : 0;
                
                // 3-2. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ "ì´ ë³´ìƒ ìœ ë‹›" ê³„ì‚° (ë…ë¦½ì ì¸ ë°°ìœ¨ ì‚¬ìš©)
                let lb_total_reward_units_t1_t6 = 0;
                tiers.forEach(tier => {
                    const tier_counts_l1 = t_counts[tier].l1;
                    const tier_counts_l2 = t_counts[tier].l2;
                    const tier_counts_l3 = t_counts[tier].l3;
                    
                    let lb_tier_reward_units = 0;
                    lb_tier_reward_units += tier_counts_l1 * lb_final_reward_units_per_person[tier].l1;
                    lb_tier_reward_units += tier_counts_l2 * lb_final_reward_units_per_person[tier].l2;
                    lb_tier_reward_units += tier_counts_l3 * lb_final_reward_units_per_person[tier].l3;
                    
                    lb_total_reward_units_t1_t6 += lb_tier_reward_units;
                });
                
                // 3-3. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ "ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡" ê³„ì‚°
                const lb_master_base_value_t1_t6 = (lb_total_reward_units_t1_t6 > 0) ? (totalLaunchBonus_t1_t6 / lb_total_reward_units_t1_t6) : 0;

                // T7 ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ê³„ì‚° (ë¹„ì°¸ì—¬ì - 0ì›)
                const lb_t7_reward_units = 0;
                const lb_t7_master_base = 0; // T7ì€ ë¹„ì°¸ì—¬ì, ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¯¸ì§€ê¸‰


                // 4. UI ë Œë”ë§ì„ ìœ„í•œ ë°ì´í„° ì§‘ê³„ (L3ê¹Œì§€ë§Œ)
                let tierData = [];
                let total_headcount_t1_t6 = 0, total_incentive_t1_t6 = 0, total_lb_t1_t6 = 0;
                let total_incentive_t1_t2 = 0, total_headcount_t1_t2 = 0; 
                let total_lb_incentive_t1_t2 = 0, total_lb_headcount_t1_t2 = 0;

                tiers.forEach(tier => {
                    const { tier_total_count, tier_reward_units } = tier_details[tier];
                    const tier_counts_l1 = t_counts[tier].l1;
                    const tier_counts_l2 = t_counts[tier].l2;
                    const tier_counts_l3 = t_counts[tier].l3;
                    
                    const tier_total_incentive = master_base_value * tier_reward_units;
                    
                    // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ëŠ” ë³„ë„ì˜ reward units ê³„ì‚° í•„ìš” (ë…ë¦½ì ì¸ ë°°ìœ¨ ì‚¬ìš©)
                    let lb_tier_reward_units = 0;
                    lb_tier_reward_units += tier_counts_l1 * lb_final_reward_units_per_person[tier].l1;
                    lb_tier_reward_units += tier_counts_l2 * lb_final_reward_units_per_person[tier].l2;
                    lb_tier_reward_units += tier_counts_l3 * lb_final_reward_units_per_person[tier].l3;
                    const lb_tier_total_incentive = lb_master_base_value_t1_t6 * lb_tier_reward_units;

                    // 1ì¸ë‹¹ ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ì§€ê¸‰ì•¡ (ë³´ì •ëœ ìœ ë‹› ê¸°ì¤€)
                    const individual_values = {
                        l1: master_base_value * pi_final_reward_units_per_person[tier].l1,
                        l2: master_base_value * pi_final_reward_units_per_person[tier].l2,
                        l3: master_base_value * pi_final_reward_units_per_person[tier].l3
                    };
                    // 1ì¸ë‹¹ ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ì§€ê¸‰ì•¡ (ë³´ì •ëœ ìœ ë‹› ê¸°ì¤€)
                    const lb_individual_values = {
                        l1: lb_master_base_value_t1_t6 * lb_final_reward_units_per_person[tier].l1,
                        l2: lb_master_base_value_t1_t6 * lb_final_reward_units_per_person[tier].l2,
                        l3: lb_master_base_value_t1_t6 * lb_final_reward_units_per_person[tier].l3
                    };

                    tierData.push({ tier, tier_total_count, tier_total_incentive, individual_values, lb_tier_total_incentive, lb_individual_values });
                    
                    total_headcount_t1_t6 += tier_total_count;
                    total_incentive_t1_t6 += tier_total_incentive;
                    total_lb_t1_t6 += lb_tier_total_incentive; // (100-X)% í’€ í•©ê³„
                    
                    if (tier === 't1' || tier === 't2') {
                        total_headcount_t1_t2 += tier_total_count;
                        total_incentive_t1_t2 += tier_total_incentive;
                        
                        total_lb_headcount_t1_t2 += tier_total_count;
                        total_lb_incentive_t1_t2 += lb_tier_total_incentive;
                    }
                });
                
                // ---------------------
                // Phase 3.5: ì¸ì›ìˆ˜ ì œí•œ (Warning) ë¡œì§
                // ---------------------
                
                // T1-T6 ì´ ì¸ì› (total_headcount_t1_t6ëŠ” ì´ë¯¸ 1910ë¼ì¸ì—ì„œ ê³„ì‚°ë¨)
                const t1_total = tier_details['t1'].tier_total_count;
                const t2_total = tier_details['t2'].tier_total_count;
                const t3_total = tier_details['t3'].tier_total_count;
                const t123_total = t1_total + t2_total + t3_total;

                let warnings = [];
                if (total_headcount_t1_t6 > 0) {
                    const t1_perc = t1_total / total_headcount_t1_t6;
                    const t2_perc = t2_total / total_headcount_t1_t6;
                    const t3_perc = t3_total / total_headcount_t1_t6;
                    const t123_perc = t123_total / total_headcount_t1_t6;

                    if (t1_perc >= 0.05) {
                        warnings.push(`T1 ì¸ì› (${t1_total}ëª…, ${formatPercentage(t1_perc)})ì´ 5% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬ í•œë„: ${Math.floor(total_headcount_t1_t6 * 0.05 - 0.0001)}ëª…)`);
                    }
                    if (t2_perc >= 0.10) {
                        warnings.push(`T2 ì¸ì› (${t2_total}ëª…, ${formatPercentage(t2_perc)})ì´ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬ í•œë„: ${Math.floor(total_headcount_t1_t6 * 0.10 - 0.0001)}ëª…)`);
                    }
                    if (t3_perc >= 0.20) {
                        warnings.push(`T3 ì¸ì› (${t3_total}ëª…, ${formatPercentage(t3_perc)})ì´ 20% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬ í•œë„: ${Math.floor(total_headcount_t1_t6 * 0.20 - 0.0001)}ëª…)`);
                    }
                    if (t123_perc > 0.35) {
                        warnings.push(`T1-T3 í•©ê³„ ì¸ì› (${t123_total}ëª…, ${formatPercentage(t123_perc)})ì´ 35% ì´í•˜ì´ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬ í•œë„: ${Math.floor(total_headcount_t1_t6 * 0.35)}ëª…)`);
                    }
                }
                const warningEl = document.getElementById('headcountWarning');
                if (warnings.length > 0) {
                    warningEl.innerHTML = '<ul class="list-disc pl-5 space-y-1">' + warnings.map(w => `<li>${w}</li>`).join('') + '</ul>';
                    warningEl.style.display = 'block';
                } else {
                    warningEl.innerHTML = '';
                    warningEl.style.display = 'none';
                }


                // ---------------------
                // Phase 4: UI ë Œë”ë§ (Step 3)
                // ---------------------
                
                // KPI
                setText('totalIncentivePool', formatCurrencyBillion(totalIncentivePool));
                setText('leaderDiscretionAmountDisplay', formatCurrencyDisplay(leaderDiscretionAmount) + ` (${(leaderDiscretionRate * 100).toFixed(1)}%)`);
                setText('distributionIncentivePoolDisplay', formatCurrencyDisplay(distributionIncentivePool) + ` (${((1 - leaderDiscretionRate) * 100).toFixed(1)}%)`);
                setText('lb_total_incentive_distributed', formatCurrencyBillion(totalLaunchBonusPool)); // ìŠ¬ë¼ì´ë” ì´ì•¡
                setText('calculatedROI', calculatedROI_pct.toFixed(1) + '%');
                setText('calculatedIncentiveRate', (incentiveRate * 100).toFixed(0) + '%');
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 3íšŒ ë¶„í•  ê¸ˆì•¡ ê³„ì‚° ë° í‘œì‹œ
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 2íšŒ ë¶„í• : 1ì°¨ 66.67% (ê¸°ì¡´ 1íšŒ+2íšŒ), 2ì°¨ 33.33% (ê¸°ì¡´ 3íšŒ)
                const lbPayment1 = totalLaunchBonusPool * (2/3); // 66.67%
                const lbPayment2 = totalLaunchBonusPool * (1/3); // 33.33%
                setText('lb_payment_1', formatCurrencyDisplay(lbPayment1));
                setText('lb_payment_2', formatCurrencyDisplay(lbPayment2));

                // ìš”ì•½ í…ìŠ¤íŠ¸ (T1-T6 ì°¸ì—¬ì)
                setText('dynamic_total_headcount', total_headcount_t1_t6.toLocaleString('ko-KR'));
                setText('dynamic_target_count', total_headcount_t1_t6.toLocaleString('ko-KR'));

                // ë””ë²„ê¹… ë¡œê·¸
                console.log('===== Step 3 ê³„ì‚° ê²°ê³¼ =====');
                console.log('ì´ ì¸ì„¼í‹°ë¸Œ í’€:', formatCurrencyDisplay(totalIncentivePool));
                console.log('ì´ ëŸ°ì¹­ ë³´ë„ˆìŠ¤ í’€:', formatCurrencyDisplay(totalLaunchBonusPool));
                console.log('T1-T6 ì´ ì¸ì›:', total_headcount_t1_t6);
                console.log('ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡:', master_base_value.toLocaleString('ko-KR'));
                console.log('ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡:', lb_master_base_value_t1_t6.toLocaleString('ko-KR'));
                console.log('ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ Multipliers:', pi_multipliers);
                console.log('ëŸ°ì¹­ ë³´ë„ˆìŠ¤ Multipliers:', lb_multipliers);
                console.log('ì„±ê³¼ T6â†’T5 ë¹„ìœ¨:', pi_t6_t5_rate);
                console.log('ì„±ê³¼ T5â†’T4 ë¹„ìœ¨:', pi_t5_t4_rate);
                console.log('ëŸ°ì¹­ T6â†’T5 ë¹„ìœ¨:', lb_t6_t5_rate_mult);
                console.log('ëŸ°ì¹­ T5â†’T4 ë¹„ìœ¨:', lb_t5_t4_rate_mult);
                console.log('T5 ì¸ì›:', t_counts.t5);
                console.log('===========================');

                // --- T6-L3 ê¸°ì¤€ê°’ ê³„ì‚° (ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ) ---
                const t6_l3_base_value = master_base_value * pi_final_reward_units_per_person.t6.l3; 
                
                // ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ í…Œì´ë¸” (T1-T4)
                tierData.forEach(tier => {
                    const { tier: tierName, tier_total_count, tier_total_incentive, individual_values } = tier;
                    setText(`${tierName}_total_count`, tier_total_count.toLocaleString('ko-KR'));
                    setText(`${tierName}_total_incentive`, formatCurrencyDisplay(tier_total_incentive));
                    
                    // T6-L3 ê¸°ì¤€ ëŒ€ë¹„ ë¹„ìœ¨ ê³„ì‚° í•¨ìˆ˜
                    function getPercentageString(value) {
                        if (t6_l3_base_value === 0) return '';
                        const absolutePercentage = (value / t6_l3_base_value * 100).toFixed(0);
                        return `(${absolutePercentage}%)`;
                    }
                    
                    const l1_value = individual_values.l1;
                    const l2_value = individual_values.l2;
                    const l3_value = individual_values.l3;
                    
                    // ì „ì—­ ë³€ìˆ˜ì— ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ê°’ ì €ì¥ (Tab 3ì—ì„œ ì‚¬ìš©)
                    calculatedIncentiveValues[tierName] = {
                        l1: l1_value,
                        l2: l2_value,
                        l3: l3_value
                    };

                    setText(`${tierName}_l1_value`, formatCurrency(l1_value));
                    setText(`${tierName}_l1_perc`, getPercentageString(l1_value));
                    setText(`${tierName}_l2_value`, formatCurrency(l2_value));
                    setText(`${tierName}_l2_perc`, getPercentageString(l2_value));
                    setText(`${tierName}_l3_value`, formatCurrency(l3_value));
                    setText(`${tierName}_l3_perc`, getPercentageString(l3_value));
                });
                
                // T1+T2 KPI Footer
                const t1_t2_perc = (total_incentive_t1_t6 > 0) ? (total_incentive_t1_t2 / total_incentive_t1_t6 * 100) : 0;
                setText('total_ppl_t1_t2', total_headcount_t1_t2.toLocaleString('ko-KR'));
                setText('total_incentive_t1_t2', formatCurrencyDisplay(total_incentive_t1_t2));
                setText('total_incentive_t1_t2_perc', t1_t2_perc.toFixed(1) + '%');
                
                // <tfoot> Total
                setText('total_ppl_incentive', total_headcount_t1_t6.toLocaleString('ko-KR'));
                setText('total_incentive_distributed', formatCurrencyDisplay(total_incentive_t1_t6));
                
                
                // --- T6-L3 ê¸°ì¤€ê°’ ê³„ì‚° (ëŸ°ì¹­ ë³´ë„ˆìŠ¤) ---
                const lb_t6_l3_base_value = lb_master_base_value_t1_t6 * lb_final_reward_units_per_person.t6.l3;
                
                console.log('===== ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ê³„ì‚° =====');
                console.log('lb_master_base_value_t1_t6:', lb_master_base_value_t1_t6.toLocaleString('ko-KR'));
                console.log('totalLaunchBonus_t1_t6:', totalLaunchBonus_t1_t6.toLocaleString('ko-KR'));
                console.log('lb_total_reward_units_t1_t6:', lb_total_reward_units_t1_t6);
                console.log('tierData ê°œìˆ˜:', tierData.length);
                tierData.forEach((t, idx) => {
                    console.log(`Tier ${idx}: ${t.tier}, ì¸ì›: ${t.tier_total_count}, LB ì´ì•¡: ${t.lb_tier_total_incentive.toLocaleString('ko-KR')}`);
                    if (t.tier === 't5') {
                        console.log('  â†’ T5 ìƒì„¸:', {
                            l1_ì¸ì›: t_counts.t5.l1,
                            l2_ì¸ì›: t_counts.t5.l2,
                            l3_ì¸ì›: t_counts.t5.l3,
                            l1_ê¸ˆì•¡: t.lb_individual_values.l1.toLocaleString('ko-KR'),
                            l2_ê¸ˆì•¡: t.lb_individual_values.l2.toLocaleString('ko-KR'),
                            l3_ê¸ˆì•¡: t.lb_individual_values.l3.toLocaleString('ko-KR')
                        });
                    }
                });
                console.log('========================');
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ T1-T6 í…Œì´ë¸” ((100-X)% í’€ ì‚¬ìš©)
                tierData.forEach(tier => {
                    const { tier: tierName, tier_total_count, lb_tier_total_incentive, lb_individual_values } = tier;
                    
                    setText(`lb_${tierName}_total_count`, tier_total_count.toLocaleString('ko-KR'));
                    setText(`lb_${tierName}_total_incentive`, formatCurrencyDisplay(lb_tier_total_incentive));
                    
                    // T6-L3 ê¸°ì¤€ ëŒ€ë¹„ ë¹„ìœ¨ ê³„ì‚° í•¨ìˆ˜
                    function getLbPercentageString(value) {
                        if (lb_t6_l3_base_value === 0) return '';
                        const absolutePercentage = (value / lb_t6_l3_base_value * 100).toFixed(0);
                        return `(${absolutePercentage}%)`;
                    }
                    
                    const lb_l1_value = lb_individual_values.l1;
                    const lb_l2_value = lb_individual_values.l2;
                    const lb_l3_value = lb_individual_values.l3;
                    
                    // ì „ì—­ ë³€ìˆ˜ì— ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ê°’ ì €ì¥ (Tab 3ì—ì„œ ì‚¬ìš©)
                    calculatedBonusValues[tierName] = {
                        l1: lb_l1_value,
                        l2: lb_l2_value,
                        l3: lb_l3_value
                    };

                    setText(`lb_${tierName}_l1_value`, formatCurrency(lb_l1_value));
                    setText(`lb_${tierName}_l1_perc`, getLbPercentageString(lb_l1_value));
                    setText(`lb_${tierName}_l2_value`, formatCurrency(lb_l2_value));
                    setText(`lb_${tierName}_l2_perc`, getLbPercentageString(lb_l2_value));
                    setText(`lb_${tierName}_l3_value`, formatCurrency(lb_l3_value));
                    setText(`lb_${tierName}_l3_perc`, getLbPercentageString(lb_l3_value));
                });
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ T1+T2 KPI Footer
                const lb_t1_t2_perc = (total_lb_t1_t6 > 0) ? (total_lb_incentive_t1_t2 / total_lb_t1_t6 * 100) : 0;
                setText('lb_total_ppl_t1_t2', total_lb_headcount_t1_t2.toLocaleString('ko-KR'));
                setText('lb_total_incentive_t1_t2', formatCurrencyDisplay(total_lb_incentive_t1_t2));
                setText('lb_total_incentive_t1_t2_perc', lb_t1_t2_perc.toFixed(1) + '%');
                
                // <tfoot> Total
                setText('lb_total_ppl_incentive', total_headcount_t1_t6.toLocaleString('ko-KR')); // T1-T6 ì´ ì¸ì›
                setText('lb_total_distributed', formatCurrencyDisplay(total_lb_t1_t6)); // T1-T6 ì´ ëŸ°ì¹­ë³´ë„ˆìŠ¤ ((100-X)% í’€)
                
                
                // --- T7-L3 ê¸°ì¤€ê°’ ê³„ì‚° (T7 ë¹„ì°¸ì—¬ì ëŸ°ì¹­ ë³´ë„ˆìŠ¤) ---
                const lb_t7_l3_base_value = lb_t7_master_base * weights.l3;

                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ T7 í…Œì´ë¸” (ë¹„ì°¸ì—¬ì - 0ì›)
                // ì´ ë°°ë¶„ì•¡ (footer)
                const lb_t7_total_incentive = 0;
                setText('lb_t7_total', formatCurrencyDisplay(lb_t7_total_incentive));

                function getLbT7PercentageString(value) {
                    return '(0%)'; // T7ì€ ë¹„ì°¸ì—¬ì, í•­ìƒ 0%
                }

                // 1ì¸ë‹¹ ì§€ê¸‰ì•¡ (T7ì€ ë¹„ì°¸ì—¬ì - 0ì›)
                const lb_t7_l1_value = 0;
                const lb_t7_l2_value = 0;
                const lb_t7_l3_value = 0;

                setText('lb_t7_l1_value', formatCurrency(lb_t7_l1_value));
                setText('lb_t7_l1_perc', getLbT7PercentageString(lb_t7_l1_value));
                
                setText('lb_t7_l2_value', formatCurrency(lb_t7_l2_value));
                setText('lb_t7_l2_perc', getLbT7PercentageString(lb_t7_l2_value));
                
                setText('lb_t7_l3_value', formatCurrency(lb_t7_l3_value));
                setText('lb_t7_l3_perc', getLbT7PercentageString(lb_t7_l3_value));
                
                // ì´ ì¸ì› (footer)
                const total_headcount_t7_calc = lb_t7_countsArr.reduce((a, b) => a + b, 0);
                setText('lb_t7_total_ppl', total_headcount_t7_calc.toLocaleString('ko-KR'));
                
                // T7 í’€ í• ë‹¹ ë¹„ìœ¨ UI ì—…ë°ì´íŠ¸
                setText('lb_t7_pool_rate_display', lb_t7_rate_percent + '%');
                
                // ë¦¬ë” ë·° KPI ì—…ë°ì´íŠ¸
                if (typeof updateLeaderViewKPIs === 'function') {
                    updateLeaderViewKPIs();
                }
                
                // ì£¼ì˜: Tab 3 í…Œì´ë¸” ì—…ë°ì´íŠ¸ëŠ” updateEmployeeTable()ì—ì„œ í˜¸ì¶œ
                // ë¬´í•œ ë£¨í”„ ë°©ì§€ë¥¼ ìœ„í•´ ì—¬ê¸°ì„œëŠ” í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
            }
            
            function formatPercentage(num) {
                return (num * 100).toFixed(1) + '%';
            }

            // ####################
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            // ####################

            // í˜ì´ì§€ ë‚´ì˜ ëª¨ë“  input, select, range ìš”ì†Œì˜ 'input' ì´ë²¤íŠ¸ì— ëŒ€í•´ ë‹¨ì¼ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš©
            document.body.addEventListener('input', (event) => {
                const target = event.target;
                
                // ë¦¬ë” ì¬ëŸ‰ ìŠ¬ë¼ì´ë” í‘œì‹œ ì—…ë°ì´íŠ¸
                if (target.matches('#leaderDiscretionSlider')) {
                    const value = target.value;
                    document.getElementById('leaderDiscretionDisplay').textContent = value + '%';
                }
                
                // MG ìŠ¬ë¼ì´ë” í‘œì‹œ ì—…ë°ì´íŠ¸
                if (target.matches('#mg_slider')) {
                    const value = target.value;
                    document.getElementById('mg_display').textContent = value + 'ì–µì›';
                }
                
                if (target.matches('input') || target.matches('select') || 
                    target.matches('#total_investment_slider') || target.matches('#launchBonusSlider') || 
                    target.matches('#mg_slider') || target.matches('#lb_t5_pool_rate_slider') || 
                    target.matches('#leaderDiscretionSlider') ||
                    target.matches('#roi_rate_0_100') || target.matches('#roi_rate_100_150') ||
                    target.matches('#roi_rate_150_200') || target.matches('#roi_rate_200_300') ||
                    target.matches('#roi_rate_300_plus')) {
                    calculateAll();
                }
            });

            // ROI ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ì…ë ¥ í•„ë“œì— change ì´ë²¤íŠ¸ë„ ì¶”ê°€ (ë”ë¸” ì²´í¬)
            document.body.addEventListener('change', (event) => {
                const target = event.target;
                if (target.matches('.rate-input')) {
                    calculateAll();
                }
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ DOMì´ ì™„ì „íˆ ì¤€ë¹„ëœ í›„ ê³„ì‚°
            // setTimeoutì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ìš”ì†Œê°€ ë Œë”ë§ëœ í›„ ì‹¤í–‰
            setTimeout(() => {
                calculateAll();
            }, 150);

            // ####################
            // Tab Management
            // ####################
            const tab1Button = document.getElementById('tab1-button');
            const tab2Button = document.getElementById('tab2-button');
            const tab3Button = document.getElementById('tab3-button');
            const tab4Button = document.getElementById('tab4-button');
            const tab1Content = document.getElementById('tab1-content');
            const tab2Content = document.getElementById('tab2-content');
            const tab3Content = document.getElementById('tab3-content');
            const tab4Content = document.getElementById('tab4-content');

            // Tab 2 ì•”í˜¸ ê´€ë¦¬
            let isTab2Unlocked = false;
            const TAB2_PASSWORD = 'Eodzb150!';

            function switchTab(tabNumber) {
                // ëª¨ë“  íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                [tab1Button, tab2Button, tab3Button, tab4Button].forEach(btn => {
                    btn.classList.add('border-transparent', 'text-gray-500');
                    btn.classList.remove('border-indigo-500', 'text-indigo-600');
                });
                
                // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
                [tab1Content, tab2Content, tab3Content, tab4Content].forEach(content => {
                    content.classList.add('hidden');
                });

                if (tabNumber === 1) {
                    tab1Button.classList.add('border-indigo-500', 'text-indigo-600');
                    tab1Button.classList.remove('border-transparent', 'text-gray-500');
                    tab1Content.classList.remove('hidden');
                } else if (tabNumber === 2) {
                    if (!isTab2Unlocked) {
                        showPasswordModal();
                        return;
                    }
                    tab2Button.classList.add('border-indigo-500', 'text-indigo-600');
                    tab2Button.classList.remove('border-transparent', 'text-gray-500');
                    tab2Content.classList.remove('hidden');
                } else if (tabNumber === 3) {
                    tab3Button.classList.add('border-indigo-500', 'text-indigo-600');
                    tab3Button.classList.remove('border-transparent', 'text-gray-500');
                    tab3Content.classList.remove('hidden');
                    // ë°ì´í„° ê²€ì¦ íƒ­ ì´ˆê¸°í™”
                    initializeVerificationTab();
                } else if (tabNumber === 4) {
                    tab4Button.classList.add('border-indigo-500', 'text-indigo-600');
                    tab4Button.classList.remove('border-transparent', 'text-gray-500');
                    tab4Content.classList.remove('hidden');
                    // HR ì¸ì‚¬ì´íŠ¸ ì´ˆê¸°í™”
                    initializeHRInsights();
                }
            }

            function showPasswordModal() {
                const password = prompt('Tab 2 ì ‘ê·¼ì„ ìœ„í•œ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                
                if (password === null) {
                    // ì‚¬ìš©ìê°€ ì·¨ì†Œë¥¼ ëˆ„ë¥¸ ê²½ìš°
                    return false;
                }
                
                if (password === TAB2_PASSWORD) {
                    isTab2Unlocked = true;
                    return true;
                } else {
                    alert('ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                    return false;
                }
            }

            tab1Button.addEventListener('click', () => switchTab(1));
            tab2Button.addEventListener('click', () => {
                if (!isTab2Unlocked) {
                    if (showPasswordModal()) {
                        switchTab(2);
                    }
                } else {
                    switchTab(2);
                }
            });
            tab3Button.addEventListener('click', () => switchTab(3));
            tab4Button.addEventListener('click', () => switchTab(4));

            // ####################
            // Employee Management
            // ####################
            
            // Initialize date dropdowns
            const baseYear = document.getElementById('baseYear');
            const baseMonth = document.getElementById('baseMonth');
            const baseDay = document.getElementById('baseDay');

            // Set default date to August 1, 2026 (ê¸°ì¤€ì¼ì)
            const currentYear = 2026;
            const currentMonth = 8;
            const currentDay = 1;

            // Populate year dropdown (2020-2030)
            for (let year = 2020; year <= 2030; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'ë…„';
                if (year === currentYear) option.selected = true;
                baseYear.appendChild(option);
            }

            // Populate month dropdown
            for (let month = 1; month <= 12; month++) {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month + 'ì›”';
                if (month === currentMonth) option.selected = true;
                baseMonth.appendChild(option);
            }

            // Populate day dropdown
            function updateDays() {
                const year = parseInt(baseYear.value);
                const month = parseInt(baseMonth.value);
                const daysInMonth = new Date(year, month, 0).getDate();
                const currentSelectedDay = parseInt(baseDay.value) || currentDay;
                
                baseDay.innerHTML = '';
                for (let day = 1; day <= daysInMonth; day++) {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = day + 'ì¼';
                    // Keep the selected day if it exists in the new month, otherwise use the last day
                    if (day === Math.min(currentSelectedDay, daysInMonth)) {
                        option.selected = true;
                    }
                    baseDay.appendChild(option);
                }

                // Update employee table when date changes (only if employees are loaded)
                if (employees && employees.length > 0) {
                    updateEmployeeTable();
                }
            }

            // Employee data management
            let employees = [];
            let lockedIncentives = []; // í™•ì •ëœ ì¸ì„¼í‹°ë¸Œ ë°ì´í„° ì €ì¥
            let isIncentivesLocked = false; // í™•ì • ì—¬ë¶€ í”Œë˜ê·¸

            // CSV ë°ì´í„°ì—ì„œ íŒ€/íŒŒíŠ¸/ì§ì±…/ìƒì„¸ì§êµ° ì •ë³´ ë§¤í•‘ (ì‚¬ë²ˆ ê¸°ì¤€)
            const employeeOrgData = {
                "SP004": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ë””ìì¸2íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP025": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜2íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP028": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "ì„œë²„íŒŒíŠ¸", position: "", detailRole: "ì„œë²„ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP041": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸4íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP042": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "ì„œë²„íŒŒíŠ¸", position: "TD", detailRole: "ì„œë²„ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP048": {team: "í€„ë¦¬í‹° íŒ€", part: "ë¹Œë“œíŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ë¹Œë“œ ë§¤ë‹ˆì €"},
                "SP052": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸4íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP071": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "ì„œë²„íŒŒíŠ¸", position: "", detailRole: "ì„œë²„ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP075": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ì›í™”íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ì›í™”ê°€"},
                "SP083": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ë””ìì¸2íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP098": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "ì„œë²„íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ì„œë²„ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP109": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸4íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP117": {team: "í•µì‹¬ë¦¬ë”íŒ€", part: "í•µì‹¬ë¦¬ë”íŒŒíŠ¸", position: "ë¦¬ë”", detailRole: ""},
                "SP164": {team: "í•µì‹¬ë¦¬ë”íŒ€", part: "í•µì‹¬ë¦¬ë”íŒŒíŠ¸", position: "AD", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP190": {team: "ê¸°íšíŒ€", part: "ê²Œì„UIíŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "UI/UX ë””ìì´ë„ˆ"},
                "SP224": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜1íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP245": {team: "2Dì•„íŠ¸íŒ€", part: "ì»¨ì…‰ì›í™”íŒŒíŠ¸", position: "", detailRole: "ì›í™”ê°€"},
                "SP249": {team: "3Dì•„íŠ¸íŒ€", part: "ì´í™íŠ¸íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ì´í™í„°"},
                "SP252": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜1íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP264": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸2íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP267": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ë””ìì¸1íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP298": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ë””ìì¸2íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP299": {team: "ê¸°íšíŒ€", part: "ê²Œì„UIíŒŒíŠ¸", position: "", detailRole: "UI/UX ë””ìì´ë„ˆ"},
                "SP313": {team: "2Dì•„íŠ¸íŒ€", part: "ê°€ì´ë“œëª¨ë¸ë§íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "3D ê°€ì´ë“œ ëª¨ë¸ëŸ¬"},
                "SP328": {team: "2Dì•„íŠ¸íŒ€", part: "ì»¨ì…‰ì›í™”íŒŒíŠ¸", position: "", detailRole: "ì›í™”ê°€"},
                "SP345": {team: "í€„ë¦¬í‹° íŒ€", part: "ë¹Œë“œíŒŒíŠ¸", position: "", detailRole: "ë¹Œë“œ PM"},
                "SP346": {team: "2Dì•„íŠ¸íŒ€", part: "ì»¨ì…‰ì›í™”íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ì›í™”ê°€"},
                "SP357": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜2íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP363": {team: "2Dì•„íŠ¸íŒ€", part: "ê°€ì´ë“œëª¨ë¸ë§íŒŒíŠ¸", position: "", detailRole: "3D ê°€ì´ë“œ ëª¨ë¸ëŸ¬"},
                "SP370": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ì›í™”íŒŒíŠ¸", position: "", detailRole: "ì›í™”ê°€"},
                "SP371": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ì›í™”íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "ì›í™”ê°€"},
                "SP380": {team: "2Dì•„íŠ¸íŒ€", part: "ì»¨ì…‰ì›í™”íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "ì›í™”ê°€"},
                "SP382": {team: "ê¸°íšíŒ€", part: "ì‹œìŠ¤í…œ1íŒŒíŠ¸", position: "", detailRole: "ì½˜í…ì¸  ê¸°íšì"},
                "SP401": {team: "ê¸°íšíŒ€", part: "ê²Œì„UIíŒŒíŠ¸", position: "", detailRole: "UI/UX ë””ìì´ë„ˆ"},
                "SP409": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ì›”ë“œë¹Œë”©íŒŒíŠ¸", position: "", detailRole: "3D ì›”ë“œ ë¹Œë”"},
                "SP418": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜2íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP419": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ë””ìì¸1íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP430": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "ì„œë²„íŒŒíŠ¸", position: "", detailRole: "ì„œë²„ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP491": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸2íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP504": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ë””ìì¸2íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP505": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜2íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP508": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜1íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP524": {team: "ê¸°íšíŒ€", part: "ë°¸ëŸ°ìŠ¤íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ê²½ì œ/ì „íˆ¬ ë°¸ëŸ°ìŠ¤ ê¸°íšì"},
                "SP531": {team: "ê¸°íšíŒ€", part: "ì½˜í…ì¸ íŒŒíŠ¸", position: "", detailRole: "ì‹œë‚˜ë¦¬ì˜¤/í€˜ìŠ¤íŠ¸ ê¸°íšì"},
                "SP535": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸4íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP536": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ëª¨ë¸ë§íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ë°°ê²½ ëª¨ë¸ëŸ¬"},
                "SP538": {team: "2Dì•„íŠ¸íŒ€", part: "ê°€ì´ë“œëª¨ë¸ë§íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "3D ê°€ì´ë“œ ëª¨ë¸ëŸ¬"},
                "SP559": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ë””ìì¸1íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP564": {team: "2Dì•„íŠ¸íŒ€", part: "ì»¨ì…‰ì›í™”íŒŒíŠ¸", position: "", detailRole: "ì›í™”ê°€"},
                "SP574": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ì›í™”íŒŒíŠ¸", position: "", detailRole: "ì›í™”ê°€"},
                "SP584": {team: "í•µì‹¬ë¦¬ë”íŒ€", part: "í•µì‹¬ë¦¬ë”íŒŒíŠ¸", position: "ë¦¬ë”", detailRole: "ë°°ê²½ ëª¨ë¸ëŸ¬"},
                "SP590": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸2íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP592": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜2íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP597": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ë””ìì¸1íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP598": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ë””ìì¸2íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP606": {team: "ê¸°íšíŒ€", part: "ì½˜í…ì¸ íŒŒíŠ¸", position: "", detailRole: "ì‹œë‚˜ë¦¬ì˜¤/í€˜ìŠ¤íŠ¸ ê¸°íšì"},
                "SP607": {team: "3Dì•„íŠ¸íŒ€", part: "3Dìºë¦­í„°ëª¨ë¸ë§íŒŒíŠ¸", position: "", detailRole: "3D ìºë¦­í„° ëª¨ë¸ëŸ¬"},
                "SP614": {team: "2Dì•„íŠ¸íŒ€", part: "ê°€ì´ë“œëª¨ë¸ë§íŒŒíŠ¸", position: "", detailRole: "3D ê°€ì´ë“œ ëª¨ë¸ëŸ¬"},
                "SP625": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ëª¨ë¸ë§íŒŒíŠ¸", position: "", detailRole: "ë°°ê²½ ëª¨ë¸ëŸ¬"},
                "SP631": {team: "í€„ë¦¬í‹° íŒ€", part: "QAíŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "QA ë‹´ë‹¹ì"},
                "SP638": {team: "ê¸°íšíŒ€", part: "ì‹œìŠ¤í…œ1íŒŒíŠ¸", position: "", detailRole: "ì œë„ˆëŸ´ ê¸°íšì"},
                "SP643": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ëª¨ë¸ë§íŒŒíŠ¸", position: "", detailRole: "ë°°ê²½ ëª¨ë¸ëŸ¬"},
                "SP644": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸1íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP645": {team: "í€„ë¦¬í‹° íŒ€", part: "QAíŒŒíŠ¸", position: "", detailRole: "QA ë‹´ë‹¹ì"},
                "SP654": {team: "3Dì•„íŠ¸íŒ€", part: "3Dìºë¦­í„°ëª¨ë¸ë§íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "3D ìºë¦­í„° ëª¨ë¸ëŸ¬"},
                "SP656": {team: "3Dì•„íŠ¸íŒ€", part: "3Dì• ë‹ˆë©”ì´ì…˜íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "3D ì• ë‹ˆë©”ì´í„°"},
                "SP665": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ì›í™”íŒŒíŠ¸", position: "", detailRole: "ì›í™”ê°€"},
                "SP668": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸1íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP669": {team: "í€„ë¦¬í‹° íŒ€", part: "QAíŒŒíŠ¸", position: "", detailRole: "QAë‹´ë‹¹ì"},
                "SP671": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ì›”ë“œë¹Œë”©íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "3D ì›”ë“œ ë¹Œë”"},
                "SP672": {team: "2Dì•„íŠ¸íŒ€", part: "ì»¨ì…‰ì›í™”íŒŒíŠ¸", position: "", detailRole: "ì›í™”ê°€"},
                "SP675": {team: "3Dì•„íŠ¸íŒ€", part: "3Dìºë¦­í„°ëª¨ë¸ë§íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "3D ìºë¦­í„° ëª¨ë¸ëŸ¬"},
                "SP676": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸1íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP677": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸2íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP687": {team: "3Dì•„íŠ¸íŒ€", part: "3Dì• ë‹ˆë©”ì´ì…˜íŒŒíŠ¸", position: "", detailRole: "3D ì• ë‹ˆë©”ì´í„°"},
                "SP690": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸2íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP693": {team: "3Dì•„íŠ¸íŒ€", part: "3Dìºë¦­í„°ëª¨ë¸ë§íŒŒíŠ¸", position: "", detailRole: "3D ìºë¦­í„° ëª¨ë¸ëŸ¬"},
                "SP695": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ì›í™”íŒŒíŠ¸", position: "", detailRole: "ì›í™”ê°€"},
                "SP699": {team: "í€„ë¦¬í‹° íŒ€", part: "PMíŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ê°œë°œ PM"},
                "SP700": {team: "3Dì•„íŠ¸íŒ€", part: "ì´í™íŠ¸íŒŒíŠ¸", position: "", detailRole: "ì´í™í„°"},
                "SP704": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜2íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP705": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜1íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP706": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜1íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP707": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜1íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP710": {team: "ê¸°íšíŒ€", part: "ì‹œìŠ¤í…œ2íŒŒíŠ¸", position: "", detailRole: "ì‹œìŠ¤í…œ ê¸°íšì"},
                "SP711": {team: "ê¸°íšíŒ€", part: "ì½˜í…ì¸ íŒŒíŠ¸", position: "", detailRole: "ì‹œë‚˜ë¦¬ì˜¤/í€˜ìŠ¤íŠ¸ ê¸°íšì"},
                "SP720": {team: "ê¸°íšíŒ€", part: "ì‹œìŠ¤í…œ2íŒŒíŠ¸", position: "", detailRole: "ì‹œìŠ¤í…œ ê¸°íšì"},
                "SP722": {team: "ê¸°íšíŒ€", part: "ë°¸ëŸ°ìŠ¤íŒŒíŠ¸", position: "", detailRole: "ì „íˆ¬ ë°¸ëŸ°ìŠ¤ ê¸°íšì"},
                "SP728": {team: "í€„ë¦¬í‹° íŒ€", part: "ë¹Œë“œíŒŒíŠ¸", position: "", detailRole: "ë¹Œë“œ ë§¤ë‹ˆì €"},
                "SP730": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸3íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP731": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "ì„œë²„íŒŒíŠ¸", position: "", detailRole: "ì„œë²„ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP735": {team: "3Dì•„íŠ¸íŒ€", part: "ì´í™íŠ¸íŒŒíŠ¸", position: "", detailRole: "ì´í™í„°"},
                "SP737": {team: "ê¸°íšíŒ€", part: "ë°¸ëŸ°ìŠ¤íŒŒíŠ¸", position: "", detailRole: "ê²½ì œ ë°¸ëŸ°ìŠ¤ ê¸°íšì"},
                "SP739": {team: "í€„ë¦¬í‹° íŒ€", part: "ë¹Œë“œíŒŒíŠ¸", position: "", detailRole: "ë¹Œë“œ ë§¤ë‹ˆì €"},
                "SP744": {team: "í•µì‹¬ë¦¬ë”íŒ€", part: "í•µì‹¬ë¦¬ë”íŒŒíŠ¸", position: "í€„ë¦¬í‹° ë””ë ‰í„°", detailRole: ""},
                "SP754": {team: "í•µì‹¬ë¦¬ë”íŒ€", part: "í•µì‹¬ë¦¬ë”íŒŒíŠ¸", position: "ê²Œì„ ë””ë ‰í„°", detailRole: ""},
                "SP755": {team: "í€„ë¦¬í‹° íŒ€", part: "PMíŒŒíŠ¸", position: "", detailRole: "ê°œë°œ PM"},
                "SP756": {team: "ê¸°íšíŒ€", part: "ì‹œìŠ¤í…œ1íŒŒíŠ¸", position: "", detailRole: "ì½˜í…ì¸  ê¸°íšì"},
                "SP764": {team: "ê¸°íšíŒ€", part: "ì‹œìŠ¤í…œ2íŒŒíŠ¸", position: "", detailRole: "ì œë„ˆëŸ´ ê¸°íšì"},
                "SP765": {team: "ê¸°íšíŒ€", part: "ë°¸ëŸ°ìŠ¤íŒŒíŠ¸", position: "", detailRole: "ì „íˆ¬ ë°¸ëŸ°ìŠ¤ ê¸°íšì"},
                "SP766": {team: "ê¸°íšíŒ€", part: "ì‹œìŠ¤í…œ2íŒŒíŠ¸", position: "", detailRole: "ì‹œìŠ¤í…œ ê¸°íšì"},
                "SP767": {team: "ê¸°íšíŒ€", part: "ì‹œìŠ¤í…œ2íŒŒíŠ¸", position: "", detailRole: "ì‹œìŠ¤í…œ ê¸°íšì"},
                "SP768": {team: "3Dì•„íŠ¸íŒ€", part: "3Dì• ë‹ˆë©”ì´ì…˜íŒŒíŠ¸", position: "", detailRole: "3D ì• ë‹ˆë©”ì´í„°"},
                "SP769": {team: "3Dì•„íŠ¸íŒ€", part: "ì´í™íŠ¸íŒŒíŠ¸", position: "", detailRole: "ì´í™í„°"},
                "SP770": {team: "í€„ë¦¬í‹° íŒ€", part: "TAíŒŒíŠ¸", position: "", detailRole: "í…Œí¬ë‹ˆì»¬ ì•„í‹°ìŠ¤íŠ¸"},
                "SP771": {team: "ê¸°íšíŒ€", part: "ë°¸ëŸ°ìŠ¤íŒŒíŠ¸", position: "", detailRole: "ì „íˆ¬ ë°¸ëŸ°ìŠ¤ ê¸°íšì"},
                "SP772": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ì›”ë“œë¹Œë”©íŒŒíŠ¸", position: "", detailRole: "ì›”ë“œ ë¹Œë”"},
                "SP773": {team: "ê¸°íšíŒ€", part: "ê²Œì„UIíŒŒíŠ¸", position: "", detailRole: "UI/UX ë””ìì´ë„ˆ"},
                "SP774": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ëª¨ë¸ë§íŒŒíŠ¸", position: "", detailRole: "ë°°ê²½ ëª¨ë¸ëŸ¬"},
                "SP775": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜1íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP776": {team: "2Dì•„íŠ¸íŒ€", part: "ë„íŠ¸ì• ë‹ˆë©”ì´ì…˜1íŒŒíŠ¸", position: "", detailRole: "ë„íŠ¸ ë””ìì´ë„ˆ"},
                "SP777": {team: "ê¸°íšíŒ€", part: "ì½˜í…ì¸ íŒŒíŠ¸", position: "", detailRole: "ì „íˆ¬ ì½˜í…ì¸  ê¸°íšì"},
                "SP778": {team: "í€„ë¦¬í‹° íŒ€", part: "PMíŒŒíŠ¸", position: "", detailRole: "ê°œë°œ PM"},
                "SP779": {team: "ê¸°íšíŒ€", part: "ì½˜í…ì¸ íŒŒíŠ¸", position: "", detailRole: "ì‹œë‚˜ë¦¬ì˜¤ ë¼ì´í„°"},
                "SP781": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ëª¨ë¸ë§íŒŒíŠ¸", position: "", detailRole: "3D ë°°ê²½ ëª¨ë¸ëŸ¬"},
                "SP782": {team: "í€„ë¦¬í‹° íŒ€", part: "TAíŒŒíŠ¸", position: "", detailRole: "í…Œí¬ë‹ˆì»¬ ì•„í‹°ìŠ¤íŠ¸"},
                "SP783": {team: "3Dì•„íŠ¸íŒ€", part: "ë°°ê²½ëª¨ë¸ë§íŒŒíŠ¸", position: "", detailRole: "3D ë°°ê²½ ëª¨ë¸ëŸ¬"},
                "SP784": {team: "ê¸°íšíŒ€", part: "ì½˜í…ì¸ íŒŒíŠ¸", position: "", detailRole: "ì „íˆ¬ ì½˜í…ì¸  ê¸°íšì"},
                "SP367": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP433": {team: "í”„ë¡œê·¸ë¨íŒ€", part: "í´ë¼ì´ì–¸íŠ¸íŒŒíŠ¸", position: "", detailRole: "í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP785": {team: "ê¸°íšíŒ€", part: "ì‹œìŠ¤í…œ íŒŒíŠ¸", position: "", detailRole: "ì‹œìŠ¤í…œ ê¸°íšì"},
                "SP786": {team: "ê¸°íšíŒ€", part: "ì½˜í…ì¸ íŒŒíŠ¸", position: "", detailRole: "ë ˆë²¨ ë””ìì¸ ê¸°íšì"},
                "SP171": {team: "ì‚¬ìš´ë“œíŒ€", part: "-", position: "ë¦¬ë”", detailRole: "ì‚¬ìš´ë“œ ë””ìì´ë„ˆ"},
                "SP177": {team: "ì‚¬ìš´ë“œíŒ€", part: "ì œì‘íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "ì‚¬ìš´ë“œ ë””ìì´ë„ˆ"},
                "SP251": {team: "ì‚¬ìš´ë“œíŒ€", part: "ì œì‘íŒŒíŠ¸", position: "", detailRole: "ì‚¬ìš´ë“œ ë””ìì´ë„ˆ"},
                "SP330": {team: "ì‚¬ìš´ë“œíŒ€", part: "ì œì‘íŒŒíŠ¸", position: "", detailRole: "ì‚¬ìš´ë“œ ë””ìì´ë„ˆ"},
                "SP103": {team: "í”Œë«í¼íŒ€", part: "-", position: "ë¦¬ë”", detailRole: "DBA ë‹´ë‹¹ì"},
                "SP258": {team: "í”Œë«í¼íŒ€", part: "ë°ì´í„°íŒŒíŠ¸", position: "", detailRole: "ì„œí¬íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP315": {team: "í”Œë«í¼íŒ€", part: "ì¸í”„ë¼íŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ì¸í”„ë¼ ì—”ì§€ë‹ˆì–´"},
                "SP383": {team: "í”Œë«í¼íŒ€", part: "ì¸í”„ë¼íŒŒíŠ¸", position: "ì„ ì„íŒŒíŠ¸ì›", detailRole: "ì¸í”„ë¼ ì—”ì§€ë‹ˆì–´"},
                "SP521": {team: "í”Œë«í¼íŒ€", part: "ì¸í”„ë¼íŒŒíŠ¸", position: "", detailRole: "IT ì„œí¬íŠ¸ ì—”ì§€ë‹ˆì–´"},
                "SP093": {team: "ì„œë¹„ìŠ¤ì„œí¬íŠ¸íŒ€", part: "-", position: "ë¦¬ë”", detailRole: "ì„œí¬íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP107": {team: "ì„œë¹„ìŠ¤ì„œí¬íŠ¸íŒ€", part: "ì†”ë£¨ì…˜ê°œë°œíŒŒíŠ¸", position: "", detailRole: "ì„œí¬íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP174": {team: "ì„œë¹„ìŠ¤ì„œí¬íŠ¸íŒ€", part: "CI/CDíŒŒíŠ¸", position: "", detailRole: "ì„œí¬íŠ¸ í”„ë¡œê·¸ë˜ë¨¸"},
                "SP460": {team: "ì„œë¹„ìŠ¤ì„œí¬íŠ¸íŒ€", part: "ì†”ë£¨ì…˜ê°œë°œíŒŒíŠ¸", position: "íŒŒíŠ¸ì¥", detailRole: "ì„œë²„ í”„ë¡œê·¸ë˜ë¨¸"}
            };

            // Load initial employee data from CSV
            const initialEmployees = [
                // CSV data updated from ì¬ì§ìí˜„í™©ì—…ë°ì´íŠ¸.csv (2025-11-26)
                // Tier 6 System: T1-T6 (ì°¸ì—¬ì) + T7 (ë¹„ì°¸ì—¬ì, ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¯¸ì§€ê¸‰)
                {id: "SP042", name: "ìµœìµí•„", tier: 1, joinDate: "2022-10-04", salary: 136000000, isNew: false},
                {id: "SP098", name: "ì¡°í¬ì„ ", tier: 1, joinDate: "2022-10-04", salary: 101000000, isNew: false},
                {id: "SP754", name: "ì¥ìˆ˜ë¯¼", tier: 1, joinDate: "2025-07-22", salary: 140000000, isNew: false},
                {id: "SP164", name: "ì¥ê°€ëŒ", tier: 2, joinDate: "2021-09-13", salary: 57000000, isNew: false},
                {id: "SP249", name: "ê¹€ìˆ˜ì™„", tier: 2, joinDate: "2021-11-08", salary: 41000000, isNew: false},
                {id: "SP584", name: "ë°•ì¸í™˜", tier: 2, joinDate: "2023-07-10", salary: 100000000, isNew: false},
                {id: "SP075", name: "ê°•ë„í™", tier: 3, joinDate: "2021-09-13", salary: 52000000, isNew: false},
                {id: "SP190", name: "ìš°ìˆ˜ì§„", tier: 3, joinDate: "2021-09-13", salary: 64500000, isNew: false},
                {id: "SP313", name: "ë°•ìƒë¯¼", tier: 3, joinDate: "2022-02-21", salary: 40500000, isNew: false},
                {id: "SP346", name: "ìœ ê²½ë¯¼", tier: 3, joinDate: "2022-04-18", salary: 48000000, isNew: false},
                {id: "SP409", name: "ê¹€í˜•ì°¬", tier: 3, joinDate: "2022-07-04", salary: 51000000, isNew: false},
                {id: "SP536", name: "ì¡°í˜„ê¸°", tier: 3, joinDate: "2023-03-27", salary: 77500000, isNew: false},
                {id: "SP538", name: "ê¹€ì˜í•˜", tier: 3, joinDate: "2023-03-27", salary: 39000000, isNew: false},
                {id: "SP559", name: "ê¹€ì£¼ì—°", tier: 3, joinDate: "2023-05-15", salary: 37500000, isNew: false},
                {id: "SP675", name: "ë°•ì •ê· ", tier: 3, joinDate: "2024-04-15", salary: 61700000, isNew: false},
                {id: "SP699", name: "ê¹€ë¯¼ì„", tier: 3, joinDate: "2024-06-24", salary: 86000000, isNew: false},
                {id: "SP028", name: "ìœ¤ì˜ì¤€", tier: 3, joinDate: "2024-07-15", salary: 68500000, isNew: false},
                {id: "SP744", name: "ì´ì„í˜¸", tier: 3, joinDate: "2025-03-04", salary: 130000000, isNew: false},
                {id: "SP048", name: "ìœ í˜¸ì˜", tier: 3, joinDate: "2025-07-22", salary: 119000000, isNew: false},
                {id: "SP117", name: "ê¹€ë„ì—°", tier: 3, joinDate: "2025-07-22", salary: 85000000, isNew: false},
                {id: "SP041", name: "í™©í˜„ì‹", tier: 3, joinDate: "2025-07-22", salary: 106000000, isNew: false},
                {id: "SP770", name: "ìµœìƒí›ˆ", tier: 3, joinDate: "2025-08-18", salary: 80000000, isNew: false},
                {id: "SP224", name: "ì¡°ì‹ ìš°", tier: 4, joinDate: "2021-09-13", salary: 37500000, isNew: false},
                {id: "SP083", name: "ì°¨ì¤€ì˜", tier: 4, joinDate: "2021-10-08", salary: 45000000, isNew: false},
                {id: "SP267", name: "ì „í˜„ì¤€", tier: 4, joinDate: "2021-12-06", salary: 40000000, isNew: false},
                {id: "SP298", name: "ì¥ì§€ì—°", tier: 4, joinDate: "2022-01-03", salary: 39800000, isNew: false},
                {id: "SP299", name: "ì „ìˆ˜ë¯¼", tier: 4, joinDate: "2022-01-10", salary: 52000000, isNew: false},
                {id: "SP357", name: "ê¹€ì •ì—½", tier: 4, joinDate: "2022-04-18", salary: 38000000, isNew: false},
                {id: "SP371", name: "ê¹€ìƒì¡°", tier: 4, joinDate: "2022-05-16", salary: 47600000, isNew: false},
                {id: "SP380", name: "ì§€í˜œì–‘", tier: 4, joinDate: "2022-05-30", salary: 40500000, isNew: false},
                {id: "SP508", name: "ê¹€ì€í¬", tier: 4, joinDate: "2023-01-09", salary: 36000000, isNew: false},
                {id: "SP564", name: "ë‚¨ë‹¤ìœ„", tier: 4, joinDate: "2023-05-30", salary: 75200000, isNew: false},
                {id: "SP592", name: "ìµœì§€ì—°", tier: 4, joinDate: "2023-09-11", salary: 47600000, isNew: false},
                {id: "SP631", name: "ì¡°ìƒí˜¸", tier: 4, joinDate: "2023-11-27", salary: 62500000, isNew: false},
                {id: "SP656", name: "ìœ¤ë¯¼ìš°", tier: 4, joinDate: "2024-01-22", salary: 63500000, isNew: false},
                {id: "SP690", name: "ì´ì •íƒœ", tier: 4, joinDate: "2024-05-27", salary: 47000000, isNew: false},
                {id: "SP700", name: "ì•ˆì°½ìš©", tier: 4, joinDate: "2024-06-24", salary: 47500000, isNew: false},
                {id: "SP764", name: "ì´í˜¸ì§„", tier: 4, joinDate: "2025-07-21", salary: 42000000, isNew: false},
                {id: "SP766", name: "ì¡°ìœ ë¹ˆ", tier: 4, joinDate: "2025-07-22", salary: 70000000, isNew: false},
                {id: "SP052", name: "ëª¨ì„±ë¯¼", tier: 4, joinDate: "2025-07-22", salary: 49300000, isNew: false},
                {id: "SP109", name: "ì´ê·¼ìˆ˜", tier: 4, joinDate: "2025-07-22", salary: 77000000, isNew: false},
                {id: "SP071", name: "ì†¡ì§„ë¯¼", tier: 4, joinDate: "2025-07-22", salary: 81000000, isNew: false},
                {id: "SP535", name: "ê¹€ì¬ê¸°", tier: 4, joinDate: "2025-07-22", salary: 92400000, isNew: false},
                {id: "SP720", name: "ë°•ì—°í¬", tier: 4, joinDate: "2025-07-22", salary: 37000000, isNew: false},
                {id: "SP025", name: "ê¹€ìœ¤ì¬", tier: 4, joinDate: "2025-07-22", salary: 52300000, isNew: false},
                {id: "SP430", name: "ì†¡ì¤€í˜¸", tier: 4, joinDate: "2025-07-22", salary: 103500000, isNew: false},
                {id: "SP418", name: "ì „í˜œì§€", tier: 4, joinDate: "2025-07-22", salary: 41100000, isNew: false},
                {id: "SP345", name: "ì˜¤ì„±ê´‘", tier: 4, joinDate: "2025-07-22", salary: 47200000, isNew: false},
                {id: "SP710", name: "ê¹€ì„ í™", tier: 4, joinDate: "2025-07-22", salary: 35500000, isNew: false},
                {id: "SP771", name: "ìµœì„±ì€", tier: 4, joinDate: "2025-09-08", salary: 74000000, isNew: false},
                {id: "SP004", name: "ê¹€íš¨ì •", tier: 5, joinDate: "2021-11-08", salary: 61400000, isNew: false},
                {id: "SP328", name: "í™ì„±ëª…", tier: 5, joinDate: "2022-03-07", salary: 36200000, isNew: false},
                {id: "SP363", name: "ìš©í™˜ë¯¼", tier: 5, joinDate: "2022-05-02", salary: 34600000, isNew: false},
                {id: "SP370", name: "ì •í˜œì˜", tier: 5, joinDate: "2022-05-16", salary: 39000000, isNew: false},
                {id: "SP401", name: "ê°•ì€í¬", tier: 5, joinDate: "2022-06-27", salary: 40400000, isNew: false},
                {id: "SP574", name: "ì¡°ë™ì£¼", tier: 5, joinDate: "2023-06-12", salary: 42000000, isNew: false},
                {id: "SP598", name: "ê¹€ì˜ì€", tier: 5, joinDate: "2023-09-25", salary: 35400000, isNew: false},
                {id: "SP607", name: "ê¹€í•´í˜„", tier: 5, joinDate: "2023-10-23", salary: 64900000, isNew: false},
                {id: "SP606", name: "ì´ê²½ë¯¼", tier: 5, joinDate: "2023-10-23", salary: 47900000, isNew: false},
                {id: "SP614", name: "ê¹€ìœ¤ì„ ", tier: 5, joinDate: "2023-10-30", salary: 42500000, isNew: false},
                {id: "SP625", name: "ì„œë¯¸ì •", tier: 5, joinDate: "2023-11-13", salary: 50500000, isNew: false},
                {id: "SP643", name: "ê¸°íƒœì–‘", tier: 5, joinDate: "2024-01-02", salary: 35800000, isNew: false},
                {id: "SP645", name: "ì„ì¬ì—½", tier: 5, joinDate: "2024-01-02", salary: 56300000, isNew: false},
                {id: "SP665", name: "ì •ê²½ì›", tier: 5, joinDate: "2024-03-11", salary: 42000000, isNew: false},
                {id: "SP668", name: "ì´ì¬í™˜", tier: 5, joinDate: "2024-03-18", salary: 59900000, isNew: false},
                {id: "SP669", name: "ê°•ì§„ì‹¤", tier: 5, joinDate: "2024-03-18", salary: 48000000, isNew: false},
                {id: "SP671", name: "ê°•ë™í˜¸", tier: 5, joinDate: "2024-04-15", salary: 70500000, isNew: false},
                {id: "SP676", name: "ìœ ì°½ë¯¼", tier: 5, joinDate: "2024-04-22", salary: 48000000, isNew: false},
                {id: "SP677", name: "ì •ì£¼í›ˆ", tier: 5, joinDate: "2024-04-29", salary: 84100000, isNew: false},
                {id: "SP687", name: "ìœ¤í˜œì§€", tier: 5, joinDate: "2024-05-13", salary: 46000000, isNew: false},
                {id: "SP693", name: "ì†ì˜ë°°", tier: 5, joinDate: "2024-06-03", salary: 55000000, isNew: false},
                {id: "SP695", name: "ì´ì„±ìš°", tier: 5, joinDate: "2024-06-24", salary: 77500000, isNew: false},
                {id: "SP705", name: "ì±„ì¢…ìˆ˜", tier: 5, joinDate: "2024-07-15", salary: 33900000, isNew: false},
                {id: "SP706", name: "ê¹€ìˆ˜ì§„B", tier: 5, joinDate: "2024-07-15", salary: 33900000, isNew: false},
                {id: "SP672", name: "ê¹€ìˆ˜ì§„", tier: 5, joinDate: "2024-07-15", salary: 61300000, isNew: false},
                {id: "SP711", name: "ì´í˜„ë¯¼", tier: 5, joinDate: "2024-07-22", salary: 86100000, isNew: false},
                {id: "SP722", name: "ë…¸í˜•ì›", tier: 5, joinDate: "2024-09-09", salary: 53000000, isNew: false},
                {id: "SP491", name: "ì¶”ì—°ì±„", tier: 5, joinDate: "2024-10-23", salary: 54000000, isNew: false},
                {id: "SP264", name: "ìµœê·œí™˜", tier: 5, joinDate: "2024-10-23", salary: 57000000, isNew: false},
                {id: "SP728", name: "ê¹€ì£¼í˜•", tier: 5, joinDate: "2024-10-28", salary: 39000000, isNew: false},
                {id: "SP597", name: "ì†¡ê¸°í˜„", tier: 5, joinDate: "2024-11-01", salary: 35400000, isNew: false},
                {id: "SP730", name: "ë°•í˜•ìš°", tier: 5, joinDate: "2024-11-04", salary: 59000000, isNew: false},
                {id: "SP731", name: "ì´ì¬í˜•", tier: 5, joinDate: "2024-11-04", salary: 55008000, isNew: false},
                {id: "SP735", name: "ì´ìš±ì„ ", tier: 5, joinDate: "2024-12-09", salary: 71000000, isNew: false},
                {id: "SP737", name: "ìœ¤í˜•ê¸°", tier: 5, joinDate: "2024-12-16", salary: 67500000, isNew: false},
                {id: "SP739", name: "ì˜¤ì„±í˜", tier: 5, joinDate: "2025-01-06", salary: 33000000, isNew: false},
                {id: "SP707", name: "ì§„ì˜í›ˆ", tier: 5, joinDate: "2025-01-20", salary: 33900000, isNew: false},
                {id: "SP505", name: "ì´ì¤€í˜¸", tier: 5, joinDate: "2025-01-20", salary: 36200000, isNew: false},
                {id: "SP245", name: "ê¹€ë‹¤ì†œ", tier: 5, joinDate: "2025-01-20", salary: 62300000, isNew: false},
                {id: "SP504", name: "ì •í¬ì—°", tier: 5, joinDate: "2025-01-20", salary: 36000000, isNew: false},
                {id: "SP755", name: "ì†íš¨ì‹", tier: 5, joinDate: "2025-05-26", salary: 30000000, isNew: false},
                {id: "SP590", name: "ì´ì¼ê·œ", tier: 5, joinDate: "2025-07-21", salary: 43700000, isNew: false},
                {id: "SP765", name: "ë°•ì„±ì›", tier: 5, joinDate: "2025-07-21", salary: 62500000, isNew: false},
                {id: "SP252", name: "ë°•íƒœì–‘", tier: 5, joinDate: "2025-07-22", salary: 42000000, isNew: false},
                {id: "SP382", name: "ì •ìœ¤ì£¼", tier: 5, joinDate: "2025-07-22", salary: 45500000, isNew: false},
                {id: "SP756", name: "ì´ì€ì„œ", tier: 5, joinDate: "2025-07-22", salary: 43000000, isNew: false},
                {id: "SP419", name: "ì´ê²½ì§„B", tier: 5, joinDate: "2025-07-22", salary: 37800000, isNew: false},
                {id: "SP638", name: "ì‹ ì§€í›ˆ", tier: 5, joinDate: "2025-07-22", salary: 42300000, isNew: false},
                {id: "SP768", name: "ì˜¤ì§€í˜„", tier: 5, joinDate: "2025-08-04", salary: 44000000, isNew: false},
                {id: "SP769", name: "ê¹€ìœ ë¦¼", tier: 5, joinDate: "2025-08-11", salary: 37000000, isNew: false},
                {id: "SP772", name: "ê¹€í¬ì• ", tier: 5, joinDate: "2025-09-01", salary: 71000000, isNew: false},
                {id: "SP775", name: "ìœ ì§„ì›…", tier: 5, joinDate: "2025-10-13", salary: 50000000, isNew: false},
                {id: "SP774", name: "ì´ì£¼ì—°", tier: 5, joinDate: "2025-10-13", salary: 42000000, isNew: false},
                {id: "SP773", name: "ê¹€ë¯¼ì•„", tier: 5, joinDate: "2025-10-13", salary: 60000000, isNew: false},
                {id: "SP776", name: "ì •ë‹¤ìŠ¬", tier: 5, joinDate: "2025-10-20", salary: 38000000, isNew: false},
                {id: "SP777", name: "ê¹€ë³´ì˜", tier: 5, joinDate: "2025-10-27", salary: 50000000, isNew: true},
                {id: "SP778", name: "ì¡°ì•„ì˜", tier: 5, joinDate: "2025-10-27", salary: 43000000, isNew: true},
                {id: "SP779", name: "ìµœì¤€í˜•", tier: 5, joinDate: "2025-11-10", salary: 34000000, isNew: true},
                {id: "SP781", name: "í™ìœ ì§„", tier: 5, joinDate: "2025-11-17", salary: 30000000, isNew: true},
                {id: "SP782", name: "í™©íƒœì¤€", tier: 5, joinDate: "2025-11-17", salary: 54000000, isNew: true},
                {id: "SP367", name: "ê¹€ì˜ì¼", tier: 5, joinDate: "2025-11-17", salary: 69000000, isNew: true},
                {id: "SP433", name: "ê¹€ëŒ€ì² ", tier: 5, joinDate: "2025-11-17", salary: 70100000, isNew: true},
                {id: "SP783", name: "ë¬¸í˜œì£¼", tier: 5, joinDate: "2025-11-24", salary: 33000000, isNew: true},
                {id: "SP784", name: "ë°•ì¤€ìˆ˜", tier: 5, joinDate: "2025-11-25", salary: 35000000, isNew: true},
                {id: "SP785", name: "ìœ¤ìŠ¹í™˜", tier: 5, joinDate: "2025-12-02", salary: 38000000, isNew: true},
                {id: "SP786", name: "ì´ì˜í™˜", tier: 5, joinDate: "2025-12-02", salary: 80000000, isNew: true},
                {id: "SP171", name: "ì‹ ì¥í˜", tier: 4, joinDate: "2021-05-31", salary: 64600000, isNew: true, level: "L2"},
                {id: "SP177", name: "ì¥ì„ì£¼", tier: 5, joinDate: "2021-06-21", salary: 51000000, isNew: true, level: "L2"},
                {id: "SP251", name: "ë°•ìœ ë‚˜", tier: 5, joinDate: "2021-11-15", salary: 42100000, isNew: true, level: "L2"},
                {id: "SP330", name: "ìœ ì¢…ìˆ˜", tier: 5, joinDate: "2022-03-07", salary: 40400000, isNew: true, level: "L2"},
                {id: "SP103", name: "í™ë³‘ê¸°", tier: 4, joinDate: "2020-09-21", salary: 142000000, isNew: true, level: "L1"},
                {id: "SP258", name: "ë°•íƒœì˜", tier: 5, joinDate: "2021-11-29", salary: 76800000, isNew: true, level: "L1"},
                {id: "SP315", name: "ê¹€ì •í›„", tier: 5, joinDate: "2022-02-21", salary: 71000000, isNew: true, level: "L1"},
                {id: "SP383", name: "í—ˆì„±ì€", tier: 5, joinDate: "2022-06-07", salary: 83000000, isNew: true, level: "L1"},
                {id: "SP521", name: "ê¹€ë™ëª…", tier: 5, joinDate: "2023-01-30", salary: 41000000, isNew: true, level: "L1"},
                {id: "SP093", name: "ìœ ì¢…ê·¼", tier: 5, joinDate: "2020-07-06", salary: 62500000, isNew: true, level: "L2"},
                {id: "SP107", name: "ë°•ê²½ë¯¼", tier: 5, joinDate: "2020-11-03", salary: 63700000, isNew: true, level: "L2"},
                {id: "SP174", name: "ë…¸ì£¼í˜„", tier: 5, joinDate: "2021-06-21", salary: 47000000, isNew: true, level: "L2"},
                {id: "SP460", name: "ê¹€ìš©ì œ", tier: 5, joinDate: "2022-10-24", salary: 74600000, isNew: true, level: "L2"}
            ];

            // ê° ì§ì›ì— ì¡°ì§ ì •ë³´ ì¶”ê°€
            initialEmployees.forEach(emp => {
                const orgData = employeeOrgData[emp.id] || {team: "", part: "", position: "", detailRole: ""};
                emp.team = orgData.team;
                emp.part = orgData.part;
                emp.position = orgData.position;
                emp.detailRole = orgData.detailRole;
            });

            function calculateLevel(joinDate, baseDate) {
                // Convert dates to UTC to avoid timezone issues
                const utcJoinDate = new Date(Date.UTC(
                    joinDate.getFullYear(),
                    joinDate.getMonth(),
                    joinDate.getDate()
                ));
                const utcBaseDate = new Date(Date.UTC(
                    baseDate.getFullYear(),
                    baseDate.getMonth(),
                    baseDate.getDate()
                ));
                
                // Calculate months difference
                let months = (utcBaseDate.getFullYear() - utcJoinDate.getFullYear()) * 12 +
                           (utcBaseDate.getMonth() - utcJoinDate.getMonth());
                
                // Adjust for day of month
                if (utcBaseDate.getDate() < utcJoinDate.getDate()) {
                    months--;
                }
                
                // Return level based on months of experience
                if (months < 0) return 'L1'; // Future join date
                if (months < 6) return 'L1'; // Less than 6 months
                if (months < 12) return 'L2'; // 6-12 months
                return 'L3'; // 12+ months
            }

            function formatDate(date) {
                return date.toISOString().split('T')[0];
            }

            // ì´ì „ ê³ ì • ë¹„ìœ¨ í•¨ìˆ˜ë“¤ì€ ì‚­ì œë¨ - Step 2ì˜ Tier ë°°ìœ¨ ë¡œì§ì„ ì‚¬ìš©
            // Tab 3ëŠ” Step 2ì—ì„œ ê³„ì‚°ëœ calculatedIncentiveValuesì™€ calculatedBonusValuesë¥¼ ì°¸ì¡°

            /**
             * Tab 2ì˜ ì‚¬ì› ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Tier/Levelë³„ ì¸ì›ì„ ê³„ì‚°í•˜ì—¬ Step 2ì— ë°˜ì˜
             */
            function updateHeadcountFromEmployeeData() {
                // ê¸°ì¤€ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );
                
                // Tier/Levelë³„ ì¹´ìš´íŠ¸ ì´ˆê¸°í™” (T1-T6 ì°¸ì—¬ì)
                const counts = {
                    t1: { l1: 0, l2: 0, l3: 0 },
                    t2: { l1: 0, l2: 0, l3: 0 },
                    t3: { l1: 0, l2: 0, l3: 0 },
                    t4: { l1: 0, l2: 0, l3: 0 },
                    t5: { l1: 0, l2: 0, l3: 0 },
                    t6: { l1: 0, l2: 0, l3: 0 }
                };
                
                // ê° ì‚¬ì›ì˜ Tierì™€ Levelì„ ê³„ì‚°í•˜ì—¬ ì¹´ìš´íŠ¸
                employees.forEach(emp => {
                    const joinDate = new Date(emp.joinDate);
                    // ì§ì› ê°ì²´ì— level ì†ì„±ì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©, ì—†ìœ¼ë©´ ê³„ì‚°
                    const level = emp.level || calculateLevel(joinDate, baseDate);
                    const tierKey = 't' + emp.tier;
                    const levelKey = level.toLowerCase();
                    
                    if (counts[tierKey] && counts[tierKey][levelKey] !== undefined) {
                        counts[tierKey][levelKey]++;
                    }
                });
                
                // Step 2ì˜ ì…ë ¥ í•„ë“œì— ê°’ ì„¤ì •
                setValue('t1_l1', counts.t1.l1);
                setValue('t1_l2', counts.t1.l2);
                setValue('t1_l3', counts.t1.l3);
                
                setValue('t2_l1', counts.t2.l1);
                setValue('t2_l2', counts.t2.l2);
                setValue('t2_l3', counts.t2.l3);
                
                setValue('t3_l1', counts.t3.l1);
                setValue('t3_l2', counts.t3.l2);
                setValue('t3_l3', counts.t3.l3);
                
                setValue('t4_l1', counts.t4.l1);
                setValue('t4_l2', counts.t4.l2);
                setValue('t4_l3', counts.t4.l3);
                
                setValue('t5_l1', counts.t5.l1);
                setValue('t5_l2', counts.t5.l2);
                setValue('t5_l3', counts.t5.l3);
                
                setValue('t6_l1', counts.t6.l1);
                setValue('t6_l2', counts.t6.l2);
                setValue('t6_l3', counts.t6.l3);
                
                // Tierë³„ í•©ê³„ ê³„ì‚° ë° í‘œì‹œ
                const t1Count = counts.t1.l1 + counts.t1.l2 + counts.t1.l3;
                const t2Count = counts.t2.l1 + counts.t2.l2 + counts.t2.l3;
                const t3Count = counts.t3.l1 + counts.t3.l2 + counts.t3.l3;
                const t4Count = counts.t4.l1 + counts.t4.l2 + counts.t4.l3;
                const t5Count = counts.t5.l1 + counts.t5.l2 + counts.t5.l3;
                const t6Count = counts.t6.l1 + counts.t6.l2 + counts.t6.l3;
                
                setText('t1_total', t1Count);
                setText('t2_total', t2Count);
                setText('t3_total', t3Count);
                setText('t4_total', t4Count);
                setText('t5_total', t5Count);
                setText('t6_total', t6Count);
                
                // Levelë³„ í•©ê³„ ê³„ì‚° ë° í‘œì‹œ
                const l1Total = counts.t1.l1 + counts.t2.l1 + counts.t3.l1 + counts.t4.l1 + counts.t5.l1 + counts.t6.l1;
                const l2Total = counts.t1.l2 + counts.t2.l2 + counts.t3.l2 + counts.t4.l2 + counts.t5.l2 + counts.t6.l2;
                const l3Total = counts.t1.l3 + counts.t2.l3 + counts.t3.l3 + counts.t4.l3 + counts.t5.l3 + counts.t6.l3;
                
                setText('level_l1_total', l1Total);
                setText('level_l2_total', l2Total);
                setText('level_l3_total', l3Total);
                
                // ì „ì²´ ì´ ì¸ì› í‘œì‹œ
                const totalEmployees = employees.length;
                setText('headcount_grand_total', totalEmployees);
                
                // Tier ë¹„ìœ¨ ê²€ì¦ (Tier 6 ì‹œìŠ¤í…œ: T1 < 5%, T2 < 10%, T3 < 20%, T1+T2+T3 <= 35%)
                const t123Count = t1Count + t2Count + t3Count;
                
                const t1Percent = totalEmployees > 0 ? (t1Count / totalEmployees) * 100 : 0;
                const t2Percent = totalEmployees > 0 ? (t2Count / totalEmployees) * 100 : 0;
                const t3Percent = totalEmployees > 0 ? (t3Count / totalEmployees) * 100 : 0;
                const t4Percent = totalEmployees > 0 ? (t4Count / totalEmployees) * 100 : 0;
                const t5Percent = totalEmployees > 0 ? (t5Count / totalEmployees) * 100 : 0;
                const t6Percent = totalEmployees > 0 ? (t6Count / totalEmployees) * 100 : 0;
                const t123Percent = totalEmployees > 0 ? (t123Count / totalEmployees) * 100 : 0;
                
                // T1 ë¹„ìœ¨ ë° ê²€ì¦ í‘œì‹œ (< 5%)
                const t1ValidationSpan = document.getElementById('t1_validation');
                if (t1ValidationSpan) {
                    if (totalEmployees === 0) {
                        t1ValidationSpan.innerHTML = '-';
                        t1ValidationSpan.className = 'font-semibold';
                    } else if (t1Percent >= 5) {
                        const excess = t1Percent - 5;
                        t1ValidationSpan.innerHTML = `${t1Percent.toFixed(1)}% <span class="text-red-600">(${excess.toFixed(1)}% ì´ˆê³¼)</span>`;
                        t1ValidationSpan.className = 'font-semibold text-red-600';
                    } else {
                        t1ValidationSpan.innerHTML = `${t1Percent.toFixed(1)}% <span class="text-green-600">(ì ì •ì¸ì›)</span>`;
                        t1ValidationSpan.className = 'font-semibold text-green-600';
                    }
                }
                
                // T2 ë¹„ìœ¨ ë° ê²€ì¦ í‘œì‹œ (< 10%)
                const t2ValidationSpan = document.getElementById('t2_validation');
                if (t2ValidationSpan) {
                    if (totalEmployees === 0) {
                        t2ValidationSpan.innerHTML = '-';
                        t2ValidationSpan.className = 'font-semibold';
                    } else if (t2Percent >= 10) {
                        const excess = t2Percent - 10;
                        t2ValidationSpan.innerHTML = `${t2Percent.toFixed(1)}% <span class="text-red-600">(${excess.toFixed(1)}% ì´ˆê³¼)</span>`;
                        t2ValidationSpan.className = 'font-semibold text-red-600';
                    } else {
                        t2ValidationSpan.innerHTML = `${t2Percent.toFixed(1)}% <span class="text-green-600">(ì ì •ì¸ì›)</span>`;
                        t2ValidationSpan.className = 'font-semibold text-green-600';
                    }
                }
                
                // T3 ë¹„ìœ¨ ë° ê²€ì¦ í‘œì‹œ (< 20%)
                const t3ValidationSpan = document.getElementById('t3_validation');
                if (t3ValidationSpan) {
                    if (totalEmployees === 0) {
                        t3ValidationSpan.innerHTML = '-';
                        t3ValidationSpan.className = 'font-semibold';
                    } else if (t3Percent >= 20) {
                        const excess = t3Percent - 20;
                        t3ValidationSpan.innerHTML = `${t3Percent.toFixed(1)}% <span class="text-red-600">(${excess.toFixed(1)}% ì´ˆê³¼)</span>`;
                        t3ValidationSpan.className = 'font-semibold text-red-600';
                    } else {
                        t3ValidationSpan.innerHTML = `${t3Percent.toFixed(1)}% <span class="text-green-600">(ì ì •ì¸ì›)</span>`;
                        t3ValidationSpan.className = 'font-semibold text-green-600';
                    }
                }
                
                // T4 ë¹„ìœ¨ í‘œì‹œ (T4ëŠ” ê²€ì¦ ê¸°ì¤€ì´ ì—†ìœ¼ë¯€ë¡œ ë‹¨ìˆœíˆ ë¹„ìœ¨ë§Œ í‘œì‹œ)
                const t4ValidationSpan = document.getElementById('t4_validation');
                if (t4ValidationSpan) {
                    if (totalEmployees === 0) {
                        t4ValidationSpan.innerHTML = '-';
                        t4ValidationSpan.className = 'font-semibold';
                    } else {
                        t4ValidationSpan.innerHTML = `${t4Percent.toFixed(1)}%`;
                        t4ValidationSpan.className = 'font-semibold text-gray-600';
                    }
                }
                
                // T5 ë¹„ìœ¨ í‘œì‹œ (T5ëŠ” ê²€ì¦ ê¸°ì¤€ì´ ì—†ìœ¼ë¯€ë¡œ ë‹¨ìˆœíˆ ë¹„ìœ¨ë§Œ í‘œì‹œ)
                const t5ValidationSpan = document.getElementById('t5_validation');
                if (t5ValidationSpan) {
                    if (totalEmployees === 0) {
                        t5ValidationSpan.innerHTML = '-';
                        t5ValidationSpan.className = 'font-semibold';
                    } else {
                        t5ValidationSpan.innerHTML = `${t5Percent.toFixed(1)}%`;
                        t5ValidationSpan.className = 'font-semibold text-gray-600';
                    }
                }
                
                // T6 ë¹„ìœ¨ í‘œì‹œ (T6ëŠ” ê²€ì¦ ê¸°ì¤€ì´ ì—†ìœ¼ë¯€ë¡œ ë‹¨ìˆœíˆ ë¹„ìœ¨ë§Œ í‘œì‹œ)
                const t6ValidationSpan = document.getElementById('t6_validation');
                if (t6ValidationSpan) {
                    if (totalEmployees === 0) {
                        t6ValidationSpan.innerHTML = '-';
                        t6ValidationSpan.className = 'font-semibold';
                    } else {
                        t6ValidationSpan.innerHTML = `${t6Percent.toFixed(1)}%`;
                        t6ValidationSpan.className = 'font-semibold text-gray-600';
                    }
                }
                
                // T1+T2+T3 í•©ê³„ ë¹„ìœ¨ ë° ê²€ì¦ í‘œì‹œ (<= 35%)
                const t123ValidationSpan = document.getElementById('t123_validation');
                if (t123ValidationSpan) {
                    if (totalEmployees === 0) {
                        t123ValidationSpan.innerHTML = '-';
                        t123ValidationSpan.className = 'font-semibold';
                    } else if (t123Percent > 35) {
                        const excess = t123Percent - 35;
                        t123ValidationSpan.innerHTML = `T1+T2+T3: ${t123Percent.toFixed(1)}% <span class="text-red-600">(${excess.toFixed(1)}% ì´ˆê³¼)</span>`;
                        t123ValidationSpan.className = 'font-semibold text-red-600';
                    } else {
                        t123ValidationSpan.innerHTML = `T1+T2+T3: ${t123Percent.toFixed(1)}% <span class="text-green-600">(ì ì •ì¸ì›)</span>`;
                        t123ValidationSpan.className = 'font-semibold text-green-600';
                    }
                }
                
                // ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ (Tier 6 ì‹œìŠ¤í…œ)
                const warningDiv = document.getElementById('headcountWarning');
                let warningMessage = '';
                
                if (t1Percent >= 5) {
                    warningMessage += `âš ï¸ T1 ì¸ì›(${t1Count}ëª…, ${t1Percent.toFixed(1)}%)ì´ 5% ì´ìƒì…ë‹ˆë‹¤.\n`;
                }
                if (t2Percent >= 10) {
                    warningMessage += `âš ï¸ T2 ì¸ì›(${t2Count}ëª…, ${t2Percent.toFixed(1)}%)ì´ 10% ì´ìƒì…ë‹ˆë‹¤.\n`;
                }
                if (t3Percent >= 20) {
                    warningMessage += `âš ï¸ T3 ì¸ì›(${t3Count}ëª…, ${t3Percent.toFixed(1)}%)ì´ 20% ì´ìƒì…ë‹ˆë‹¤.\n`;
                }
                if (t123Percent > 35) {
                    warningMessage += `âš ï¸ T1+T2+T3 í•©ê³„(${t123Count}ëª…, ${t123Percent.toFixed(1)}%)ê°€ 35%ë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.\n`;
                }
                
                if (warningMessage && warningDiv) {
                    warningDiv.textContent = warningMessage.trim();
                    warningDiv.classList.remove('hidden');
                } else if (warningDiv) {
                    warningDiv.classList.add('hidden');
                }
            }

            // í•„í„° ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateFilterDropdowns() {
                // ê³ ìœ í•œ ê°’ë“¤ ì¶”ì¶œ
                const teams = [...new Set(employees.map(emp => emp.team).filter(t => t))].sort();
                const parts = [...new Set(employees.map(emp => emp.part).filter(p => p))].sort();
                const positions = [...new Set(employees.map(emp => emp.position).filter(p => p))].sort();
                const detailRoles = [...new Set(employees.map(emp => emp.detailRole).filter(r => r))].sort();

                // íŒ€ í•„í„° ì—…ë°ì´íŠ¸
                const teamFilter = document.getElementById('teamFilter');
                if (teamFilter) {
                    const currentValue = teamFilter.value;
                    teamFilter.innerHTML = '<option value="all">ì „ì²´</option>' + 
                        teams.map(team => `<option value="${team}">${team}</option>`).join('');
                    teamFilter.value = currentValue || 'all';
                }

                // íŒŒíŠ¸ í•„í„° ì—…ë°ì´íŠ¸
                const partFilter = document.getElementById('partFilter');
                if (partFilter) {
                    const currentValue = partFilter.value;
                    partFilter.innerHTML = '<option value="all">ì „ì²´</option>' + 
                        parts.map(part => `<option value="${part}">${part}</option>`).join('');
                    partFilter.value = currentValue || 'all';
                }

                // ì§ì±… í•„í„° ì—…ë°ì´íŠ¸
                const positionFilter = document.getElementById('positionFilter');
                if (positionFilter) {
                    const currentValue = positionFilter.value;
                    positionFilter.innerHTML = '<option value="all">ì „ì²´</option>' + 
                        positions.map(position => `<option value="${position}">${position || '(ì—†ìŒ)'}</option>`).join('');
                    positionFilter.value = currentValue || 'all';
                }

                // ìƒì„¸ì§êµ° í•„í„° ì—…ë°ì´íŠ¸
                const detailRoleFilter = document.getElementById('detailRoleFilter');
                if (detailRoleFilter) {
                    const currentValue = detailRoleFilter.value;
                    detailRoleFilter.innerHTML = '<option value="all">ì „ì²´</option>' + 
                        detailRoles.map(role => `<option value="${role}">${role}</option>`).join('');
                    detailRoleFilter.value = currentValue || 'all';
                }
            }

            function updateEmployeeTable() {
                // ë¨¼ì € ì‚¬ì› ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Step 2 ì¸ì› ì—…ë°ì´íŠ¸
                updateHeadcountFromEmployeeData();
                
                // Step 2ì˜ ì¸ì›ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìœ¼ë¯€ë¡œ ì „ì²´ ê³„ì‚° ì¬ì‹¤í–‰
                calculateAll();
                
                // ì´ì œ ê³„ì‚°ëœ ê°’ì„ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸” í‘œì‹œ ì—…ë°ì´íŠ¸
                const tbody = document.getElementById('employeeTableBody');
                if (!tbody) {
                    console.error('Employee table body not found');
                    return;
                }
                tbody.innerHTML = '';

                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );

                // Get filter and sort values
                const searchName = document.getElementById('searchName')?.value.toLowerCase() || '';
                const tierFilter = document.getElementById('tierFilter')?.value || 'all';
                const teamFilter = document.getElementById('teamFilter')?.value || 'all';
                const partFilter = document.getElementById('partFilter')?.value || 'all';
                const positionFilter = document.getElementById('positionFilter')?.value || 'all';
                const detailRoleFilter = document.getElementById('detailRoleFilter')?.value || 'all';
                const sortOrder = document.getElementById('sortOrder')?.value || 'asc';

                // Filter employees
                let filteredEmployees = employees.filter(emp => {
                    const nameMatch = emp.name.toLowerCase().includes(searchName);
                    const tierMatch = tierFilter === 'all' || emp.tier === parseInt(tierFilter);
                    const teamMatch = teamFilter === 'all' || emp.team === teamFilter;
                    const partMatch = partFilter === 'all' || emp.part === partFilter;
                    const positionMatch = positionFilter === 'all' || emp.position === positionFilter;
                    const detailRoleMatch = detailRoleFilter === 'all' || emp.detailRole === detailRoleFilter;
                    return nameMatch && tierMatch && teamMatch && partMatch && positionMatch && detailRoleMatch;
                });

                // Sort employees by tier
                if (sortOrder === 'asc') {
                    filteredEmployees.sort((a, b) => a.tier - b.tier);
                } else if (sortOrder === 'desc') {
                    filteredEmployees.sort((a, b) => b.tier - a.tier);
                }
                // sortOrder === 'none'ì´ë©´ ì •ë ¬í•˜ì§€ ì•ŠìŒ

                // Display search results
                const searchResultsDiv = document.getElementById('searchResults');
                const searchResultText = document.getElementById('searchResultText');
                
                // Update filter dropdowns dynamically
                updateFilterDropdowns();

                if (searchName || tierFilter !== 'all' || teamFilter !== 'all' || partFilter !== 'all' || positionFilter !== 'all' || detailRoleFilter !== 'all') {
                    const totalCount = employees.length;
                    const filteredCount = filteredEmployees.length;
                    let resultText = `ê²€ìƒ‰ ê²°ê³¼: ${filteredCount}ëª…`;
                    
                    if (searchName) {
                        resultText += ` (ì´ë¦„: "${searchName}")`;
                    }
                    if (tierFilter !== 'all') {
                        resultText += ` (Tier: T${tierFilter})`;
                    }
                    if (teamFilter !== 'all') {
                        resultText += ` (íŒ€: ${teamFilter})`;
                    }
                    if (partFilter !== 'all') {
                        resultText += ` (íŒŒíŠ¸: ${partFilter})`;
                    }
                    if (positionFilter !== 'all') {
                        resultText += ` (ì§ì±…: ${positionFilter})`;
                    }
                    if (detailRoleFilter !== 'all') {
                        resultText += ` (ìƒì„¸ì§êµ°: ${detailRoleFilter})`;
                    }
                    resultText += ` / ì „ì²´ ${totalCount}ëª…`;
                    
                    if (searchResultText) searchResultText.textContent = resultText;
                    if (searchResultsDiv) searchResultsDiv.classList.remove('hidden');
                } else {
                    if (searchResultsDiv) searchResultsDiv.classList.add('hidden');
                }

                let totalSalary = 0;
                let totalMonthly = 0;
                let totalIncentive = 0;
                let totalBonus = 0;

                filteredEmployees.forEach((emp, displayIndex) => {
                    // Find original index for editing
                    const originalIndex = employees.indexOf(emp);
                    const tr = document.createElement('tr');
                    const joinDate = new Date(emp.joinDate);
                    // ì§ì› ê°ì²´ì— level ì†ì„±ì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©, ì—†ìœ¼ë©´ ê³„ì‚°
                    const level = emp.level || calculateLevel(joinDate, baseDate);
                    
                    // Step 2ì—ì„œ ê³„ì‚°ëœ Tier/Levelë³„ ì¸ì„¼í‹°ë¸Œì™€ ë³´ë„ˆìŠ¤ ê°’ ê°€ì ¸ì˜¤ê¸°
                    const tierKey = 't' + emp.tier;
                    const levelKey = level.toLowerCase();
                    
                    const incentive = calculatedIncentiveValues[tierKey]?.[levelKey] || 0;
                    const bonus = calculatedBonusValues[tierKey]?.[levelKey] || 0;
                    const monthlySalary = emp.salary / 12;
                    
                    // Calculate ratio: ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ / ì›”ê¸‰ (ë°°ìˆ˜ë¡œ í‘œì‹œ)
                    const ratio = incentive / monthlySalary;
                    const ratioColor = ratio >= 1 ? 'text-green-600' : 'text-red-600';
                    
                    // Calculate bonus ratio: ëŸ°ì¹­ ë³´ë„ˆìŠ¤ / ì›”ê¸‰ (ë°°ìˆ˜ë¡œ í‘œì‹œ)
                    const bonusRatio = bonus / monthlySalary;
                    const bonusRatioColor = bonusRatio >= 1 ? 'text-green-600' : 'text-red-600';
                    
                    // Calculate bonus payment splits (66.67% for 1st, 33.33% for 2nd)
                    const bonusPayment1 = bonus * (2/3); // 1ì°¨ 66.67%
                    const bonusPayment2 = bonus * (1/3); // 2ì°¨ 33.33%
                    
                    // Calculate payment ratios
                    const bonusPayment1Ratio = bonusPayment1 / monthlySalary;
                    const bonusPayment1RatioColor = bonusPayment1Ratio >= 1 ? 'text-green-600' : 'text-red-600';
                    const bonusPayment2Ratio = bonusPayment2 / monthlySalary;
                    const bonusPayment2RatioColor = bonusPayment2Ratio >= 1 ? 'text-green-600' : 'text-red-600';
                    
                    // Update totals
                    totalSalary += emp.salary;
                    totalMonthly += monthlySalary;
                    totalIncentive += incentive;
                    totalBonus += bonus;

                    // ìƒˆë¡œ ì¶”ê°€ëœ ì§ì›ì¸ ê²½ìš° ì´ë¦„ì„ íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œ
                    const nameStyle = emp.isNew ? 'color: #2563eb; font-weight: 600;' : '';

                    tr.innerHTML = `
                        <td class="text-center">${displayIndex + 1}</td>
                        <td class="text-center">${emp.id}</td>
                        <td class="text-center" style="${nameStyle}">${emp.name}</td>
                        <td class="text-center">${emp.team || '-'}</td>
                        <td class="text-center">${emp.part || '-'}</td>
                        <td class="text-center">${emp.position || '-'}</td>
                        <td class="text-center">${emp.detailRole || '-'}</td>
                        <td class="text-center">
                    <select class="input-base" onchange="updateEmployeeTier(${originalIndex}, this.value)">
                        ${[1,2,3,4,5,6,7].map(t => 
                            `<option value="${t}" ${emp.tier === t ? 'selected' : ''}>T${t}</option>`
                        ).join('')}
                    </select>
                        </td>
                        <td class="text-center">${formatDate(joinDate)}</td>
                        <td class="text-center">${level}</td>
                        <td class="text-right">${emp.salary.toLocaleString()}ì›</td>
                        <td class="text-right">${Math.round(monthlySalary).toLocaleString()}ì›</td>
                        <td class="text-right">${Math.round(incentive).toLocaleString()}ì›</td>
                        <td class="text-right ${ratioColor} font-semibold">${ratio.toFixed(2)}ë°°</td>
                        <td class="text-right bg-blue-50">${Math.round(bonus).toLocaleString()}ì›</td>
                        <td class="text-right bg-blue-50 ${bonusRatioColor} font-semibold">${bonusRatio.toFixed(2)}ë°°</td>
                        <td class="text-right bg-blue-50 text-sm">${Math.round(bonusPayment1).toLocaleString()}ì›</td>
                        <td class="text-right bg-blue-50 text-sm ${bonusPayment1RatioColor} font-semibold">${bonusPayment1Ratio.toFixed(2)}ë°°</td>
                        <td class="text-right bg-blue-50 text-sm">${Math.round(bonusPayment2).toLocaleString()}ì›</td>
                        <td class="text-right bg-blue-50 text-sm ${bonusPayment2RatioColor} font-semibold">${bonusPayment2Ratio.toFixed(2)}ë°°</td>
                        <td class="text-center">
                            <button onclick="deleteEmployee(${originalIndex})" 
                                    class="text-red-600 hover:text-red-800 transition-colors">
                                ì‚­ì œ
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // Update totals in footer
                const totalSalaryEl = document.getElementById('total_salary');
                const totalMonthlyEl = document.getElementById('total_monthly');
                const totalIncentiveEl = document.getElementById('total_incentive');
                const totalBonusEl = document.getElementById('total_bonus');
                const totalBonusPayment1El = document.getElementById('total_bonus_payment1');
                const totalBonusPayment2El = document.getElementById('total_bonus_payment2');
                const totalBonusPayment1RatioEl = document.getElementById('total_bonus_payment1_ratio');
                const totalBonusPayment2RatioEl = document.getElementById('total_bonus_payment2_ratio');
                const totalRatioEl = document.getElementById('total_ratio');
                const totalBonusRatioEl = document.getElementById('total_bonus_ratio');
                const displayedCountEl = document.getElementById('displayedCount');
                
                const totalBonusPayment1 = totalBonus * (2/3);
                const totalBonusPayment2 = totalBonus * (1/3);
                
                if (totalSalaryEl) totalSalaryEl.textContent = Math.round(totalSalary).toLocaleString() + 'ì›';
                if (totalMonthlyEl) totalMonthlyEl.textContent = Math.round(totalMonthly).toLocaleString() + 'ì›';
                if (totalIncentiveEl) totalIncentiveEl.textContent = Math.round(totalIncentive).toLocaleString() + 'ì›';
                if (totalBonusEl) totalBonusEl.textContent = Math.round(totalBonus).toLocaleString() + 'ì›';
                if (totalBonusPayment1El) totalBonusPayment1El.textContent = Math.round(totalBonusPayment1).toLocaleString() + 'ì›';
                if (totalBonusPayment2El) totalBonusPayment2El.textContent = Math.round(totalBonusPayment2).toLocaleString() + 'ì›';
                
                // Calculate total ratio (ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ) - ë°°ìˆ˜ë¡œ í‘œì‹œ
                if (totalRatioEl && totalMonthly > 0) {
                    const totalRatio = totalIncentive / totalMonthly;
                    const ratioColor = totalRatio >= 1 ? 'text-green-600' : 'text-red-600';
                    totalRatioEl.className = `text-right font-bold ${ratioColor}`;
                    totalRatioEl.textContent = `${totalRatio.toFixed(2)}ë°°`;
                }
                
                // Calculate total bonus ratio (ëŸ°ì¹­ ë³´ë„ˆìŠ¤) - ë°°ìˆ˜ë¡œ í‘œì‹œ
                if (totalBonusRatioEl && totalMonthly > 0) {
                    const totalBonusRatio = totalBonus / totalMonthly;
                    const bonusRatioColor = totalBonusRatio >= 1 ? 'text-green-600' : 'text-red-600';
                    totalBonusRatioEl.className = `text-right font-bold bg-blue-50 ${bonusRatioColor}`;
                    totalBonusRatioEl.textContent = `${totalBonusRatio.toFixed(2)}ë°°`;
                }
                
                // Calculate bonus payment 1 ratio (1ì°¨ ì§€ê¸‰)
                if (totalBonusPayment1RatioEl && totalMonthly > 0) {
                    const payment1Ratio = totalBonusPayment1 / totalMonthly;
                    const payment1RatioColor = payment1Ratio >= 1 ? 'text-green-600' : 'text-red-600';
                    totalBonusPayment1RatioEl.className = `text-right font-bold bg-blue-50 ${payment1RatioColor}`;
                    totalBonusPayment1RatioEl.textContent = `${payment1Ratio.toFixed(2)}ë°°`;
                }
                
                // Calculate bonus payment 2 ratio (2ì°¨ ì§€ê¸‰)
                if (totalBonusPayment2RatioEl && totalMonthly > 0) {
                    const payment2Ratio = totalBonusPayment2 / totalMonthly;
                    const payment2RatioColor = payment2Ratio >= 1 ? 'text-green-600' : 'text-red-600';
                    totalBonusPayment2RatioEl.className = `text-right font-bold bg-blue-50 ${payment2RatioColor}`;
                    totalBonusPayment2RatioEl.textContent = `${payment2Ratio.toFixed(2)}ë°°`;
                }
                
                // Update displayed count
                if (displayedCountEl) {
                    displayedCountEl.textContent = filteredEmployees.length;
                }
                
                // ì£¼ì˜: updateHeadcountFromEmployeeData()ì™€ calculateAll()ì€
                // í•¨ìˆ˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ ì´ë¯¸ í˜¸ì¶œë˜ì—ˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì¤‘ë³µ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
            }

            // Global functions for employee management
            window.updateEmployeeTier = function(index, newTier) {
                const newTierInt = parseInt(newTier);
                const oldTier = employees[index].tier;
                
                // Count employees in each tier after the change
                const tierCounts = employees.reduce((acc, emp, i) => {
                    if (i === index) {
                        // This is the employee being changed
                        acc[newTierInt] = (acc[newTierInt] || 0) + 1;
                    } else {
                        acc[emp.tier] = (acc[emp.tier] || 0) + 1;
                    }
                    return acc;
                }, {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0});
                
                // Calculate percentages
                const totalEmployees = employees.length;
                const t1Percent = totalEmployees > 0 ? (tierCounts[1] / totalEmployees) * 100 : 0;
                const t2Percent = totalEmployees > 0 ? (tierCounts[2] / totalEmployees) * 100 : 0;
                const t3Percent = totalEmployees > 0 ? (tierCounts[3] / totalEmployees) * 100 : 0;
                const t123Percent = totalEmployees > 0 ? ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / totalEmployees) * 100 : 0;
                
                // Validate tier change
                let errorMessage = '';
                if (t1Percent >= 5) {
                    errorMessage = 'T1ì€ ì „ì²´ ì¸ì›ì˜ 5% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t2Percent >= 10) {
                    errorMessage = 'T2ëŠ” ì „ì²´ ì¸ì›ì˜ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t3Percent >= 20) {
                    errorMessage = 'T3ëŠ” ì „ì²´ ì¸ì›ì˜ 20% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t123Percent > 35) {
                    errorMessage = 'T1+T2+T3 í•©ê³„ëŠ” ì „ì²´ ì¸ì›ì˜ 35% ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.';
                }
                
                if (errorMessage) {
                    alert(errorMessage);
                    // Reset the select element to the previous value
                    const select = document.querySelector(`select[onchange="updateEmployeeTier(${index}, this.value)"]`);
                    if (select) select.value = oldTier;
                    return;
                }
                
                employees[index].tier = newTierInt;
                updateEmployeeTable();
            };

            window.deleteEmployee = function(index) {
                const employee = employees[index];
                if (!employee) return;

                // Calculate tier percentages after deletion
                const tierCounts = employees.reduce((acc, emp, i) => {
                    if (i !== index) {
                        acc[emp.tier] = (acc[emp.tier] || 0) + 1;
                    }
                    return acc;
                }, {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0});

                const totalEmployees = employees.length - 1;
                const t1Percent = totalEmployees > 0 ? (tierCounts[1] / totalEmployees) * 100 : 0;
                const t2Percent = totalEmployees > 0 ? (tierCounts[2] / totalEmployees) * 100 : 0;
                const t3Percent = totalEmployees > 0 ? (tierCounts[3] / totalEmployees) * 100 : 0;
                const t123Percent = totalEmployees > 0 ? ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / totalEmployees) * 100 : 0;

                // Check if deletion would violate tier restrictions
                let errorMessage = '';
                if (totalEmployees > 0) {
                    if (t1Percent >= 5) {
                        errorMessage = 'T1 ì¸ì›ì´ 5% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ T1 ì¸ì›ì„ ë¨¼ì € ì¡°ì •í•´ì£¼ì„¸ìš”.';
                    } else if (t2Percent >= 10) {
                        errorMessage = 'T2 ì¸ì›ì´ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ T2 ì¸ì›ì„ ë¨¼ì € ì¡°ì •í•´ì£¼ì„¸ìš”.';
                    } else if (t3Percent >= 20) {
                        errorMessage = 'T3 ì¸ì›ì´ 20% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ T3 ì¸ì›ì„ ë¨¼ì € ì¡°ì •í•´ì£¼ì„¸ìš”.';
                    } else if (t123Percent > 35) {
                        errorMessage = 'T1+T2+T3 í•©ê³„ê°€ 35% ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì¸ì›ì„ ë¨¼ì € ì¡°ì •í•´ì£¼ì„¸ìš”.';
                    }
                }

                if (errorMessage) {
                    alert(errorMessage);
                    return;
                }

                if (confirm(`ì •ë§ ${employee.name}(${employee.id}) ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    employees.splice(index, 1);
                    updateEmployeeTable();
                }
            };

            // Add new employee
            document.getElementById('addEmployee').addEventListener('click', () => {
                const id = document.getElementById('newEmpId').value.trim();
                const name = document.getElementById('newEmpName').value.trim();
                const tier = parseInt(document.getElementById('newEmpTier').value);
                const joinDate = document.getElementById('newEmpJoinDate').value;

                // Validate input fields
                if (!id || !name || !joinDate) {
                    alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // Validate employee ID format
                if (!/^SP\d{3}$/.test(id)) {
                    alert('ì‚¬ë²ˆì€ SPë¡œ ì‹œì‘í•˜ëŠ” 5ìë¦¬ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: SP001)');
                    return;
                }

                // Check for duplicate employee ID
                if (employees.some(emp => emp.id === id)) {
                    alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ë²ˆì…ë‹ˆë‹¤.');
                    return;
                }

                // Calculate tier percentages after addition
                const tierCounts = employees.reduce((acc, emp) => {
                    acc[emp.tier] = (acc[emp.tier] || 0) + 1;
                    return acc;
                }, {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0});
                tierCounts[tier] = (tierCounts[tier] || 0) + 1; // Add the new employee

                const totalEmployees = employees.length + 1;
                const t1Percent = totalEmployees > 0 ? (tierCounts[1] / totalEmployees) * 100 : 0;
                const t2Percent = totalEmployees > 0 ? (tierCounts[2] / totalEmployees) * 100 : 0;
                const t3Percent = totalEmployees > 0 ? (tierCounts[3] / totalEmployees) * 100 : 0;
                const t123Percent = totalEmployees > 0 ? ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / totalEmployees) * 100 : 0;

                // Validate tier restrictions
                let errorMessage = '';
                if (t1Percent >= 5) {
                    errorMessage = 'T1 ì¸ì›ì´ 5% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t2Percent >= 10) {
                    errorMessage = 'T2 ì¸ì›ì´ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t3Percent >= 20) {
                    errorMessage = 'T3 ì¸ì›ì´ 20% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t123Percent > 35) {
                    errorMessage = 'T1+T2+T3 í•©ê³„ê°€ 35% ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.';
                }

                if (errorMessage) {
                    alert(errorMessage);
                    return;
                }

                // Add the new employee
                employees.push({
                    id,
                    name,
                    tier,
                    joinDate,
                    salary: 50000000 // Default salary
                });

                // Clear input fields
                document.getElementById('newEmpId').value = '';
                document.getElementById('newEmpName').value = '';
                document.getElementById('newEmpTier').value = '4';
                document.getElementById('newEmpJoinDate').value = '';

                updateEmployeeTable();
            });

            // CSV íŒŒì‹± í—¬í¼ í•¨ìˆ˜ (ë”°ì˜´í‘œ ê³ ë ¤)
            function parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim());
                return result;
            }

            // CSV íŒŒì¼ ì²˜ë¦¬
            document.getElementById('importCSV').addEventListener('click', () => {
                const fileInput = document.getElementById('csvFile');
                const file = fileInput.files[0];
                
                if (!file) {
                    alert('CSV íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    const lines = text.split('\n');
                    
                    // Skip header row and empty lines
                    const newEmployees = lines
                        .slice(2) // Skip "â–  ì¬ì§ì í˜„í™©" and header rows
                        .filter(line => line.trim())
                        .map(line => {
                            const columns = parseCSVLine(line);
                            
                            // Parse salary (ì—°ë´‰ ì»¬ëŸ¼: index 6)
                            const salaryStr = columns[6] ? columns[6].replace(/[" ,]/g, '') : '';
                            const salary = parseInt(salaryStr) || 50000000;
                            
                            const tier = parseInt(columns[3]);
                            return {
                                id: columns[1],
                                name: columns[2],
                                tier: tier,
                                joinDate: columns[5], // OQ í•©ë¥˜ì¼ ì‚¬ìš©
                                salary: salary
                            };
                        })
                        .filter(emp => {
                            // ìœ íš¨ì„± ê²€ì¦: id, name, tierê°€ ëª¨ë‘ ì¡´ì¬í•˜ê³  tierëŠ” 1-7 ë²”ìœ„ ë‚´ì—¬ì•¼ í•¨
                            return emp.id && emp.name && !isNaN(emp.tier) && emp.tier >= 1 && emp.tier <= 7;
                        });

                    if (newEmployees.length === 0) {
                        alert('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }

                    // Validate tier restrictions
                    const tierCounts = newEmployees.reduce((acc, emp) => {
                        acc[emp.tier] = (acc[emp.tier] || 0) + 1;
                        return acc;
                    }, {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0});

                    const totalEmployees = newEmployees.length;
                    const t1Percent = totalEmployees > 0 ? (tierCounts[1] / totalEmployees) * 100 : 0;
                    const t2Percent = totalEmployees > 0 ? (tierCounts[2] / totalEmployees) * 100 : 0;
                    const t3Percent = totalEmployees > 0 ? (tierCounts[3] / totalEmployees) * 100 : 0;
                    const t123Percent = totalEmployees > 0 ? ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / totalEmployees) * 100 : 0;

                    let errorMessage = '';
                    if (t1Percent >= 5) {
                        errorMessage = 'T1 ì¸ì›ì´ 5% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                    } else if (t2Percent >= 10) {
                        errorMessage = 'T2 ì¸ì›ì´ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                    } else if (t3Percent >= 20) {
                        errorMessage = 'T3 ì¸ì›ì´ 20% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                    } else if (t123Percent > 35) {
                        errorMessage = 'T1+T2+T3 í•©ê³„ê°€ 35% ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.';
                    }

                    if (errorMessage) {
                        alert('CSV íŒŒì¼ì˜ Tier ë¶„í¬ê°€ ì œí•œì„ ìœ„ë°˜í•©ë‹ˆë‹¤:\n' + errorMessage);
                        return;
                    }

                    // Replace existing employees with new ones
                    employees = newEmployees;
                    
                    // ê° ì§ì›ì— ì¡°ì§ ì •ë³´ ì¶”ê°€ (employeeOrgData ì‚¬ìš©)
                    employees.forEach(emp => {
                        const orgData = employeeOrgData[emp.id] || {team: "", part: "", position: "", detailRole: ""};
                        emp.team = orgData.team;
                        emp.part = orgData.part;
                        emp.position = orgData.position;
                        emp.detailRole = orgData.detailRole;
                        // isNew í”Œë˜ê·¸ëŠ” CSVì—ì„œ ê°€ì ¸ì˜¤ì§€ ì•Šìœ¼ë¯€ë¡œ ê¸°ë³¸ê°’ falseë¡œ ì„¤ì •
                        if (emp.isNew === undefined) {
                            emp.isNew = false;
                        }
                    });
                    
                    updateEmployeeTable();
                    
                    // Clear file input
                    fileInput.value = '';
                    
                    alert(`${newEmployees.length}ëª…ì˜ ì¸ì› ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
                };
                
                reader.onerror = function() {
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                };
                
                reader.readAsText(file);
            });

            // CSV ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥
            document.getElementById('exportCSV').addEventListener('click', () => {
                if (employees.length === 0) {
                    alert('ë‚´ë³´ë‚¼ ì§ì› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // CSV í—¤ë”
                let csvContent = 'ì´ë¦„,Tier,OQ í•©ë¥˜ì¼,ì—°ë´‰,ì‚¬ë²ˆ,íŒ€,íŒŒíŠ¸,ì§ì±…,ìƒì„¸ì§êµ°,ì‹ ê·œ ì¶”ê°€ ì—¬ë¶€\n';
                
                // ë°ì´í„° í–‰ ì¶”ê°€ (Tier ìˆœìœ¼ë¡œ ì •ë ¬)
                const sortedEmployees = [...employees].sort((a, b) => {
                    if (a.tier !== b.tier) return a.tier - b.tier;
                    return a.name.localeCompare(b.name);
                });
                
                sortedEmployees.forEach(emp => {
                    const joinDate = emp.joinDate;
                    const isNewFlag = emp.isNew ? 'ì‹ ê·œ' : '';
                    csvContent += `${emp.name},${emp.tier},${joinDate},${emp.salary},${emp.id},${emp.team || ''},${emp.part || ''},${emp.position || ''},${emp.detailRole || ''},${isNewFlag}\n`;
                });

                // Blob ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                const now = new Date();
                const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`;
                
                link.setAttribute('href', url);
                link.setAttribute('download', `ì¬ì§ìí˜„í™©_${dateStr}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url); // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
                
                alert(`${employees.length}ëª…ì˜ ì§ì› ë°ì´í„°ë¥¼ CSV íŒŒì¼ë¡œ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤.`);
            });

            // Initialize table with CSV data
            employees = initialEmployees;
            
            // ì´ˆê¸° ë¡œë“œ ì‹œ ì‚¬ì› ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì¸ì› ê³„ì‚° ë° í…Œì´ë¸” í‘œì‹œ
            updateDays();
            updateEmployeeTable();
            
            // Add event listeners for date changes
            baseYear.addEventListener('change', updateDays);
            baseMonth.addEventListener('change', updateDays);
            baseDay.addEventListener('change', updateEmployeeTable);
            
            // Add event listeners for search, filter, and sort
            const searchNameInput = document.getElementById('searchName');
            const tierFilterSelect = document.getElementById('tierFilter');
            const sortOrderSelect = document.getElementById('sortOrder');
            const resetFiltersBtn = document.getElementById('resetFilters');
            
            if (searchNameInput) {
                searchNameInput.addEventListener('input', updateEmployeeTable);
            }
            if (tierFilterSelect) {
                tierFilterSelect.addEventListener('change', updateEmployeeTable);
            }
            const teamFilterSelect = document.getElementById('teamFilter');
            if (teamFilterSelect) {
                teamFilterSelect.addEventListener('change', updateEmployeeTable);
            }
            const partFilterSelect = document.getElementById('partFilter');
            if (partFilterSelect) {
                partFilterSelect.addEventListener('change', updateEmployeeTable);
            }
            const positionFilterSelect = document.getElementById('positionFilter');
            if (positionFilterSelect) {
                positionFilterSelect.addEventListener('change', updateEmployeeTable);
            }
            const detailRoleFilterSelect = document.getElementById('detailRoleFilter');
            if (detailRoleFilterSelect) {
                detailRoleFilterSelect.addEventListener('change', updateEmployeeTable);
            }
            if (sortOrderSelect) {
                sortOrderSelect.addEventListener('change', updateEmployeeTable);
            }
            
            // Reset filters button
            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', () => {
                    if (searchNameInput) searchNameInput.value = '';
                    if (tierFilterSelect) tierFilterSelect.value = 'all';
                    if (teamFilterSelect) teamFilterSelect.value = 'all';
                    if (partFilterSelect) partFilterSelect.value = 'all';
                    if (positionFilterSelect) positionFilterSelect.value = 'all';
                    if (detailRoleFilterSelect) detailRoleFilterSelect.value = 'all';
                    if (sortOrderSelect) sortOrderSelect.value = 'none';
                    updateEmployeeTable();
                });
            }
            
            // Initial population
            updateDays();
            updateFilterDropdowns();
            updateEmployeeTable();

            // ####################
            // HR ì¸ì‚¬ì´íŠ¸ ê´€ë ¨ í•¨ìˆ˜ë“¤
            // ####################

            // Chart ì¸ìŠ¤í„´ìŠ¤ ì €ì¥
            let hrCharts = {};
            
            // í•µì‹¬ ì¸ì¬ ë¶„í¬ ë¶„ì„ Tier ë²”ìœ„ (ê¸°ë³¸ê°’: T12)
            let talentTierRange = 'T12';

            // ì¸ì‚¬ì´íŠ¸ íƒ­ ì „í™˜
            function switchInsightTab(tabName) {
                // ëª¨ë“  ì¸ì‚¬ì´íŠ¸ íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                document.querySelectorAll('.insight-tab-button').forEach(btn => {
                    btn.classList.add('border-transparent', 'text-gray-500');
                    btn.classList.remove('border-indigo-500', 'text-indigo-600');
                });

                // ëª¨ë“  ì¸ì‚¬ì´íŠ¸ íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
                document.querySelectorAll('.insight-tab-content').forEach(content => {
                    content.classList.add('hidden');
                });

                // ì„ íƒëœ íƒ­ í™œì„±í™”
                const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
                const activeContent = document.getElementById(`insight-${tabName}`);
                
                if (activeButton && activeContent) {
                    activeButton.classList.add('border-indigo-500', 'text-indigo-600');
                    activeButton.classList.remove('border-transparent', 'text-gray-500');
                    activeContent.classList.remove('hidden');
                    
                    // íƒ­ë³„ ë¶„ì„ ì‹¤í–‰
                    updateInsightTab(tabName);
                }
            }

            // ì¸ì‚¬ì´íŠ¸ íƒ­ë³„ ì—…ë°ì´íŠ¸
            function updateInsightTab(tabName) {
                const segment = document.getElementById('insightSegment')?.value || 'team';
                const targetRatio = parseFloat(document.getElementById('targetTierRatio')?.value || 30);

                switch(tabName) {
                    case 'capability':
                        analyzeCapability(segment);
                        break;
                    case 'mismatch':
                        analyzeMismatch();
                        break;
                    case 'concentration':
                        analyzeConcentration(segment);
                        break;
                    case 'efficiency':
                        analyzeEfficiency(segment);
                        break;
                    case 'growth':
                        analyzeGrowthPotential(segment);
                        break;
                    case 'gap':
                        analyzeGap(segment, targetRatio);
                        break;
                    case 'talent':
                        analyzeTalentDistribution(segment, talentTierRange);
                        break;
                    case 'experience':
                        analyzeExperienceMatch();
                        break;
                    case 'comprehensive':
                        analyzeComprehensive(segment);
                        break;
                }
            }

            // í˜„ì¬ ì—´ë¦° ëª¨ë‹¬ì˜ ì¸ì‚¬ì´íŠ¸ íƒ€ì…
            let currentModalInsight = null;

            // ëª¨ë‹¬ ì—´ê¸° (ì „ì—­ í•¨ìˆ˜)
            window.openInsightModal = function(insightType) {
                currentModalInsight = insightType;
                const modal = document.getElementById('insightModal');
                const modalContent = document.getElementById('modalContent');
                const contentWrapper = document.getElementById(`insight-${insightType}`);
                
                if (!modal || !contentWrapper) return;

                // ëª¨ë‹¬ ì œëª© ì„¤ì •
                const titles = {
                    'capability': 'ì—°ë´‰-ëŠ¥ë ¥ ê´´ë¦¬ ë¶„ì„',
                    'mismatch': 'ë¦¬ë” ëŠ¥ë ¥ ì·¨ì•½ë„ ë¶„ì„',
                    'concentration': 'ì—­ëŸ‰ ì§‘ì¤‘ë„',
                    'efficiency': 'ì—°ë´‰ íš¨ìœ¨ì„±',
                    'growth': 'ì„±ì¥ ì ì¬ë ¥',
                    'gap': 'ëª©í‘œ-ì‹¤ì œ ì—­ëŸ‰ ê´´ë¦¬ ë¶„ì„',
                    'talent': 'í•µì‹¬ ì¸ì¬ ë¶„í¬',
                    'experience': 'ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­',
                    'comprehensive': 'ì¢…í•© ë¶„ì„'
                };
                
                const subtitles = {
                    'capability': 'Segmentë³„ ì—°ë´‰-ëŠ¥ë ¥ ê´´ë¦¬ ë¶„ì„',
                    'mismatch': 'ë¦¬ë” ëŠ¥ë ¥ ì·¨ì•½ë„ ë¶„ì„',
                    'concentration': 'ì—­ëŸ‰ ì§‘ì¤‘ë„ ë¶„ì„',
                    'efficiency': 'Tier ëŒ€ë¹„ ì—°ë´‰ íš¨ìœ¨ì„± ë¶„ì„',
                    'growth': 'ì„±ì¥ ì ì¬ë ¥ ë¶„ì„',
                    'gap': 'ëª©í‘œ-ì‹¤ì œ ì—­ëŸ‰ ê´´ë¦¬ ë¶„ì„',
                    'talent': 'í•µì‹¬ ì¸ì¬ ë¶„í¬ ë¶„ì„',
                    'experience': 'ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­ë„ ë¶„ì„',
                    'comprehensive': 'ì¢…í•© ë¶„ì„'
                };

                document.getElementById('modalTitle').textContent = titles[insightType] || 'ì¸ì‚¬ì´íŠ¸ ë¶„ì„';
                document.getElementById('modalSubtitle').textContent = subtitles[insightType] || 'ìƒì„¸ ë¶„ì„ ë° ë°ì´í„°';

                // ì½˜í…ì¸  ë³µì‚¬
                modalContent.innerHTML = contentWrapper.innerHTML;

                // ëª¨ë‹¬ í‘œì‹œ
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';

                // ëª¨ë‹¬ ë‚´ë¶€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì—°ê²°
                setTimeout(() => {
                    // ëª©í‘œ ë¹„ìœ¨ ìŠ¬ë¼ì´ë”
                    const slider = modalContent.querySelector('#targetRatioSlider');
                    const sliderValue = modalContent.querySelector('#targetRatioValue');
                    if (slider && sliderValue) {
                        slider.addEventListener('input', (e) => {
                            const value = e.target.value;
                            sliderValue.textContent = value + '%';
                            const targetRatioInput = modalContent.querySelector('#targetTierRatio');
                            if (targetRatioInput) targetRatioInput.value = value;
                            if (insightType === 'gap') {
                                const segment = document.getElementById('insightSegment')?.value || 'team';
                                analyzeGap(segment, parseFloat(value));
                            }
                        });
                    }

                    // í•µì‹¬ ì¸ì¬ ë¶„í¬ Tier ë²”ìœ„ ì„ íƒ ë²„íŠ¼
                    const t12Button = modalContent.querySelector('#talentRangeT12');
                    const t13Button = modalContent.querySelector('#talentRangeT13');
                    if (t12Button && t13Button) {
                        t12Button.addEventListener('click', () => {
                            talentTierRange = 'T12';
                            t12Button.classList.remove('bg-gray-300', 'text-gray-700');
                            t12Button.classList.add('bg-indigo-600', 'text-white');
                            t13Button.classList.remove('bg-indigo-600', 'text-white');
                            t13Button.classList.add('bg-gray-300', 'text-gray-700');
                            if (insightType === 'talent') {
                                const segment = document.getElementById('insightSegment')?.value || 'team';
                                analyzeTalentDistribution(segment, talentTierRange);
                            }
                        });
                        
                        t13Button.addEventListener('click', () => {
                            talentTierRange = 'T13';
                            t13Button.classList.remove('bg-gray-300', 'text-gray-700');
                            t13Button.classList.add('bg-indigo-600', 'text-white');
                            t12Button.classList.remove('bg-indigo-600', 'text-white');
                            t12Button.classList.add('bg-gray-300', 'text-gray-700');
                            if (insightType === 'talent') {
                                const segment = document.getElementById('insightSegment')?.value || 'team';
                                analyzeTalentDistribution(segment, talentTierRange);
                            }
                        });
                    }

                    // ë¶„ì„ ì‹¤í–‰
                    const segment = document.getElementById('insightSegment')?.value || 'team';
                    updateInsightTab(insightType);
                }, 100);
            }

            // ëª¨ë‹¬ ë‹«ê¸° (ì „ì—­ í•¨ìˆ˜)
            window.closeInsightModal = function() {
                const modal = document.getElementById('insightModal');
                if (modal) {
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                    currentModalInsight = null;
                }
            }

            // ì ìˆ˜ ë“±ê¸‰ íŒì • í•¨ìˆ˜
            function getScoreGrade(score) {
                if (score >= 80) return { grade: 'ìš°ìˆ˜', color: 'green', bgColor: 'bg-green-100', textColor: 'text-green-700', borderColor: 'border-green-300' };
                if (score >= 60) return { grade: 'ì–‘í˜¸', color: 'blue', bgColor: 'bg-blue-100', textColor: 'text-blue-700', borderColor: 'border-blue-300' };
                if (score >= 40) return { grade: 'ì£¼ì˜', color: 'yellow', bgColor: 'bg-yellow-100', textColor: 'text-yellow-700', borderColor: 'border-yellow-300' };
                if (score >= 20) return { grade: 'ê²½ê³ ', color: 'orange', bgColor: 'bg-orange-100', textColor: 'text-orange-700', borderColor: 'border-orange-300' };
                return { grade: 'ì‹¬ê°', color: 'red', bgColor: 'bg-red-100', textColor: 'text-red-700', borderColor: 'border-red-300' };
            }

            // ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ ìƒì„±
            function createInsightCards() {
                const grid = document.getElementById('insightCardsGrid');
                if (!grid) return;

                const insights = [
                    { 
                        type: 'capability', 
                        icon: 'ğŸ“Š', 
                        title: 'ì—°ë´‰-ëŠ¥ë ¥ ê´´ë¦¬ ë¶„ì„', 
                        desc: 'íŒ€/íŒŒíŠ¸/ì§ì±…ë³„ í‰ê·  Tierì™€ ì—°ë´‰ì„ ë¹„êµí•˜ì—¬ ê° ì¡°ì§ì˜ ì—­ëŸ‰ ìˆ˜ì¤€ì„ íŒŒì•…í•©ë‹ˆë‹¤.',
                        color: 'indigo', 
                        status: 'active' 
                    },
                    { 
                        type: 'mismatch', 
                        icon: 'âš ï¸', 
                        title: 'ë¦¬ë” ëŠ¥ë ¥ ì·¨ì•½ë„ ë¶„ì„', 
                        desc: 'ì§ì±…ì(ë¦¬ë”, íŒŒíŠ¸ì¥, AD, TD ë“±) ì¤‘ Tier 4-6ì¸ ì¸ì›ì„ íŒ€/íŒŒíŠ¸ë³„ë¡œ ì§„ë‹¨í•˜ì—¬ ê°€ì¥ ì‹¬ê°í•œ ê³³ë¶€í„° ë³´ì—¬ì¤ë‹ˆë‹¤.',
                        color: 'red', 
                        status: 'alert', 
                        alertCount: 0 
                    },
                    { 
                        type: 'concentration', 
                        icon: 'ğŸ“ˆ', 
                        title: 'ì—­ëŸ‰ ì§‘ì¤‘ë„', 
                        desc: 'íŠ¹ì • ì¡°ì§ì— ê³ Tier ì¸ì›ì´ ê³¼ë„í•˜ê²Œ ì§‘ì¤‘ë˜ê±°ë‚˜ ë¶€ì¡±í•œ ê²½ìš°ë¥¼ ë¶„ì„í•˜ì—¬ ì¸ë ¥ ë°°ì¹˜ ê· í˜•ì„ ì ê²€í•©ë‹ˆë‹¤.',
                        color: 'yellow', 
                        status: 'waiting' 
                    },
                    { 
                        type: 'efficiency', 
                        icon: 'ğŸ’°', 
                        title: 'ì—°ë´‰ íš¨ìœ¨ì„±', 
                        desc: 'Tierê°€ ë‚®ì€ë° ì—°ë´‰ì´ ë†’ì€ ì¸ì›ì„ ì°¾ì•„ ë³´ìƒ ì²´ê³„ì˜ ê³µì •ì„±ê³¼ íš¨ìœ¨ì„±ì„ ì ê²€í•©ë‹ˆë‹¤.',
                        color: 'green', 
                        status: 'alert', 
                        alertCount: 0 
                    },
                    { 
                        type: 'growth', 
                        icon: 'ğŸŒ±', 
                        title: 'ì„±ì¥ ì ì¬ë ¥', 
                        desc: 'ì‹ ê·œ ì…ì‚¬ì ì¤‘ ê³ Tier ë¹„ìœ¨ì„ ë¶„ì„í•˜ì—¬ ì¡°ì§ì˜ ì„±ì¥ ì ì¬ë ¥ê³¼ ì±„ìš© í’ˆì§ˆì„ í‰ê°€í•©ë‹ˆë‹¤.',
                        color: 'purple', 
                        status: 'waiting' 
                    },
                    { 
                        type: 'gap', 
                        icon: 'ğŸ“‰', 
                        title: 'ëª©í‘œ-ì‹¤ì œ ì—­ëŸ‰ ê´´ë¦¬ ë¶„ì„', 
                        desc: 'ëª©í‘œ T1-T3 ë¹„ìœ¨ ëŒ€ë¹„ ì‹¤ì œ ë¹„ìœ¨ì„ ë¹„êµí•˜ì—¬ ì—­ëŸ‰ ê°•í™”ê°€ í•„ìš”í•œ ì¡°ì§ì„ ì‹ë³„í•©ë‹ˆë‹¤.',
                        color: 'blue', 
                        status: 'waiting' 
                    },
                    { 
                        type: 'talent', 
                        icon: 'â­', 
                        title: 'í•µì‹¬ ì¸ì¬ ë¶„í¬', 
                        desc: 'T1-T2 í•µì‹¬ ì¸ì¬ê°€ ì–´ëŠ ì¡°ì§ì— ì–¼ë§ˆë‚˜ ë¶„í¬ë˜ì–´ ìˆëŠ”ì§€ íŒŒì•…í•˜ì—¬ í•µì‹¬ ì¸ë ¥ ê´€ë¦¬ ì „ëµì„ ìˆ˜ë¦½í•©ë‹ˆë‹¤.',
                        color: 'orange', 
                        status: 'waiting' 
                    },
                    { 
                        type: 'experience', 
                        icon: 'ğŸ‘¥', 
                        title: 'ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­', 
                        desc: 'ê·¼ì† ê¸°ê°„ ëŒ€ë¹„ Tier ë¶„í¬ë¥¼ ë¶„ì„í•˜ì—¬ ê²½ë ¥ì— ë§ëŠ” ì„±ì¥ì„ í•˜ê³  ìˆëŠ”ì§€ ì ê²€í•©ë‹ˆë‹¤.',
                        color: 'teal', 
                        status: 'waiting' 
                    },
                    { 
                        type: 'comprehensive', 
                        icon: 'ğŸ¯', 
                        title: 'ì¢…í•© ë¶„ì„', 
                        desc: 'ëª¨ë“  ì§€í‘œë¥¼ ì¢…í•©í•˜ì—¬ ì¡°ì§ë³„ ê±´ê°•ë„ ìˆœìœ„ë¥¼ ë§¤ê¸°ê³  ê°œì„  ìš°ì„ ìˆœìœ„ë¥¼ ì œì‹œí•©ë‹ˆë‹¤.',
                        color: 'gray', 
                        status: 'waiting' 
                    }
                ];

                // ê´€ë ¨ ì ìˆ˜ ê°€ì ¸ì˜¤ê¸°
                const scoreMap = {
                    'capability': null, // ì—­ëŸ‰ ë¶„ì„ì€ ì¢…í•© ì ìˆ˜ë¡œ ëŒ€ì²´
                    'mismatch': null, // ë¶ˆì¼ì¹˜ ê°ì§€ëŠ” Alert ê¸°ë°˜
                    'concentration': null, // ì—­ëŸ‰ ì§‘ì¤‘ë„ëŠ” ë³„ë„ ê³„ì‚° í•„ìš”
                    'efficiency': parseFloat(document.getElementById('salaryEfficiencyScore')?.textContent) || 0,
                    'growth': null, // ì„±ì¥ ì ì¬ë ¥ì€ ì ìˆ˜ í™˜ì‚°í•˜ì§€ ì•ŠìŒ (ë¹„êµë§Œ)
                    'gap': null, // ì—­ëŸ‰ ê²©ì°¨ëŠ” ë³„ë„ ê³„ì‚° í•„ìš”
                    'talent': null, // í•µì‹¬ ì¸ì¬ ë¶„í¬ëŠ” ì ìˆ˜ í™˜ì‚°í•˜ì§€ ì•ŠìŒ (ë¹„êµë§Œ)
                    'experience': parseFloat(document.getElementById('experienceMatchScore')?.textContent) || 0,
                    'comprehensive': parseFloat(document.getElementById('overallHealthScore')?.textContent) || 0
                };
                
                // ë¹„ìœ¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì ìˆ˜ í™˜ì‚°í•˜ì§€ ì•ŠëŠ” í•­ëª©)
                const ratioMap = {
                    'growth': parseFloat(document.getElementById('growthPotentialScore')?.textContent) || 0,
                    'talent': parseFloat(document.getElementById('keyTalentScore')?.textContent) || 0
                };

                const colorClasses = {
                    indigo: 'bg-indigo-100',
                    red: 'bg-red-100',
                    yellow: 'bg-yellow-100',
                    green: 'bg-green-100',
                    purple: 'bg-purple-100',
                    blue: 'bg-blue-100',
                    orange: 'bg-orange-100',
                    teal: 'bg-teal-100',
                    gray: 'bg-gray-100'
                };

                grid.innerHTML = insights.map(insight => {
                    const score = scoreMap[insight.type];
                    const grade = score !== null ? getScoreGrade(score) : null;
                    
                    let statusBadge = '';
                    // ì„±ì¥ ì ì¬ë ¥ê³¼ í•µì‹¬ ì¸ì¬ ë¶„í¬ëŠ” ë°°ì§€ í‘œì‹œ ì•ˆ í•¨
                    if (insight.type === 'growth' || insight.type === 'talent') {
                        statusBadge = '';
                    } else if (score !== null && !isNaN(score)) {
                        statusBadge = `<span class="px-2 py-1 ${grade.bgColor} ${grade.textColor} text-xs font-semibold rounded">${score.toFixed(0)}ì  (${grade.grade})</span>`;
                    } else if (insight.status === 'alert') {
                        statusBadge = `<span class="px-2 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded">Alert</span>`;
                    }

                    return `
                        <div class="insight-card bg-white rounded-xl shadow-sm border border-gray-200 p-6 cursor-pointer hover:shadow-lg transition-all duration-300" 
                             onclick="openInsightModal('${insight.type}')" 
                             style="transform: translateY(0);">
                            <div class="flex items-start justify-between mb-4">
                                <div class="w-12 h-12 ${colorClasses[insight.color]} rounded-lg flex items-center justify-center">
                                    <span class="text-2xl">${insight.icon}</span>
                                </div>
                                ${statusBadge}
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">${insight.title}</h3>
                            <p class="text-sm text-gray-600 mb-4 line-clamp-2">${insight.desc}</p>
                            <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                                <span class="text-xs text-gray-500">í´ë¦­í•˜ì—¬ ìƒì„¸ ë¶„ì„</span>
                                <span class="text-indigo-600 font-medium text-sm">ë³´ê¸° â†’</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Alert ìš”ì•½ ì—…ë°ì´íŠ¸
            function updateAlertSummary() {
                const summary = document.getElementById('alertSummary');
                const alertSection = document.getElementById('alertSummarySection');
                if (!summary || !alertSection) return;

                // ì‹¤ì œ Alert ë°ì´í„°ëŠ” updateAlerts()ì—ì„œ ê°€ì ¸ì˜´
                // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ìš”ì•½ë§Œ í‘œì‹œ
                const alertContainer = document.getElementById('alertContainer');
                if (alertContainer && alertContainer.children.length > 0) {
                    const alertCount = alertContainer.querySelectorAll('.bg-red-50, .bg-yellow-50').length;
                    summary.innerHTML = `
                        <p class="font-semibold text-red-900">ì£¼ìš” Alert: ${alertCount}ê±´</p>
                        <p class="text-sm text-red-700">ìì„¸í•œ ë‚´ìš©ì€ ê° ì¸ì‚¬ì´íŠ¸ ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.</p>
                    `;
                    alertSection.classList.remove('hidden');
                } else {
                    // Alertê°€ ì—†ìœ¼ë©´ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                    alertSection.classList.add('hidden');
                }
            }

            // HR ì¸ì‚¬ì´íŠ¸ ì´ˆê¸°í™”
            function initializeHRInsights() {
                // ì „ì²´ ì—…ë°ì´íŠ¸ ë²„íŠ¼
                document.getElementById('updateAllInsights')?.addEventListener('click', () => {
                    updateOverallHealthScore();
                    updateAlerts();
                    updateAlertSummary();
                    // ëª¨ë“  ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸
                    createInsightCards();
                });

                // ëª¨ë‹¬ ì—…ë°ì´íŠ¸ ë²„íŠ¼
                document.getElementById('updateModalInsight')?.addEventListener('click', () => {
                    if (currentModalInsight) {
                        const segment = document.getElementById('insightSegment')?.value || 'team';
                        updateInsightTab(currentModalInsight);
                    }
                    updateOverallHealthScore();
                    updateAlerts();
                });

                // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        closeInsightModal();
                    }
                });

                // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
                document.getElementById('insightModal')?.addEventListener('click', (e) => {
                    if (e.target.id === 'insightModal') {
                        closeInsightModal();
                    }
                });

                // ëª©í‘œ ë¹„ìœ¨ ìŠ¬ë¼ì´ë” (ëª©í‘œ-ì‹¤ì œ ì—­ëŸ‰ ê´´ë¦¬ ë¶„ì„ ëª¨ë‹¬ ë‚´ë¶€ì—ì„œ ì‚¬ìš©)
                const slider = document.getElementById('targetRatioSlider');
                const sliderValue = document.getElementById('targetRatioValue');
                if (slider && sliderValue) {
                    slider.addEventListener('input', (e) => {
                        const value = e.target.value;
                        sliderValue.textContent = value + '%';
                        document.getElementById('targetTierRatio').value = value;
                        if (currentModalInsight === 'gap') {
                            const segment = document.getElementById('insightSegment')?.value || 'team';
                            analyzeGap(segment, parseFloat(value));
                        }
                    });
                }

                // í•µì‹¬ ì¸ì¬ ë¶„í¬ Tier ë²”ìœ„ ì„ íƒ ë²„íŠ¼
                const t12Button = document.getElementById('talentRangeT12');
                const t13Button = document.getElementById('talentRangeT13');
                if (t12Button && t13Button) {
                    t12Button.addEventListener('click', () => {
                        talentTierRange = 'T12';
                        t12Button.classList.remove('bg-gray-300', 'text-gray-700');
                        t12Button.classList.add('bg-indigo-600', 'text-white');
                        t13Button.classList.remove('bg-indigo-600', 'text-white');
                        t13Button.classList.add('bg-gray-300', 'text-gray-700');
                        if (currentModalInsight === 'talent') {
                            const segment = document.getElementById('insightSegment')?.value || 'team';
                            analyzeTalentDistribution(segment, talentTierRange);
                        }
                    });
                    
                    t13Button.addEventListener('click', () => {
                        talentTierRange = 'T13';
                        t13Button.classList.remove('bg-gray-300', 'text-gray-700');
                        t13Button.classList.add('bg-indigo-600', 'text-white');
                        t12Button.classList.remove('bg-indigo-600', 'text-white');
                        t12Button.classList.add('bg-gray-300', 'text-gray-700');
                        if (currentModalInsight === 'talent') {
                            const segment = document.getElementById('insightSegment')?.value || 'team';
                            analyzeTalentDistribution(segment, talentTierRange);
                        }
                    });
                }

                // ì´ˆê¸° ë¶„ì„ ì‹¤í–‰
                updateOverallHealthScore();
                updateAlerts();
                updateAlertSummary();
                // ì ìˆ˜ ê³„ì‚° í›„ ì¹´ë“œ ìƒì„± (ì ìˆ˜ í‘œì‹œë¥¼ ìœ„í•´)
                createInsightCards();
            }

            // Segmentë³„ ë°ì´í„° ê·¸ë£¹í™”
            function groupEmployeesBySegment(segment) {
                const groups = {};
                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );

                employees.forEach(emp => {
                    // í•µì‹¬ë¦¬ë”íŒ€ ì œì™¸
                    if (emp.team === 'í•µì‹¬ë¦¬ë”íŒ€') {
                        return;
                    }

                    let key = '';
                    if (segment === 'team') {
                        key = emp.team || '-';
                    } else if (segment === 'part') {
                        key = emp.part || '-';
                    } else if (segment === 'position') {
                        key = emp.position || '-';
                    }

                    if (!groups[key]) {
                        groups[key] = [];
                    }
                    groups[key].push(emp);
                });

                return groups;
            }

            // Tier ê°€ì¤‘ì¹˜ ê³„ì‚° (T1=6, T2=5, T3=4, T4=3, T5=2, T6=1)
            function getTierWeight(tier) {
                return 7 - tier; // T1=6, T2=5, ..., T6=1
            }

            // ì—­ëŸ‰ ì ìˆ˜ ê³„ì‚°
            function calculateCapabilityScore(empList) {
                if (empList.length === 0) return 0;
                
                const totalSalary = empList.reduce((sum, emp) => sum + emp.salary, 0);
                const avgSalary = totalSalary / empList.length;
                const avgTierWeight = empList.reduce((sum, emp) => sum + getTierWeight(emp.tier), 0) / empList.length;
                
                return (avgSalary * avgTierWeight) / 1000000; // ë°±ë§Œì› ë‹¨ìœ„ë¡œ ì •ê·œí™”
            }

            // ì •ë ¬ ìƒíƒœ ì €ì¥
            let capabilitySortColumn = 'score';
            let capabilitySortOrder = 'desc';

            // ì •ë ¬ í•¨ìˆ˜
            function sortCapabilityData(data, column, order) {
                const sorted = [...data];
                sorted.sort((a, b) => {
                    let aVal, bVal;
                    switch(column) {
                        case 'rank':
                            // ìˆœìœ„ëŠ” ì—­ëŸ‰ ì ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
                            return order === 'asc' ? a.capabilityScore - b.capabilityScore : b.capabilityScore - a.capabilityScore;
                        case 'segment':
                            aVal = a.segment;
                            bVal = b.segment;
                            if (order === 'asc') {
                                return aVal.localeCompare(bVal, 'ko');
                            } else {
                                return bVal.localeCompare(aVal, 'ko');
                            }
                        case 'salary':
                            aVal = a.avgSalary;
                            bVal = b.avgSalary;
                            break;
                        case 'tier':
                            aVal = a.avgTierWeight;
                            bVal = b.avgTierWeight;
                            break;
                        case 'score':
                            aVal = a.capabilityScore;
                            bVal = b.capabilityScore;
                            break;
                        case 'count':
                            aVal = a.count;
                            bVal = b.count;
                            break;
                        default:
                            return 0;
                    }
                    return order === 'asc' ? aVal - bVal : bVal - aVal;
                });
                return sorted;
            }

            // ì •ë ¬ ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
            function updateSortIndicators(column, order) {
                document.querySelectorAll('[data-sort]').forEach(th => {
                    const indicator = th.querySelector('.sort-indicator');
                    if (th.dataset.sort === column) {
                        th.dataset.order = order;
                        indicator.textContent = order === 'asc' ? 'â†‘' : 'â†“';
                        th.classList.add('bg-indigo-100');
                    } else {
                        th.dataset.order = 'asc';
                        indicator.textContent = 'â†•';
                        th.classList.remove('bg-indigo-100');
                    }
                });
            }

            // í…Œì´ë¸” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateCapabilityTable(data) {
                const tbody = document.getElementById('capabilityTableBody');
                if (tbody) {
                    tbody.innerHTML = data.map((d, idx) => `
                        <tr>
                            <td class="p-2 text-center">
                                <span class="inline-block w-6 h-6 rounded-full ${idx < 3 ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-600'} text-xs font-semibold text-center leading-6">${idx + 1}</span>
                            </td>
                            <td class="p-2">${d.segment}</td>
                            <td class="text-right p-2">${Math.round(d.avgSalary).toLocaleString()}ì›</td>
                            <td class="text-right p-2">${d.avgTierWeight.toFixed(2)}</td>
                            <td class="text-right p-2 font-semibold text-indigo-600">${Math.round(d.capabilityScore)}</td>
                            <td class="text-right p-2">${d.count}ëª…</td>
                        </tr>
                    `).join('');
                }
            }

            // 1. ì—°ë´‰-ëŠ¥ë ¥ ê´´ë¦¬ ë¶„ì„
            function analyzeCapability(segment) {
                const groups = groupEmployeesBySegment(segment);
                const segmentData = [];

                Object.keys(groups).forEach(key => {
                    const empList = groups[key];
                    const avgSalary = empList.reduce((sum, emp) => sum + emp.salary, 0) / empList.length;
                    const avgTierWeight = empList.reduce((sum, emp) => sum + getTierWeight(emp.tier), 0) / empList.length;
                    const capabilityScore = calculateCapabilityScore(empList);
                    
                    // Tier ë¶„í¬ ê³„ì‚°
                    const tierDistribution = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
                    empList.forEach(emp => {
                        if (tierDistribution[emp.tier] !== undefined) {
                            tierDistribution[emp.tier]++;
                        }
                    });

                    segmentData.push({
                        segment: key,
                        avgSalary,
                        avgTierWeight,
                        capabilityScore,
                        count: empList.length,
                        tierDistribution
                    });
                });

                // ì •ë ¬ ì ìš©
                const sortedData = sortCapabilityData(segmentData, capabilitySortColumn, capabilitySortOrder);
                updateSortIndicators(capabilitySortColumn, capabilitySortOrder);

                // ë§‰ëŒ€ ê·¸ë˜í”„
                if (hrCharts.capabilityBar) {
                    hrCharts.capabilityBar.destroy();
                }
                const barCtx = document.getElementById('capabilityBarChart');
                if (barCtx) {
                    hrCharts.capabilityBar = new Chart(barCtx, {
                        type: 'bar',
                        data: {
                            labels: sortedData.map(d => d.segment),
                            datasets: [{
                                label: 'í‰ê·  ì—°ë´‰ (ë§Œì›)',
                                data: sortedData.map(d => Math.round(d.avgSalary / 10000)),
                                backgroundColor: 'rgba(79, 70, 229, 0.6)',
                                borderColor: 'rgba(79, 70, 229, 1)',
                                borderWidth: 1
                            }, {
                                label: 'ì—­ëŸ‰ ì ìˆ˜',
                                data: sortedData.map(d => Math.round(d.capabilityScore)),
                                backgroundColor: 'rgba(16, 185, 129, 0.6)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1,
                                yAxisID: 'y1'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: { display: true, text: 'í‰ê·  ì—°ë´‰ (ë§Œì›)' }
                                },
                                y1: {
                                    type: 'linear',
                                    position: 'right',
                                    beginAtZero: true,
                                    title: { display: true, text: 'ì—­ëŸ‰ ì ìˆ˜' },
                                    grid: { drawOnChartArea: false }
                                }
                            }
                        }
                    });
                }

                // ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                const detailSelect = document.getElementById('capabilityDetailSelect');
                if (detailSelect) {
                    detailSelect.innerHTML = '<option value="">ì „ì²´</option>' + segmentData.map(d => 
                        `<option value="${d.segment}">${d.segment}</option>`
                    ).join('');
                }

                // íŒŒì´ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
                function updateCapabilityPieChart(selectedSegment) {
                    let targetSegment = selectedSegment || (segmentData.length > 0 ? segmentData[0].segment : null);
                    if (!targetSegment) return;
                    
                    const segment = segmentData.find(d => d.segment === targetSegment);
                    if (!segment) return;

                    if (hrCharts.capabilityPie) {
                        hrCharts.capabilityPie.destroy();
                    }
                    const pieCtx = document.getElementById('capabilityPieChart');
                    if (pieCtx) {
                        hrCharts.capabilityPie = new Chart(pieCtx, {
                            type: 'pie',
                            data: {
                                labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6'],
                                datasets: [{
                                    data: [
                                        segment.tierDistribution[1],
                                        segment.tierDistribution[2],
                                        segment.tierDistribution[3],
                                        segment.tierDistribution[4],
                                        segment.tierDistribution[5],
                                        segment.tierDistribution[6]
                                    ],
                                    backgroundColor: [
                                        'rgba(239, 68, 68, 0.8)',
                                        'rgba(245, 101, 101, 0.8)',
                                        'rgba(251, 146, 60, 0.8)',
                                        'rgba(251, 191, 36, 0.8)',
                                        'rgba(34, 197, 94, 0.8)',
                                        'rgba(59, 130, 246, 0.8)'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: `${segment.segment} Tier ë¶„í¬`
                                    }
                                }
                            }
                        });
                    }
                }

                // ì´ˆê¸° íŒŒì´ ì°¨íŠ¸ í‘œì‹œ
                if (sortedData.length > 0) {
                    updateCapabilityPieChart();
                }

                // ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                if (detailSelect) {
                    detailSelect.addEventListener('change', (e) => {
                        updateCapabilityPieChart(e.target.value);
                    });
                }

                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateCapabilityTable(sortedData);

                // ì •ë ¬ í—¤ë” í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                document.querySelectorAll('[data-sort]').forEach(th => {
                    th.addEventListener('click', () => {
                        const column = th.dataset.sort;
                        const currentOrder = th.dataset.order;
                        
                        // ê°™ì€ ì»¬ëŸ¼ í´ë¦­ ì‹œ ì •ë ¬ ìˆœì„œ í† ê¸€
                        if (column === capabilitySortColumn) {
                            capabilitySortOrder = currentOrder === 'asc' ? 'desc' : 'asc';
                        } else {
                            capabilitySortColumn = column;
                            capabilitySortOrder = 'asc';
                        }
                        
                        // ì •ë ¬ ì¬ì ìš©
                        const reSortedData = sortCapabilityData(segmentData, capabilitySortColumn, capabilitySortOrder);
                        updateSortIndicators(capabilitySortColumn, capabilitySortOrder);
                        updateCapabilityTable(reSortedData);
                        
                        // ì°¨íŠ¸ë„ ì—…ë°ì´íŠ¸
                        if (hrCharts.capabilityBar) {
                            hrCharts.capabilityBar.destroy();
                        }
                        const barCtx = document.getElementById('capabilityBarChart');
                        if (barCtx) {
                            hrCharts.capabilityBar = new Chart(barCtx, {
                                type: 'bar',
                                data: {
                                    labels: reSortedData.map(d => d.segment),
                                    datasets: [{
                                        label: 'í‰ê·  ì—°ë´‰ (ë§Œì›)',
                                        data: reSortedData.map(d => Math.round(d.avgSalary / 10000)),
                                        backgroundColor: 'rgba(79, 70, 229, 0.6)',
                                        borderColor: 'rgba(79, 70, 229, 1)',
                                        borderWidth: 1
                                    }, {
                                        label: 'ì—­ëŸ‰ ì ìˆ˜',
                                        data: reSortedData.map(d => Math.round(d.capabilityScore)),
                                        backgroundColor: 'rgba(16, 185, 129, 0.6)',
                                        borderColor: 'rgba(16, 185, 129, 1)',
                                        borderWidth: 1,
                                        yAxisID: 'y1'
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            title: { display: true, text: 'í‰ê·  ì—°ë´‰ (ë§Œì›)' }
                                        },
                                        y1: {
                                            type: 'linear',
                                            position: 'right',
                                            beginAtZero: true,
                                            title: { display: true, text: 'ì—­ëŸ‰ ì ìˆ˜' },
                                            grid: { drawOnChartArea: false }
                                        }
                                    }
                                }
                            });
                        }
                    });
                });

                // Segment ì„ íƒ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì´ë²¤íŠ¸
                const segmentSelect = document.getElementById('capabilitySegmentSelect');
                if (segmentSelect) {
                    segmentSelect.addEventListener('change', (e) => {
                        capabilitySortColumn = 'score';
                        capabilitySortOrder = 'desc';
                        analyzeCapability(e.target.value);
                    });
                }
            }

            // 2. ë¦¬ë” ëŠ¥ë ¥ ì·¨ì•½ë„ ë¶„ì„
            function analyzeMismatch() {
                // í•µì‹¬ë¦¬ë”íŒ€ ì œì™¸
                const filteredEmployees = employees.filter(emp => emp.team !== 'í•µì‹¬ë¦¬ë”íŒ€');

                // ì§ì±…ì í•„í„°ë§ (ë¦¬ë”, íŒŒíŠ¸ì¥, AD, TD ë“±)
                const leaders = filteredEmployees.filter(emp => {
                    if (!emp.position || emp.position === '-') return false;
                    return emp.position.includes('ë¦¬ë”') || emp.position.includes('íŒŒíŠ¸ì¥') || 
                           emp.position.includes('AD') || emp.position.includes('TD') ||
                           emp.position.includes('ì‹¤ì¥') || emp.position.includes('ë””ë ‰í„°');
                });

                // ì§ì±…ì ì¤‘ Tier 4-6ì¸ ì¸ì› ì°¾ê¸° (ë¬¸ì œ ì¸ì›)
                const problemLeaders = leaders.filter(emp => emp.tier >= 4);

                // íŒ€/íŒŒíŠ¸ë³„ë¡œ ë¬¸ì œ ì§ì±…ì ê·¸ë£¹í™”
                const mismatchByGroup = {};
                problemLeaders.forEach(emp => {
                    const groupKey = emp.part && emp.part !== '-' ? emp.part : emp.team || '-';
                    if (!mismatchByGroup[groupKey]) {
                        mismatchByGroup[groupKey] = {
                            name: groupKey,
                            totalLeaders: 0,
                            problemLeaders: [],
                            tier4Count: 0,
                            tier5Count: 0,
                            tier6Count: 0
                        };
                    }
                    mismatchByGroup[groupKey].problemLeaders.push(emp);
                    if (emp.tier === 4) mismatchByGroup[groupKey].tier4Count++;
                    if (emp.tier === 5) mismatchByGroup[groupKey].tier5Count++;
                    if (emp.tier === 6) mismatchByGroup[groupKey].tier6Count++;
                });

                // ê° ê·¸ë£¹ì˜ ì „ì²´ ì§ì±…ì ìˆ˜ ê³„ì‚°
                leaders.forEach(emp => {
                    const groupKey = emp.part && emp.part !== '-' ? emp.part : emp.team || '-';
                    if (mismatchByGroup[groupKey]) {
                        mismatchByGroup[groupKey].totalLeaders++;
                    }
                });

                // ë¬¸ì œ ì‹¬ê°ë„ ìˆœìœ¼ë¡œ ì •ë ¬ (Tier 5-6 ì¸ì› > Tier 4 ì¸ì› > ë¹„ìœ¨)
                const sortedGroups = Object.values(mismatchByGroup)
                    .map(g => ({
                        ...g,
                        severeCount: g.tier5Count + g.tier6Count,
                        problemCount: g.problemLeaders.length,
                        problemRatio: g.totalLeaders > 0 ? (g.problemLeaders.length / g.totalLeaders) * 100 : 0
                    }))
                    .sort((a, b) => {
                        // Tier 5-6 ì¸ì› ìˆ˜ ìš°ì„ 
                        if (b.severeCount !== a.severeCount) return b.severeCount - a.severeCount;
                        // ì „ì²´ ë¬¸ì œ ì¸ì› ìˆ˜
                        if (b.problemCount !== a.problemCount) return b.problemCount - a.problemCount;
                        // ë¬¸ì œ ë¹„ìœ¨
                        return b.problemRatio - a.problemRatio;
                    });

                // ë§‰ëŒ€ ê·¸ë˜í”„ (ë¬¸ì œ ì§ì±…ì ìˆ˜ by íŒ€/íŒŒíŠ¸)
                if (hrCharts.mismatchHeatmap) {
                    hrCharts.mismatchHeatmap.destroy();
                }
                const heatmapCtx = document.getElementById('mismatchHeatmapChart');
                if (heatmapCtx && sortedGroups.length > 0) {
                    hrCharts.mismatchHeatmap = new Chart(heatmapCtx, {
                        type: 'bar',
                        data: {
                            labels: sortedGroups.map(g => g.name),
                            datasets: [
                                {
                                    label: 'Tier 5-6 (ì‹¬ê°)',
                                    data: sortedGroups.map(g => g.tier5Count + g.tier6Count),
                                    backgroundColor: 'rgba(239, 68, 68, 0.8)'
                                },
                                {
                                    label: 'Tier 4 (ì£¼ì˜)',
                                    data: sortedGroups.map(g => g.tier4Count),
                                    backgroundColor: 'rgba(251, 191, 36, 0.8)'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'y',
                            scales: {
                                x: { 
                                    stacked: true,
                                    beginAtZero: true,
                                    title: { display: true, text: 'ë¬¸ì œ ì§ì±…ì ìˆ˜' }
                                },
                                y: { stacked: true }
                            },
                            plugins: {
                                legend: { position: 'top' },
                                title: { display: true, text: 'íŒ€/íŒŒíŠ¸ë³„ ì €Tier ì§ì±…ì ë¶„í¬ (ì‹¬ê°ë„ ìˆœ)' }
                            }
                        }
                    });
                }

                // Alert ë¦¬ìŠ¤íŠ¸
                const alertList = document.getElementById('mismatchAlertList');
                if (alertList) {
                    if (problemLeaders.length === 0) {
                        alertList.innerHTML = '<div class="text-green-600 p-2 bg-green-50 rounded">âœ… ëª¨ë“  ì§ì±…ìì˜ Tierê°€ ì ì • ìˆ˜ì¤€(T1-T3)ì…ë‹ˆë‹¤.</div>';
                    } else {
                        let html = `<div class="mb-3 p-3 bg-gray-100 rounded text-sm">
                            <strong>ğŸ“Š ì „ì²´ í˜„í™©:</strong> ì´ ${leaders.length}ëª…ì˜ ì§ì±…ì ì¤‘ ${problemLeaders.length}ëª…(${((problemLeaders.length/leaders.length)*100).toFixed(1)}%)ì´ Tier 4 ì´í•˜
                        </div>`;
                        
                        sortedGroups.forEach((group, idx) => {
                            const severityClass = group.severeCount > 0 ? 'bg-red-50 border-red-300' : 'bg-yellow-50 border-yellow-300';
                            const severityIcon = group.severeCount > 0 ? 'ğŸš¨' : 'âš ï¸';
                            
                            html += `
                                <div class="mb-3 p-3 rounded border ${severityClass}">
                                    <div class="font-semibold text-gray-800 mb-2">
                                        ${severityIcon} ${idx + 1}ìˆœìœ„: ${group.name} 
                                        <span class="text-sm font-normal">(ë¬¸ì œ ${group.problemCount}ëª… / ì „ì²´ ì§ì±…ì ${group.totalLeaders}ëª…)</span>
                                    </div>
                                    <div class="flex gap-2 mb-2">
                                        ${group.tier6Count > 0 ? `<span class="px-2 py-1 bg-red-200 text-red-800 text-xs rounded">T6: ${group.tier6Count}ëª…</span>` : ''}
                                        ${group.tier5Count > 0 ? `<span class="px-2 py-1 bg-red-200 text-red-800 text-xs rounded">T5: ${group.tier5Count}ëª…</span>` : ''}
                                        ${group.tier4Count > 0 ? `<span class="px-2 py-1 bg-yellow-200 text-yellow-800 text-xs rounded">T4: ${group.tier4Count}ëª…</span>` : ''}
                                    </div>
                                    <div class="text-sm text-gray-600 space-y-1">
                                        ${group.problemLeaders.map(emp => `
                                            <div>â€¢ ${emp.name} (${emp.position}, T${emp.tier})</div>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
                        });
                        
                        alertList.innerHTML = html;
                    }
                }
            }

            // 3. ì—­ëŸ‰ ì§‘ì¤‘ë„ ë¶„ì„
            function analyzeConcentration(segment) {
                const groups = groupEmployeesBySegment(segment);
                const concentrationData = [];

                Object.keys(groups).sort().forEach(key => {
                    const empList = groups[key];
                    const tierCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
                    empList.forEach(emp => {
                        if (tierCounts[emp.tier] !== undefined) {
                            tierCounts[emp.tier]++;
                        }
                    });

                    const t123Ratio = ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / empList.length * 100);
                    const t456Ratio = ((tierCounts[4] + tierCounts[5] + tierCounts[6]) / empList.length * 100);
                    
                    // í‘œì¤€í¸ì°¨ ê³„ì‚° (ì§‘ì¤‘ë„ ì¸¡ì •)
                    const tierValues = Object.values(tierCounts);
                    const mean = tierValues.reduce((a, b) => a + b, 0) / tierValues.length;
                    const variance = tierValues.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / tierValues.length;
                    const stdDev = Math.sqrt(variance);
                    const concentration = stdDev / mean; // ë³€ë™ê³„ìˆ˜

                    concentrationData.push({
                        segment: key,
                        t123Ratio,
                        t456Ratio,
                        concentration,
                        tierDistribution: tierCounts,
                        count: empList.length
                    });
                });

                // ë ˆì´ë” ì°¨íŠ¸
                if (hrCharts.concentrationRadar) {
                    hrCharts.concentrationRadar.destroy();
                }
                const radarCtx = document.getElementById('concentrationRadarChart');
                if (radarCtx && concentrationData.length > 0) {
                    const maxDataPoints = Math.min(5, concentrationData.length);
                    const selectedData = concentrationData.slice(0, maxDataPoints);
                    
                    hrCharts.concentrationRadar = new Chart(radarCtx, {
                        type: 'radar',
                        data: {
                            labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6'],
                            datasets: selectedData.map((d, idx) => ({
                                label: d.segment,
                                data: [
                                    d.tierDistribution[1],
                                    d.tierDistribution[2],
                                    d.tierDistribution[3],
                                    d.tierDistribution[4],
                                    d.tierDistribution[5],
                                    d.tierDistribution[6]
                                ],
                                borderColor: `hsl(${idx * 60}, 70%, 50%)`,
                                backgroundColor: `hsla(${idx * 60}, 70%, 50%, 0.2)`
                            }))
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                r: { beginAtZero: true }
                            }
                        }
                    });
                }

                // Alert ë¦¬ìŠ¤íŠ¸
                const alertList = document.getElementById('concentrationAlertList');
                if (alertList) {
                    const highConcentration = concentrationData.filter(d => d.t123Ratio >= 50);
                    const lowConcentration = concentrationData.filter(d => d.t123Ratio < 15);
                    
                    let alerts = [];
                    if (highConcentration.length > 0) {
                        alerts.push(...highConcentration.map(d => `
                            <div class="text-yellow-600 p-2 bg-yellow-50 rounded border border-yellow-200">
                                âš ï¸ <strong>${d.segment}</strong>: ì—­ëŸ‰ì´ ê³¼ë„í•˜ê²Œ ì§‘ì¤‘ë¨ (T1-T3 ë¹„ìœ¨: ${d.t123Ratio.toFixed(1)}%)
                            </div>
                        `));
                    }
                    if (lowConcentration.length > 0) {
                        alerts.push(...lowConcentration.map(d => `
                            <div class="text-red-600 p-2 bg-red-50 rounded border border-red-200">
                                âš ï¸ <strong>${d.segment}</strong>: ì—­ëŸ‰ ë¶€ì¡± (T1-T3 ë¹„ìœ¨: ${d.t123Ratio.toFixed(1)}%)
                            </div>
                        `));
                    }
                    if (alerts.length === 0) {
                        alerts.push('<div class="text-green-600 p-2 bg-green-50 rounded">âœ… ëª¨ë“  Segmentì˜ ì—­ëŸ‰ ë¶„í¬ê°€ ì ì •í•©ë‹ˆë‹¤.</div>');
                    }
                    alertList.innerHTML = alerts.join('');
                }
            }

            // 4. ì—°ë´‰ íš¨ìœ¨ì„± ë¶„ì„ (Tierê°€ ë‚®ì€ë° ì—°ë´‰ì´ ë†’ì€ ì¸ì› ì°¾ê¸°)
            function analyzeEfficiency(segment) {
                const groups = groupEmployeesBySegment(segment);
                const efficiencyData = [];
                
                // ì „ì²´ í‰ê·  ì—°ë´‰ ê³„ì‚° (ë¹„êµ ê¸°ì¤€)
                const allEmployees = Object.values(groups).flat();
                const overallAvgSalary = allEmployees.reduce((sum, emp) => sum + emp.salary, 0) / allEmployees.length;

                Object.keys(groups).sort().forEach(key => {
                    const empList = groups[key];
                    const avgSalary = empList.reduce((sum, emp) => sum + emp.salary, 0) / empList.length;
                    const avgTierWeight = empList.reduce((sum, emp) => sum + getTierWeight(emp.tier), 0) / empList.length;
                    
                    // Tier 5-6ì¸ë° ì—°ë´‰ì´ ë†’ì€ ì¸ì› ì°¾ê¸° (ìƒì„¸ ì •ë³´ í¬í•¨)
                    const lowTierHighSalary = empList.filter(emp => {
                        return (emp.tier >= 5) && (emp.salary > avgSalary || emp.salary > overallAvgSalary);
                    }).map(emp => {
                        // Segment í‰ê·  ëŒ€ë¹„ ë¹„ìœ¨ ê³„ì‚°
                        const segmentDiff = emp.salary - avgSalary;
                        const segmentPercent = avgSalary > 0 ? (segmentDiff / avgSalary) * 100 : 0;
                        
                        // ì „ì²´ í‰ê·  ëŒ€ë¹„ ë¹„ìœ¨ ê³„ì‚°
                        const overallDiff = emp.salary - overallAvgSalary;
                        const overallPercent = overallAvgSalary > 0 ? (overallDiff / overallAvgSalary) * 100 : 0;
                        
                        // ê´´ë¦¬ë„ ê³„ì‚° (ì—°ë´‰ - í‰ê·  ì—°ë´‰ì˜ ìµœëŒ€ê°’)
                        const gap = Math.max(segmentDiff, overallDiff);
                        const gapPercent = Math.max(segmentPercent, overallPercent);
                        
                        return {
                            ...emp,
                            segmentAvg: avgSalary,
                            overallAvg: overallAvgSalary,
                            segmentDiff,
                            segmentPercent,
                            overallDiff,
                            overallPercent,
                            gap,
                            gapPercent
                        };
                    });

                    efficiencyData.push({
                        segment: key,
                        avgSalary,
                        avgTierWeight,
                        count: empList.length,
                        lowTierHighSalary: lowTierHighSalary,
                        alertCount: lowTierHighSalary.length
                    });
                });

                // ë²„ë¸” ì°¨íŠ¸ (Tier ê°€ì¤‘ì¹˜ vs í‰ê·  ì—°ë´‰)
                if (hrCharts.efficiencyBubble) {
                    hrCharts.efficiencyBubble.destroy();
                }
                const bubbleCtx = document.getElementById('efficiencyBubbleChart');
                if (bubbleCtx) {
                    hrCharts.efficiencyBubble = new Chart(bubbleCtx, {
                        type: 'bubble',
                        data: {
                            datasets: [{
                                label: 'Segmentë³„ ë¶„í¬',
                                data: efficiencyData.map(d => ({
                                    x: d.avgTierWeight,
                                    y: d.avgSalary / 10000,
                                    r: Math.sqrt(d.count) * 3
                                })),
                                backgroundColor: efficiencyData.map(d => 
                                    d.alertCount > 0 ? 'rgba(239, 68, 68, 0.6)' : 
                                    d.avgTierWeight < 3 && d.avgSalary > overallAvgSalary ? 'rgba(251, 191, 36, 0.6)' : 
                                    'rgba(34, 197, 94, 0.6)'
                                )
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    title: { display: true, text: 'í‰ê·  Tier ê°€ì¤‘ì¹˜' }
                                },
                                y: {
                                    title: { display: true, text: 'í‰ê·  ì—°ë´‰ (ë§Œì›)' }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const idx = context.dataIndex;
                                            const d = efficiencyData[idx];
                                            return `${d.segment}: í‰ê·  ì—°ë´‰ ${Math.round(d.avgSalary).toLocaleString()}ì›, Alert ${d.alertCount}ëª…`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }

                // íŒŒíŠ¸ í•„í„° ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                const partFilter = document.getElementById('efficiencyPartFilter');
                if (partFilter) {
                    const parts = [...new Set(efficiencyData.map(d => d.segment))].sort();
                    partFilter.innerHTML = '<option value="">ì „ì²´</option>' + parts.map(part => 
                        `<option value="${part}">${part}</option>`
                    ).join('');
                }

                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                const tbody = document.getElementById('efficiencyTableBody');
                if (tbody) {
                    let tableHTML = '';
                    efficiencyData.forEach(d => {
                        tableHTML += `
                            <tr class="${d.alertCount > 0 ? 'bg-red-50' : ''}">
                                <td class="p-2">${d.segment}</td>
                                <td class="text-right p-2">${Math.round(d.avgSalary).toLocaleString()}ì›</td>
                                <td class="text-right p-2">${d.avgTierWeight.toFixed(2)}</td>
                                <td class="text-right p-2 font-semibold ${d.alertCount > 0 ? 'text-red-600' : 'text-green-600'}">
                                    ${d.alertCount}ëª…
                                </td>
                            </tr>
                        `;
                    });
                    tbody.innerHTML = tableHTML;
                }

                // Alert ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
                function updateEfficiencyAlertList() {
                    const selectedPart = partFilter ? partFilter.value : '';
                    const sortOrder = document.getElementById('efficiencySortOrder')?.value || 'desc';
                    
                    // ëª¨ë“  Alert ì¸ì› ìˆ˜ì§‘
                    let allAlerts = [];
                    efficiencyData.forEach(d => {
                        if (selectedPart && d.segment !== selectedPart) return;
                        d.lowTierHighSalary.forEach(emp => {
                            allAlerts.push({
                                ...emp,
                                segment: d.segment
                            });
                        });
                    });

                    // ê´´ë¦¬ë„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
                    allAlerts.sort((a, b) => {
                        return sortOrder === 'desc' ? b.gapPercent - a.gapPercent : a.gapPercent - b.gapPercent;
                    });

                    // Alert HTML ìƒì„±
                    const alertList = document.getElementById('efficiencyAlertList');
                    if (alertList) {
                        if (allAlerts.length === 0) {
                            alertList.innerHTML = '<div class="text-green-600 p-2 bg-green-50 rounded">âœ… Tier ëŒ€ë¹„ ì—°ë´‰ì´ ì ì •í•œ ì¸ì›ë§Œ ìˆìŠµë‹ˆë‹¤.</div>';
                        } else {
                            // íŒŒíŠ¸ë³„ë¡œ ê·¸ë£¹í™”
                            const alertsByPart = {};
                            allAlerts.forEach(alert => {
                                if (!alertsByPart[alert.segment]) {
                                    alertsByPart[alert.segment] = [];
                                }
                                alertsByPart[alert.segment].push(alert);
                            });

                            let alertHTML = '';
                            Object.keys(alertsByPart).sort().forEach(part => {
                                const partAlerts = alertsByPart[part];
                                alertHTML += `
                                    <div class="p-3 bg-red-50 rounded border border-red-200 mb-3">
                                        <div class="font-semibold text-red-800 mb-2">${part} (${partAlerts.length}ëª…)</div>
                                        <div class="space-y-1">
                                            ${partAlerts.map(emp => {
                                                const tierWeight = getTierWeight(emp.tier);
                                                const segmentPercentText = emp.segmentPercent > 0 ? `íŒŒíŠ¸ í‰ê·  ëŒ€ë¹„ +${emp.segmentPercent.toFixed(1)}%` : '';
                                                const overallPercentText = emp.overallPercent > 0 ? `ì „ì²´ í‰ê·  ëŒ€ë¹„ +${emp.overallPercent.toFixed(1)}%` : '';
                                                const percentTexts = [segmentPercentText, overallPercentText].filter(t => t).join(', ');
                                                
                                                return `
                                                    <div class="text-sm text-red-700 pl-4 mb-1">
                                                        âš ï¸ <strong>${emp.name}</strong> - Tier ${emp.tier} (ê°€ì¤‘ì¹˜ ${tierWeight}) | 
                                                        ì—°ë´‰ ${Math.round(emp.salary).toLocaleString()}ì›
                                                        ${percentTexts ? ` | ${percentTexts}` : ''}
                                                        <span class="text-red-900 font-semibold"> (ê´´ë¦¬ë„: ${emp.gapPercent.toFixed(1)}%)</span>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `;
                            });
                            alertList.innerHTML = alertHTML;
                        }
                    }
                }

                // ì´ˆê¸° Alert ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                updateEfficiencyAlertList();

                // íŒŒíŠ¸ í•„í„° ë³€ê²½ ì´ë²¤íŠ¸
                if (partFilter) {
                    partFilter.addEventListener('change', updateEfficiencyAlertList);
                }

                // ì •ë ¬ ìˆœì„œ ë³€ê²½ ì´ë²¤íŠ¸
                const sortOrderSelect = document.getElementById('efficiencySortOrder');
                if (sortOrderSelect) {
                    sortOrderSelect.addEventListener('change', updateEfficiencyAlertList);
                }
            }

            // 5. ì„±ì¥ ì ì¬ë ¥ ë¶„ì„ (ìˆ˜ì •: ì‹ ê·œ ì¸ì›ì¸ë° Tierê°€ ë†’ì€ ê²½ìš°)
            function analyzeGrowthPotential(segment) {
                const groups = groupEmployeesBySegment(segment);
                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );
                const growthData = [];

                Object.keys(groups).sort().forEach(key => {
                    const empList = groups[key];
                    
                    // ì‹ ê·œ ì¸ì› ì¤‘ Tierê°€ ë†’ì€ ì¸ì› ì°¾ê¸° (T1-T3)
                    const highTierNewEmployees = empList.filter(emp => {
                        const joinDate = new Date(emp.joinDate);
                        const monthsDiff = (baseDate.getFullYear() - joinDate.getFullYear()) * 12 + 
                                         (baseDate.getMonth() - joinDate.getMonth());
                        const isNew = monthsDiff <= 12; // 12ê°œì›” ì´ë‚´
                        return isNew && emp.tier <= 3;
                    });

                    const growthPotential = (highTierNewEmployees.length / empList.length) * 100;

                    // Level ë¶„í¬ ê³„ì‚°
                    const levelDistribution = {L1: 0, L2: 0, L3: 0};
                    empList.forEach(emp => {
                        const joinDate = new Date(emp.joinDate);
                        const monthsDiff = (baseDate.getFullYear() - joinDate.getFullYear()) * 12 + 
                                         (baseDate.getMonth() - joinDate.getMonth());
                        let level = 'L1';
                        if (monthsDiff >= 12) level = 'L3';
                        else if (monthsDiff >= 6) level = 'L2';
                        levelDistribution[level]++;
                    });

                    growthData.push({
                        segment: key,
                        growthPotential,
                        highTierNewCount: highTierNewEmployees.length,
                        totalCount: empList.length,
                        levelDistribution
                    });
                });

                // ìŠ¤íƒ ë°” ì°¨íŠ¸
                if (hrCharts.growthStack) {
                    hrCharts.growthStack.destroy();
                }
                const stackCtx = document.getElementById('growthStackChart');
                if (stackCtx) {
                    hrCharts.growthStack = new Chart(stackCtx, {
                        type: 'bar',
                        data: {
                            labels: growthData.map(d => d.segment),
                            datasets: [
                                {
                                    label: 'L1',
                                    data: growthData.map(d => d.levelDistribution.L1),
                                    backgroundColor: 'rgba(59, 130, 246, 0.8)'
                                },
                                {
                                    label: 'L2',
                                    data: growthData.map(d => d.levelDistribution.L2),
                                    backgroundColor: 'rgba(34, 197, 94, 0.8)'
                                },
                                {
                                    label: 'L3',
                                    data: growthData.map(d => d.levelDistribution.L3),
                                    backgroundColor: 'rgba(251, 191, 36, 0.8)'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { stacked: true },
                                y: { stacked: true }
                            }
                        }
                    });
                }

                // ì„±ì¥ ì ì¬ë ¥ ë¦¬ìŠ¤íŠ¸
                const growthList = document.getElementById('growthPotentialList');
                if (growthList) {
                    const sortedData = [...growthData].sort((a, b) => b.growthPotential - a.growthPotential);
                    growthList.innerHTML = sortedData.slice(0, 5).map(d => `
                        <div class="p-3 bg-blue-50 rounded border border-blue-200">
                            <div class="font-semibold text-blue-800">${d.segment}</div>
                            <div class="text-sm text-blue-600 mt-1">
                                ì„±ì¥ ì ì¬ë ¥: ${d.growthPotential.toFixed(1)}% | 
                                ì‹ ê·œ ê³ Tier ì¸ì›: ${d.highTierNewCount}ëª… / ì „ì²´ ${d.totalCount}ëª…
                            </div>
                        </div>
                    `).join('');
                }
            }

            // 6. ì—­ëŸ‰ ê²©ì°¨ ë¶„ì„
            function analyzeGap(segment, targetRatio) {
                const groups = groupEmployeesBySegment(segment);
                const gapData = [];

                Object.keys(groups).sort().forEach(key => {
                    const empList = groups[key];
                    const tierCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
                    empList.forEach(emp => {
                        if (tierCounts[emp.tier] !== undefined) {
                            tierCounts[emp.tier]++;
                        }
                    });

                    const actualT123Ratio = ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / empList.length * 100);
                    const gap = actualT123Ratio - targetRatio;

                    gapData.push({
                        segment: key,
                        targetRatio,
                        actualT123Ratio,
                        gap,
                        count: empList.length
                    });
                });

                // ë¹„êµ ë§‰ëŒ€ ê·¸ë˜í”„
                if (hrCharts.gapComparison) {
                    hrCharts.gapComparison.destroy();
                }
                const gapCtx = document.getElementById('gapComparisonChart');
                if (gapCtx) {
                    hrCharts.gapComparison = new Chart(gapCtx, {
                        type: 'bar',
                        data: {
                            labels: gapData.map(d => d.segment),
                            datasets: [
                                {
                                    label: 'ëª©í‘œ T1-T3 ë¹„ìœ¨',
                                    data: gapData.map(d => d.targetRatio),
                                    backgroundColor: 'rgba(59, 130, 246, 0.6)',
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'ì‹¤ì œ T1-T3 ë¹„ìœ¨',
                                    data: gapData.map(d => d.actualT123Ratio),
                                    backgroundColor: gapData.map(d => 
                                        d.gap >= 0 ? 'rgba(34, 197, 94, 0.6)' : 'rgba(239, 68, 68, 0.6)'
                                    ),
                                    borderColor: gapData.map(d => 
                                        d.gap >= 0 ? 'rgba(34, 197, 94, 1)' : 'rgba(239, 68, 68, 1)'
                                    ),
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    title: { display: true, text: 'ë¹„ìœ¨ (%)' }
                                }
                            }
                        }
                    });
                }

                // ì œì•ˆ ë¦¬ìŠ¤íŠ¸
                const recommendations = document.getElementById('gapRecommendations');
                if (recommendations) {
                    const negativeGap = gapData.filter(d => d.gap < -5).sort((a, b) => a.gap - b.gap);
                    recommendations.innerHTML = negativeGap.map(d => `
                        <div class="p-3 bg-red-50 rounded border border-red-200">
                            <div class="font-semibold text-red-800">${d.segment}</div>
                            <div class="text-sm text-red-600 mt-1">
                                ëª©í‘œ ëŒ€ë¹„ ${Math.abs(d.gap).toFixed(1)}%p ë¶€ì¡± | 
                                ì—­ëŸ‰ ê°•í™” í”„ë¡œê·¸ë¨ ì¶”ì²œ
                            </div>
                        </div>
                    `).join('');
                }
            }

            // 7. í•µì‹¬ ì¸ì¬ ë¶„í¬ ë¶„ì„
            function analyzeTalentDistribution(segment, tierRange = 'T12') {
                const groups = groupEmployeesBySegment(segment);
                const talentData = [];

                Object.keys(groups).sort().forEach(key => {
                    const empList = groups[key];
                    // T1-T2 ë˜ëŠ” T1-T3 ì„ íƒ
                    const talentCount = tierRange === 'T13' 
                        ? empList.filter(emp => emp.tier <= 3).length
                        : empList.filter(emp => emp.tier <= 2).length;

                    talentData.push({
                        segment: key,
                        talentCount,
                        totalCount: empList.length
                    });
                });

                // í•µì‹¬ ì¸ì¬ ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
                const sortedData = [...talentData].sort((a, b) => b.talentCount - a.talentCount);

                // ë§‰ëŒ€ ê·¸ë˜í”„ (ì ˆëŒ€ ìˆ˜ í‘œì‹œ)
                if (hrCharts.talentTreemap) {
                    hrCharts.talentTreemap.destroy();
                }
                const talentCtx = document.getElementById('talentTreemapChart');
                if (talentCtx) {
                    const rangeLabel = tierRange === 'T13' ? 'T1-T3' : 'T1-T2';
                    hrCharts.talentTreemap = new Chart(talentCtx, {
                        type: 'bar',
                        data: {
                            labels: sortedData.map(d => d.segment),
                            datasets: [{
                                label: `í•µì‹¬ ì¸ì¬ ìˆ˜ (${rangeLabel})`,
                                data: sortedData.map(d => d.talentCount),
                                backgroundColor: sortedData.map((d, idx) => 
                                    idx < 3 ? 'rgba(34, 197, 94, 0.6)' : 
                                    idx < 6 ? 'rgba(251, 191, 36, 0.6)' : 
                                    'rgba(239, 68, 68, 0.6)'
                                )
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'y',
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    title: { display: true, text: `í•µì‹¬ ì¸ì¬ ìˆ˜ (${rangeLabel})` }
                                }
                            }
                        }
                    });
                }

                // ìˆœìœ„ë³„ ë¦¬ìŠ¤íŠ¸
                const recommendations = document.getElementById('talentRecommendations');
                if (recommendations) {
                    const rangeLabel = tierRange === 'T13' ? 'T1-T3' : 'T1-T2';
                    let recs = [];
                    recs.push(`<div class="text-sm font-semibold mb-2">ğŸ“Š í•µì‹¬ ì¸ì¬ ë¶„í¬ ìˆœìœ„ (${rangeLabel} ê¸°ì¤€)</div>`);
                    
                    sortedData.forEach((d, idx) => {
                        const rank = idx + 1;
                        const badgeColor = rank <= 3 ? 'bg-green-100 text-green-800' : 
                                         rank <= 6 ? 'bg-yellow-100 text-yellow-800' : 
                                         'bg-gray-100 text-gray-800';
                        recs.push(`
                            <div class="p-3 bg-white rounded border border-gray-200 mb-2">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${badgeColor} mr-2">${rank}ìœ„</span>
                                        <span class="font-semibold">${d.segment}</span>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-indigo-600">${d.talentCount}ëª…</div>
                                        <div class="text-xs text-gray-500">ì „ì²´ ${d.totalCount}ëª… ì¤‘</div>
                                    </div>
                                </div>
                            </div>
                        `);
                    });
                    
                    recommendations.innerHTML = recs.join('');
                }
            }

            // 8. ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­ë„ ë¶„ì„
            function analyzeExperienceMatch() {
                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );

                // í•µì‹¬ë¦¬ë”íŒ€ ì œì™¸
                const filteredEmployees = employees.filter(emp => emp.team !== 'í•µì‹¬ë¦¬ë”íŒ€');

                // ê²½ë ¥ êµ¬ê°„ë³„ Tier ë§¤íŠ¸ë¦­ìŠ¤ (ë” ìƒì„¸í•œ êµ¬ê°„)
                const experienceTierMatrix = {
                    '0-6ê°œì›”': {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0},
                    '6-12ê°œì›”': {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0},
                    '12-18ê°œì›”': {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0},
                    '18-24ê°œì›”': {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0},
                    '24ê°œì›” ì´ìƒ': {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0}
                };

                filteredEmployees.forEach(emp => {
                    const joinDate = new Date(emp.joinDate);
                    const monthsDiff = (baseDate.getFullYear() - joinDate.getFullYear()) * 12 + 
                                     (baseDate.getMonth() - joinDate.getMonth());
                    
                    let experienceRange = '0-6ê°œì›”';
                    if (monthsDiff >= 24) {
                        experienceRange = '24ê°œì›” ì´ìƒ';
                    } else if (monthsDiff >= 18) {
                        experienceRange = '18-24ê°œì›”';
                    } else if (monthsDiff >= 12) {
                        experienceRange = '12-18ê°œì›”';
                    } else if (monthsDiff >= 6) {
                        experienceRange = '6-12ê°œì›”';
                    }
                    
                    if (experienceTierMatrix[experienceRange] && experienceTierMatrix[experienceRange][emp.tier] !== undefined) {
                        experienceTierMatrix[experienceRange][emp.tier]++;
                    }
                });

                // ê²½ë ¥ì´ ë§ì€ë° Tierê°€ ë‚®ì€ ì¸ì› ì°¾ê¸° (24ê°œì›” ì´ìƒ, Tier 5-6)
                const mismatches = filteredEmployees.filter(emp => {
                    const joinDate = new Date(emp.joinDate);
                    const monthsDiff = (baseDate.getFullYear() - joinDate.getFullYear()) * 12 + 
                                     (baseDate.getMonth() - joinDate.getMonth());
                    return monthsDiff >= 24 && emp.tier >= 5;
                });

                // ê²½ë ¥ êµ¬ê°„ ìˆœì„œ ì •ì˜
                const experienceRanges = ['0-6ê°œì›”', '6-12ê°œì›”', '12-18ê°œì›”', '18-24ê°œì›”', '24ê°œì›” ì´ìƒ'];

                // íˆíŠ¸ë§µ ì°¨íŠ¸
                if (hrCharts.experienceHeatmap) {
                    hrCharts.experienceHeatmap.destroy();
                }
                const expCtx = document.getElementById('experienceHeatmapChart');
                if (expCtx) {
                    hrCharts.experienceHeatmap = new Chart(expCtx, {
                        type: 'bar',
                        data: {
                            labels: experienceRanges,
                            datasets: [1, 2, 3, 4, 5, 6].map(tier => ({
                                label: `T${tier}`,
                                data: experienceRanges.map(range => 
                                    experienceTierMatrix[range][tier] || 0
                                ),
                                backgroundColor: tier <= 3 ? 'rgba(34, 197, 94, 0.6)' : 'rgba(239, 68, 68, 0.6)'
                            }))
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { stacked: true },
                                y: { stacked: true }
                            }
                        }
                    });
                }

                // ìƒì„¸ ë¶„ì„ í…Œì´ë¸”
                const alerts = document.getElementById('experienceAlerts');
                if (alerts) {
                    let analysisHTML = '<div class="text-sm font-semibold mb-3">ğŸ“Š ê²½ë ¥ êµ¬ê°„ë³„ Tier ë¶„í¬ ìƒì„¸ ë¶„ì„</div>';
                    
                    // ê° ê²½ë ¥ êµ¬ê°„ë³„ ë¶„ì„
                    experienceRanges.forEach(range => {
                        const tierData = experienceTierMatrix[range];
                        const total = Object.values(tierData).reduce((sum, val) => sum + val, 0);
                        const t123Count = (tierData[1] || 0) + (tierData[2] || 0) + (tierData[3] || 0);
                        const t456Count = (tierData[4] || 0) + (tierData[5] || 0) + (tierData[6] || 0);
                        const t123Ratio = total > 0 ? ((t123Count / total) * 100).toFixed(1) : 0;
                        
                        analysisHTML += `
                            <div class="p-3 bg-white rounded border border-gray-200 mb-3">
                                <div class="font-semibold text-gray-800 mb-2">${range} (ì´ ${total}ëª…)</div>
                                <div class="grid grid-cols-6 gap-2 text-xs mb-2">
                                    <div>T1: ${tierData[1] || 0}ëª…</div>
                                    <div>T2: ${tierData[2] || 0}ëª…</div>
                                    <div>T3: ${tierData[3] || 0}ëª…</div>
                                    <div>T4: ${tierData[4] || 0}ëª…</div>
                                    <div>T5: ${tierData[5] || 0}ëª…</div>
                                    <div>T6: ${tierData[6] || 0}ëª…</div>
                                </div>
                                <div class="text-sm">
                                    <span class="text-green-600 font-semibold">T1-T3: ${t123Count}ëª… (${t123Ratio}%)</span> | 
                                    <span class="text-red-600">T4-T6: ${t456Count}ëª… (${(100 - parseFloat(t123Ratio)).toFixed(1)}%)</span>
                                </div>
                            </div>
                        `;
                    });

                    // ë¶ˆì¼ì¹˜ ì¸ì› ë¦¬ìŠ¤íŠ¸
                    if (mismatches.length === 0) {
                        analysisHTML += '<div class="text-green-600 p-2 bg-green-50 rounded mt-3">âœ… ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­ì´ ì ì •í•©ë‹ˆë‹¤.</div>';
                    } else {
                        analysisHTML += '<div class="text-sm font-semibold mt-4 mb-2">âš ï¸ ê²½ë ¥ ëŒ€ë¹„ Tierê°€ ë‚®ì€ ì¸ì› (24ê°œì›” ì´ìƒ, Tier 5-6)</div>';
                        mismatches.slice(0, 10).forEach(emp => {
                            const joinDate = new Date(emp.joinDate);
                            const monthsDiff = (baseDate.getFullYear() - joinDate.getFullYear()) * 12 + 
                                             (baseDate.getMonth() - joinDate.getMonth());
                            analysisHTML += `
                                <div class="text-yellow-600 p-2 bg-yellow-50 rounded border border-yellow-200 mb-2">
                                    âš ï¸ <strong>${emp.name}</strong> - ê²½ë ¥ ${monthsDiff}ê°œì›” (Tier ${emp.tier}) | ${emp.team || '-'} / ${emp.part || '-'}
                                </div>
                            `;
                        });
                    }
                    
                    alerts.innerHTML = analysisHTML;
                }
            }

            // 9. ì¢…í•© ë¶„ì„
            function analyzeComprehensive(segment) {
                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );
                
                const groups = groupEmployeesBySegment(segment);
                const comprehensiveData = [];
                
                // ì „ì²´ í‰ê·  ì—°ë´‰ ê³„ì‚° (ë¹„êµ ê¸°ì¤€)
                const allEmployees = Object.values(groups).flat();
                const overallAvgSalary = allEmployees.reduce((sum, emp) => sum + emp.salary, 0) / allEmployees.length;

                Object.keys(groups).sort().forEach(key => {
                    const empList = groups[key];
                    
                    // ê° ì§€í‘œ ê³„ì‚°
                    const tierCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
                    empList.forEach(emp => {
                        if (tierCounts[emp.tier] !== undefined) {
                            tierCounts[emp.tier]++;
                        }
                    });

                    const t123Ratio = ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / empList.length * 100);
                    
                    // ì—°ë´‰ íš¨ìœ¨ì„±: Alert ë¹„ìœ¨ ê¸°ë°˜ ì ìˆ˜ ê³„ì‚°
                    // Tier 5-6ì¸ë° ì „ì²´ í‰ê·  ì—°ë´‰ë³´ë‹¤ ë†’ì€ ì¸ì›
                    const lowTierHighSalaryCount = empList.filter(emp => {
                        return (emp.tier >= 5) && (emp.salary > overallAvgSalary);
                    }).length;
                    const lowTierHighSalaryRatio = (lowTierHighSalaryCount / empList.length) * 100;
                    // Alert ë¹„ìœ¨ì´ ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ: 0% = 100ì , 50% = 0ì  (ì„ í˜• ê°ì†Œ)
                    const efficiencyScore = Math.max(0, Math.min(100, 100 - (lowTierHighSalaryRatio * 2)));
                    
                    // ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­: Alert ë¹„ìœ¨ ê¸°ë°˜ ì ìˆ˜ ê³„ì‚°
                    // 24ê°œì›” ì´ìƒ ê·¼ë¬´í–ˆëŠ”ë° Tier 5-6ì¸ ì¸ì›
                    const experiencedLowTier = empList.filter(emp => {
                        const joinDate = new Date(emp.joinDate);
                        const monthsDiff = (baseDate.getFullYear() - joinDate.getFullYear()) * 12 + 
                                         (baseDate.getMonth() - joinDate.getMonth());
                        return monthsDiff >= 24 && emp.tier >= 5;
                    }).length;
                    const experiencedLowTierRatio = (experiencedLowTier / empList.length) * 100;
                    // Alert ë¹„ìœ¨ì´ ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ: 0% = 100ì , 40% = 0ì  (ì„ í˜• ê°ì†Œ)
                    const experienceMatchScore = Math.max(0, Math.min(100, 100 - (experiencedLowTierRatio * 2.5)));

                    // ì¢…í•© ì ìˆ˜ ê³„ì‚° (ì„±ì¥ ì ì¬ë ¥ê³¼ í•µì‹¬ ì¸ì¬ ë¶„í¬ ì œì™¸)
                    const tierScore = Math.min(100, (t123Ratio / 30) * 100); // 30% ê¸°ì¤€
                    const comprehensiveScore = (
                        tierScore * 0.5 +
                        efficiencyScore * 0.3 +
                        experienceMatchScore * 0.2
                    );

                    comprehensiveData.push({
                        segment: key,
                        comprehensiveScore,
                        tierScore,
                        efficiencyScore,
                        t123Ratio,
                        count: empList.length
                    });
                });

                // ìˆœìœ„ ì°¨íŠ¸
                if (hrCharts.comprehensiveRanking) {
                    hrCharts.comprehensiveRanking.destroy();
                }
                const rankCtx = document.getElementById('comprehensiveRankingChart');
                if (rankCtx) {
                    const sortedData = [...comprehensiveData].sort((a, b) => b.comprehensiveScore - a.comprehensiveScore);
                    hrCharts.comprehensiveRanking = new Chart(rankCtx, {
                        type: 'bar',
                        data: {
                            labels: sortedData.map(d => d.segment),
                            datasets: [{
                                label: 'ì¢…í•© ì ìˆ˜',
                                data: sortedData.map(d => d.comprehensiveScore),
                                backgroundColor: sortedData.map(d => 
                                    d.comprehensiveScore >= 70 ? 'rgba(34, 197, 94, 0.6)' : 
                                    d.comprehensiveScore >= 50 ? 'rgba(251, 191, 36, 0.6)' : 
                                    'rgba(239, 68, 68, 0.6)'
                                )
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'y',
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                }

                // ê°œì„  ìš°ì„ ìˆœìœ„
                const priority = document.getElementById('improvementPriority');
                if (priority) {
                    const sortedData = [...comprehensiveData].sort((a, b) => a.comprehensiveScore - b.comprehensiveScore);
                    priority.innerHTML = sortedData.slice(0, 5).map((d, idx) => `
                        <div class="p-3 bg-gray-50 rounded border mb-2">
                            <div class="font-semibold">${idx + 1}ìˆœìœ„: ${d.segment}</div>
                            <div class="text-sm text-gray-600 mt-1">
                                ì¢…í•© ì ìˆ˜: ${d.comprehensiveScore.toFixed(1)} | 
                                T1-T3 ë¹„ìœ¨: ${d.t123Ratio.toFixed(1)}% | 
                                ì¸ì›: ${d.count}ëª…
                            </div>
                        </div>
                    `).join('');
                }
            }

            // ì¡°ì§ ê±´ê°•ë„ ì¢…í•© ì ìˆ˜ ê³„ì‚°
            function updateOverallHealthScore() {
                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );

                // í•µì‹¬ë¦¬ë”íŒ€ ì œì™¸
                const filteredEmployees = employees.filter(emp => emp.team !== 'í•µì‹¬ë¦¬ë”íŒ€');

                // ì „ì²´ Tier ë¶„í¬
                const tierCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
                filteredEmployees.forEach(emp => {
                    if (tierCounts[emp.tier] !== undefined) {
                        tierCounts[emp.tier]++;
                    }
                });

                const total = filteredEmployees.length;
                const t123Ratio = ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / total * 100);
                const t12Ratio = ((tierCounts[1] + tierCounts[2]) / total * 100);

                // ê° ì§€í‘œ ì ìˆ˜ ê³„ì‚°
                const tierDistributionScore = Math.min(100, (t123Ratio / 30) * 100);

                // ì—°ë´‰ íš¨ìœ¨ì„±: Alert ì¼€ì´ìŠ¤ ë¹„ìœ¨ ê¸°ë°˜ ì ìˆ˜ ê³„ì‚°
                // Tier 5-6ì¸ë° ì „ì²´ í‰ê·  ì—°ë´‰ë³´ë‹¤ ë†’ì€ ì¸ì›
                const overallAvgSalary = filteredEmployees.reduce((sum, emp) => sum + emp.salary, 0) / total;
                const lowTierHighSalaryCount = filteredEmployees.filter(emp => {
                    return (emp.tier >= 5) && (emp.salary > overallAvgSalary);
                }).length;
                const lowTierHighSalaryRatio = (lowTierHighSalaryCount / total) * 100;
                // Alert ë¹„ìœ¨ì´ ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ: 0% = 100ì , 50% = 0ì  (ì„ í˜• ê°ì†Œ)
                // í˜„ì‹¤ì  ê¸°ì¤€: 50% ë¯¸ë§Œì´ë©´ ì–‘í˜¸, 25% ë¯¸ë§Œì´ë©´ ìš°ìˆ˜
                const salaryEfficiencyScore = Math.max(0, Math.min(100, 100 - (lowTierHighSalaryRatio * 2)));

                // ê²½ë ¥-ì—­ëŸ‰ ë§¤ì¹­ë„: Alert ì¼€ì´ìŠ¤ ë¹„ìœ¨ ê¸°ë°˜ ì ìˆ˜ ê³„ì‚°
                // 24ê°œì›” ì´ìƒ ê·¼ë¬´í–ˆëŠ”ë° Tier 5-6ì¸ ì¸ì›
                const experiencedLowTier = filteredEmployees.filter(emp => {
                    const joinDate = new Date(emp.joinDate);
                    const monthsDiff = (baseDate.getFullYear() - joinDate.getFullYear()) * 12 + 
                                     (baseDate.getMonth() - joinDate.getMonth());
                    return monthsDiff >= 24 && emp.tier >= 5;
                }).length;
                const experiencedLowTierRatio = (experiencedLowTier / total) * 100;
                // Alert ë¹„ìœ¨ì´ ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ: 0% = 100ì , 40% = 0ì  (ì„ í˜• ê°ì†Œ)
                // í˜„ì‹¤ì  ê¸°ì¤€: 40% ë¯¸ë§Œì´ë©´ ì–‘í˜¸, 20% ë¯¸ë§Œì´ë©´ ìš°ìˆ˜
                const experienceMatchScore = Math.max(0, Math.min(100, 100 - (experiencedLowTierRatio * 2.5)));

                // ì„±ì¥ ì ì¬ë ¥ 1ìˆœìœ„ ê³„ì‚° (íŒ€/íŒŒíŠ¸ë³„)
                const growthGroups = {};
                filteredEmployees.forEach(emp => {
                    const key = emp.part || emp.team || '-';
                    if (!growthGroups[key]) growthGroups[key] = { total: 0, newHighTier: 0 };
                    growthGroups[key].total++;
                    
                    const joinDate = new Date(emp.joinDate);
                    const monthsDiff = (baseDate.getFullYear() - joinDate.getFullYear()) * 12 + 
                                     (baseDate.getMonth() - joinDate.getMonth());
                    if (monthsDiff <= 12 && emp.tier <= 3) {
                        growthGroups[key].newHighTier++;
                    }
                });
                
                const growthRanking = Object.keys(growthGroups)
                    .map(key => ({
                        name: key,
                        count: growthGroups[key].newHighTier,
                        ratio: (growthGroups[key].newHighTier / growthGroups[key].total) * 100
                    }))
                    .filter(g => g.count > 0)
                    .sort((a, b) => b.count - a.count || b.ratio - a.ratio);
                
                const growthTop1 = growthRanking.length > 0 ? growthRanking[0] : null;

                // í•µì‹¬ ì¸ì¬ ë¶„í¬ 1ìˆœìœ„ ê³„ì‚° (íŒ€/íŒŒíŠ¸ë³„)
                const talentGroups = {};
                filteredEmployees.forEach(emp => {
                    const key = emp.part || emp.team || '-';
                    if (!talentGroups[key]) talentGroups[key] = { total: 0, talent: 0 };
                    talentGroups[key].total++;
                    if (emp.tier <= 2) {
                        talentGroups[key].talent++;
                    }
                });
                
                const talentRanking = Object.keys(talentGroups)
                    .map(key => ({
                        name: key,
                        count: talentGroups[key].talent,
                        ratio: (talentGroups[key].talent / talentGroups[key].total) * 100
                    }))
                    .filter(t => t.count > 0)
                    .sort((a, b) => b.count - a.count || b.ratio - a.ratio);
                
                const talentTop1 = talentRanking.length > 0 ? talentRanking[0] : null;

                // ì¢…í•© ì ìˆ˜ (ì„±ì¥ ì ì¬ë ¥ê³¼ í•µì‹¬ ì¸ì¬ ë¶„í¬ ì œì™¸)
                const overallScore = (
                    tierDistributionScore * 0.5 +
                    salaryEfficiencyScore * 0.3 +
                    experienceMatchScore * 0.2
                );

                // ë“±ê¸‰ë³„ ìŠ¤íƒ€ì¼ ì ìš© í•¨ìˆ˜ (ì ìˆ˜ ê¸°ë°˜)
                function applyScoreStyle(scoreId, gradeId, cardId, score) {
                    const grade = getScoreGrade(score);
                    const scoreEl = document.getElementById(scoreId);
                    const gradeEl = document.getElementById(gradeId);
                    const cardEl = document.getElementById(cardId);
                    
                    if (scoreEl) {
                        scoreEl.textContent = score.toFixed(0);
                        scoreEl.className = `text-2xl font-bold ${grade.textColor}`;
                    }
                    if (gradeEl) {
                        gradeEl.textContent = grade.grade;
                        gradeEl.className = `text-xs font-medium px-2 py-0.5 rounded mt-1 inline-block ${grade.bgColor} ${grade.textColor}`;
                    }
                    if (cardEl) {
                        cardEl.className = `p-4 rounded-xl border-2 transition-all ${grade.bgColor} ${grade.borderColor}`;
                    }
                }

                // ë¹„ìœ¨ í‘œì‹œ í•¨ìˆ˜ (ì ìˆ˜ í™˜ì‚° ì—†ìŒ)
                function applyRatioStyle(scoreId, gradeId, cardId, ratio, label) {
                    const scoreEl = document.getElementById(scoreId);
                    const gradeEl = document.getElementById(gradeId);
                    const cardEl = document.getElementById(cardId);
                    
                    if (scoreEl) {
                        scoreEl.textContent = ratio.toFixed(1);
                        scoreEl.className = `text-2xl font-bold text-gray-700`;
                    }
                    if (gradeEl) {
                        gradeEl.textContent = label || 'ë¹„êµ ì§€í‘œ';
                        gradeEl.className = `text-xs font-medium px-2 py-0.5 rounded mt-1 inline-block bg-gray-100 text-gray-700`;
                    }
                    if (cardEl) {
                        cardEl.className = `p-4 rounded-xl border-2 transition-all bg-gray-50 border-gray-200`;
                    }
                }

                // UI ì—…ë°ì´íŠ¸
                const overallGrade = getScoreGrade(overallScore);
                document.getElementById('overallHealthScore').textContent = overallScore.toFixed(0);
                document.getElementById('overallHealthScore').className = `text-5xl font-bold ${overallGrade.textColor}`;
                const overallGradeEl = document.getElementById('overallHealthGrade');
                if (overallGradeEl) {
                    overallGradeEl.textContent = overallGrade.grade;
                    overallGradeEl.className = `ml-2 px-3 py-1 text-sm font-semibold rounded-full ${overallGrade.bgColor} ${overallGrade.textColor}`;
                }

                // ê°œë³„ ì§€í‘œ ìŠ¤íƒ€ì¼ ì ìš©
                applyScoreStyle('tierDistributionScore', 'tierDistributionGrade', 'tierDistributionCard', tierDistributionScore);
                applyScoreStyle('salaryEfficiencyScore', 'salaryEfficiencyGrade', 'salaryEfficiencyCard', salaryEfficiencyScore);
                applyScoreStyle('experienceMatchScore', 'experienceMatchGrade', 'experienceMatchCard', experienceMatchScore);

                // ì„±ì¥ ì ì¬ë ¥ 1ìˆœìœ„ í‘œì‹œ
                const growthScoreEl = document.getElementById('growthPotentialScore');
                if (growthScoreEl) {
                    growthScoreEl.textContent = growthTop1 ? `${growthTop1.name}` : 'ì—†ìŒ';
                }
                const growthGradeEl = document.getElementById('growthPotentialGrade');
                if (growthGradeEl && growthTop1) {
                    growthGradeEl.textContent = `${growthTop1.count}ëª…`;
                }

                // í•µì‹¬ ì¸ì¬ 1ìˆœìœ„ í‘œì‹œ
                const talentScoreEl = document.getElementById('keyTalentScore');
                if (talentScoreEl) {
                    talentScoreEl.textContent = talentTop1 ? `${talentTop1.name}` : 'ì—†ìŒ';
                }
                const talentGradeEl = document.getElementById('keyTalentGrade');
                if (talentGradeEl && talentTop1) {
                    talentGradeEl.textContent = `${talentTop1.count}ëª…`;
                }

                // ìƒì„¸ ì •ë³´ í‘œì‹œ
                const salaryEfficiencyDetail = document.getElementById('salaryEfficiencyDetail');
                if (salaryEfficiencyDetail) {
                    salaryEfficiencyDetail.textContent = `ë¹„íš¨ìœ¨ ${lowTierHighSalaryCount}ëª… (${lowTierHighSalaryRatio.toFixed(1)}%)`;
                }
                const experienceMatchDetail = document.getElementById('experienceMatchDetail');
                if (experienceMatchDetail) {
                    experienceMatchDetail.textContent = `ë¯¸ìŠ¤ë§¤ì¹˜ ${experiencedLowTier}ëª… (${experiencedLowTierRatio.toFixed(1)}%)`;
                }

                // ê²Œì´ì§€ ì°¨íŠ¸
                if (hrCharts.healthGauge) {
                    hrCharts.healthGauge.destroy();
                }
                const gaugeCtx = document.getElementById('healthGaugeChart');
                if (gaugeCtx) {
                    hrCharts.healthGauge = new Chart(gaugeCtx, {
                        type: 'doughnut',
                        data: {
                            datasets: [{
                                data: [overallScore, 100 - overallScore],
                                backgroundColor: [
                                    overallScore >= 70 ? 'rgba(34, 197, 94, 0.8)' : 
                                    overallScore >= 50 ? 'rgba(251, 191, 36, 0.8)' : 
                                    'rgba(239, 68, 68, 0.8)',
                                    'rgba(229, 231, 235, 0.3)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '75%',
                            plugins: {
                                legend: { display: false },
                                tooltip: { enabled: false }
                            }
                        },
                        plugins: [{
                            id: 'centerText',
                            beforeDraw: function(chart) {
                                const ctx = chart.ctx;
                                const centerX = chart.chartArea.left + (chart.chartArea.right - chart.chartArea.left) / 2;
                                const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2;
                                ctx.save();
                                ctx.font = 'bold 24px Inter';
                                ctx.fillStyle = overallScore >= 70 ? '#22c55e' : overallScore >= 50 ? '#fbbf24' : '#ef4444';
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
                                ctx.fillText(overallScore.toFixed(0), centerX, centerY);
                                ctx.restore();
                            }
                        }]
                    });
                }
            }

            // Alert ì—…ë°ì´íŠ¸
            function updateAlerts() {
                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );

                // í•µì‹¬ë¦¬ë”íŒ€ ì œì™¸
                const filteredEmployees = employees.filter(emp => emp.team !== 'í•µì‹¬ë¦¬ë”íŒ€');

                const alerts = [];

                // 1. ë¦¬ë”ì¸ë° Tierê°€ ë‚®ì€ ê²½ìš°
                const lowTierLeaders = filteredEmployees.filter(emp => {
                    const isLeader = emp.position && (emp.position.includes('ë¦¬ë”') || emp.position.includes('íŒŒíŠ¸ì¥') || emp.position.includes('AD') || emp.position.includes('TD'));
                    return isLeader && emp.tier >= 5;
                });
                if (lowTierLeaders.length > 0) {
                    alerts.push({
                        level: 'critical',
                        message: `âš ï¸ ë¦¬ë”/íŒŒíŠ¸ì¥ì¸ë° Tierê°€ ë‚®ì€ ì¸ì›: ${lowTierLeaders.length}ëª…`,
                        details: lowTierLeaders.slice(0, 3).map(emp => `${emp.name} (${emp.position}, T${emp.tier})`).join(', ')
                    });
                }

                // 2. ì—­ëŸ‰ ì§‘ì¤‘ë„ ê³¼ë‹¤
                const groups = groupEmployeesBySegment('part');
                Object.keys(groups).forEach(key => {
                    const empList = groups[key];
                    const tierCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
                    empList.forEach(emp => {
                        if (tierCounts[emp.tier] !== undefined) {
                            tierCounts[emp.tier]++;
                        }
                    });
                    const t123Ratio = ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / empList.length * 100);
                    if (t123Ratio >= 50) {
                        alerts.push({
                            level: 'warning',
                            message: `âš ï¸ ${key} íŒŒíŠ¸: ì—­ëŸ‰ì´ ê³¼ë„í•˜ê²Œ ì§‘ì¤‘ë¨ (T1-T3 ë¹„ìœ¨: ${t123Ratio.toFixed(1)}%)`
                        });
                    }
                });

                // 3. ì—­ëŸ‰ ë¶€ì¡± íŒŒíŠ¸
                Object.keys(groups).forEach(key => {
                    const empList = groups[key];
                    const tierCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
                    empList.forEach(emp => {
                        if (tierCounts[emp.tier] !== undefined) {
                            tierCounts[emp.tier]++;
                        }
                    });
                    const t123Ratio = ((tierCounts[1] + tierCounts[2] + tierCounts[3]) / empList.length * 100);
                    if (t123Ratio < 15 && empList.length >= 5) {
                        alerts.push({
                            level: 'warning',
                            message: `âš ï¸ ${key} íŒŒíŠ¸: ì—­ëŸ‰ ë¶€ì¡± (T1-T3 ë¹„ìœ¨: ${t123Ratio.toFixed(1)}%)`
                        });
                    }
                });

                // Alert ì»¨í…Œì´ë„ˆ ì—…ë°ì´íŠ¸
                const alertContainer = document.getElementById('alertContainer');
                if (alertContainer) {
                    if (alerts.length === 0) {
                        alertContainer.innerHTML = '<div class="p-3 bg-green-50 rounded border border-green-200 text-green-700">âœ… ì£¼ìš” Alert ì—†ìŒ</div>';
                    } else {
                        alertContainer.innerHTML = alerts.map(alert => {
                            const bgColor = alert.level === 'critical' ? 'bg-red-50 border-red-200 text-red-700' : 
                                          alert.level === 'warning' ? 'bg-yellow-50 border-yellow-200 text-yellow-700' : 
                                          'bg-blue-50 border-blue-200 text-blue-700';
                            return `
                                <div class="p-3 rounded border ${bgColor}">
                                    <div class="font-semibold">${alert.message}</div>
                                    ${alert.details ? `<div class="text-sm mt-1">${alert.details}</div>` : ''}
                                </div>
                            `;
                        }).join('');
                    }
                }

                // Alert ìš”ì•½ ì—…ë°ì´íŠ¸
                const alertSummary = document.getElementById('alertSummary');
                const alertSection = document.getElementById('alertSummarySection');
                if (alertSummary && alertSection) {
                    if (alerts.length === 0) {
                        // Alertê°€ ì—†ìœ¼ë©´ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                        alertSection.classList.add('hidden');
                    } else {
                        const criticalCount = alerts.filter(a => a.level === 'critical').length;
                        const warningCount = alerts.filter(a => a.level === 'warning').length;
                        alertSummary.innerHTML = `
                            <p class="font-semibold text-red-900">ì£¼ìš” Alert: ${alerts.length}ê±´</p>
                            <p class="text-sm text-red-700">Critical: ${criticalCount}ê±´, Warning: ${warningCount}ê±´ | ìì„¸í•œ ë‚´ìš©ì€ ê° ì¸ì‚¬ì´íŠ¸ ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.</p>
                        `;
                        alertSection.classList.remove('hidden');
                    }
                }
            }

            // ####################
            // ì¸ì„¼í‹°ë¸Œ í™•ì • ë° CSV ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥
            // ####################

            // ì¸ì„¼í‹°ë¸Œ í™•ì • í•¨ìˆ˜ (ë°ì´í„°ë§Œ í™•ì •, CSVëŠ” ë‚´ë³´ë‚´ì§€ ì•ŠìŒ)
            function lockIncentivesData() {
                // í˜„ì¬ í•„í„°ë§ëœ ì§ì›ë“¤ì˜ ì¸ì„¼í‹°ë¸Œ ì •ë³´ë¥¼ ì €ì¥
                lockedIncentives = [];
                
                // Step 2 ê³„ì‚° ê²°ê³¼ í™•ì¸
                if (!calculatedIncentiveValues || !calculatedBonusValues) {
                    alert('âš ï¸ ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ì„ ê³„ì‚°í•˜ê¸° ì „ì— Step 2ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                    return false;
                }
                
                // ì§ì› ë°ì´í„° í™•ì¸
                if (!employees || employees.length === 0) {
                    alert('âš ï¸ ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì§ì› ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
                    return false;
                }
                
                const baseYear = document.getElementById('baseYear');
                const baseMonth = document.getElementById('baseMonth');
                const baseDay = document.getElementById('baseDay');
                
                // ë‚ ì§œ ì…ë ¥ ìš”ì†Œ í™•ì¸
                if (!baseYear || !baseMonth || !baseDay) {
                    alert('âš ï¸ ê¸°ì¤€ì¼ ì„¤ì •ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return false;
                }
                
                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );
                
                // ìœ íš¨í•œ ë‚ ì§œì¸ì§€ í™•ì¸
                if (isNaN(baseDate.getTime())) {
                    alert('âš ï¸ ê¸°ì¤€ì¼ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return false;
                }

                employees.forEach(emp => {
                    const joinDate = new Date(emp.joinDate);
                    // ì§ì› ê°ì²´ì— level ì†ì„±ì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©, ì—†ìœ¼ë©´ ê³„ì‚°
                    const level = emp.level || calculateLevel(joinDate, baseDate);
                    
                    // Step 2ì—ì„œ ê³„ì‚°ëœ Tier/Levelë³„ ì¸ì„¼í‹°ë¸Œì™€ ë³´ë„ˆìŠ¤ ê°’ ê°€ì ¸ì˜¤ê¸°
                    const tierKey = 't' + emp.tier;
                    const levelKey = level.toLowerCase();
                    
                    const incentive = calculatedIncentiveValues[tierKey]?.[levelKey] || 0;
                    const bonus = calculatedBonusValues[tierKey]?.[levelKey] || 0;
                    const bonusPayment1 = bonus * (2/3); // 1ì°¨ 66.67%
                    const bonusPayment2 = bonus * (1/3); // 2ì°¨ 33.33%
                    const monthlySalary = emp.salary / 12;
                    const ratio = monthlySalary > 0 ? incentive / monthlySalary : 0;
                    const bonusRatio = monthlySalary > 0 ? bonus / monthlySalary : 0;
                    const bonusPayment1Ratio = monthlySalary > 0 ? bonusPayment1 / monthlySalary : 0;
                    const bonusPayment2Ratio = monthlySalary > 0 ? bonusPayment2 / monthlySalary : 0;

                    lockedIncentives.push({
                        id: emp.id,
                        name: emp.name,
                        tier: emp.tier,
                        level: level,
                        team: emp.team || '-',
                        part: emp.part || '-',
                        position: emp.position || '-',
                        detailRole: emp.detailRole || '-',
                        joinDate: emp.joinDate,
                        salary: emp.salary,
                        monthlySalary: Math.round(monthlySalary),
                        incentive: Math.round(incentive),
                        incentiveRatio: ratio.toFixed(2),
                        launchBonusTotal: Math.round(bonus),
                        launchBonusRatio: bonusRatio.toFixed(2),
                        launchBonusPayment1: Math.round(bonusPayment1),
                        launchBonusPayment1Ratio: bonusPayment1Ratio.toFixed(2),
                        launchBonusPayment2: Math.round(bonusPayment2),
                        launchBonusPayment2Ratio: bonusPayment2Ratio.toFixed(2)
                    });
                });

                if (lockedIncentives.length === 0) {
                    alert('âš ï¸ ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì§ì› ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
                    return false;
                }

                // í™•ì • ìƒíƒœ ì—…ë°ì´íŠ¸
                isIncentivesLocked = true;
                document.getElementById('lockStatus').classList.remove('hidden');
                document.getElementById('exportLaunchBonusCSV').disabled = false;
                document.getElementById('csvExportOptions').classList.remove('hidden');
                
                return true;
            }

            // CSV ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜ (ì„ íƒëœ ì˜µì…˜ì— ë”°ë¼ CSV ë‚´ë³´ë‚´ê¸°)
            function exportIncentivesToCSV() {
                if (!isIncentivesLocked || lockedIncentives.length === 0) {
                    alert('âš ï¸ ì¸ì„¼í‹°ë¸Œë¥¼ ë¨¼ì € í™•ì •í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ì„ íƒëœ CSV ë‚´ë³´ë‚¼ í•„ë“œ í™•ì¸
                const exportFields = {
                    id: document.getElementById('csv_export_id')?.checked || false,
                    name: document.getElementById('csv_export_name')?.checked || false,
                    tier: document.getElementById('csv_export_tier')?.checked || false,
                    level: document.getElementById('csv_export_level')?.checked || false,
                    team: document.getElementById('csv_export_team')?.checked || false,
                    part: document.getElementById('csv_export_part')?.checked || false,
                    position: document.getElementById('csv_export_position')?.checked || false,
                    detailRole: document.getElementById('csv_export_detailRole')?.checked || false,
                    joinDate: document.getElementById('csv_export_joinDate')?.checked || false,
                    salary: document.getElementById('csv_export_salary')?.checked || false,
                    monthlySalary: document.getElementById('csv_export_monthlySalary')?.checked || false,
                    incentive: document.getElementById('csv_export_incentive')?.checked || false,
                    incentiveRatio: document.getElementById('csv_export_incentiveRatio')?.checked || false,
                    launchBonusTotal: document.getElementById('csv_export_launchBonusTotal')?.checked || false,
                    launchBonusRatio: document.getElementById('csv_export_launchBonusRatio')?.checked || false,
                    launchBonusPayment1: document.getElementById('csv_export_launchBonusPayment1')?.checked || false,
                    launchBonusPayment1Ratio: document.getElementById('csv_export_launchBonusPayment1Ratio')?.checked || false,
                    launchBonusPayment2: document.getElementById('csv_export_launchBonusPayment2')?.checked || false,
                    launchBonusPayment2Ratio: document.getElementById('csv_export_launchBonusPayment2Ratio')?.checked || false
                };

                // ìµœì†Œ í•˜ë‚˜ ì´ìƒ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
                const hasAnySelected = Object.values(exportFields).some(v => v);
                if (!hasAnySelected) {
                    alert('âš ï¸ ë‚´ë³´ë‚¼ ë°ì´í„°ë¥¼ ìµœì†Œ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                // CSV í—¤ë” ìƒì„± (ì„ íƒëœ í•„ë“œë§Œ)
                const headers = [];
                const fieldOrder = [
                    { key: 'id', label: 'ì‚¬ë²ˆ' },
                    { key: 'name', label: 'ì´ë¦„' },
                    { key: 'tier', label: 'Tier' },
                    { key: 'level', label: 'Level' },
                    { key: 'team', label: 'íŒ€' },
                    { key: 'part', label: 'íŒŒíŠ¸' },
                    { key: 'position', label: 'ì§ì±…' },
                    { key: 'detailRole', label: 'ìƒì„¸ì§êµ°' },
                    { key: 'joinDate', label: 'í”„ë¡œì íŠ¸ í•©ë¥˜ì¼' },
                    { key: 'salary', label: 'ì—°ë´‰' },
                    { key: 'monthlySalary', label: 'ì›”ê¸‰' },
                    { key: 'incentive', label: 'ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ' },
                    { key: 'incentiveRatio', label: 'ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨' },
                    { key: 'launchBonusTotal', label: 'ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ì´ì•¡' },
                    { key: 'launchBonusRatio', label: 'ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¹„ìœ¨' },
                    { key: 'launchBonusPayment1', label: 'ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 1ì°¨ ì§€ê¸‰' },
                    { key: 'launchBonusPayment1Ratio', label: 'ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 1ì°¨ ì§€ê¸‰ ë¹„ìœ¨' },
                    { key: 'launchBonusPayment2', label: 'ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 2ì°¨ ì§€ê¸‰' },
                    { key: 'launchBonusPayment2Ratio', label: 'ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 2ì°¨ ì§€ê¸‰ ë¹„ìœ¨' }
                ];

                fieldOrder.forEach(field => {
                    if (exportFields[field.key]) {
                        headers.push(field.label);
                    }
                });
                
                // CSV ë°ì´í„° ìƒì„±
                const csvRows = [headers.join(',')];
                
                lockedIncentives.forEach(emp => {
                    const row = [];
                    fieldOrder.forEach(field => {
                        if (exportFields[field.key]) {
                            let value = emp[field.key];
                            if (field.key === 'tier') {
                                value = `T${value}`;
                            }
                            // ìˆ«ì í•„ë“œëŠ” ê·¸ëŒ€ë¡œ, ì—†ì´, ë¬¸ìì—´ í•„ë“œëŠ” ë”°ì˜´í‘œë¡œ ê°ì‹¸ê¸°
                            if (typeof value === 'string') {
                                row.push(`"${value}"`);
                            } else if (typeof value === 'number') {
                                row.push(value);
                            } else {
                                row.push(`"${value}"`);
                            }
                        }
                    });
                    csvRows.push(row.join(','));
                });

                // CSV íŒŒì¼ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
                const csvContent = '\uFEFF' + csvRows.join('\n'); // BOM ì¶”ê°€ (Excel í•œê¸€ í˜¸í™˜)
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                const today = new Date();
                const dateStr = `${today.getFullYear()}${String(today.getMonth() + 1).padStart(2, '0')}${String(today.getDate()).padStart(2, '0')}`;
                
                link.setAttribute('href', url);
                link.setAttribute('download', `ëŸ°ì¹­ë³´ë„ˆìŠ¤_í™•ì •_${dateStr}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url); // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
                
                alert(`âœ… CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ ${lockedIncentives.length}ëª…ì˜ ë°ì´í„°ê°€ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }

            // ì¸ì„¼í‹°ë¸Œ í™•ì • ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('lockIncentives').addEventListener('click', function() {
                if (confirm('í˜„ì¬ ê³„ì‚°ëœ ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ì„ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\ní™•ì • í›„ CSV ë‚´ë³´ë‚´ê¸° ì˜µì…˜ì„ ì„ íƒí•˜ì—¬ ë‚´ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                    if (lockIncentivesData()) {
                        alert(`âœ… ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ ${lockedIncentives.length}ëª…ì˜ ë°ì´í„°ê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\nì•„ë˜ ì˜µì…˜ì„ ì„ íƒí•œ í›„ CSV ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.`);
                    }
                }
            });

            // CSV ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('exportLaunchBonusCSV').addEventListener('click', function() {
                exportIncentivesToCSV();
            });

            // ####################
            // ë°ì´í„° ê²€ì¦ íƒ­ ê¸°ëŠ¥
            // ####################

            // ê²€ì¦ì— í•„ìš”í•œ ê¸€ë¡œë²Œ ë³€ìˆ˜
            let verificationData = {
                expectedTotal: 0,
                actualTotal: 0,
                masterBase: 0,
                tierMultipliers: {},
                levelWeights: {},
                lockedData: []
            };

            // ë°ì´í„° ê²€ì¦ íƒ­ ì´ˆê¸°í™”
            function initializeVerificationTab() {
                // í™•ì •ëœ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
                if (!isIncentivesLocked || lockedIncentives.length === 0) {
                    // íŒì—… ëª¨ë‹¬ í‘œì‹œ
                    document.getElementById('noDataModal').classList.remove('hidden');
                    document.getElementById('noDataMessage').classList.remove('hidden');
                    document.getElementById('verificationTableContainer').classList.add('hidden');
                    document.getElementById('verificationStatus').textContent = 'ë¯¸ê²€ì¦';
                    document.getElementById('verificationStatus').className = 'px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-600';
                    return;
                }
                
                // ë°ì´í„°ê°€ ìˆìœ¼ë©´ íŒì—… ìˆ¨ê¸°ê¸°
                document.getElementById('noDataModal').classList.add('hidden');

                document.getElementById('noDataMessage').classList.add('hidden');
                document.getElementById('verificationTableContainer').classList.remove('hidden');

                // Level ë°°ìˆ˜ í‘œì‹œ
                const w1 = parseFloat(document.getElementById('w1')?.value) || 0.2;
                const w2 = parseFloat(document.getElementById('w2')?.value) || 0.6;
                const w3 = parseFloat(document.getElementById('w3')?.value) || 1.0;
                
                document.getElementById('verify_weight_l1').textContent = w1.toFixed(1);
                document.getElementById('verify_weight_l2').textContent = w2.toFixed(1);
                document.getElementById('verify_weight_l3').textContent = w3.toFixed(1);

                verificationData.levelWeights = { l1: w1, l2: w2, l3: w3 };

                // Tier ê°„ ì¦ê°€ìœ¨(%) ê°€ì ¸ì˜¤ê¸° ë° í‘œì‹œ
                const lb_t6_t5_rate = parseFloat(document.getElementById('lb_t6_t5_rate')?.value) || 300;
                const lb_t5_t4_rate = parseFloat(document.getElementById('lb_t5_t4_rate')?.value) || 50;
                const lb_t4_t3_rate = parseFloat(document.getElementById('lb_t4_t3_rate')?.value) || 40;
                const lb_t3_t2_rate = parseFloat(document.getElementById('lb_t3_t2_rate')?.value) || 30;
                const lb_t2_t1_rate = parseFloat(document.getElementById('lb_t2_t1_rate')?.value) || 20;

                // Tier ê°„ ì¦ê°€ìœ¨ì„ %ë¡œ í‘œì‹œ
                document.getElementById('verify_rate_t6_t5').textContent = '+' + lb_t6_t5_rate + '%';
                document.getElementById('verify_rate_t5_t4').textContent = '+' + lb_t5_t4_rate + '%';
                document.getElementById('verify_rate_t4_t3').textContent = '+' + lb_t4_t3_rate + '%';
                document.getElementById('verify_rate_t3_t2').textContent = '+' + lb_t3_t2_rate + '%';
                document.getElementById('verify_rate_t2_t1').textContent = '+' + lb_t2_t1_rate + '%';

                // ì €ì¥í•  Tier ê°„ ì¦ê°€ìœ¨
                verificationData.tierRates = {
                    t6_t5: lb_t6_t5_rate,
                    t5_t4: lb_t5_t4_rate,
                    t4_t3: lb_t4_t3_rate,
                    t3_t2: lb_t3_t2_rate,
                    t2_t1: lb_t2_t1_rate
                };

                // Tier ë°°ìˆ˜ ê³„ì‚° (ë‚´ë¶€ ê²€ì¦ìš©)
                const tierMultipliers = {
                    t6: 1.0,
                    t5: 1.0 * (1 + lb_t6_t5_rate / 100),
                    t4: 1.0 * (1 + lb_t6_t5_rate / 100) * (1 + lb_t5_t4_rate / 100),
                    t3: 1.0 * (1 + lb_t6_t5_rate / 100) * (1 + lb_t5_t4_rate / 100) * (1 + lb_t4_t3_rate / 100),
                    t2: 1.0 * (1 + lb_t6_t5_rate / 100) * (1 + lb_t5_t4_rate / 100) * (1 + lb_t4_t3_rate / 100) * (1 + lb_t3_t2_rate / 100),
                    t1: 1.0 * (1 + lb_t6_t5_rate / 100) * (1 + lb_t5_t4_rate / 100) * (1 + lb_t4_t3_rate / 100) * (1 + lb_t3_t2_rate / 100) * (1 + lb_t2_t1_rate / 100)
                };

                verificationData.tierMultipliers = tierMultipliers;

                // í™•ì • ì´ì•¡ í‘œì‹œ
                const actualTotal = lockedIncentives.reduce((sum, emp) => sum + emp.launchBonusTotal, 0);
                verificationData.actualTotal = actualTotal;

                document.getElementById('verify_total_bonus').textContent = actualTotal.toLocaleString('ko-KR') + 'ì›';
                document.getElementById('verify_total_count').textContent = lockedIncentives.length + 'ëª…';

                // ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡ (ì—­ì‚°) - ê°€ì¥ ë‚®ì€ Tier/Level ê¸°ì¤€
                // ê°€ì¥ ë†’ì€ Tier ë²ˆí˜¸(ë‚®ì€ ë“±ê¸‰), ê°€ì¥ ë‚®ì€ Level ì°¾ê¸°
                const sortedByLowest = [...lockedIncentives].sort((a, b) => {
                    // Tierê°€ ë†’ì„ìˆ˜ë¡(ë²ˆí˜¸ê°€ í´ìˆ˜ë¡) ë‚®ì€ ë“±ê¸‰
                    if (b.tier !== a.tier) return b.tier - a.tier;
                    // Levelì´ ë‚®ì„ìˆ˜ë¡(L1 < L2 < L3) ë‚®ì€ ê¸‰ì—¬
                    const levelOrder = { 'L1': 1, 'L2': 2, 'L3': 3 };
                    return (levelOrder[a.level] || 0) - (levelOrder[b.level] || 0);
                });

                if (sortedByLowest.length > 0) {
                    const lowestEmployee = sortedByLowest[0];
                    const tierKey = 't' + lowestEmployee.tier;
                    const levelKey = lowestEmployee.level.toLowerCase();
                    const tierMult = tierMultipliers[tierKey] || 1;
                    const levelMult = verificationData.levelWeights[levelKey] || 1;
                    const masterBase = lowestEmployee.launchBonusTotal / (tierMult * levelMult);
                    verificationData.masterBase = masterBase;
                    verificationData.baseEmployee = lowestEmployee;
                    document.getElementById('verify_master_base').textContent = 
                        Math.round(masterBase).toLocaleString('ko-KR') + 'ì› (T' + lowestEmployee.tier + '-' + lowestEmployee.level + ' ê¸°ì¤€)';
                } else {
                    document.getElementById('verify_master_base').textContent = 'ê³„ì‚° ë¶ˆê°€';
                }

                // ë°ì´í„° í…Œì´ë¸” ë Œë”ë§
                renderVerificationTable();
            }

            // íŒì—… ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
            function closeNoDataModal() {
                document.getElementById('noDataModal').classList.add('hidden');
            }

            // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (HTMLì—ì„œ onclickìœ¼ë¡œ í˜¸ì¶œí•˜ê¸° ìœ„í•´)
            window.closeNoDataModal = closeNoDataModal;

            // ê²€ì¦ í…Œì´ë¸” ë Œë”ë§
            function renderVerificationTable() {
                const tbody = document.getElementById('verificationTableBody');
                tbody.innerHTML = '';

                // Tier, Level ìˆœìœ¼ë¡œ ì •ë ¬
                const sortedData = [...lockedIncentives].sort((a, b) => {
                    if (a.tier !== b.tier) return a.tier - b.tier;
                    const levelOrder = { 'L1': 1, 'L2': 2, 'L3': 3 };
                    return (levelOrder[a.level] || 0) - (levelOrder[b.level] || 0);
                });

                sortedData.forEach((emp, index) => {
                    const tr = document.createElement('tr');
                    tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                    
                    tr.innerHTML = `
                        <td class="text-center py-2 px-3">${index + 1}</td>
                        <td class="text-center py-2 px-3">${emp.id}</td>
                        <td class="text-center py-2 px-3">${emp.name}</td>
                        <td class="text-center py-2 px-3 font-semibold">T${emp.tier}</td>
                        <td class="text-center py-2 px-3">${emp.level}</td>
                        <td class="text-right py-2 px-3 font-semibold">${emp.launchBonusTotal.toLocaleString('ko-KR')}ì›</td>
                        <td class="text-right py-2 px-3">${emp.launchBonusPayment1.toLocaleString('ko-KR')}ì›</td>
                        <td class="text-right py-2 px-3">${emp.launchBonusPayment2.toLocaleString('ko-KR')}ì›</td>
                        <td class="text-center py-2 px-3"><span class="px-2 py-1 rounded text-xs bg-gray-100 text-gray-600">ëŒ€ê¸°</span></td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            // ì „ì²´ ê²€ì¦ ì‹¤í–‰
            function runVerification() {
                if (!isIncentivesLocked || lockedIncentives.length === 0) {
                    alert('âš ï¸ í™•ì •ëœ ì¸ì„¼í‹°ë¸Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const { tierMultipliers, levelWeights, masterBase, actualTotal } = verificationData;
                
                // 1. ì´ì•¡ ê²€ì¦
                let expectedTotal = 0;
                let passCount = 0;
                let failCount = 0;

                const tbody = document.getElementById('verificationTableBody');
                const rows = tbody.querySelectorAll('tr');

                // Tier, Level ìˆœìœ¼ë¡œ ì •ë ¬ëœ ë°ì´í„°
                const sortedData = [...lockedIncentives].sort((a, b) => {
                    if (a.tier !== b.tier) return a.tier - b.tier;
                    const levelOrder = { 'L1': 1, 'L2': 2, 'L3': 3 };
                    return (levelOrder[a.level] || 0) - (levelOrder[b.level] || 0);
                });

                sortedData.forEach((emp, index) => {
                    const tierKey = 't' + emp.tier;
                    const levelKey = emp.level.toLowerCase();
                    
                    const tierMult = tierMultipliers[tierKey] || 1;
                    const levelMult = levelWeights[levelKey] || 1;
                    
                    // ì˜ˆìƒ ê¸ˆì•¡ ê³„ì‚°
                    const expectedAmount = masterBase * tierMult * levelMult;
                    expectedTotal += expectedAmount;
                    
                    // ê²€ì¦ (1% ì˜¤ì°¨ í—ˆìš©)
                    const diff = Math.abs(emp.launchBonusTotal - expectedAmount);
                    const diffPercent = expectedAmount > 0 ? (diff / expectedAmount) * 100 : 0;
                    
                    let status, statusClass;
                    if (diffPercent <= 1) {
                        status = 'âœ… í†µê³¼';
                        statusClass = 'bg-green-100 text-green-800';
                        passCount++;
                    } else if (diffPercent <= 5) {
                        status = 'âš ï¸ ê²½ê³ ';
                        statusClass = 'bg-yellow-100 text-yellow-800';
                        passCount++;
                    } else {
                        status = 'âŒ ì‹¤íŒ¨';
                        statusClass = 'bg-red-100 text-red-800';
                        failCount++;
                    }
                    
                    // í…Œì´ë¸” í–‰ ì—…ë°ì´íŠ¸
                    if (rows[index]) {
                        const statusCell = rows[index].querySelector('td:last-child');
                        statusCell.innerHTML = `<span class="px-2 py-1 rounded text-xs ${statusClass}">${status}</span>`;
                    }
                });

                // ì´ì•¡ ê²€ì¦ ê²°ê³¼
                const totalDiff = Math.abs(actualTotal - expectedTotal);
                const totalDiffPercent = expectedTotal > 0 ? (totalDiff / expectedTotal) * 100 : 0;
                
                document.getElementById('verify_expected_total').textContent = Math.round(expectedTotal).toLocaleString('ko-KR') + 'ì›';
                document.getElementById('verify_actual_total').textContent = actualTotal.toLocaleString('ko-KR') + 'ì›';
                document.getElementById('verify_total_diff').textContent = Math.round(totalDiff).toLocaleString('ko-KR') + 'ì› (' + totalDiffPercent.toFixed(2) + '%)';
                
                const totalStatus = document.getElementById('verify_total_status');
                const totalCard = document.getElementById('verifyCard_total');
                if (totalDiffPercent <= 1) {
                    totalStatus.textContent = 'âœ… í†µê³¼';
                    totalStatus.className = 'px-2 py-1 rounded text-xs font-semibold bg-green-100 text-green-800';
                    totalCard.className = 'bg-green-50 rounded-lg p-4 border-2 border-green-300';
                } else {
                    totalStatus.textContent = 'âŒ ì‹¤íŒ¨';
                    totalStatus.className = 'px-2 py-1 rounded text-xs font-semibold bg-red-100 text-red-800';
                    totalCard.className = 'bg-red-50 rounded-lg p-4 border-2 border-red-300';
                }

                // ë°°ìˆ˜ ì ìš© ê²€ì¦ ê²°ê³¼
                document.getElementById('verify_multiplier_count').textContent = lockedIncentives.length + 'ê±´';
                document.getElementById('verify_multiplier_pass').textContent = passCount + 'ê±´';
                document.getElementById('verify_multiplier_fail').textContent = failCount + 'ê±´';
                
                const multiplierStatus = document.getElementById('verify_multiplier_status');
                const multiplierCard = document.getElementById('verifyCard_multiplier');
                if (failCount === 0) {
                    multiplierStatus.textContent = 'âœ… í†µê³¼';
                    multiplierStatus.className = 'px-2 py-1 rounded text-xs font-semibold bg-green-100 text-green-800';
                    multiplierCard.className = 'bg-green-50 rounded-lg p-4 border-2 border-green-300';
                } else {
                    multiplierStatus.textContent = 'âŒ ì‹¤íŒ¨';
                    multiplierStatus.className = 'px-2 py-1 rounded text-xs font-semibold bg-red-100 text-red-800';
                    multiplierCard.className = 'bg-red-50 rounded-lg p-4 border-2 border-red-300';
                }

                // ì „ì²´ ê²€ì¦ ê²°ê³¼
                const overallRate = ((passCount / lockedIncentives.length) * 100).toFixed(1);
                document.getElementById('verify_overall_rate').textContent = overallRate + '%';
                
                const overallStatus = document.getElementById('verify_overall_status');
                const overallCard = document.getElementById('verifyCard_overall');
                const statusIndicator = document.getElementById('verificationStatus');
                
                if (parseFloat(overallRate) >= 99) {
                    overallStatus.textContent = 'âœ… í†µê³¼';
                    overallStatus.className = 'px-2 py-1 rounded text-xs font-semibold bg-green-100 text-green-800';
                    overallCard.className = 'bg-green-50 rounded-lg p-4 border-2 border-green-300';
                    document.getElementById('verify_overall_rate').className = 'text-4xl font-bold text-green-600';
                    statusIndicator.textContent = 'ê²€ì¦ ì™„ë£Œ âœ…';
                    statusIndicator.className = 'px-4 py-2 rounded-full text-sm font-semibold bg-green-100 text-green-800';
                } else if (parseFloat(overallRate) >= 90) {
                    overallStatus.textContent = 'âš ï¸ ê²½ê³ ';
                    overallStatus.className = 'px-2 py-1 rounded text-xs font-semibold bg-yellow-100 text-yellow-800';
                    overallCard.className = 'bg-yellow-50 rounded-lg p-4 border-2 border-yellow-300';
                    document.getElementById('verify_overall_rate').className = 'text-4xl font-bold text-yellow-600';
                    statusIndicator.textContent = 'ë¶€ë¶„ í†µê³¼ âš ï¸';
                    statusIndicator.className = 'px-4 py-2 rounded-full text-sm font-semibold bg-yellow-100 text-yellow-800';
                } else {
                    overallStatus.textContent = 'âŒ ì‹¤íŒ¨';
                    overallStatus.className = 'px-2 py-1 rounded text-xs font-semibold bg-red-100 text-red-800';
                    overallCard.className = 'bg-red-50 rounded-lg p-4 border-2 border-red-300';
                    document.getElementById('verify_overall_rate').className = 'text-4xl font-bold text-red-600';
                    statusIndicator.textContent = 'ê²€ì¦ ì‹¤íŒ¨ âŒ';
                    statusIndicator.className = 'px-4 py-2 rounded-full text-sm font-semibold bg-red-100 text-red-800';
                }
            }

            // ëœë¤ ìƒ˜í”Œë§ - ë‹¤ì–‘í•œ Tier/Levelì´ í¬í•¨ë˜ë„ë¡
            function randomSampleEmployees(count = 10) {
                if (!isIncentivesLocked || lockedIncentives.length === 0) {
                    alert('âš ï¸ í™•ì •ëœ ì¸ì„¼í‹°ë¸Œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return [];
                }

                // Tier/Level ì¡°í•©ë³„ë¡œ ê·¸ë£¹í™”
                const groups = {};
                lockedIncentives.forEach(emp => {
                    const key = `T${emp.tier}-${emp.level}`;
                    if (!groups[key]) groups[key] = [];
                    groups[key].push(emp);
                });

                const samples = [];
                const groupKeys = Object.keys(groups).sort(); // ì •ë ¬ëœ ê·¸ë£¹ í‚¤

                // ê° ê·¸ë£¹ì—ì„œ 1ëª…ì”© ë¨¼ì € ì„ íƒ (ìµœëŒ€ countëª…ê¹Œì§€)
                groupKeys.forEach(key => {
                    if (samples.length < count && groups[key].length > 0) {
                        const randomIndex = Math.floor(Math.random() * groups[key].length);
                        samples.push(groups[key][randomIndex]);
                        groups[key].splice(randomIndex, 1); // ì¤‘ë³µ ë°©ì§€
                    }
                });

                // ë‚¨ì€ ìë¦¬ëŠ” ëœë¤ìœ¼ë¡œ ì±„ìš°ê¸°
                if (samples.length < count) {
                    const remaining = lockedIncentives.filter(emp => !samples.includes(emp));
                    const shuffled = remaining.sort(() => Math.random() - 0.5);
                    samples.push(...shuffled.slice(0, count - samples.length));
                }

                return samples.slice(0, count);
            }

            // ëœë¤ ìƒ˜í”Œë§ ê²€ì¦ ì‹¤í–‰
            function runRandomSamplingVerification() {
                const samples = randomSampleEmployees(10);
                
                if (samples.length === 0) return;

                // ìƒ˜í”Œë§ëœ ì¸ì› ëª©ë¡ í‘œì‹œ
                document.getElementById('sampledEmployeesList').classList.remove('hidden');
                document.getElementById('crossVerificationSection').classList.remove('hidden');
                
                const grid = document.getElementById('sampledEmployeesGrid');
                grid.innerHTML = '';
                
                // Tier, Level ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ í‘œì‹œ
                const sortedSamples = [...samples].sort((a, b) => {
                    if (a.tier !== b.tier) return a.tier - b.tier;
                    const levelOrder = { 'L1': 1, 'L2': 2, 'L3': 3 };
                    return (levelOrder[a.level] || 0) - (levelOrder[b.level] || 0);
                });
                
                sortedSamples.forEach((emp, index) => {
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-lg p-3 border shadow-sm';
                    card.innerHTML = `
                        <div class="text-xs text-gray-500 mb-1">#${index + 1}</div>
                        <div class="font-semibold text-sm">${emp.name}</div>
                        <div class="text-xs text-gray-600 font-medium">T${emp.tier}-${emp.level}</div>
                        <div class="text-xs font-medium text-indigo-600">${emp.launchBonusTotal.toLocaleString('ko-KR')}ì›</div>
                    `;
                    grid.appendChild(card);
                });

                // ìŒë³„ êµì°¨ ê²€ì¦ ìƒì„±
                renderPairVerification(sortedSamples);
            }

            // ìŒë³„ êµì°¨ ê²€ì¦ ë Œë”ë§ - ìƒì„¸ ì‚°ì‹ í¬í•¨
            function renderPairVerification(samples) {
                const { tierMultipliers, levelWeights, tierRates } = verificationData;
                const container = document.getElementById('pairVerificationResults');
                container.innerHTML = '';

                // Tier ê°„ ì¦ê°€ìœ¨ ë§µ
                const tierRateMap = {
                    '6_5': tierRates.t6_t5,
                    '5_4': tierRates.t5_t4,
                    '4_3': tierRates.t4_t3,
                    '3_2': tierRates.t3_t2,
                    '2_1': tierRates.t2_t1
                };

                // Level ê°„ ë¹„ìœ¨ ë§µ (L3 ê¸°ì¤€)
                const levelRatioMap = {
                    'l1': levelWeights.l1 / levelWeights.l3,
                    'l2': levelWeights.l2 / levelWeights.l3,
                    'l3': 1.0
                };

                // ëª¨ë“  ìŒ ìƒì„± (i < j)
                const pairs = [];
                for (let i = 0; i < samples.length; i++) {
                    for (let j = i + 1; j < samples.length; j++) {
                        pairs.push({ empA: samples[i], empB: samples[j] });
                    }
                }

                // Tierê°€ ë‹¤ë¥¸ ìŒê³¼ Levelì´ ë‹¤ë¥¸ ìŒìœ¼ë¡œ ë¶„ë¥˜
                const tierPairs = pairs.filter(p => p.empA.tier !== p.empB.tier);
                const levelPairs = pairs.filter(p => p.empA.level !== p.empB.level && p.empA.tier === p.empB.tier);

                let html = '';

                // Tier ê°„ ê²€ì¦ ì„¹ì…˜
                if (tierPairs.length > 0) {
                    html += '<div class="mb-8">';
                    html += '<h5 class="font-bold text-lg text-gray-700 mb-4 flex items-center"><span class="w-3 h-3 bg-indigo-500 rounded-full mr-2"></span>Tier ê°„ ì¦ê°€ìœ¨ ê²€ì¦ (ìƒì„¸ ì‚°ì‹ í¬í•¨)</h5>';
                    html += '<div class="space-y-6">';
                    
                    // ëŒ€í‘œì ì¸ Tier ìŒë§Œ í‘œì‹œ (ìµœëŒ€ 10ê°œ)
                    tierPairs.slice(0, 10).forEach((pair, pairIdx) => {
                        const { empA, empB } = pair;
                        // ë†’ì€ Tier(ë‚®ì€ ë²ˆí˜¸)ê°€ ë” ë§ì´ ë°›ì•„ì•¼ í•¨
                        const higher = empA.tier < empB.tier ? empA : empB;
                        const lower = empA.tier < empB.tier ? empB : empA;
                        
                        // ì˜ˆìƒ ì¦ê°€ìœ¨ ê³„ì‚° ê³¼ì • ìƒì„¸ ê¸°ë¡
                        let expectedRate = 0;
                        let tierCalcSteps = [];
                        for (let t = lower.tier; t > higher.tier; t--) {
                            const key = `${t}_${t-1}`;
                            if (tierRateMap[key]) {
                                const prevRate = expectedRate;
                                expectedRate = (1 + expectedRate/100) * (1 + tierRateMap[key]/100) * 100 - 100;
                                tierCalcSteps.push({
                                    from: t,
                                    to: t - 1,
                                    rate: tierRateMap[key],
                                    cumulative: expectedRate
                                });
                            }
                        }
                        
                        // ì‹¤ì œ ì¦ê°€ìœ¨ ê³„ì‚° (ë™ì¼ Level ê°€ì • ì‹œ)
                        const higherLevelMult = levelWeights[higher.level.toLowerCase()] || 1;
                        const lowerLevelMult = levelWeights[lower.level.toLowerCase()] || 1;
                        
                        // Level ì°¨ì´ ë³´ì •
                        const levelAdjustedHigherAmount = higher.launchBonusTotal / higherLevelMult * levelWeights.l3;
                        const levelAdjustedLowerAmount = lower.launchBonusTotal / lowerLevelMult * levelWeights.l3;
                        
                        const actualRate = levelAdjustedLowerAmount > 0 ? 
                            ((levelAdjustedHigherAmount / levelAdjustedLowerAmount) - 1) * 100 : 0;
                        
                        const diff = Math.abs(actualRate - expectedRate);
                        const needsLevelAdjust = higher.level !== lower.level;
                        
                        let statusClass, statusText, borderColor;
                        if (diff <= 1) {
                            statusClass = 'bg-green-50';
                            borderColor = 'border-green-400';
                            statusText = 'âœ… ê²€ì¦ í†µê³¼';
                        } else if (diff <= 5) {
                            statusClass = 'bg-yellow-50';
                            borderColor = 'border-yellow-400';
                            statusText = 'âš ï¸ ê²½ê³  (í—ˆìš© ë²”ìœ„ ë‚´)';
                        } else {
                            statusClass = 'bg-red-50';
                            borderColor = 'border-red-400';
                            statusText = 'âŒ ê²€ì¦ ì‹¤íŒ¨';
                        }

                        const detailId = `tier-detail-${pairIdx}`;
                        // ìƒì„¸ ì‚°ì‹ì„ í¬í•¨í•œ HTML ìƒì„±
                        html += `
                            <div class="p-5 rounded-xl border-2 ${borderColor} ${statusClass}">
                                <!-- í—¤ë” -->
                                <div class="flex justify-between items-center mb-4 pb-3 border-b border-gray-200">
                                    <div class="flex items-center gap-3">
                                        <span class="bg-indigo-600 text-white px-3 py-1 rounded-full text-sm font-bold">#${pairIdx + 1}</span>
                                        <span class="font-bold text-lg text-gray-800">T${lower.tier} â†’ T${higher.tier} ì¦ê°€ìœ¨ ê²€ì¦</span>
                                    </div>
                                    <span class="px-4 py-2 rounded-lg font-bold ${diff <= 1 ? 'bg-green-100 text-green-800' : diff <= 5 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">${statusText}</span>
                                </div>

                                <!-- ê°„ë‹¨ ìš”ì•½ ì •ë³´ -->
                                <div class="mb-4">
                                    <div class="grid grid-cols-2 gap-4 mb-3">
                                        <div class="p-3 bg-orange-50 rounded-lg border border-orange-200">
                                            <div class="text-xs text-orange-600 mb-1 font-semibold">ğŸ‘¤ ê¸°ì¤€ ì§ì› (ë‚®ì€ Tier)</div>
                                            <div class="font-bold text-gray-800">${lower.name}</div>
                                            <div class="text-sm text-gray-600">T${lower.tier}-${lower.level}</div>
                                            <div class="text-lg font-bold text-orange-600 mt-1">ğŸ’° ${lower.launchBonusTotal.toLocaleString()}ì›</div>
                                        </div>
                                        <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                            <div class="text-xs text-blue-600 mb-1 font-semibold">ğŸ‘¤ ë¹„êµ ì§ì› (ë†’ì€ Tier)</div>
                                            <div class="font-bold text-gray-800">${higher.name}</div>
                                            <div class="text-sm text-gray-600">T${higher.tier}-${higher.level}</div>
                                            <div class="text-lg font-bold text-blue-600 mt-1">ğŸ’° ${higher.launchBonusTotal.toLocaleString()}ì›</div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-3 gap-3 text-center">
                                        <div class="p-3 bg-indigo-50 rounded-lg">
                                            <div class="text-xs text-indigo-600 mb-1">ì˜ˆìƒ ì¦ê°€ìœ¨</div>
                                            <div class="text-xl font-bold text-indigo-700">+${expectedRate.toFixed(1)}%</div>
                                        </div>
                                        <div class="p-3 bg-green-50 rounded-lg">
                                            <div class="text-xs text-green-600 mb-1">ì‹¤ì œ ì¦ê°€ìœ¨</div>
                                            <div class="text-xl font-bold text-green-700">+${actualRate.toFixed(1)}%</div>
                                        </div>
                                        <div class="p-3 ${diff <= 1 ? 'bg-green-100' : diff <= 5 ? 'bg-yellow-100' : 'bg-red-100'} rounded-lg">
                                            <div class="text-xs ${diff <= 1 ? 'text-green-600' : diff <= 5 ? 'text-yellow-600' : 'text-red-600'} mb-1">ì˜¤ì°¨</div>
                                            <div class="text-xl font-bold ${diff <= 1 ? 'text-green-700' : diff <= 5 ? 'text-yellow-700' : 'text-red-700'}">${diff.toFixed(1)}%</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- í¼ì³ì„œ ë³´ê¸° ë²„íŠ¼ -->
                                <div class="text-center mb-3">
                                    <button onclick="toggleDetail('${detailId}')" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold text-sm flex items-center gap-2 mx-auto">
                                        <span id="${detailId}-btn-text">ğŸ“– í¼ì³ì„œ ë³´ê¸°</span>
                                        <span id="${detailId}-icon">â–¼</span>
                                    </button>
                                </div>

                                <!-- ìƒì„¸ ë‚´ìš© (ê¸°ë³¸ ìˆ¨ê¹€) -->
                                <div id="${detailId}" class="hidden">
                                    <!-- STEP 1: ë¹„êµ ëŒ€ìƒ -->
                                    <div class="mb-4 p-4 bg-white rounded-lg border border-gray-200">
                                        <div class="text-sm font-bold text-indigo-600 mb-3">ğŸ“‹ STEP 1: ë¹„êµ ëŒ€ìƒ í™•ì¸</div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div class="p-3 bg-orange-50 rounded-lg border border-orange-200">
                                                <div class="text-xs text-orange-600 mb-1 font-semibold">ğŸ‘¤ ê¸°ì¤€ ì§ì› (ë‚®ì€ Tier)</div>
                                                <div class="font-bold text-gray-800 text-lg">${lower.name}</div>
                                                <div class="text-sm text-gray-600">Tier: <span class="font-bold text-blue-600">T${lower.tier}</span> | Level: <span class="font-bold text-purple-600">${lower.level}</span></div>
                                                <div class="text-xl font-bold text-orange-600 mt-2">ğŸ’° ${lower.launchBonusTotal.toLocaleString()}ì›</div>
                                            </div>
                                            <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                                <div class="text-xs text-blue-600 mb-1 font-semibold">ğŸ‘¤ ë¹„êµ ì§ì› (ë†’ì€ Tier)</div>
                                                <div class="font-bold text-gray-800 text-lg">${higher.name}</div>
                                                <div class="text-sm text-gray-600">Tier: <span class="font-bold text-blue-600">T${higher.tier}</span> | Level: <span class="font-bold text-purple-600">${higher.level}</span></div>
                                                <div class="text-xl font-bold text-blue-600 mt-2">ğŸ’° ${higher.launchBonusTotal.toLocaleString()}ì›</div>
                                            </div>
                                        </div>
                                    </div>

                                <!-- STEP 2: ì˜ˆìƒ ì¦ê°€ìœ¨ ê³„ì‚° -->
                                <div class="mb-4 p-4 bg-white rounded-lg border border-gray-200">
                                    <div class="text-sm font-bold text-indigo-600 mb-3">ğŸ“ STEP 2: ì˜ˆìƒ ì¦ê°€ìœ¨ ê³„ì‚°í•˜ê¸°</div>
                                    
                                    <div class="mb-3 p-3 bg-indigo-50 rounded-lg border border-indigo-200">
                                        <div class="text-sm text-indigo-800">
                                            <strong>ğŸ’¡ ì´í•´í•˜ê¸°:</strong> T${lower.tier}ì—ì„œ T${higher.tier}ë¡œ ì˜¬ë¼ê°€ë©´, íšŒì‚¬ì—ì„œ ì •í•œ ì¦ê°€ìœ¨ë§Œí¼ ë³´ë„ˆìŠ¤ë¥¼ ë” ë§ì´ ë°›ì•„ì•¼ í•´ìš”!
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="text-sm font-semibold text-gray-700 mb-2">ğŸ“ Tierë³„ ì¦ê°€ìœ¨ (íšŒì‚¬ ì„¤ì •ê°’):</div>
                                        <div class="space-y-2">
                                            ${tierCalcSteps.map((step, i) => `
                                                <div class="flex items-center gap-2 p-2 bg-gray-50 rounded border">
                                                    <span class="bg-indigo-500 text-white px-2 py-1 rounded text-xs font-bold">${i + 1}ë‹¨ê³„</span>
                                                    <span class="font-semibold">T${step.from} â†’ T${step.to}</span>
                                                    <span class="text-indigo-600 font-bold">+${step.rate}% ì¦ê°€</span>
                                                    ${i > 0 ? `<span class="text-gray-500 text-sm">(ëˆ„ì : +${step.cumulative.toFixed(1)}%)</span>` : ''}
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    
                                    <div class="p-3 bg-indigo-100 rounded-lg border border-indigo-300">
                                        <div class="text-sm font-semibold text-indigo-800 mb-2">ğŸ“ ì‚°ì‹:</div>
                                        <div class="bg-white p-3 rounded border text-center font-mono text-sm">
                                            ${tierCalcSteps.length === 1 ? 
                                                `T${lower.tier}ì—ì„œ T${higher.tier}ë¡œ ê°€ë©´ <strong class="text-indigo-600">+${tierCalcSteps[0].rate}%</strong> ì¦ê°€` :
                                                tierCalcSteps.map((s, i) => `(1 + ${s.rate}/100)`).join(' Ã— ') + ' - 1 = ?'
                                            }
                                        </div>
                                        ${tierCalcSteps.length > 1 ? `
                                        <div class="mt-2 bg-white p-3 rounded border text-center font-mono text-sm">
                                            = ${tierCalcSteps.map(s => (1 + s.rate/100).toFixed(2)).join(' Ã— ')} - 1
                                        </div>
                                        <div class="mt-2 bg-white p-3 rounded border text-center font-mono text-sm">
                                            = ${tierCalcSteps.reduce((acc, s) => acc * (1 + s.rate/100), 1).toFixed(4)} - 1
                                        </div>
                                        ` : ''}
                                        <div class="mt-3 text-center">
                                            <span class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-lg">
                                                â¡ï¸ ì˜ˆìƒ ì¦ê°€ìœ¨: +${expectedRate.toFixed(1)}%
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                ${needsLevelAdjust ? `
                                <!-- STEP 3: Level ë³´ì • -->
                                <div class="mb-4 p-4 bg-white rounded-lg border border-gray-200">
                                    <div class="text-sm font-bold text-purple-600 mb-3">âš–ï¸ STEP 3: Level ì°¨ì´ ë³´ì •í•˜ê¸°</div>
                                    
                                    <div class="mb-3 p-3 bg-purple-50 rounded-lg border border-purple-200">
                                        <div class="text-sm text-purple-800">
                                            <strong>ğŸ’¡ ì™œ ë³´ì •ì´ í•„ìš”í• ê¹Œìš”?</strong><br>
                                            ${lower.name}(${lower.level})ê³¼ ${higher.name}(${higher.level})ì˜ Levelì´ ë‹¬ë¼ìš”!<br>
                                            ê³µì •í•˜ê²Œ Tierë§Œ ë¹„êµí•˜ë ¤ë©´, ë‘˜ ë‹¤ L3ë¼ê³  ê°€ì •í•˜ê³  ê¸ˆì•¡ì„ ë°”ê¿”ì¤˜ì•¼ í•´ìš”.
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="p-3 bg-orange-50 rounded-lg border border-orange-200">
                                            <div class="text-sm font-bold text-orange-600 mb-2">${lower.name} (${lower.level}) ë³´ì •</div>
                                            <div class="space-y-1 text-sm font-mono">
                                                <div>ì›ë˜ ê¸ˆì•¡: <strong>${lower.launchBonusTotal.toLocaleString()}ì›</strong></div>
                                                <div class="text-gray-500">Ã· ${lower.level} ê°€ì¤‘ì¹˜(${lowerLevelMult})</div>
                                                <div class="text-gray-500">Ã— L3 ê°€ì¤‘ì¹˜(${levelWeights.l3})</div>
                                                <div class="border-t pt-1 font-bold text-orange-700">
                                                    = ${Math.round(levelAdjustedLowerAmount).toLocaleString()}ì› (L3 ê¸°ì¤€)
                                                </div>
                                            </div>
                                        </div>
                                        <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                            <div class="text-sm font-bold text-blue-600 mb-2">${higher.name} (${higher.level}) ë³´ì •</div>
                                            <div class="space-y-1 text-sm font-mono">
                                                <div>ì›ë˜ ê¸ˆì•¡: <strong>${higher.launchBonusTotal.toLocaleString()}ì›</strong></div>
                                                <div class="text-gray-500">Ã· ${higher.level} ê°€ì¤‘ì¹˜(${higherLevelMult})</div>
                                                <div class="text-gray-500">Ã— L3 ê°€ì¤‘ì¹˜(${levelWeights.l3})</div>
                                                <div class="border-t pt-1 font-bold text-blue-700">
                                                    = ${Math.round(levelAdjustedHigherAmount).toLocaleString()}ì› (L3 ê¸°ì¤€)
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}

                                <!-- STEP: ì‹¤ì œ ì¦ê°€ìœ¨ ê³„ì‚° -->
                                <div class="mb-4 p-4 bg-white rounded-lg border border-gray-200">
                                    <div class="text-sm font-bold text-green-600 mb-3">ğŸ§® STEP ${needsLevelAdjust ? '4' : '3'}: ì‹¤ì œ ì¦ê°€ìœ¨ ê³„ì‚°í•˜ê¸°</div>
                                    
                                    <div class="mb-3 p-3 bg-green-50 rounded-lg border border-green-200">
                                        <div class="text-sm text-green-800">
                                            <strong>ğŸ’¡ ê³„ì‚° ë°©ë²•:</strong> ë†’ì€ Tier ì§ì›ì˜ ê¸ˆì•¡ì´ ë‚®ì€ Tier ì§ì›ë³´ë‹¤ ëª‡ % ë” ë§ì€ì§€ ê³„ì‚°í•´ìš”!
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-4 rounded-lg border">
                                        <div class="text-sm font-semibold text-gray-700 mb-3">ğŸ“ ì‚°ì‹:</div>
                                        <div class="bg-white p-3 rounded border text-center mb-2">
                                            <span class="font-mono">ì‹¤ì œ ì¦ê°€ìœ¨ = (ë†’ì€Tier ê¸ˆì•¡ Ã· ë‚®ì€Tier ê¸ˆì•¡ - 1) Ã— 100</span>
                                        </div>
                                        
                                        <div class="text-sm font-semibold text-gray-700 mb-2 mt-4">ğŸ”¢ ìˆ«ì ëŒ€ì…:</div>
                                        <div class="bg-white p-3 rounded border text-center mb-2 font-mono text-sm">
                                            = (<span class="text-blue-600 font-bold">${needsLevelAdjust ? Math.round(levelAdjustedHigherAmount).toLocaleString() : higher.launchBonusTotal.toLocaleString()}</span> Ã· <span class="text-orange-600 font-bold">${needsLevelAdjust ? Math.round(levelAdjustedLowerAmount).toLocaleString() : lower.launchBonusTotal.toLocaleString()}</span> - 1) Ã— 100
                                        </div>
                                        
                                        <div class="text-sm font-semibold text-gray-700 mb-2 mt-4">ğŸ“Š ë‚˜ëˆ„ê¸° ê³„ì‚°:</div>
                                        <div class="bg-white p-3 rounded border text-center mb-2 font-mono text-sm">
                                            = (${(needsLevelAdjust ? levelAdjustedHigherAmount / levelAdjustedLowerAmount : higher.launchBonusTotal / lower.launchBonusTotal).toFixed(6)} - 1) Ã— 100
                                        </div>
                                        
                                        <div class="text-sm font-semibold text-gray-700 mb-2 mt-4">âœ¨ ìµœì¢… ê²°ê³¼:</div>
                                        <div class="text-center">
                                            <span class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-lg">
                                                â¡ï¸ ì‹¤ì œ ì¦ê°€ìœ¨: +${actualRate.toFixed(1)}%
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                    <!-- ìµœì¢… ê²°ê³¼ ë¹„êµ -->
                                    <div class="p-4 bg-white rounded-lg border-2 ${borderColor}">
                                        <div class="text-sm font-bold text-gray-700 mb-3">ğŸ¯ STEP ${needsLevelAdjust ? '5' : '4'}: ìµœì¢… ê²°ê³¼ ë¹„êµ</div>
                                        
                                        <div class="grid grid-cols-3 gap-4 text-center mb-4">
                                            <div class="p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                                                <div class="text-xs text-indigo-600 mb-1 font-semibold">ì˜ˆìƒ ì¦ê°€ìœ¨</div>
                                                <div class="text-3xl font-bold text-indigo-700">+${expectedRate.toFixed(1)}%</div>
                                                <div class="text-xs text-gray-500 mt-1">íšŒì‚¬ ì„¤ì •ê°’ ê¸°ì¤€</div>
                                            </div>
                                            <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                                                <div class="text-xs text-green-600 mb-1 font-semibold">ì‹¤ì œ ì¦ê°€ìœ¨</div>
                                                <div class="text-3xl font-bold text-green-700">+${actualRate.toFixed(1)}%</div>
                                                <div class="text-xs text-gray-500 mt-1">ì‹¤ì œ ê¸ˆì•¡ ê¸°ì¤€</div>
                                            </div>
                                            <div class="p-4 ${diff <= 1 ? 'bg-green-100 border-green-300' : diff <= 5 ? 'bg-yellow-100 border-yellow-300' : 'bg-red-100 border-red-300'} rounded-lg border">
                                                <div class="text-xs ${diff <= 1 ? 'text-green-600' : diff <= 5 ? 'text-yellow-600' : 'text-red-600'} mb-1 font-semibold">ì°¨ì´ (ì˜¤ì°¨)</div>
                                                <div class="text-3xl font-bold ${diff <= 1 ? 'text-green-700' : diff <= 5 ? 'text-yellow-700' : 'text-red-700'}">${diff.toFixed(1)}%</div>
                                                <div class="text-xs text-gray-500 mt-1">|ì˜ˆìƒ - ì‹¤ì œ|</div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 ${diff <= 1 ? 'bg-green-100' : diff <= 5 ? 'bg-yellow-100' : 'bg-red-100'} rounded-lg text-center">
                                            <div class="font-bold ${diff <= 1 ? 'text-green-800' : diff <= 5 ? 'text-yellow-800' : 'text-red-800'}">
                                                ${diff <= 1 ? 'ğŸ‰ ì™„ë²½í•´ìš”! ì˜ˆìƒê³¼ ì‹¤ì œê°€ ê±°ì˜ ê°™ì•„ìš”. Tier ë°°ìœ¨ì´ ì •í™•íˆ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!' : 
                                                  diff <= 5 ? 'âš ï¸ ì•½ê°„ ì°¨ì´ê°€ ìˆì§€ë§Œ ê´œì°®ì•„ìš” (í—ˆìš© ë²”ìœ„ 5% ì´ë‚´)' : 
                                                  'âŒ ì°¨ì´ê°€ ë„ˆë¬´ ì»¤ìš”! Tier ë°°ìœ¨ ì ìš©ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆì–´ìš”.'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                }

                // Level ê°„ ê²€ì¦ ì„¹ì…˜ (ìƒì„¸ ì‚°ì‹ í¬í•¨)
                if (levelPairs.length > 0) {
                    html += '<div class="mb-8">';
                    html += '<h5 class="font-bold text-lg text-gray-700 mb-4 flex items-center"><span class="w-3 h-3 bg-purple-500 rounded-full mr-2"></span>Level ê°„ ë¹„ìœ¨ ê²€ì¦ (ë™ì¼ Tier ë‚´, ìƒì„¸ ì‚°ì‹ í¬í•¨)</h5>';
                    html += '<div class="space-y-6">';
                    
                    levelPairs.slice(0, 10).forEach((pair, pairIdx) => {
                        const { empA, empB } = pair;
                        // ë†’ì€ Levelì´ ë” ë§ì´ ë°›ì•„ì•¼ í•¨
                        const levelOrder = { 'L1': 1, 'L2': 2, 'L3': 3 };
                        const higher = levelOrder[empA.level] > levelOrder[empB.level] ? empA : empB;
                        const lower = levelOrder[empA.level] > levelOrder[empB.level] ? empB : empA;
                        
                        // ì˜ˆìƒ ë¹„ìœ¨ (L3 ëŒ€ë¹„)
                        const higherLevelWeight = levelWeights[higher.level.toLowerCase()];
                        const lowerLevelWeight = levelWeights[lower.level.toLowerCase()];
                        const expectedRatio = higherLevelWeight / lowerLevelWeight;
                        
                        // ì‹¤ì œ ë¹„ìœ¨
                        const actualRatio = lower.launchBonusTotal > 0 ? higher.launchBonusTotal / lower.launchBonusTotal : 0;
                        
                        const diffPercent = expectedRatio > 0 ? Math.abs((actualRatio - expectedRatio) / expectedRatio) * 100 : 0;
                        
                        let statusClass, statusText, borderColor;
                        if (diffPercent <= 1) {
                            statusClass = 'bg-green-50';
                            borderColor = 'border-green-400';
                            statusText = 'âœ… ê²€ì¦ í†µê³¼';
                        } else if (diffPercent <= 5) {
                            statusClass = 'bg-yellow-50';
                            borderColor = 'border-yellow-400';
                            statusText = 'âš ï¸ ê²½ê³  (í—ˆìš© ë²”ìœ„ ë‚´)';
                        } else {
                            statusClass = 'bg-red-50';
                            borderColor = 'border-red-400';
                            statusText = 'âŒ ê²€ì¦ ì‹¤íŒ¨';
                        }

                        const levelDetailId = `level-detail-${pairIdx}`;
                        html += `
                            <div class="p-5 rounded-xl border-2 ${borderColor} ${statusClass}">
                                <!-- í—¤ë” -->
                                <div class="flex justify-between items-center mb-4 pb-3 border-b border-gray-200">
                                    <div class="flex items-center gap-3">
                                        <span class="bg-purple-600 text-white px-3 py-1 rounded-full text-sm font-bold">#${pairIdx + 1}</span>
                                        <span class="font-bold text-lg text-gray-800">T${empA.tier} ë‚´ ${lower.level} â†’ ${higher.level} ë¹„ìœ¨ ê²€ì¦</span>
                                    </div>
                                    <span class="px-4 py-2 rounded-lg font-bold ${diffPercent <= 1 ? 'bg-green-100 text-green-800' : diffPercent <= 5 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">${statusText}</span>
                                </div>

                                <!-- ê°„ë‹¨ ìš”ì•½ ì •ë³´ -->
                                <div class="mb-4">
                                    <div class="grid grid-cols-2 gap-4 mb-3">
                                        <div class="p-3 bg-orange-50 rounded-lg border border-orange-200">
                                            <div class="text-xs text-orange-600 mb-1 font-semibold">ğŸ‘¤ ê¸°ì¤€ ì§ì› (ë‚®ì€ Level)</div>
                                            <div class="font-bold text-gray-800">${lower.name}</div>
                                            <div class="text-sm text-gray-600">T${lower.tier}-${lower.level}</div>
                                            <div class="text-lg font-bold text-orange-600 mt-1">ğŸ’° ${lower.launchBonusTotal.toLocaleString()}ì›</div>
                                        </div>
                                        <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                            <div class="text-xs text-blue-600 mb-1 font-semibold">ğŸ‘¤ ë¹„êµ ì§ì› (ë†’ì€ Level)</div>
                                            <div class="font-bold text-gray-800">${higher.name}</div>
                                            <div class="text-sm text-gray-600">T${higher.tier}-${higher.level}</div>
                                            <div class="text-lg font-bold text-blue-600 mt-1">ğŸ’° ${higher.launchBonusTotal.toLocaleString()}ì›</div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-3 gap-3 text-center">
                                        <div class="p-3 bg-purple-50 rounded-lg">
                                            <div class="text-xs text-purple-600 mb-1">ì˜ˆìƒ ë¹„ìœ¨</div>
                                            <div class="text-xl font-bold text-purple-700">${expectedRatio.toFixed(4)}ë°°</div>
                                        </div>
                                        <div class="p-3 bg-green-50 rounded-lg">
                                            <div class="text-xs text-green-600 mb-1">ì‹¤ì œ ë¹„ìœ¨</div>
                                            <div class="text-xl font-bold text-green-700">${actualRatio.toFixed(4)}ë°°</div>
                                        </div>
                                        <div class="p-3 ${diffPercent <= 1 ? 'bg-green-100' : diffPercent <= 5 ? 'bg-yellow-100' : 'bg-red-100'} rounded-lg">
                                            <div class="text-xs ${diffPercent <= 1 ? 'text-green-600' : diffPercent <= 5 ? 'text-yellow-600' : 'text-red-600'} mb-1">ì˜¤ì°¨ìœ¨</div>
                                            <div class="text-xl font-bold ${diffPercent <= 1 ? 'text-green-700' : diffPercent <= 5 ? 'text-yellow-700' : 'text-red-700'}">${diffPercent.toFixed(2)}%</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- í¼ì³ì„œ ë³´ê¸° ë²„íŠ¼ -->
                                <div class="text-center mb-3">
                                    <button onclick="toggleDetail('${levelDetailId}')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold text-sm flex items-center gap-2 mx-auto">
                                        <span id="${levelDetailId}-btn-text">ğŸ“– í¼ì³ì„œ ë³´ê¸°</span>
                                        <span id="${levelDetailId}-icon">â–¼</span>
                                    </button>
                                </div>

                                <!-- ìƒì„¸ ë‚´ìš© (ê¸°ë³¸ ìˆ¨ê¹€) -->
                                <div id="${levelDetailId}" class="hidden">
                                    <!-- STEP 1: ë¹„êµ ëŒ€ìƒ -->
                                    <div class="mb-4 p-4 bg-white rounded-lg border border-gray-200">
                                        <div class="text-sm font-bold text-purple-600 mb-3">ğŸ“‹ STEP 1: ë¹„êµ ëŒ€ìƒ í™•ì¸</div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div class="p-3 bg-orange-50 rounded-lg border border-orange-200">
                                                <div class="text-xs text-orange-600 mb-1 font-semibold">ğŸ‘¤ ê¸°ì¤€ ì§ì› (ë‚®ì€ Level)</div>
                                                <div class="font-bold text-gray-800 text-lg">${lower.name}</div>
                                                <div class="text-sm text-gray-600">Tier: <span class="font-bold text-blue-600">T${lower.tier}</span> | Level: <span class="font-bold text-purple-600">${lower.level}</span></div>
                                                <div class="text-xl font-bold text-orange-600 mt-2">ğŸ’° ${lower.launchBonusTotal.toLocaleString()}ì›</div>
                                            </div>
                                            <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                                <div class="text-xs text-blue-600 mb-1 font-semibold">ğŸ‘¤ ë¹„êµ ì§ì› (ë†’ì€ Level)</div>
                                                <div class="font-bold text-gray-800 text-lg">${higher.name}</div>
                                                <div class="text-sm text-gray-600">Tier: <span class="font-bold text-blue-600">T${higher.tier}</span> | Level: <span class="font-bold text-purple-600">${higher.level}</span></div>
                                                <div class="text-xl font-bold text-blue-600 mt-2">ğŸ’° ${higher.launchBonusTotal.toLocaleString()}ì›</div>
                                            </div>
                                        </div>
                                    </div>

                                <!-- STEP 2: Level ê°€ì¤‘ì¹˜ ì„¤ëª… -->
                                <div class="mb-4 p-4 bg-white rounded-lg border border-gray-200">
                                    <div class="text-sm font-bold text-purple-600 mb-3">ğŸ“ STEP 2: Level ê°€ì¤‘ì¹˜ ì´í•´í•˜ê¸°</div>
                                    
                                    <div class="mb-3 p-3 bg-purple-50 rounded-lg border border-purple-200">
                                        <div class="text-sm text-purple-800">
                                            <strong>ğŸ’¡ ì´í•´í•˜ê¸°:</strong> Levelì€ í”„ë¡œì íŠ¸ í•©ë¥˜ ì‹œì ì„ ë‚˜íƒ€ë‚´ìš”!<br>
                                            ì¼ì° í•©ë¥˜í• ìˆ˜ë¡(L3) ê°€ì¤‘ì¹˜ê°€ ë†’ê³ , ëŠ¦ê²Œ í•©ë¥˜í• ìˆ˜ë¡(L1) ê°€ì¤‘ì¹˜ê°€ ë‚®ì•„ìš”.
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-3 gap-3 mb-4">
                                        <div class="p-3 text-center rounded-lg border ${lower.level === 'L1' || higher.level === 'L1' ? 'bg-purple-100 border-purple-400 ring-2 ring-purple-400' : 'bg-gray-50 border-gray-200'}">
                                            <div class="text-xs text-gray-500 mb-1">L1 (ëŠ¦ì€ í•©ë¥˜)</div>
                                            <div class="text-2xl font-bold text-purple-700">${levelWeights.l1}</div>
                                        </div>
                                        <div class="p-3 text-center rounded-lg border ${lower.level === 'L2' || higher.level === 'L2' ? 'bg-purple-100 border-purple-400 ring-2 ring-purple-400' : 'bg-gray-50 border-gray-200'}">
                                            <div class="text-xs text-gray-500 mb-1">L2 (ì¤‘ê°„ í•©ë¥˜)</div>
                                            <div class="text-2xl font-bold text-purple-700">${levelWeights.l2}</div>
                                        </div>
                                        <div class="p-3 text-center rounded-lg border ${lower.level === 'L3' || higher.level === 'L3' ? 'bg-purple-100 border-purple-400 ring-2 ring-purple-400' : 'bg-gray-50 border-gray-200'}">
                                            <div class="text-xs text-gray-500 mb-1">L3 (ì´ˆê¸° í•©ë¥˜)</div>
                                            <div class="text-2xl font-bold text-purple-700">${levelWeights.l3}</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- STEP 3: ì˜ˆìƒ ë¹„ìœ¨ ê³„ì‚° -->
                                <div class="mb-4 p-4 bg-white rounded-lg border border-gray-200">
                                    <div class="text-sm font-bold text-purple-600 mb-3">ğŸ”¢ STEP 3: ì˜ˆìƒ ë¹„ìœ¨ ê³„ì‚°í•˜ê¸°</div>
                                    
                                    <div class="mb-3 p-3 bg-purple-50 rounded-lg border border-purple-200">
                                        <div class="text-sm text-purple-800">
                                            <strong>ğŸ’¡ ê³„ì‚° ì›ë¦¬:</strong> ê°™ì€ Tierì—ì„œ Levelì´ ë‹¤ë¥´ë©´, ë†’ì€ Levelì´ ë°›ëŠ” ê¸ˆì•¡ì€ ë‚®ì€ Levelì˜ ëª‡ ë°°ì¸ì§€ ê³„ì‚°í•´ìš”!
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-4 rounded-lg border">
                                        <div class="text-sm font-semibold text-gray-700 mb-3">ğŸ“ ì‚°ì‹:</div>
                                        <div class="bg-white p-3 rounded border text-center mb-3">
                                            <span class="font-mono">ì˜ˆìƒ ë¹„ìœ¨ = ${higher.level} ê°€ì¤‘ì¹˜ Ã· ${lower.level} ê°€ì¤‘ì¹˜</span>
                                        </div>
                                        
                                        <div class="text-sm font-semibold text-gray-700 mb-2 mt-3">ğŸ”¢ ìˆ«ì ëŒ€ì…:</div>
                                        <div class="bg-white p-3 rounded border text-center mb-3 font-mono">
                                            = <span class="text-blue-600 font-bold">${higherLevelWeight}</span> Ã· <span class="text-orange-600 font-bold">${lowerLevelWeight}</span>
                                        </div>
                                        
                                        <div class="text-center mt-3">
                                            <span class="bg-purple-600 text-white px-4 py-2 rounded-lg font-bold text-lg">
                                                â¡ï¸ ì˜ˆìƒ ë¹„ìœ¨: ${expectedRatio.toFixed(4)}ë°°
                                            </span>
                                        </div>
                                        
                                        <div class="mt-3 p-2 bg-purple-50 rounded text-center text-sm text-purple-700">
                                            ì¦‰, ${higher.name}(${higher.level})ì˜ ê¸ˆì•¡ì€ ${lower.name}(${lower.level})ì˜ <strong>${expectedRatio.toFixed(2)}ë°°</strong>ì—¬ì•¼ í•´ìš”!
                                        </div>
                                    </div>
                                </div>

                                <!-- STEP 4: ì‹¤ì œ ë¹„ìœ¨ ê³„ì‚° -->
                                <div class="mb-4 p-4 bg-white rounded-lg border border-gray-200">
                                    <div class="text-sm font-bold text-green-600 mb-3">ğŸ§® STEP 4: ì‹¤ì œ ë¹„ìœ¨ ê³„ì‚°í•˜ê¸°</div>
                                    
                                    <div class="mb-3 p-3 bg-green-50 rounded-lg border border-green-200">
                                        <div class="text-sm text-green-800">
                                            <strong>ğŸ’¡ ê³„ì‚° ë°©ë²•:</strong> ì‹¤ì œë¡œ ë°›ì€ ê¸ˆì•¡ì„ ë‚˜ëˆ ì„œ ë¹„ìœ¨ì„ êµ¬í•´ë´ìš”!
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-4 rounded-lg border">
                                        <div class="text-sm font-semibold text-gray-700 mb-3">ğŸ“ ì‚°ì‹:</div>
                                        <div class="bg-white p-3 rounded border text-center mb-3">
                                            <span class="font-mono">ì‹¤ì œ ë¹„ìœ¨ = ${higher.name} ê¸ˆì•¡ Ã· ${lower.name} ê¸ˆì•¡</span>
                                        </div>
                                        
                                        <div class="text-sm font-semibold text-gray-700 mb-2 mt-3">ğŸ”¢ ìˆ«ì ëŒ€ì…:</div>
                                        <div class="bg-white p-3 rounded border text-center mb-3 font-mono text-sm">
                                            = <span class="text-blue-600 font-bold">${higher.launchBonusTotal.toLocaleString()}ì›</span> Ã· <span class="text-orange-600 font-bold">${lower.launchBonusTotal.toLocaleString()}ì›</span>
                                        </div>
                                        
                                        <div class="text-center mt-3">
                                            <span class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-lg">
                                                â¡ï¸ ì‹¤ì œ ë¹„ìœ¨: ${actualRatio.toFixed(4)}ë°°
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- STEP 5: ì˜¤ì°¨ìœ¨ ê³„ì‚° -->
                                <div class="mb-4 p-4 bg-white rounded-lg border border-gray-200">
                                    <div class="text-sm font-bold text-amber-600 mb-3">ğŸ“Š STEP 5: ì˜¤ì°¨ìœ¨ ê³„ì‚°í•˜ê¸°</div>
                                    
                                    <div class="mb-3 p-3 bg-amber-50 rounded-lg border border-amber-200">
                                        <div class="text-sm text-amber-800">
                                            <strong>ğŸ’¡ ì˜¤ì°¨ìœ¨ì´ë€?</strong> ì˜ˆìƒí•œ ê°’ê³¼ ì‹¤ì œ ê°’ì´ ì–¼ë§ˆë‚˜ ë‹¤ë¥¸ì§€ë¥¼ %ë¡œ ë‚˜íƒ€ë‚´ìš”.<br>
                                            ì˜¤ì°¨ìœ¨ì´ ì‘ì„ìˆ˜ë¡ ì •í™•í•˜ê²Œ ì ìš©ëœ ê±°ì˜ˆìš”!
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-4 rounded-lg border">
                                        <div class="text-sm font-semibold text-gray-700 mb-3">ğŸ“ ì‚°ì‹:</div>
                                        <div class="bg-white p-3 rounded border text-center mb-3">
                                            <span class="font-mono">ì˜¤ì°¨ìœ¨ = |ì‹¤ì œ ë¹„ìœ¨ - ì˜ˆìƒ ë¹„ìœ¨| Ã· ì˜ˆìƒ ë¹„ìœ¨ Ã— 100</span>
                                        </div>
                                        
                                        <div class="text-sm font-semibold text-gray-700 mb-2 mt-3">ğŸ”¢ ìˆ«ì ëŒ€ì…:</div>
                                        <div class="bg-white p-3 rounded border text-center mb-3 font-mono text-sm">
                                            = |<span class="text-green-600">${actualRatio.toFixed(4)}</span> - <span class="text-purple-600">${expectedRatio.toFixed(4)}</span>| Ã· <span class="text-purple-600">${expectedRatio.toFixed(4)}</span> Ã— 100
                                        </div>
                                        
                                        <div class="bg-white p-3 rounded border text-center mb-3 font-mono text-sm">
                                            = ${Math.abs(actualRatio - expectedRatio).toFixed(6)} Ã· ${expectedRatio.toFixed(4)} Ã— 100
                                        </div>
                                        
                                        <div class="text-center mt-3">
                                            <span class="bg-amber-500 text-white px-4 py-2 rounded-lg font-bold text-lg">
                                                â¡ï¸ ì˜¤ì°¨ìœ¨: ${diffPercent.toFixed(2)}%
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                    <!-- ìµœì¢… ê²°ê³¼ ë¹„êµ -->
                                    <div class="p-4 bg-white rounded-lg border-2 ${borderColor}">
                                        <div class="text-sm font-bold text-gray-700 mb-3">ğŸ¯ STEP 6: ìµœì¢… ê²°ê³¼</div>
                                        
                                        <div class="grid grid-cols-3 gap-4 text-center mb-4">
                                            <div class="p-4 bg-purple-50 rounded-lg border border-purple-200">
                                                <div class="text-xs text-purple-600 mb-1 font-semibold">ì˜ˆìƒ ë¹„ìœ¨</div>
                                                <div class="text-3xl font-bold text-purple-700">${expectedRatio.toFixed(4)}ë°°</div>
                                                <div class="text-xs text-gray-500 mt-1">Level ê°€ì¤‘ì¹˜ ê¸°ì¤€</div>
                                            </div>
                                            <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                                                <div class="text-xs text-green-600 mb-1 font-semibold">ì‹¤ì œ ë¹„ìœ¨</div>
                                                <div class="text-3xl font-bold text-green-700">${actualRatio.toFixed(4)}ë°°</div>
                                                <div class="text-xs text-gray-500 mt-1">ì‹¤ì œ ê¸ˆì•¡ ê¸°ì¤€</div>
                                            </div>
                                            <div class="p-4 ${diffPercent <= 1 ? 'bg-green-100 border-green-300' : diffPercent <= 5 ? 'bg-yellow-100 border-yellow-300' : 'bg-red-100 border-red-300'} rounded-lg border">
                                                <div class="text-xs ${diffPercent <= 1 ? 'text-green-600' : diffPercent <= 5 ? 'text-yellow-600' : 'text-red-600'} mb-1 font-semibold">ì˜¤ì°¨ìœ¨</div>
                                                <div class="text-3xl font-bold ${diffPercent <= 1 ? 'text-green-700' : diffPercent <= 5 ? 'text-yellow-700' : 'text-red-700'}">${diffPercent.toFixed(2)}%</div>
                                                <div class="text-xs text-gray-500 mt-1">${diffPercent <= 5 ? 'í—ˆìš© ë²”ìœ„ ë‚´' : 'ë²”ìœ„ ì´ˆê³¼'}</div>
                                            </div>
                                        </div>
                                        
                                        <div class="p-3 ${diffPercent <= 1 ? 'bg-green-100' : diffPercent <= 5 ? 'bg-yellow-100' : 'bg-red-100'} rounded-lg text-center">
                                            <div class="font-bold ${diffPercent <= 1 ? 'text-green-800' : diffPercent <= 5 ? 'text-yellow-800' : 'text-red-800'}">
                                                ${diffPercent <= 1 ? 'ğŸ‰ ì™„ë²½í•´ìš”! ì˜ˆìƒê³¼ ì‹¤ì œê°€ ê±°ì˜ ê°™ì•„ìš”. Level ê°€ì¤‘ì¹˜ê°€ ì •í™•íˆ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!' : 
                                                  diffPercent <= 5 ? 'âš ï¸ ì•½ê°„ ì°¨ì´ê°€ ìˆì§€ë§Œ ê´œì°®ì•„ìš” (í—ˆìš© ë²”ìœ„ 5% ì´ë‚´)' : 
                                                  'âŒ ì°¨ì´ê°€ ë„ˆë¬´ ì»¤ìš”! Level ê°€ì¤‘ì¹˜ ì ìš©ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆì–´ìš”.'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                }

                if (tierPairs.length === 0 && levelPairs.length === 0) {
                    html = '<div class="text-center py-8 text-gray-500">ë¹„êµ ê°€ëŠ¥í•œ ìŒì´ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ Tier/Levelì˜ ì§ì›ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>';
                }

                container.innerHTML = html;
            }

            // ìƒì„¸ ë‚´ìš© í† ê¸€ í•¨ìˆ˜
            function toggleDetail(detailId) {
                const detailElement = document.getElementById(detailId);
                const btnText = document.getElementById(detailId + '-btn-text');
                const btnIcon = document.getElementById(detailId + '-icon');
                
                if (detailElement) {
                    if (detailElement.classList.contains('hidden')) {
                        // í¼ì¹˜ê¸°
                        detailElement.classList.remove('hidden');
                        if (btnText) btnText.textContent = 'ğŸ“• ì ‘ê¸°';
                        if (btnIcon) btnIcon.textContent = 'â–²';
                    } else {
                        // ì ‘ê¸°
                        detailElement.classList.add('hidden');
                        if (btnText) btnText.textContent = 'ğŸ“– í¼ì³ì„œ ë³´ê¸°';
                        if (btnIcon) btnIcon.textContent = 'â–¼';
                    }
                }
            }

            // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (HTMLì—ì„œ onclickìœ¼ë¡œ í˜¸ì¶œí•˜ê¸° ìœ„í•´)
            window.toggleDetail = toggleDetail;

            // ê²€ì¦ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('runVerificationBtn').addEventListener('click', runVerification);
            document.getElementById('randomSampleBtn').addEventListener('click', runRandomSamplingVerification);
        });
    </script>
</body>
</html>

