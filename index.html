<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ì„¼í‹°ë¸Œ ì‹œë®¬ë ˆì´í„° (v9) - Tier 6 System</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
        }
        .card {
            background-color: white;
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* shadow-md */
            margin-bottom: 1.5rem; /* mb-6 */
            overflow: hidden;
        }
        .step-title {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            padding: 1rem 1.5rem; /* p-4 sm:p-6 */
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
        }
        .card-content {
            padding: 1.5rem; /* p-6 */
        }
        .section-title {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #111827; /* gray-900 */
            margin-bottom: 1rem; /* mb-4 */
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
            padding-bottom: 0.5rem; /* pb-2 */
        }
        
        /* í‘œì¤€ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .input-base {
            width: 100%;
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #d1d5db; /* border-gray-300 */
            padding: 0.5rem 0.75rem; /* px-3 py-2 */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            transition: all 0.15s ease-in-out;
        }
        .input-base:focus {
            outline: none;
            border-color: #4f46e5; /* focus:border-indigo-500 */
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2); /* focus:ring-indigo-200 */
        }
        
        /* íŠ¹ì • ë„ˆë¹„ ì…ë ¥ì°½ */
        .level-count-input {
            width: 4rem; /* w-16 */
            text-align: right;
        }
        .weight-input {
            width: 6rem; /* w-24 */
            text-align: right;
        }
        .rate-input {
            width: 5rem; /* w-20 */
            text-align: right;
        }

        /* ê³„ì‚° ê²°ê³¼ ì¶œë ¥ */
        .calc-output {
            font-weight: 600; /* font-semibold */
            color: #2563eb; /* text-blue-600 */
            display: block; /* ë°°ìˆ˜ í‘œì‹œë¥¼ ìœ„í•´ blockìœ¼ë¡œ ë³€ê²½ */
        }
        .calc-output-lg {
            font-weight: 700; /* font-bold */
            color: #1d4ed8; /* text-blue-700 */
            font-size: 1.125rem; /* text-lg */
        }
        
        /* KPI ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .kpi-box {
            background-color: #f9fafb; /* gray-50 */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem; /* p-4 */
        }
        .kpi-title {
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #6b7280; /* text-gray-500 */
            margin-bottom: 0.25rem; /* mb-1 */
        }
        .kpi-value {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #1f2937; /* text-gray-900 */
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem; /* text-sm */
        }
        th, td {
            border: 1px solid #e5e7eb; /* border-gray-200 */
            padding: 0.75rem; /* p-3 */
            text-align: right;
            white-space: nowrap;
        }
        th {
            background-color: #f9fafb; /* gray-50 */
            font-weight: 600; /* font-semibold */
            color: #374151; /* text-gray-700 */
        }
        td:first-child, th:first-child {
            text-align: left;
            font-weight: 500; /* font-medium */
            background-color: #f9fafb; /* gray-50 */
        }
        tfoot td {
            font-weight: 700; /* font-bold */
            background-color: #f3f4f6; /* gray-100 */
        }
        /* P&L í…Œì´ë¸” ì…ë ¥/ì¶œë ¥ */
        .pl-table-input {
            width: 100%;
            min-width: 6rem; /* w-24 */
            text-align: right;
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.25rem 0.5rem; /* px-2 py-1 */
        }
        .pl-table-input:disabled {
            background-color: #e5e7eb; /* bg-gray-200 */
            color: #4b5563; /* text-gray-600 */
            font-weight: 500; /* font-medium */
            border: none;
        }
        .pl-table-output {
            display: block;
            min-height: 1.5rem; /* h-6 */
            padding-right: 0.5rem; /* pr-2 */
            font-weight: 500; /* font-medium */
            color: #111827; /* text-gray-900 */
        }
        .relative-multiplier {
            font-size: 0.75rem; /* text-xs (ê¸°ì¡´ í°íŠ¸ë³´ë‹¤ 20% ì‘ì€ ê¸€ì) */
            color: #1f2937; /* text-gray-800 (ê²€ì •ìƒ‰) */
            font-weight: 500;
            display: block; /* í•­ìƒ ìƒˆ ì¤„ì— í‘œì‹œ */
        }
        
        /* Tab2 ì§ì› í…Œì´ë¸” Tier ì»¬ëŸ¼ ìŠ¤íƒ€ì¼ */
        #employeeTableBody td:nth-child(4) {
            min-width: 90px; /* Tier ì»¬ëŸ¼ ìµœì†Œ ë„ˆë¹„ */
            padding: 0.5rem; /* íŒ¨ë”© ì¡°ì • */
        }
        
        /* Tab2 í…Œì´ë¸” ë‚´ select ìŠ¤íƒ€ì¼ ê°œì„  */
        #employeeTableBody select.input-base {
            min-width: 75px; /* ìµœì†Œ ë„ˆë¹„ */
            width: 100%; /* ì…€ ë„ˆë¹„ì— ë§ì¶¤ */
            padding: 0.375rem 0.5rem; /* íŒ¨ë”© */
            font-size: 0.875rem; /* í°íŠ¸ í¬ê¸° */
            text-align: center; /* ì¤‘ì•™ ì •ë ¬ */
            font-weight: 500; /* í°íŠ¸ ë‘ê»˜ */
        }

        /* T5 ì¸ì›ìˆ˜ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ (í…Œì´ë¸” ì…€ì— ì§ì ‘ ì ìš©) */
        .t5-input-in-table {
            width: 100%;
            min-width: 4rem; /* level-count-inputê³¼ ìœ ì‚¬í•˜ê²Œ ì„¤ì • */
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.25rem 0.5rem;
            text-align: right;
            /* ë°°ê²½ìƒ‰ì„ í°ìƒ‰ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì…ë ¥ ê°€ëŠ¥í•œ í•„ë“œì²˜ëŸ¼ ë³´ì´ê²Œ í•¨ */
            background-color: white; 
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .t5-input-in-table:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        
        /* ë¦¬ë” ë·° ìŠ¤íƒ€ì¼ */
        .leader-view .detailed-section {
            display: none;
        }
        
        .leader-view .kpi-box {
            transform: scale(1.1);
            margin: 1.5rem 0;
        }
        
        .collapsible-section {
            transition: all 0.3s ease;
        }
        
        .collapse-toggle {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
        }
        
        .collapse-toggle:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .collapse-toggle .arrow {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
        }
        
        .collapse-toggle.collapsed .arrow {
            transform: rotate(-90deg);
        }
        
        .collapsible-content {
            max-height: 5000px;
            overflow: hidden;
            transition: max-height 0.5s ease, opacity 0.3s ease, margin 0.3s ease;
            opacity: 1;
        }
        
        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin: 0;
        }
        
        /* ë¦¬ë” ë·° ì „ìš© KPI ê°•ì¡° */
        .leader-kpi-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
        }
        
    </style>
</head>
<body class="bg-gray-100">

    <div class="container max-w-5xl mx-auto p-4 md:p-8">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-3xl font-bold text-gray-800">
                ì¸ì„¼í‹°ë¸Œ ì‹œë®¬ë ˆì´í„° (v9)
            </h1>
            <div class="flex items-center gap-3">
                <span class="text-sm text-gray-600">ë·° ëª¨ë“œ:</span>
                <button id="toggleViewMode" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium shadow-sm">
                    ğŸ“Š ë¦¬ë” ë·°
                </button>
            </div>
        </div>
        <p class="text-center text-sm text-gray-500 mb-6">
            <span id="viewModeDescription">ë¦¬ë” í”„ë ˆì  í…Œì´ì…˜ ìµœì í™” ë·° - í•µì‹¬ ê²°ê³¼ ì¤‘ì‹¬</span>
        </p>

        <!-- Tab Navigation -->
        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="flex -mb-px" aria-label="Tabs">
                    <button id="tab1-button" 
                            class="tab-button w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm cursor-pointer transition-colors duration-200 border-indigo-500 text-indigo-600">
                        ì¸ì„¼í‹°ë¸Œ ì‹œë®¬ë ˆì´í„° (Step 1-3)
                    </button>
                    <button id="tab2-button"
                            class="tab-button w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm cursor-pointer transition-colors duration-200 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        ìŠˆí¼ìº£ ì¸ì› ê´€ë¦¬
                    </button>
                </nav>
            </div>
        </div>

        <!-- Tab Content -->
        <div id="tab1-content">
            <!-- #################### -->
            <!-- STEP 1: P&L ì¬ì› ì„¤ì • -->
        <!-- #################### -->
        <div class="card">
            <h2 class="step-title">Step 1: P&L ì¬ì› ì„¤ì • ë° ì¶”ì •</h2>
            <div class="card-content space-y-6">
                
                <!-- ë¦¬ë” ë·°: í•µì‹¬ ì§€í‘œ ìš”ì•½ (í•­ìƒ í‘œì‹œ) -->
                <div class="leader-kpi-highlight leader-view-only" style="display:none;">
                    <h3 class="text-2xl font-bold mb-4">ğŸ“Š í•µì‹¬ ì¬ë¬´ ì§€í‘œ</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-sm opacity-90">ì´ íˆ¬ìë¹„</div>
                            <div id="leader_total_investment" class="text-3xl font-bold mt-1">-</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm opacity-90">ì˜ì—…ì´ìµ (ê¸°ì¤€ ê¸°ê°„)</div>
                            <div id="leader_operating_profit" class="text-3xl font-bold mt-1">-</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm opacity-90">ROI</div>
                            <div id="leader_roi" class="text-3xl font-bold mt-1">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- ìƒì„¸ ì„¤ì • í† ê¸€ -->
                <div class="collapse-toggle collapsed detailed-section" onclick="toggleCollapse(this)">
                    <div>
                        <span class="font-semibold text-gray-700">ğŸ”§ ìƒì„¸ P&L ì„¤ì •</span>
                        <span class="text-sm text-gray-500 ml-2">(í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°/ì ‘ê¸°)</span>
                    </div>
                    <span class="arrow">â–¼</span>
                </div>
                
                <!-- P&L ì„¤ì • (ì…ë ¥) -->
                <section class="collapsible-content collapsed detailed-section">
                    <h3 class="section-title">P&L ì„¤ì •</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ -->
                        <div>
                            <label for="revenueScenario" class="block text-sm font-medium text-gray-700 mb-1">ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤</label>
                            <select id="revenueScenario" class="input-base">
                                <option value="base">Base (ê¸°ë³¸)</option>
                                <option value="best" selected>Best</option>
                                <option value="worst">Worst</option>
                            </select>
                        </div>
                        <!-- ì´ íˆ¬ìë¹„ -->
                        <div>
                            <label for="total_investment_slider" class="block text-sm font-medium text-gray-700 mb-1">
                                ì´ íˆ¬ìë¹„ (ê°œë°œë¹„+ë³´ë„ˆìŠ¤): <span id="total_investment_display" class="font-bold text-indigo-600">397ì–µì›</span>
                            </label>
                            <input type="range" id="total_investment_slider" min="0" max="377" value="377" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <!-- MG (ì„ ìˆ˜ê¸ˆ) -->
                        <div>
                            <label for="mg_slider" class="block text-sm font-medium text-gray-700 mb-1">
                                MG ì„ ìˆ˜ê¸ˆ (ìƒí™˜ í•„ìš”): <span id="mg_display" class="font-bold text-orange-600">100ì–µì›</span>
                            </label>
                            <input type="range" id="mg_slider" min="0" max="100" value="100" step="5" class="w-full h-2 bg-orange-200 rounded-lg appearance-none cursor-pointer">
                            <p class="text-xs text-gray-500 mt-1">â€» ìˆœë§¤ì¶œì—ì„œ ìš°ì„  ìƒí™˜ë˜ëŠ” ì„ ìˆ˜ê¸ˆ ê¸ˆì•¡ (0~100ì–µì›)</p>
                        </div>
                        <!-- ìƒê° ê¸°ê°„ -->
                        <div>
                            <label for="amortization_periods" class="block text-sm font-medium text-gray-700 mb-1">ìƒê° ê¸°ê°„ (Period)</label>
                            <select id="amortization_periods" class="input-base">
                                <option value="1">1 Period</option>
                                <option value="2" selected>2 Period</option>
                                <option value="3">3 Period</option>
                                <option value="4">4 Period</option>
                                <option value="5">5 Period</option>
                                <option value="6">6 Period</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ë¡œì§ -->
                <section>
                    <h3 class="section-title">ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ë¡œì§ (ìˆ˜ì • ê°€ëŠ¥)</h3>
                    <p class="text-sm text-gray-600 mb-4 -mt-3">
                        ì—¬ê¸°ì„œ ì„¤ì •í•œ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ 'Base', 'Best', 'Worst' ì‹œë‚˜ë¦¬ì˜¤ê°€ ìë™ ìƒì„±ë˜ë©°, 'P&L ì„¤ì •'ì˜ ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒí•œ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì•„ë˜ P&L ì¶”ì • í…Œì´ë¸”ì— ë°˜ì˜ë©ë‹ˆë‹¤.
                    </p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                        <!-- Base P1 -->
                        <div>
                            <label for="base_p1_revenue" class="block text-sm font-medium text-gray-700 mb-1">Base P1 ë§¤ì¶œ (ì–µì›)</label>
                            <input type="number" id="base_p1_revenue" value="1000" class="input-base">
                        </div>
                        <!-- Best Multiplier -->
                        <div>
                            <label for="best_multiplier" class="block text-sm font-medium text-gray-700 mb-1">Best ë°°ìœ¨ (Base ëŒ€ë¹„ %)</label>
                            <input type="number" id="best_multiplier" value="150" class="input-base">
                        </div>
                        <!-- Worst Multiplier -->
                        <div>
                            <label for="worst_multiplier" class="block text-sm font-medium text-gray-700 mb-1">Worst ë°°ìœ¨ (Base ëŒ€ë¹„ %)</label>
                            <input type="number" id="worst_multiplier" value="50" class="input-base">
                        </div>
                        <!-- P2 Retention -->
                        <div>
                            <label for="p2_retention" class="block text-sm font-medium text-gray-700 mb-1">P2 ë§¤ì¶œ ìœ ì§€ìœ¨ (%)</label>
                            <input type="number" id="p2_retention" value="60" class="input-base">
                        </div>
                        <!-- P3 Retention -->
                        <div>
                            <label for="p3_retention" class="block text-sm font-medium text-gray-700 mb-1">P3 ë§¤ì¶œ ìœ ì§€ìœ¨ (%)</label>
                            <input type="number" id="p3_retention" value="85" class="input-base">
                        </div>
                        <!-- P4 Retention -->
                        <div>
                            <label for="p4_retention" class="block text-sm font-medium text-gray-700 mb-1">P4 ë§¤ì¶œ ìœ ì§€ìœ¨ (%)</label>
                            <input type="number" id="p4_retention" value="85" class="input-base">
                        </div>
                    </div>
                </section>
                
                <!-- P&L ì¶”ì • í…Œì´ë¸” -->
                <section>
                    <h3 class="section-title">P&L ì¶”ì • (ë‹¨ìœ„: ì–µì›)</h3>
                    <!-- ì„¤ëª… í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ -->
                    <p id="amortization_desc" class="text-sm text-gray-600 mb-3 p-3 bg-gray-50 rounded-md">
                        -
                    </p>
                    <p class="text-sm text-gray-600 mb-3 p-3 bg-indigo-50 border border-indigo-200 rounded-md">
                        â€» **ìˆœë§¤ì¶œ ë°°ë¶„ìœ¨ ì ìš©:** 'ë°°ë¶„ ì „ ìˆœë§¤ì¶œ(ë§¤ì¶œ G * 70%)'ì— **'ëˆ„ì  ë§¤ì¶œ(G)'**ì„ ê¸°ì¤€ìœ¼ë¡œ í•œ ë°°ë¶„ìœ¨ì´ **êµ¬ê°„ë³„ë¡œ ì°¨ë“± ì ìš©**ë©ë‹ˆë‹¤: <br>
                        - <span class="font-bold">ëˆ„ì  ë§¤ì¶œ(G) 3,000ì–µì› ì´í•˜ êµ¬ê°„ë¶„: 45%</span> <br>
                        - <span class="font-bold">ëˆ„ì  ë§¤ì¶œ(G) 3,000ì–µì› ì´ˆê³¼ ~ 5,000ì–µì› ì´í•˜ êµ¬ê°„ë¶„: 50%</span> <br>
                        - <span class="font-bold">ëˆ„ì  ë§¤ì¶œ(G) 5,000ì–µì› ì´ˆê³¼ êµ¬ê°„ë¶„: 55%</span>
                    </p>
                    <p class="text-sm text-gray-600 mb-3 p-3 bg-yellow-50 border border-yellow-300 rounded-md">
                        âš ï¸ **ì¸ì„¼í‹°ë¸Œ ê³„ì‚° ë°©ì‹ (ROI êµ¬ê°„ë³„ ì°¨ë“±):**<br>
                        - <span class="font-bold text-red-600">ROI < 100% (BEP ë¯¸ë‹¬):</span> ìˆœë§¤ì¶œ(S)ì˜ 2% (ìµœì†Œ ë³´ì¥)<br>
                        - <span class="font-bold text-green-600">ROI â‰¥ 100% (BEP ë‹¬ì„±):</span> ì˜ì—…ì´ìµ * ì¸ì„¼ ë¹„ìœ¨ (ROI êµ¬ê°„ë³„ ì°¨ë“± ì ìš©)
                    </p>
                    <p class="text-sm text-gray-600 mb-3 p-3 bg-red-50 border border-red-300 rounded-md">
                        ğŸ’° **MG(Minimum Guarantee) ìƒí™˜ ë¡œì§:**<br>
                        - <span class="font-bold">ì„ ìˆ˜ê¸ˆ 100ì–µì›</span>ì„ ì‚¬ì „ì— ë°›ì•˜ìœ¼ë©°, ì´ëŠ” ìˆœë§¤ì¶œì—ì„œ ìš°ì„  ìƒí™˜ë©ë‹ˆë‹¤.<br>
                        - ê° Periodì˜ ìˆœë§¤ì¶œ(S)ì€ <span class="font-bold text-red-600">MG ì”ì•¡ì´ 0ì´ ë  ë•Œê¹Œì§€ ìš°ì„  ìƒí™˜</span>ì— ì‚¬ìš©ë©ë‹ˆë‹¤.<br>
                        - MGê°€ ì™„ì „íˆ ìƒí™˜ëœ í›„ë¶€í„° ìˆœë§¤ì¶œì´ ì‹¤ì œ ì´ìµìœ¼ë¡œ ì¸ì •ë©ë‹ˆë‹¤.<br>
                        - ì˜ˆ: P1 ìˆœë§¤ì¶œ 50ì–µ â†’ MG ìƒí™˜ 50ì–µ, ì‹¤ì œ ìˆœë§¤ì¶œ 0ì–µ (MG ì”ì•¡ 50ì–µ)
                    </p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th>ê¸°ê°„</th>
                                    <th>ë§¤ì¶œ(G)</th>
                                    <th>ë°°ë¶„ ì „</th>
                                    <th>ìˆœë§¤ì¶œ(S)</th>
                                    <th>ì´ íˆ¬ìë¹„ ìƒê°</th>
                                    <th>ìš´ì˜ë¹„</th>
                                    <th>ë¹„ìš© í•©ê³„</th>
                                    <th>ì˜ì—…ì´ìµ</th>
                                    <th>ëˆ„ì ë¹„ìš©</th>
                                    <th>ëˆ„ì ì˜ì—…ìµ</th>
                                    <th>ROI(%)</th>
                                    <th>ì¸ì„¼ ë¹„ìœ¨(%)</th>
                                    <th class="bg-yellow-50">ì¸ì„¼í‹°ë¸Œ</th>
                                    <th class="bg-green-50">OQìˆœì´ìµ</th>
                                    <th class="bg-blue-50">OQì™¸ ë¹„ìš©</th>
                                    <th class="bg-purple-50 font-bold">ë‹¹ê¸°ìˆœì´ìµ</th>
                                    <th class="bg-purple-100 font-bold">ëˆ„ì  ë‹¹ê¸°ìˆœì´ìµ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Period 1 -->
                                <tr>
                                    <td>Period 1</td>
                                    <td><input type="text" id="p1_revenue" class="pl-table-input" disabled></td>
                                    <td><span id="p1_pre_dist" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p1_supercat_net" class="pl-table-output calc-output">-</span></td>
                                    <td><input type="text" id="p1_amortization" class="pl-table-input" disabled></td>
                                    <td><input type="number" id="p1_op_cost" class="pl-table-input" value="67"></td>
                                    <td><span id="p1_total_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p1_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p1_cum_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p1_cum_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p1_roi" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p1_incentive_rate" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-yellow-50"><span id="p1_incentive_amount" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-green-50 font-semibold"><span id="p1_oq_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-blue-50"><input type="number" id="p1_non_oq_cost" class="pl-table-input" value="42.5"></td>
                                    <td class="bg-purple-50 font-bold"><span id="p1_net_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-purple-100 font-bold"><span id="p1_cum_net_profit" class="pl-table-output calc-output">-</span></td>
                                </tr>
                                <!-- Period 2 -->
                                <tr>
                                    <td>Period 2</td>
                                    <td><input type="text" id="p2_revenue" class="pl-table-input" disabled></td>
                                    <td><span id="p2_pre_dist" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p2_supercat_net" class="pl-table-output calc-output">-</span></td>
                                    <td><input type="text" id="p2_amortization" class="pl-table-input" disabled></td>
                                    <td><input type="number" id="p2_op_cost" class="pl-table-input" value="67"></td>
                                    <td><span id="p2_total_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p2_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p2_cum_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p2_cum_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p2_roi" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p2_incentive_rate" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-yellow-50"><span id="p2_incentive_amount" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-green-50 font-semibold"><span id="p2_oq_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-blue-50"><input type="number" id="p2_non_oq_cost" class="pl-table-input" value="37.5"></td>
                                    <td class="bg-purple-50 font-bold"><span id="p2_net_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-purple-100 font-bold"><span id="p2_cum_net_profit" class="pl-table-output calc-output">-</span></td>
                                </tr>
                                <!-- Period 3 -->
                                <tr>
                                    <td>Period 3</td>
                                    <td><input type="text" id="p3_revenue" class="pl-table-input" disabled></td>
                                    <td><span id="p3_pre_dist" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p3_supercat_net" class="pl-table-output calc-output">-</span></td>
                                    <td><input type="text" id="p3_amortization" class="pl-table-input" disabled></td>
                                    <td><input type="number" id="p3_op_cost" class="pl-table-input" value="67"></td>
                                    <td><span id="p3_total_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p3_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p3_cum_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p3_cum_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p3_roi" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p3_incentive_rate" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-yellow-50"><span id="p3_incentive_amount" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-green-50 font-semibold"><span id="p3_oq_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-blue-50"><input type="number" id="p3_non_oq_cost" class="pl-table-input" value="37.5"></td>
                                    <td class="bg-purple-50 font-bold"><span id="p3_net_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-purple-100 font-bold"><span id="p3_cum_net_profit" class="pl-table-output calc-output">-</span></td>
                                </tr>
                                <!-- Period 4 -->
                                <tr>
                                    <td>Period 4</td>
                                    <td><input type="text" id="p4_revenue" class="pl-table-input" disabled></td>
                                    <td><span id="p4_pre_dist" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p4_supercat_net" class="pl-table-output calc-output">-</span></td>
                                    <td><input type="text" id="p4_amortization" class="pl-table-input" disabled></td>
                                    <td><input type="number" id="p4_op_cost" class="pl-table-input" value="67"></td>
                                    <td><span id="p4_total_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p4_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p4_cum_cost" class="pl-table-output">-</span></td>
                                    <td><span id="p4_cum_profit" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p4_roi" class="pl-table-output calc-output">-</span></td>
                                    <td><span id="p4_incentive_rate" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-yellow-50"><span id="p4_incentive_amount" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-green-50 font-semibold"><span id="p4_oq_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-blue-50"><input type="number" id="p4_non_oq_cost" class="pl-table-input" value="37.5"></td>
                                    <td class="bg-purple-50 font-bold"><span id="p4_net_profit" class="pl-table-output calc-output">-</span></td>
                                    <td class="bg-purple-100 font-bold"><span id="p4_cum_net_profit" class="pl-table-output calc-output">-</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- ROI êµ¬ê°„ë³„ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ì„¤ì • -->
                <section>
                    <h3 class="section-title">ROI êµ¬ê°„ë³„ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ì„¤ì •</h3>
                    <p class="text-sm text-gray-600 mb-4 -mt-3 p-3 bg-indigo-50 border border-indigo-200 rounded-md">
                        â€» ROI(ëˆ„ì  ìˆœë§¤ì¶œ / ì´ ëˆ„ì  ë¹„ìš©) êµ¬ê°„ì— ë”°ë¼ ì ìš©ë˜ëŠ” ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ì„ ì„¤ì •í•©ë‹ˆë‹¤.<br>
                        â€» ìµœì¢… ì¸ì„¼í‹°ë¸Œ ì¬ì› = <strong>ëˆ„ì  ì˜ì—…ì´ìµ Ã— ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨(%)</strong>
                    </p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th>ROI êµ¬ê°„ (%)</th>
                                    <th>ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ (%)</th>
                                    <th>ì„¤ëª…</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>0% ~ 100%</td>
                                    <td><input type="number" id="roi_rate_0_100" value="2" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 100% ì´í•˜</td>
                                </tr>
                                <tr>
                                    <td>100% ì´ˆê³¼ ~ 150%</td>
                                    <td><input type="number" id="roi_rate_100_150" value="10" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 100% ì´ˆê³¼ 150% ì´í•˜</td>
                                </tr>
                                <tr>
                                    <td>150% ì´ˆê³¼ ~ 200%</td>
                                    <td><input type="number" id="roi_rate_150_200" value="20" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 150% ì´ˆê³¼ 200% ì´í•˜</td>
                                </tr>
                                <tr>
                                    <td>200% ì´ˆê³¼ ~ 300%</td>
                                    <td><input type="number" id="roi_rate_200_300" value="25" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 200% ì´ˆê³¼ 300% ì´í•˜</td>
                                </tr>
                                <tr>
                                    <td>300% ì´ˆê³¼</td>
                                    <td><input type="number" id="roi_rate_300_plus" value="30" min="0" max="100" step="0.5" class="input-base rate-input"></td>
                                    <td class="text-left">ROI 300% ì´ˆê³¼</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                </section>
                <!-- collapsible-content ë‹«ê¸° -->
            </div>
        </div>

        <!-- ######################### -->
        <!-- STEP 2: ì¸ì„¼í‹°ë¸Œ ë° ë³´ë„ˆìŠ¤ ì„¤ì • -->
        <!-- ######################### -->
        <div class="card">
            <h2 class="step-title">Step 2: ì¸ì„¼í‹°ë¸Œ ë° ë³´ë„ˆìŠ¤ ì„¤ì •</h2>
            <div class="card-content space-y-6">
                
                <!-- ë¦¬ë” ë·°: í•µì‹¬ ì„¤ì • ìš”ì•½ -->
                <div class="leader-kpi-highlight leader-view-only" style="display:none;">
                    <h3 class="text-2xl font-bold mb-4">ğŸ¯ ì¸ì„¼í‹°ë¸Œ ë°°ë¶„ ì „ëµ</h3>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <div class="text-sm opacity-90 mb-2">ì´ ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ì¬ì›</div>
                            <div id="leader_incentive_pool" class="text-3xl font-bold">-</div>
                        </div>
                        <div>
                            <div class="text-sm opacity-90 mb-2">ì´ ëŸ°ì¹­ ë³´ë„ˆìŠ¤</div>
                            <div id="leader_launch_bonus" class="text-3xl font-bold">-</div>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/20">
                        <div class="text-sm opacity-90">Tier ë°°ìœ¨ ë¡œì§ì„ í†µí•œ ì •êµí•œ ë°°ë¶„ ì‹œìŠ¤í…œ ì ìš©</div>
                        <div class="text-xs opacity-75 mt-1">â€¢ Level ê°€ì¤‘ì¹˜ ë°˜ì˜ â€¢ ì—­ì „ í˜„ìƒ ë°©ì§€ â€¢ ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡ ë¶„ë¦¬</div>
                    </div>
                </div>
                
                <!-- ìƒì„¸ ì„¤ì • í† ê¸€ -->
                <div class="collapse-toggle collapsed detailed-section" onclick="toggleCollapse(this)">
                    <div>
                        <span class="font-semibold text-gray-700">ğŸ”§ ìƒì„¸ ë°°ë¶„ ì„¤ì •</span>
                        <span class="text-sm text-gray-500 ml-2">(ê°€ì¤‘ì¹˜, Tier ë°°ìœ¨, ì¸ì› í…Œì´ë¸”)</span>
                    </div>
                    <span class="arrow">â–¼</span>
                </div>
                
                <!-- ê°€ì¤‘ì¹˜ ì„¤ì • -->
                <section class="collapsible-content collapsed detailed-section">
                    <h3 class="section-title">Levelë³„ ê°€ì¤‘ì¹˜ ì„¤ì •</h3>
                    <p class="text-sm text-gray-600 mb-4 -mt-3">â€» Level: í•´ë‹¹ í”„ë¡œì íŠ¸ì— ì¢…ì‚¬í•œ ê¸°ê°„ì— ë”°ë¥¸ êµ¬ë¶„</p>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                        <div>
                            <label for="w1" class="block text-sm font-medium text-gray-700 mb-1">
                                L1 <span class="font-normal text-gray-500">(6ê°œì›” ë¯¸ë§Œ)</span>
                            </label>
                            <input type="number" id="w1" value="0.2" step="0.1" class="input-base weight-input">
                        </div>
                        <div>
                            <label for="w2" class="block text-sm font-medium text-gray-700 mb-1">
                                L2 <span class="font-normal text-gray-500">(6-12ê°œì›”)</span>
                            </label>
                            <input type="number" id="w2" value="0.6" step="0.1" class="input-base weight-input">
                        </div>
                        <div>
                            <label for="w3" class="block text-sm font-medium text-gray-700 mb-1">
                                L3 <span class="font-normal text-gray-500">(1ë…„ ì´ìƒ)</span>
                            </label>
                            <input type="number" id="w3" value="1.0" step="0.1" class="input-base weight-input">
                        </div>
                    </div>
                </section>

                <!-- ì„±ê³¼ë³´ìƒ ëŒ€ìƒ ì¸ì› -->
                <section>
                    <h3 class="section-title">ì„±ê³¼ë³´ìƒ ëŒ€ìƒ ì¸ì› (T1-T6)</h3>
                    
                    <p class="text-sm text-gray-600 mb-4 -mt-3 p-3 bg-blue-50 rounded-md border border-blue-200">
                        <strong class="text-blue-800">ğŸ“Š ìë™ ê³„ì‚°:</strong> ì•„ë˜ ì¸ì›ì€ <strong>Tab 2 (ìŠˆí¼ìº£ ì¸ì› ê´€ë¦¬)</strong>ì˜ ì‹¤ì œ ì‚¬ì› ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
                        â€» Tab 2ì—ì„œ ì‚¬ì›ì„ ì¶”ê°€/ì‚­ì œ/ìˆ˜ì •í•˜ë©´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.<br>
                        â€» TierëŠ” ì—­ëŸ‰ì— ë”°ë¥¸ 6ë‹¨ê³„ êµ¬ë¶„ì´ë©°, ì´ ì¸ì› ëŒ€ë¹„ ë¹„ìœ¨ ì œí•œì´ ìˆìŠµë‹ˆë‹¤.<br>
                        - <span class="font-semibold">T1 (ìµœìƒìœ„):</span> ì´ ì¸ì›ì˜ 5% ë¯¸ë§Œ<br>
                        - <span class="font-semibold">T2 (ìƒìœ„):</span> ì´ ì¸ì›ì˜ 10% ë¯¸ë§Œ<br>
                        - <span class="font-semibold">T3 (ì¤‘ìƒìœ„):</span> ì´ ì¸ì›ì˜ 20% ë¯¸ë§Œ<br>
                        - <span class="font-semibold">T1+T2+T3 í•©ê³„:</span> ì´ ì¸ì›ì˜ 35% ì´í•˜
                    </p>
                    
                    <div id="headcountWarning" class="text-red-600 font-semibold my-3 p-3 bg-red-50 border border-red-200 rounded-md text-sm hidden">
                        <!-- ê²½ê³  ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤. -->
                    </div>

                    <div class="overflow-x-auto">
                        <table>
                            <thead>
                                <tr>
                                    <th>êµ¬ë¶„</th>
                                    <th>L1 <span class="font-normal text-gray-500">(6ê°œì›” ë¯¸ë§Œ)</span></th>
                                    <th>L2 <span class="font-normal text-gray-500">(6-12ê°œì›”)</span></th>
                                    <th>L3 <span class="font-normal text-gray-500">(1ë…„ ì´ìƒ)</span></th>
                                    <th class="bg-indigo-50">Tierë³„ ì´ ì¸ì›</th>
                                    <th class="bg-blue-50">ì¸ì› ë¹„ìœ¨ ë° ê²€ì¦</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- T1 -->
                                <tr>
                                    <td>T1 (1st Tier)</td>
                                    <td><input type="number" id="t1_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t1_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t1_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t1_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t1_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T2 -->
                                <tr>
                                    <td>T2 (2nd Tier)</td>
                                    <td><input type="number" id="t2_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t2_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t2_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t2_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t2_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T3 -->
                                <tr>
                                    <td>T3 (3rd Tier)</td>
                                    <td><input type="number" id="t3_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t3_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t3_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t3_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t3_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T4 -->
                                <tr>
                                    <td>T4 (ì¤‘í•˜ìœ„)</td>
                                    <td><input type="number" id="t4_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t4_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t4_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t4_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t4_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T5 -->
                                <tr>
                                    <td>T5 (í•˜ìœ„)</td>
                                    <td><input type="number" id="t5_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t5_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t5_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t5_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t5_validation" class="font-semibold">-</span></td>
                                </tr>
                                <!-- T6 -->
                                <tr>
                                    <td>T6 (ìµœí•˜ìœ„)</td>
                                    <td><input type="number" id="t6_l1" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t6_l2" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td><input type="number" id="t6_l3" value="0" class="input-base level-count-input bg-gray-100" readonly></td>
                                    <td class="bg-indigo-50 font-bold text-indigo-700"><span id="t6_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t6_validation" class="font-semibold">-</span></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="bg-gray-100 font-bold">
                                    <td>Levelë³„ ì´ ì¸ì›</td>
                                    <td class="text-gray-700"><span id="level_l1_total">0</span></td>
                                    <td class="text-gray-700"><span id="level_l2_total">0</span></td>
                                    <td class="text-gray-700"><span id="level_l3_total">0</span></td>
                                    <td class="bg-indigo-100 text-indigo-800 text-lg"><span id="headcount_grand_total">0</span></td>
                                    <td class="bg-blue-50"><span id="t123_validation" class="font-semibold">-</span></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </section>

                <!-- ì‹œë®¬ë ˆì´ì…˜ ê¸°ì¤€ -->
                <section>
                    <h3 class="section-title">ì‹œë®¬ë ˆì´ì…˜ ê¸°ì¤€</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="periodSelect" class="block text-sm font-medium text-gray-700 mb-1">ê¸°ì¤€ ê¸°ê°„ ì„ íƒ</label>
                            <select id="periodSelect" class="input-base">
                                <option value="p1">Period 1</option>
                                <option value="p2">Period 2</option>
                                <option value="p3" selected>Period 3</option>
                                <option value="p4">Period 4</option>
                            </select>
                        </div>
                        <div>
                            <label for="launchBonusSlider" class="block text-sm font-medium text-gray-700 mb-1">
                                ì´ ëŸ°ì¹­ ë³´ë„ˆìŠ¤: <span id="launchBonusDisplay" class="font-bold text-indigo-600">10ì–µì›</span>
                            </label>
                            <input type="range" id="launchBonusSlider" min="1" max="50" value="10" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>
                    <div class="mt-6 p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡ ì„¤ì •</h4>
                        <div class="space-y-2">
                            <label for="leaderDiscretionSlider" class="block text-sm font-medium text-gray-700">
                                ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡: <span id="leaderDiscretionDisplay" class="font-bold text-yellow-600">0%</span> (ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ í’€ì˜ ë¹„ìœ¨)
                            </label>
                            <input type="range" id="leaderDiscretionSlider" min="0" max="15" value="0" step="0.5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <p class="text-sm text-gray-600 mt-2">
                                * ë¦¬ë”ê°€ ì¬ëŸ‰ìœ¼ë¡œ ë°°ë¶„í•  ìˆ˜ ìˆëŠ” ê¸ˆì•¡ì…ë‹ˆë‹¤. ì „ì²´ ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ í’€ì—ì„œ í•´ë‹¹ ë¹„ìœ¨ë§Œí¼ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ë¥¼ ìë™ ë°°ë¶„í•©ë‹ˆë‹¤.<br>
                                * ì˜ˆ: ì´ ì¸ì„¼í‹°ë¸Œ 100ì–µì›, ë¦¬ë” ì¬ëŸ‰ 10% â†’ 10ì–µì›ì€ ë¦¬ë” ì¬ëŸ‰, 90ì–µì›ì„ ìë™ ë°°ë¶„
                            </p>
                        </div>
                    </div>
                </section>

                <!-- ğŸ†• ë°°ë¶„ìœ¨ ì„¤ì • (ë¡œì§ ìˆ˜ì •) -->
                <section>
                    <h3 class="section-title">ë°°ë¶„ ì„¤ì •</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë°°ìœ¨ -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3 text-indigo-700">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ Tierê°„ ë°°ìœ¨ ì„¤ì •</h4>
                            <p class="text-sm text-gray-600 mb-4 -mt-1 p-3 bg-indigo-50 rounded-md">
                                â€» T6 ëŒ€ë¹„ ê° Tierì˜ í‰ê·  ë³´ìƒ ìˆ˜ì¤€(%)ì„ ì„¤ì •í•©ë‹ˆë‹¤. (L3 ê¸°ì¤€)<br>
                                â€» <strong class="text-indigo-600">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë°°ë¶„</strong>ì— ì ìš©ë©ë‹ˆë‹¤.<br>
                                â€» T7ì€ ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¹„ì°¸ì—¬ìì…ë‹ˆë‹¤.
                            </p>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t6_t5_rate" class="block text-sm font-medium text-gray-700 w-24">T6 â†’ T5</label>
                                    <input type="number" id="pi_t6_t5_rate" value="300" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t5_t4_rate" class="block text-sm font-medium text-gray-700 w-24">T5 â†’ T4</label>
                                    <input type="number" id="pi_t5_t4_rate" value="20" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t4_t3_rate" class="block text-sm font-medium text-gray-700 w-24">T4 â†’ T3</label>
                                    <input type="number" id="pi_t4_t3_rate" value="30" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t3_t2_rate" class="block text-sm font-medium text-gray-700 w-24">T3 â†’ T2</label>
                                    <input type="number" id="pi_t3_t2_rate" value="100" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="pi_t2_t1_rate" class="block text-sm font-medium text-gray-700 w-24">T2 â†’ T1</label>
                                    <input type="number" id="pi_t2_t1_rate" value="200" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë°°ìœ¨ -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3 text-green-700">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ Tierê°„ ë°°ìœ¨ ì„¤ì •</h4>
                            <p class="text-sm text-gray-600 mb-4 -mt-1 p-3 bg-green-50 rounded-md">
                                â€» T6 ëŒ€ë¹„ ê° Tierì˜ í‰ê·  ë³´ìƒ ìˆ˜ì¤€(%)ì„ ì„¤ì •í•©ë‹ˆë‹¤. (L3 ê¸°ì¤€)<br>
                                â€» <strong class="text-green-600">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë°°ë¶„(T1-T6)</strong>ì— ì ìš©ë©ë‹ˆë‹¤.<br>
                                â€» ì„±ê³¼ ì¸ì„¼í‹°ë¸Œë³´ë‹¤ ì™„ë§Œí•œ ë°°ìœ¨ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
                            </p>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t6_t5_rate" class="block text-sm font-medium text-gray-700 w-24">T6 â†’ T5</label>
                                    <input type="number" id="lb_t6_t5_rate" value="150" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t5_t4_rate" class="block text-sm font-medium text-gray-700 w-24">T5 â†’ T4</label>
                                    <input type="number" id="lb_t5_t4_rate" value="15" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t4_t3_rate" class="block text-sm font-medium text-gray-700 w-24">T4 â†’ T3</label>
                                    <input type="number" id="lb_t4_t3_rate" value="20" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t3_t2_rate" class="block text-sm font-medium text-gray-700 w-24">T3 â†’ T2</label>
                                    <input type="number" id="lb_t3_t2_rate" value="50" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label for="lb_t2_t1_rate" class="block text-sm font-medium text-gray-700 w-24">T2 â†’ T1</label>
                                    <input type="number" id="lb_t2_t1_rate" value="100" class="input-base rate-input">
                                    <span class="text-sm text-gray-600">% ì¦ê°€</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                </section>
                <!-- collapsible-content ë‹«ê¸° -->
            </div>
        </div>

        <!-- ################### -->
        <!-- STEP 3: ìµœì¢… ë°°ë¶„ ê²°ê³¼ -->
        <!-- ################### -->
        <div class="card">
            <h2 class="step-title">Step 3: ìµœì¢… ë°°ë¶„ ê²°ê³¼</h2>
            <div class="card-content space-y-6">
                <!-- í•µì‹¬ ìš”ì•½ -->
                <section>
                    <h3 class="section-title">í•µì‹¬ ìš”ì•½ (KPI)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div class="kpi-box">
                            <div class="kpi-title">ì´ ì¸ì„¼í‹°ë¸Œ ì¬ì›</div>
                            <div id="totalIncentivePool" class="kpi-value">-</div>
                        </div>
                        <div class="kpi-box bg-yellow-50">
                            <div class="kpi-title">ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡</div>
                            <div id="leaderDiscretionAmountDisplay" class="kpi-value text-yellow-700">-</div>
                        </div>
                        <div class="kpi-box bg-green-50">
                            <div class="kpi-title">ìë™ ë°°ë¶„ ê¸ˆì•¡</div>
                            <div id="distributionIncentivePoolDisplay" class="kpi-value text-green-700">-</div>
                        </div>
                        <div class="kpi-box">
                            <div class="kpi-title">ëˆ„ì  ROI (ê¸°ì¤€ ê¸°ê°„)</div>
                            <div id="calculatedROI" class="kpi-value">-</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="kpi-box">
                            <div class="kpi-title">ì¸ì„¼ ë¹„ìœ¨ (ê¸°ì¤€ ê¸°ê°„)</div>
                            <div id="calculatedIncentiveRate" class="kpi-value">-</div>
                        </div>
                        <div class="kpi-box">
                            <div class="kpi-title">ì´ ëŸ°ì¹­ ë³´ë„ˆìŠ¤</div>
                            <div id="lb_total_incentive_distributed" class="kpi-value">-</div>
                        </div>
                    </div>
                    
                    <!-- ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¶„í•  ì§€ê¸‰ -->
                    <div class="mt-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-3 text-center">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¶„í•  ì§€ê¸‰ ê³„íš</h4>
                        <p class="text-sm text-gray-600 mb-3 text-center">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ëŠ” 3íšŒì— ê±¸ì³ ê· ë“± ë¶„í•  ì§€ê¸‰ë©ë‹ˆë‹¤ (ê° 33.33%)</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="kpi-box bg-white">
                                <div class="kpi-title text-sm">1ì°¨: 12ì›”ë§ ì§€ê¸‰</div>
                                <div id="lb_payment_1" class="kpi-value text-lg">-</div>
                            </div>
                            <div class="kpi-box bg-white">
                                <div class="kpi-title text-sm">2ì°¨: IBT í›„ ì§€ê¸‰</div>
                                <div id="lb_payment_2" class="kpi-value text-lg">-</div>
                            </div>
                            <div class="kpi-box bg-white">
                                <div class="kpi-title text-sm">3ì°¨: ëŸ°ì¹­ì‹œ ì§€ê¸‰</div>
                                <div id="lb_payment_3" class="kpi-value text-lg">-</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ìš”ì•½ í…ìŠ¤íŠ¸ ë° ë¹„ì°¸ì—¬ì -->
                <section>
                    <h3 class="section-title">ì¸ì› ìš”ì•½</h3>
                    <div class="p-4 bg-gray-50 rounded-lg mb-4 grid grid-cols-2 gap-4">
                        <p class="text-sm font-medium text-gray-700">
                            ì´ ì°¸ì—¬ì¸ì› (T1-T6): 
                            <span id="dynamic_total_headcount" class="font-bold text-lg text-indigo-600">0</span>ëª…
                        </p>
                        <p class="text-sm font-medium text-gray-700">
                            ì„±ê³¼ë³´ìƒ + ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ëŒ€ìƒ (T1-T6): 
                            <span id="dynamic_target_count" class="font-bold text-lg text-indigo-600">0</span>ëª…
                        </p>
                    </div>
                </section>

                <!-- ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë°°ë¶„ ê²°ê³¼ -->
                <section>
                    <h3 class="section-title">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë°°ë¶„ ê²°ê³¼ (T1-T6)</h3>
                    
                    <p class="text-sm text-gray-600 mb-4 -mt-3 p-3 bg-gray-50 rounded-md">
                        â€» <strong>Tier ë°°ìœ¨ ë¡œì§ ì ìš©:</strong> ì´ ì¬ì›ì„ T6-L3(ê¸°ì¤€ 1.0) ëŒ€ë¹„ Tierë³„ ì„¤ì •ëœ ë°°ìœ¨(ì˜ˆ: T5ëŠ” T6ë³´ë‹¤ 300% ë” ë°›ìŒ)ê³¼ Level ê°€ì¤‘ì¹˜ë¥¼ í•©ì‚°í•œ 'ì´ ë³´ìƒ ìœ ë‹›'ìœ¼ë¡œ ë‚˜ëˆˆ "ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡"ì„ ì‚°ì •í•©ë‹ˆë‹¤. ê°œì¸ë³„ ì§€ê¸‰ì•¡ì€ (ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡ * Tierë°°ìœ¨ * Levelê°€ì¤‘ì¹˜)ë¡œ ê³„ì‚°ë˜ì–´ "ì—­ì „ í˜„ìƒ"ì„ ë°©ì§€í•©ë‹ˆë‹¤.<br>
                        â€» <strong>[v5.1.3b] L2 ìµœì†Œ ë³´ìƒ ë³´ì •:</strong> `í•˜ìœ„ Tier L3` ì§€ê¸‰ì•¡ ëŒ€ë¹„ `í˜„ì¬ Tier L2` ì§€ê¸‰ì•¡ì´ 10% ì´ìƒì´ ë˜ë„ë¡ ë³´ìƒ ìœ ë‹›ì„ ìƒí–¥ ë³´ì •í•©ë‹ˆë‹¤.<br>
                        â€» <strong>ë¹„ìœ¨ í‘œì‹œ:</strong> ê° ì…€ì˜ ê´„í˜¸ ì•ˆ ë¹„ìœ¨ì€ <span class="font-bold text-indigo-600">T6-L3ë¥¼ 100%ë¡œ í•˜ëŠ” ì ˆëŒ€ ë°°ìœ¨</span>ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì˜ˆ: (400%) = T6-L3 ëŒ€ë¹„ 400% ìˆ˜ì¤€ (T5-L3), (100%) = T6-L3 ê¸°ì¤€
                    </p>

                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th>êµ¬ë¶„</th>
                                    <th>ì´ ì¸ì›</th>
                                    <th>ì´ì•¡ (ì›)</th>
                                    <th>L1 (1ì¸ë‹¹)</th>
                                    <th>L2 (1ì¸ë‹¹)</th>
                                    <th>L3 (1ì¸ë‹¹)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>T1 (1st Tier)</td>
                                    <td><span id="t1_total_count">-</span></td>
                                    <td><span id="t1_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t1_l1_value" class="calc-output">-</span><span id="t1_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t1_l2_value" class="calc-output">-</span><span id="t1_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t1_l3_value" class="calc-output">-</span><span id="t1_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T2 (2nd Tier)</td>
                                    <td><span id="t2_total_count">-</span></td>
                                    <td><span id="t2_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t2_l1_value" class="calc-output">-</span><span id="t2_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t2_l2_value" class="calc-output">-</span><span id="t2_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t2_l3_value" class="calc-output">-</span><span id="t2_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T3 (3rd Tier)</td>
                                    <td><span id="t3_total_count">-</span></td>
                                    <td><span id="t3_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t3_l1_value" class="calc-output">-</span><span id="t3_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t3_l2_value" class="calc-output">-</span><span id="t3_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t3_l3_value" class="calc-output">-</span><span id="t3_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T4 (ì¼ë°˜ íŒ€ì›)</td>
                                    <td><span id="t4_total_count">-</span></td>
                                    <td><span id="t4_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t4_l1_value" class="calc-output">-</span><span id="t4_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t4_l2_value" class="calc-output">-</span><span id="t4_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t4_l3_value" class="calc-output">-</span><span id="t4_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T5 (Base)</td>
                                    <td><span id="t5_total_count">-</span></td>
                                    <td><span id="t5_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t5_l1_value" class="calc-output">-</span><span id="t5_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t5_l2_value" class="calc-output">-</span><span id="t5_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t5_l3_value" class="calc-output">-</span><span id="t5_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                                <tr>
                                    <td>T6 (ìµœí•˜ìœ„)</td>
                                    <td><span id="t6_total_count">-</span></td>
                                    <td><span id="t6_total_incentive" class="calc-output">-</span></td>
                                    <td><span id="t6_l1_value" class="calc-output">-</span><span id="t6_l1_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t6_l2_value" class="calc-output">-</span><span id="t6_l2_perc" class="relative-multiplier"></span></td>
                                    <td><span id="t6_l3_value" class="calc-output">-</span><span id="t6_l3_perc" class="relative-multiplier"></span></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="bg-gray-100">
                                    <td>T1+T2 í•©ê³„</td>
                                    <td><span id="total_ppl_t1_t2">-</span></td>
                                    <td>
                                        <span id="total_incentive_t1_t2" class="calc-output-lg">-</span>
                                        (<span id="total_incentive_t1_t2_perc" class="font-bold text-indigo-600">-</span>)
                                    </td>
                                    <td colspan="3" class="text-gray-500 font-normal text-right">T1+T2 ì¬ì› ì ìœ ìœ¨</td>
                                </tr>
                                <tr class="bg-gray-200">
                                    <td>ì „ì²´ í•©ê³„ (T1-T6)</td>
                                    <td><span id="total_ppl_incentive">-</span></td>
                                    <td><span id="total_incentive_distributed" class="calc-output-lg">-</span></td>
                                    <td colspan="3" class="text-gray-500 font-normal text-right">ì´ ë°°ë¶„ì•¡ (100%)</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </section>
                
                <!-- ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë°°ë¶„ ê²°ê³¼ -->
                <section>
                    <h3 class="section-title">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë°°ë¶„ ê²°ê³¼</h3>
                    <div class="space-y-8">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">ì°¸ì—¬ì ë°°ë¶„ (T1-T6)</h4>
                            <p class="text-sm text-gray-600 mb-4 p-3 bg-gray-50 rounded-md">
                                â€» <strong>Tier ë°°ìœ¨ ë¡œì§ ë™ì¼ ì ìš©:</strong> ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë˜í•œ ì„±ê³¼ ì¸ì„¼í‹°ë¸Œì™€ ë™ì¼í•œ Tier ë°°ìœ¨ ë¡œì§ì„ ë”°ë¦…ë‹ˆë‹¤.<br>
                                â€» <strong>ë¹„ìœ¨ í‘œì‹œ:</strong> ê° ì…€ì˜ ê´„í˜¸ ì•ˆ ë¹„ìœ¨ì€ <span class="font-bold text-indigo-600">T6-L3ë¥¼ 100%ë¡œ í•˜ëŠ” ì ˆëŒ€ ë°°ìœ¨</span>ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
                            </p>
                            <div class="overflow-x-auto">
                                <table class="min-w-full">
                                    <thead>
                                        <tr>
                                            <th>êµ¬ë¶„</th>
                                            <th>ì´ ì¸ì›</th>
                                            <th>ì´ì•¡ (ì›)</th>
                                            <th>L1 (1ì¸ë‹¹)</th>
                                            <th>L2 (1ì¸ë‹¹)</th>
                                            <th>L3 (1ì¸ë‹¹)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>T1 (1st Tier)</td>
                                            <td><span id="lb_t1_total_count">-</span></td>
                                            <td><span id="lb_t1_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t1_l1_value" class="calc-output">-</span><span id="lb_t1_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t1_l2_value" class="calc-output">-</span><span id="lb_t1_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t1_l3_value" class="calc-output">-</span><span id="lb_t1_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T2 (2nd Tier)</td>
                                            <td><span id="lb_t2_total_count">-</span></td>
                                            <td><span id="lb_t2_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t2_l1_value" class="calc-output">-</span><span id="lb_t2_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t2_l2_value" class="calc-output">-</span><span id="lb_t2_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t2_l3_value" class="calc-output">-</span><span id="lb_t2_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T3 (3rd Tier)</td>
                                            <td><span id="lb_t3_total_count">-</span></td>
                                            <td><span id="lb_t3_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t3_l1_value" class="calc-output">-</span><span id="lb_t3_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t3_l2_value" class="calc-output">-</span><span id="lb_t3_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t3_l3_value" class="calc-output">-</span><span id="lb_t3_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T4 (ì¼ë°˜ íŒ€ì›)</td>
                                            <td><span id="lb_t4_total_count">-</span></td>
                                            <td><span id="lb_t4_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t4_l1_value" class="calc-output">-</span><span id="lb_t4_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t4_l2_value" class="calc-output">-</span><span id="lb_t4_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t4_l3_value" class="calc-output">-</span><span id="lb_t4_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T5 (Base)</td>
                                            <td><span id="lb_t5_total_count">-</span></td>
                                            <td><span id="lb_t5_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t5_l1_value" class="calc-output">-</span><span id="lb_t5_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t5_l2_value" class="calc-output">-</span><span id="lb_t5_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t5_l3_value" class="calc-output">-</span><span id="lb_t5_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>T6 (ìµœí•˜ìœ„)</td>
                                            <td><span id="lb_t6_total_count">-</span></td>
                                            <td><span id="lb_t6_total_incentive" class="calc-output">-</span></td>
                                            <td><span id="lb_t6_l1_value" class="calc-output">-</span><span id="lb_t6_l1_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t6_l2_value" class="calc-output">-</span><span id="lb_t6_l2_perc" class="relative-multiplier"></span></td>
                                            <td><span id="lb_t6_l3_value" class="calc-output">-</span><span id="lb_t6_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr class="bg-gray-100">
                                            <td>T1+T2 í•©ê³„</td>
                                            <td><span id="lb_total_ppl_t1_t2">-</span></td>
                                            <td>
                                                <span id="lb_total_incentive_t1_t2" class="calc-output-lg">-</span>
                                                (<span id="lb_total_incentive_t1_t2_perc" class="font-bold text-indigo-600">-</span>)
                                            </td>
                                            <td colspan="3" class="text-gray-500 font-normal text-right">T1+T2 ì¬ì› ì ìœ ìœ¨</td>
                                        </tr>
                                        <tr class="bg-gray-200">
                                            <td>ì „ì²´ í•©ê³„ (T1-T6)</td>
                                            <td><span id="lb_total_ppl_incentive">-</span></td>
                                            <td><span id="lb_total_distributed" class="calc-output-lg">-</span></td>
                                            <td colspan="3" class="text-gray-500 font-normal text-right">ì´ ë°°ë¶„ì•¡ (100%)</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>

                        <!-- T7 (ë¹„ì°¸ì—¬ì) - ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¹„ì°¸ì—¬ -->
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">ë¹„ì°¸ì—¬ì ë°°ë¶„ (T7) - <span class="text-red-600">ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¯¸ì§€ê¸‰ ëŒ€ìƒ</span></h4>
                            <div class="mb-4 space-y-3 p-3 bg-red-50 rounded-md border border-red-200">
                                <!-- ìŠ¬ë¼ì´ë” ë° ì„¤ëª… í…ìŠ¤íŠ¸ ì¶”ê°€ -->
                                <div>
                                    <label for="lb_t7_pool_rate_slider" class="block text-sm font-medium text-gray-700 mb-1">
                                        T7 í• ë‹¹ ë¹„ìœ¨: <span id="lb_t7_pool_rate_display" class="font-bold text-indigo-600">0%</span> (0% ~ 30%)
                                    </label>
                                    <input type="range" id="lb_t7_pool_rate_slider" min="0" max="30" value="0" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" disabled>
                                </div>
                                <p class="text-sm text-gray-600">
                                    * <strong class="text-red-600">T7ì€ ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¹„ì°¸ì—¬ìì…ë‹ˆë‹¤. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ê°€ ì§€ê¸‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong><br>
                                    * ì°¸ê³ : ì´ì „ ë²„ì „ì˜ T5 ë¹„ì°¸ì—¬ì ì„¤ì •ì€ í˜„ì¬ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                                </p>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Level</th>
                                            <th>ë°°ë¶„ ëŒ€ìƒ ì¸ì›</th>
                                            <th>1ì¸ë‹¹ ì§€ê¸‰ì•¡ (ì›)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>L1 <span class="font-normal text-gray-500">(6ê°œì›” ë¯¸ë§Œ)</span></td>
                                            <td><input type="number" id="lb_t7_l1" value="0" class="t5-input-in-table" readonly disabled></td>
                                            <td><span id="lb_t7_l1_value" class="calc-output">â‚©0</span><span id="lb_t7_l1_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>L2 <span class="font-normal text-gray-500">(6-12ê°œì›”)</span></td>
                                            <td><input type="number" id="lb_t7_l2" value="0" class="t5-input-in-table" readonly disabled></td>
                                            <td><span id="lb_t7_l2_value" class="calc-output">â‚©0</span><span id="lb_t7_l2_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                        <tr>
                                            <td>L3 <span class="font-normal text-gray-500">(1ë…„ ì´ìƒ)</span></td>
                                            <td><input type="number" id="lb_t7_l3" value="0" class="t5-input-in-table" readonly disabled></td>
                                            <td><span id="lb_t7_l3_value" class="calc-output">â‚©0</span><span id="lb_t7_l3_perc" class="relative-multiplier"></span></td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td>ë¹„ì°¸ì—¬ì í•©ê³„</td>
                                            <td><span id="lb_t7_total_ppl">0</span></td> 
                                            <td><span id="lb_t7_total" class="calc-output-lg">â‚©0</span></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
        </div><!-- End of tab1-content -->

        <!-- Tab 2 Content -->
        <div id="tab2-content" class="hidden">
            <div class="card">
                <h2 class="step-title">ì¸ì› ê´€ë¦¬</h2>
                <div class="card-content space-y-6">
                    <!-- ë‚ ì§œ ì„ íƒ -->
                    <section>
                        <h3 class="section-title">ê¸°ì¤€ ì¼ì ì„¤ì •</h3>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label for="baseYear" class="block text-sm font-medium text-gray-700 mb-1">ë…„ë„</label>
                                <select id="baseYear" class="input-base">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div>
                                <label for="baseMonth" class="block text-sm font-medium text-gray-700 mb-1">ì›”</label>
                                <select id="baseMonth" class="input-base">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div>
                                <label for="baseDay" class="block text-sm font-medium text-gray-700 mb-1">ì¼</label>
                                <select id="baseDay" class="input-base">
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </section>

                    <!-- CSV íŒŒì¼ ì—…ë¡œë“œ -->
                    <section>
                        <h3 class="section-title">CSV íŒŒì¼ë¡œ ì¸ì› ì¼ê´„ ì¶”ê°€</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="csvFile" class="block text-sm font-medium text-gray-700 mb-1">CSV íŒŒì¼ ì„ íƒ</label>
                                <input type="file" id="csvFile" accept=".csv" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-md file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-indigo-50 file:text-indigo-600
                                    hover:file:bg-indigo-100">
                            </div>
                            <div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-md">
                                <p class="font-semibold mb-2">CSV íŒŒì¼ í˜•ì‹:</p>
                                <p>NO,ì‚¬ë²ˆ,ì´ë¦„,Tier,ê·¸ë£¹ì…ì‚¬ì¼,OQ í•©ë¥˜ì¼,ì—°ë´‰,ì›”ê¸‰</p>
                                <p class="mt-2">â€» ì²« ë‘ ì¤„ì€ ì œëª©/í—¤ë”ë¡œ ìë™ ê±´ë„ˆëœë‹ˆë‹¤.</p>
                                <p class="mt-1">â€» ì—°ë´‰ê³¼ ì›”ê¸‰ì€ ì‰¼í‘œë¥¼ í¬í•¨í•œ ìˆ«ì(ì˜ˆ: "61,400,000") ë˜ëŠ” ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                            </div>
                            <div>
                                <button id="importCSV" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors">
                                    CSV íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
                                </button>
                            </div>
                        </div>
                    </section>

                    <!-- ì¸ì› ì¶”ê°€ -->
                    <section>
                        <h3 class="section-title">ì‹ ê·œ ì¸ì› ì¶”ê°€</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label for="newEmpId" class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ë²ˆ</label>
                                <input type="text" id="newEmpId" class="input-base" placeholder="SP000">
                            </div>
                            <div>
                                <label for="newEmpName" class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„</label>
                                <input type="text" id="newEmpName" class="input-base" placeholder="í™ê¸¸ë™">
                            </div>
                            <div>
                                <label for="newEmpTier" class="block text-sm font-medium text-gray-700 mb-1">Tier</label>
                                <select id="newEmpTier" class="input-base">
                                    <option value="1">T1</option>
                                    <option value="2">T2</option>
                                    <option value="3">T3</option>
                                    <option value="4">T4</option>
                                </select>
                            </div>
                            <div>
                                <label for="newEmpJoinDate" class="block text-sm font-medium text-gray-700 mb-1">í•©ë¥˜ì¼</label>
                                <input type="date" id="newEmpJoinDate" class="input-base">
                            </div>
                        </div>
                        <div class="mt-4">
                            <button id="addEmployee" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors">
                                ì¸ì› ì¶”ê°€
                            </button>
                        </div>
                    </section>

                    <!-- ì¸ì› ëª©ë¡ -->
                    <section>
                        <h3 class="section-title">ì¸ì› ëª©ë¡</h3>
                        
                        <!-- ê²€ìƒ‰ ë° ì •ë ¬ ì˜µì…˜ -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label for="searchName" class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„ ê²€ìƒ‰</label>
                                <input type="text" id="searchName" class="input-base" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                            <div>
                                <label for="tierFilter" class="block text-sm font-medium text-gray-700 mb-1">Tier í•„í„°</label>
                                <select id="tierFilter" class="input-base">
                                    <option value="all">ì „ì²´</option>
                                    <option value="1">T1ë§Œ ë³´ê¸°</option>
                                    <option value="2">T2ë§Œ ë³´ê¸°</option>
                                    <option value="3">T3ë§Œ ë³´ê¸°</option>
                                    <option value="4">T4ë§Œ ë³´ê¸°</option>
                                </select>
                            </div>
                            <div>
                                <label for="sortOrder" class="block text-sm font-medium text-gray-700 mb-1">Tier ì •ë ¬</label>
                                <select id="sortOrder" class="input-base">
                                    <option value="none">ì •ë ¬ ì•ˆí•¨</option>
                                    <option value="asc">ì˜¤ë¦„ì°¨ìˆœ (T1 â†’ T4)</option>
                                    <option value="desc">ë‚´ë¦¼ì°¨ìˆœ (T4 â†’ T1)</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button id="resetFilters" class="w-full bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors">
                                    ì´ˆê¸°í™”
                                </button>
                            </div>
                        </div>
                        
                        <!-- ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ -->
                        <div id="searchResults" class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md text-sm text-gray-700 hidden">
                            <span id="searchResultText"></span>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th class="text-center" rowspan="2">ìˆœë²ˆ</th>
                                        <th class="text-center" rowspan="2">ì‚¬ë²ˆ</th>
                                        <th class="text-center" rowspan="2">ì´ë¦„</th>
                                        <th class="text-center" rowspan="2">Tier</th>
                                        <th class="text-center" rowspan="2">í”„ë¡œì íŠ¸ í•©ë¥˜ì¼</th>
                                        <th class="text-center" rowspan="2">Level</th>
                                        <th class="text-right" rowspan="2">ì—°ë´‰</th>
                                        <th class="text-right" rowspan="2">ì›”ê¸‰</th>
                                        <th class="text-right" rowspan="2">ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ</th>
                                        <th class="text-right" colspan="4">ëŸ°ì¹­ ë³´ë„ˆìŠ¤</th>
                                        <th class="text-right" rowspan="2">ì›”ê¸‰ ëŒ€ë¹„<br>ì„±ê³¼ê¸‰ ë¹„ìœ¨</th>
                                        <th class="text-right" rowspan="2">ì›”ê¸‰ ëŒ€ë¹„<br>ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¹„ìœ¨</th>
                                        <th class="text-center" rowspan="2">ê´€ë¦¬</th>
                                    </tr>
                                    <tr>
                                        <th class="text-right bg-blue-50">ì´ì•¡</th>
                                        <th class="text-right bg-blue-50">1ì°¨(12ì›”)</th>
                                        <th class="text-right bg-blue-50">2ì°¨(IBT)</th>
                                        <th class="text-right bg-blue-50">3ì°¨(ëŸ°ì¹­)</th>
                                    </tr>
                                </thead>
                                <tbody id="employeeTableBody">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                                <tfoot>
                                    <tr class="bg-gray-100">
                                        <td colspan="6" class="text-right font-bold">í•©ê³„:</td>
                                        <td class="text-right font-bold" id="total_salary">-</td>
                                        <td class="text-right font-bold" id="total_monthly">-</td>
                                        <td class="text-right font-bold" id="total_incentive">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus_payment1">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus_payment2">-</td>
                                        <td class="text-right font-bold bg-blue-50" id="total_bonus_payment3">-</td>
                                        <td class="text-right font-bold" id="total_ratio">-</td>
                                        <td class="text-right font-bold" id="total_bonus_ratio">-</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-600">
                            ì´ <span id="displayedCount" class="font-bold text-indigo-600">0</span>ëª… í‘œì‹œ ì¤‘
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë¦¬ë” ë·° ì „ì—­ ë³€ìˆ˜
        let isLeaderView = true; // ê¸°ë³¸ê°’: ë¦¬ë” ë·°
        
        // ë¦¬ë” ë·° í† ê¸€ í•¨ìˆ˜
        function toggleViewMode() {
            isLeaderView = !isLeaderView;
            const body = document.body;
            const button = document.getElementById('toggleViewMode');
            const description = document.getElementById('viewModeDescription');
            const leaderViewElements = document.querySelectorAll('.leader-view-only');
            const detailedElements = document.querySelectorAll('.detailed-section');
            
            if (isLeaderView) {
                // ë¦¬ë” ë·° í™œì„±í™”
                body.classList.add('leader-view');
                button.innerHTML = 'ğŸ“Š ë¦¬ë” ë·°';
                button.classList.remove('bg-gray-600');
                button.classList.add('bg-indigo-600');
                description.textContent = 'ë¦¬ë” í”„ë ˆì  í…Œì´ì…˜ ìµœì í™” ë·° - í•µì‹¬ ê²°ê³¼ ì¤‘ì‹¬';
                
                // ë¦¬ë” ë·° ì „ìš© ìš”ì†Œ í‘œì‹œ
                leaderViewElements.forEach(el => el.style.display = '');
                // ìƒì„¸ ìš”ì†Œ ìˆ¨ê¸°ê¸°
                detailedElements.forEach(el => el.style.display = 'none');
            } else {
                // ìƒì„¸ ë·° í™œì„±í™”
                body.classList.remove('leader-view');
                button.innerHTML = 'ğŸ”§ ìƒì„¸ ë·°';
                button.classList.remove('bg-indigo-600');
                button.classList.add('bg-gray-600');
                description.textContent = 'ì „ì²´ ì„¤ì • ë° ìƒì„¸ ë°ì´í„° ë·°';
                
                // ë¦¬ë” ë·° ì „ìš© ìš”ì†Œ ìˆ¨ê¸°ê¸°
                leaderViewElements.forEach(el => el.style.display = 'none');
                // ìƒì„¸ ìš”ì†Œ í‘œì‹œ
                detailedElements.forEach(el => el.style.display = '');
            }
            
            // ë¦¬ë” ë·° KPI ì—…ë°ì´íŠ¸
            if (isLeaderView) {
                updateLeaderViewKPIs();
            }
        }
        
        // Collapsible ì„¹ì…˜ í† ê¸€ í•¨ìˆ˜
        function toggleCollapse(element) {
            element.classList.toggle('collapsed');
            const content = element.nextElementSibling;
            if (content && content.classList.contains('collapsible-content')) {
                content.classList.toggle('collapsed');
            }
        }
        
        // ë¦¬ë” ë·° KPI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLeaderViewKPIs() {
            // Step 1 KPIs
            const totalInvestment = document.getElementById('total_investment_display')?.textContent || '-';
            const roi = document.getElementById('calculatedROI')?.textContent || '-';
            
            document.getElementById('leader_total_investment').textContent = totalInvestment;
            document.getElementById('leader_roi').textContent = roi;
            
            // ì˜ì—…ì´ìµì€ ì„ íƒëœ ê¸°ì¤€ ê¸°ê°„ì˜ ê°’
            const selectedPeriod = document.getElementById('incentive_base_period')?.value || 'p2';
            const profit = document.getElementById(`${selectedPeriod}_profit`)?.textContent || '-';
            document.getElementById('leader_operating_profit').textContent = profit + ' ì–µì›';
            
            // Step 2 KPIs
            const incentivePool = document.getElementById('totalIncentivePool')?.textContent || '-';
            const launchBonus = document.getElementById('lb_total_incentive_distributed')?.textContent || '-';
            
            document.getElementById('leader_incentive_pool').textContent = incentivePool;
            document.getElementById('leader_launch_bonus').textContent = launchBonus;
        }
        
        // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.getElementById('toggleViewMode')?.addEventListener('click', toggleViewMode);
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¦¬ë” ë·°ë¡œ ì‹œì‘
        window.addEventListener('load', () => {
            toggleViewMode(); // ë¦¬ë” ë·° í™œì„±í™”
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // ####################
            // 5.1. ìƒìˆ˜ ë° í—¬í¼ í•¨ìˆ˜
            // ####################

            const shareConfig = {
                threshold_1: 300000000000, // 3000ì–µ
                threshold_2: 500000000000, // 5000ì–µ
                rate_1: 0.45, rate_2: 0.50, rate_3: 0.55
            };

            let projectedProfits = {};
            const periods = ['p1', 'p2', 'p3', 'p4']; // L3 ì¶•ì†Œ ì‹œ ì‹¤ìˆ˜ë¡œ p4ê°€ ì‚­ì œë˜ì—ˆë˜ ê²ƒ ë³µì›
            
            // Step 2 ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜ (Tab 3ì—ì„œ ì°¸ì¡°)
            let calculatedIncentiveValues = {
                t1: { l1: 0, l2: 0, l3: 0 },
                t2: { l1: 0, l2: 0, l3: 0 },
                t3: { l1: 0, l2: 0, l3: 0 },
                t4: { l1: 0, l2: 0, l3: 0 }
            };
            let calculatedBonusValues = {
                t1: { l1: 0, l2: 0, l3: 0 },
                t2: { l1: 0, l2: 0, l3: 0 },
                t3: { l1: 0, l2: 0, l3: 0 },
                t4: { l1: 0, l2: 0, l3: 0 }
            };

            function formatCurrency(num) {
                if (isNaN(num) || num === null || num === undefined) return '-';
                return new Intl.NumberFormat('ko-KR').format(Math.round(num)); 
            }
            function formatCurrencyDisplay(num) {
                if (isNaN(num) || num === null || num === undefined) return '-';
                return new Intl.NumberFormat('ko-KR').format(Math.round(num)) + 'ì›';
            }
            function formatBillion(num) {
                if (isNaN(num) || num === null || num === undefined) return '-';
                return (num / 100000000).toFixed(2);
            }
            function formatCurrencyBillion(num) {
                if (isNaN(num) || num === null || num === undefined) return '-';
                return (num / 100000000).toFixed(2) + 'ì–µì›';
            }
            /**
             * ROIì— ë”°ë¥¸ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
             * @param {number} roi - ROI ê°’ (ë°±ë¶„ìœ¨, ì˜ˆ: 178.5)
             * @returns {number} ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ (ì†Œìˆ˜, ì˜ˆ: 0.20 = 20%)
             */
            function getIncentiveRateByROI(roi) {
                // 1. ROI ìœ íš¨ì„± ê²€ì¦
                const validROI = (typeof roi === 'number' && !isNaN(roi) && isFinite(roi)) ? roi : 0;
                
                // 2. ì…ë ¥ í•„ë“œì—ì„œ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ì½ê¸° (ì•ˆì „í•˜ê²Œ)
                const readRate = (id, fallback) => {
                    const elem = document.getElementById(id);
                    if (!elem) return fallback;
                    
                    const rawValue = elem.value;
                    if (rawValue === '' || rawValue == null) return fallback;
                    
                    const parsed = parseFloat(rawValue);
                    if (isNaN(parsed) || !isFinite(parsed) || parsed < 0 || parsed > 100) {
                        return fallback;
                    }
                    
                    return parsed;
                };
                
                // ê° ROI êµ¬ê°„ë³„ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ (%)
                const rates = {
                    r0: readRate('roi_rate_0_100', 2),      // 0~100%
                    r1: readRate('roi_rate_100_150', 10),   // 100~150%
                    r2: readRate('roi_rate_150_200', 20),   // 150~200%
                    r3: readRate('roi_rate_200_300', 25),   // 200~300%
                    r4: readRate('roi_rate_300_plus', 30)   // 300%+
                };
                
                // 3. ROI êµ¬ê°„ì— ë”°ë¼ ì ìš©í•  ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨(%) ì„ íƒ
                let ratePercent;
                if (validROI <= 100) {
                    ratePercent = rates.r0;
                } else if (validROI <= 150) {
                    ratePercent = rates.r1;
                } else if (validROI <= 200) {
                    ratePercent = rates.r2;
                } else if (validROI <= 300) {
                    ratePercent = rates.r3;
                } else {
                    ratePercent = rates.r4;
                }
                
                // 4. í¼ì„¼íŠ¸ â†’ ì†Œìˆ˜ ë³€í™˜ (20% â†’ 0.20)
                const decimal = ratePercent / 100;
                
                // 5. ìµœì¢… ê²€ì¦
                return (decimal >= 0 && decimal <= 1 && isFinite(decimal)) ? decimal : 0.02;
            }
            function getTotalWeight(counts, weights) {
                // L3ê¹Œì§€ë§Œ ê³„ì‚°í•˜ë„ë¡ ìˆ˜ì •
                return (counts[0] * weights[0]) + (counts[1] * weights[1]) + (counts[2] * weights[2]);
            }
            function getValue(id, isFloat = false) {
                const el = document.getElementById(id);
                if (!el) return 0;
                const value = isFloat ? parseFloat(el.value) : parseInt(el.value, 10);
                return isNaN(value) ? 0 : value;
            }
            function getText(id) {
                const el = document.getElementById(id);
                if (el && el.type === 'range') return Number(el.value);
                return el ? el.value : '';
            }
            function setValue(id, value) {
                const el = document.getElementById(id);
                if (el) el.value = value;
            }
            function setText(id, value) {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            }

            // P&L ìƒì„¸ ë¡œì§
            // [MODIFIED] roiMethodì— ë”°ë¼ ë¶„ìë§Œ ë°”ê¾¸ê³  ë¶„ëª¨ëŠ” cumulativeCostë¡œ í†µì¼
            function calculatePAndL(total_investment, periodAmortizedCost, amortization_periods, revenues, op_costs, mgAmount) {
                projectedProfits = {}; 
                let cumulativeRevenueG = 0; 
                let cumulativeCost = 0;
                let cumulativeProfit = 0;
                let cumulativeSupercatNetRevenue = 0; // ëˆ„ì  ìˆœë§¤ì¶œ(S) ì¶”ì 
                let cumulativeNetProfit = 0; // ëˆ„ì  ë‹¹ê¸°ìˆœì´ìµ ì¶”ì 
                
                // MG(Minimum Guarantee) ìƒí™˜ ì¶”ì  ë³€ìˆ˜
                let mgRemaining = mgAmount; // ë‚¨ì€ MG ì”ì•¡ (ìŠ¬ë¼ì´ë”ì—ì„œ ì…ë ¥ë°›ìŒ)

                periods.forEach((p, index) => {
                    const revenue = revenues[p] || 0;
                    // Note: total_investmentëŠ” (ê°œë°œë¹„+ë³´ë„ˆìŠ¤) í•©ê³„
                    const amortization = (index < amortization_periods) ? periodAmortizedCost : 0;
                    const operating_cost = op_costs[p] || 0;
                    
                    // --- ìˆœë§¤ì¶œ(S) ê³„ì‚° (êµ¬ê°„ë³„ ëˆ„ì§„ ì ìš©) ---
                    const initialNetRevenue = revenue * 0.70; // (ì°¸ê³ ìš©: ë°°ë¶„ ì „)
                    let supercatNetRevenue = 0; // (ìµœì¢… ìˆœë§¤ì¶œS)
                    const newCumulativeG = cumulativeRevenueG + revenue;
                    
                    // 55% êµ¬ê°„ (5000ì–µ ì´ˆê³¼)
                    const revIn55 = Math.max(0, newCumulativeG - shareConfig.threshold_2) - Math.max(0, cumulativeRevenueG - shareConfig.threshold_2);
                    supercatNetRevenue += (revIn55 * 0.70) * shareConfig.rate_3; // (ë§¤ì¶œG * 70%) * 55%
                    // 50% êµ¬ê°„ (3000ì–µ ì´ˆê³¼ 5000ì–µ ì´í•˜)
                    const revIn50 = Math.max(0, Math.min(newCumulativeG, shareConfig.threshold_2) - shareConfig.threshold_1) - Math.max(0, Math.min(cumulativeRevenueG, shareConfig.threshold_2) - shareConfig.threshold_1);
                    supercatNetRevenue += (revIn50 * 0.70) * shareConfig.rate_2; // (ë§¤ì¶œG * 70%) * 50%
                    // 45% êµ¬ê°„ (3000ì–µ ì´í•˜)
                    const revIn45 = Math.max(0, Math.min(newCumulativeG, shareConfig.threshold_1)) - Math.max(0, Math.min(cumulativeRevenueG, shareConfig.threshold_1));
                    supercatNetRevenue += (revIn45 * 0.70) * shareConfig.rate_1; // (ë§¤ì¶œG * 70%) * 45%

                    cumulativeRevenueG = newCumulativeG; // ë‹¤ìŒ ê¸°ê°„ì„ ìœ„í•´ ëˆ„ì (G)
                    
                    // --- MG ìƒí™˜ ë¡œì§ ---
                    let actualSupercatNetRevenue = supercatNetRevenue; // ì‹¤ì œ ìˆœë§¤ì¶œ (MG ìƒí™˜ í›„)
                    let mgRepayment = 0; // ì´ë²ˆ ê¸°ê°„ MG ìƒí™˜ì•¡
                    
                    if (mgRemaining > 0) {
                        // MG ì”ì•¡ì´ ë‚¨ì•„ìˆìœ¼ë©´ ìˆœë§¤ì¶œì—ì„œ ìš°ì„  ìƒí™˜
                        mgRepayment = Math.min(supercatNetRevenue, mgRemaining);
                        mgRemaining -= mgRepayment;
                        actualSupercatNetRevenue = supercatNetRevenue - mgRepayment;
                        
                        console.log(`[${p}] MG ìƒí™˜: ${formatCurrencyBillion(mgRepayment)}, MG ì”ì•¡: ${formatCurrencyBillion(mgRemaining)}, ì‹¤ì œ ìˆœë§¤ì¶œ: ${formatCurrencyBillion(actualSupercatNetRevenue)}`);
                    }
                    
                    cumulativeSupercatNetRevenue += actualSupercatNetRevenue; // ì‹¤ì œ ìˆœë§¤ì¶œë§Œ ëˆ„ì 
                    // --- ---

                    const total_cost = amortization + operating_cost;
                    const profit = actualSupercatNetRevenue - total_cost; // MG ìƒí™˜ í›„ ìˆœë§¤ì¶œë¡œ ê³„ì‚°
                    
                    cumulativeCost += total_cost;
                    cumulativeProfit += profit;

                    // ========================================
                    // ROI ë° ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ê³„ì‚° (ì™„ì „ ìƒˆë¡œ ì‘ì„±)
                    // ========================================
                    
                    // 1. ROI ê³„ì‚°: ëˆ„ì  ìˆœë§¤ì¶œ(S) / ì´ ëˆ„ì  ë¹„ìš©
                    let periodROI = 0;
                    if (cumulativeCost > 0) {
                        periodROI = (cumulativeSupercatNetRevenue / cumulativeCost) * 100;
                    }
                    
                    // 2. ROI ê°’ ê²€ì¦ ë° ì •ë¦¬
                    if (!isFinite(periodROI) || isNaN(periodROI)) {
                        periodROI = 0;
                    }
                    
                    // 3. ROIì— ë”°ë¥¸ ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ê²°ì •
                    const incentiveRate = getIncentiveRateByROI(periodROI);
                    
                    // 4. ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ê²€ì¦
                    const validIncentiveRate = (!isNaN(incentiveRate) && isFinite(incentiveRate) && incentiveRate >= 0) 
                        ? incentiveRate 
                        : 0.02;

                    // 5. ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ ê³„ì‚° (ROI êµ¬ê°„ë³„ ì°¨ë“± ì ìš©, MG ìƒí™˜ í›„ ì‹¤ì œ ìˆœë§¤ì¶œ ê¸°ì¤€)
                    let incentiveAmount = 0;
                    if (periodROI < 100) {
                        // ROI < 100%: ì‹¤ì œ ìˆœë§¤ì¶œì˜ 2% (BEP ë¯¸ë‹¬ êµ¬ê°„, MG ìƒí™˜ í›„)
                        incentiveAmount = actualSupercatNetRevenue * 0.02;
                        console.log(`[${p}] ROI < 100% â†’ ì‹¤ì œ ìˆœë§¤ì¶œ ê¸°ì¤€: ${formatCurrencyBillion(actualSupercatNetRevenue)} * 2% = ${formatCurrencyBillion(incentiveAmount)}`);
                    } else {
                        // ROI >= 100%: ì˜ì—…ì´ìµ * ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ (ì´ë¯¸ MG ìƒí™˜ í›„ ìˆœë§¤ì¶œë¡œ ê³„ì‚°ëœ profit ì‚¬ìš©)
                        incentiveAmount = (profit > 0) ? (profit * validIncentiveRate) : 0;
                        console.log(`[${p}] ROI â‰¥ 100% â†’ ì˜ì—…ì´ìµ ê¸°ì¤€: ${formatCurrencyBillion(profit)} * ${(validIncentiveRate*100).toFixed(0)}% = ${formatCurrencyBillion(incentiveAmount)}`);
                    }

                    // 6. P&L ê³„ì‚° ê²°ê³¼ë¥¼ ì „ì—­ ê°ì²´ì— ì €ì¥
                    projectedProfits[p] = { 
                        profit: profit,
                        cumulativeProfit: cumulativeProfit,
                        periodROI: periodROI,
                        incentiveRate: validIncentiveRate,
                        supercatNetRevenue: actualSupercatNetRevenue, // MG ìƒí™˜ í›„ ì‹¤ì œ ìˆœë§¤ì¶œ
                        cumulativeSupercatNetRevenue: cumulativeSupercatNetRevenue,
                        cumulativeCost: cumulativeCost,
                        incentiveAmount: incentiveAmount,  // ê³„ì‚°ëœ ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ ì €ì¥
                        mgRepayment: mgRepayment, // MG ìƒí™˜ì•¡ (ì¶”ì ìš©)
                        mgRemaining: mgRemaining  // MG ì”ì•¡ (ì¶”ì ìš©)
                    };

                    // 6. P&L í…Œì´ë¸” UI ì—…ë°ì´íŠ¸ (ë‹¨ìœ„: ì–µì›)
                    setValue(`${p}_revenue`, formatBillion(revenue));
                    setText(`${p}_pre_dist`, formatCurrencyBillion(initialNetRevenue));
                    // ìˆœë§¤ì¶œ(S)ì€ MG ìƒí™˜ í›„ ì‹¤ì œ ìˆœë§¤ì¶œ í‘œì‹œ
                    setText(`${p}_supercat_net`, formatCurrencyBillion(actualSupercatNetRevenue));
                    setValue(`${p}_amortization`, formatBillion(amortization));
                    setText(`${p}_total_cost`, formatCurrencyBillion(total_cost));
                    setText(`${p}_profit`, formatCurrencyBillion(profit));
                    setText(`${p}_cum_cost`, formatCurrencyBillion(cumulativeCost));
                    setText(`${p}_cum_profit`, formatCurrencyBillion(cumulativeProfit));
                    
                    // ROI í‘œì‹œ (ì†Œìˆ˜ì  1ìë¦¬)
                    const roiText = periodROI.toFixed(1) + '%';
                    setText(`${p}_roi`, roiText);
                    
                    // ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ í‘œì‹œ (ì •ìˆ˜)
                    const incentiveRatePercent = Math.round(validIncentiveRate * 100);
                    const incentiveRateText = incentiveRatePercent + '%';
                    setText(`${p}_incentive_rate`, incentiveRateText);
                    
                    // ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ í‘œì‹œ (ì´ë¯¸ ê³„ì‚°ëœ ê°’ ì‚¬ìš©)
                    setText(`${p}_incentive_amount`, formatCurrencyBillion(incentiveAmount));
                    
                    // OQìˆœì´ìµ ê³„ì‚° (ì˜ì—…ì´ìµ - ì¸ì„¼í‹°ë¸Œ)
                    const oqProfit = profit - incentiveAmount;
                    const oqProfitColor = oqProfit >= 0 ? 'text-green-600' : 'text-red-600';
                    const oqProfitEl = document.getElementById(`${p}_oq_profit`);
                    if (oqProfitEl) {
                        oqProfitEl.textContent = formatCurrencyBillion(oqProfit);
                        oqProfitEl.className = `pl-table-output calc-output ${oqProfitColor}`;
                    }
                    
                    // OQì™¸ ë¹„ìš© (input í•„ë“œì—ì„œ ì½ì–´ì˜´, ë‹¨ìœ„: ì–µì›)
                    const nonOqCostBillion = getValue(`${p}_non_oq_cost`) || 0;
                    const nonOqCost = nonOqCostBillion * 100000000; // ì–µì› -> ì› ë‹¨ìœ„ë¡œ ë³€í™˜
                    
                    // ë‹¹ê¸°ìˆœì´ìµ ê³„ì‚° (OQìˆœì´ìµ - OQì™¸ ë¹„ìš©)
                    const netProfit = oqProfit - nonOqCost;
                    cumulativeNetProfit += netProfit;
                    
                    const netProfitColor = netProfit >= 0 ? 'text-green-600' : 'text-red-600';
                    const netProfitEl = document.getElementById(`${p}_net_profit`);
                    if (netProfitEl) {
                        netProfitEl.textContent = formatCurrencyBillion(netProfit);
                        netProfitEl.className = `pl-table-output calc-output ${netProfitColor}`;
                    }
                    
                    // ëˆ„ì  ë‹¹ê¸°ìˆœì´ìµ í‘œì‹œ
                    const cumNetProfitColor = cumulativeNetProfit >= 0 ? 'text-green-600' : 'text-red-600';
                    const cumNetProfitEl = document.getElementById(`${p}_cum_net_profit`);
                    if (cumNetProfitEl) {
                        cumNetProfitEl.textContent = formatCurrencyBillion(cumulativeNetProfit);
                        cumNetProfitEl.className = `pl-table-output calc-output ${cumNetProfitColor}`;
                    }
                });
            }


            // ####################
            // 5.2. calculateAll í•¨ìˆ˜ (ë©”ì¸ ë¡œì§)
            // ####################
            function calculateAll() {
                
                // ---------------------
                // Phase 1: ì…ë ¥ê°’ ì½ê¸° (Read)
                // ---------------------
                
                const revenueScenarioKey = getText('revenueScenario');

                const total_investment_slider = getValue('total_investment_slider'); // ì¶œì‹œì „ ê°œë°œë¹„ (ìŠ¬ë¼ì´ë”)
                const launchBonusSlider = getValue('launchBonusSlider'); // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ (ìŠ¬ë¼ì´ë”)
                const totalLaunchBonusPool = launchBonusSlider * 100000000; // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ (ì›)
                
                // [MODIFIED] ì´ íˆ¬ìë¹„ = ê°œë°œë¹„ + ëŸ°ì¹­ ë³´ë„ˆìŠ¤
                const total_investment = (total_investment_slider + launchBonusSlider) * 100000000; 
                
                const amortization_periods = getValue('amortization_periods');
                const op_costs = {
                    p1: getValue('p1_op_cost') * 100000000, // ì–µì› -> ì›
                    p2: getValue('p2_op_cost') * 100000000,
                    p3: getValue('p3_op_cost') * 100000000,
                    p4: getValue('p4_op_cost') * 100000000
                };

                // Step 1 - ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ë¡œì§
                const base_p1_revenue_b = getValue('base_p1_revenue'); // 1000 (ì–µì›)
                const base_p1_revenue_w = base_p1_revenue_b * 100000000; // ì›
                const best_multiplier = getValue('best_multiplier') / 100; // 1.5
                const worst_multiplier = getValue('worst_multiplier') / 100; // 0.5
                const p2_retention = getValue('p2_retention') / 100; // 0.6
                const p3_retention = getValue('p3_retention') / 100; // 0.85
                const p4_retention = getValue('p4_retention') / 100; // 0.85

                // Step 2 (L1~L3ë¡œ ì¶•ì†Œ)
                const weights = {
                    l1: getValue('w1', true), l2: getValue('w2', true), l3: getValue('w3', true)
                };
                const weightsArr = [weights.l1, weights.l2, weights.l3]; // T5 ê³„ì‚°ìš©

                const t_counts = {
                    t1: { l1: getValue('t1_l1'), l2: getValue('t1_l2'), l3: getValue('t1_l3') },
                    t2: { l1: getValue('t2_l1'), l2: getValue('t2_l2'), l3: getValue('t2_l3') },
                    t3: { l1: getValue('t3_l1'), l2: getValue('t3_l2'), l3: getValue('t3_l3') },
                    t4: { l1: getValue('t4_l1'), l2: getValue('t4_l2'), l3: getValue('t4_l3') },
                    t5: { l1: getValue('t5_l1'), l2: getValue('t5_l2'), l3: getValue('t5_l3') },
                    t6: { l1: getValue('t6_l1'), l2: getValue('t6_l2'), l3: getValue('t6_l3') }
                };

                const selectedPeriod = getText('periodSelect'); // 'p1', 'p2', 'p3', 'p4'

                // ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ Tier ë°°ìœ¨ ë¡œì§ ì…ë ¥ê°’ (T6 ê¸°ì¤€)
                const pi_t6_t5_rate = getValue('pi_t6_t5_rate') / 100; // 3.0 (ê¸°ë³¸ê°’, 300% ì¦ê°€)
                const pi_t5_t4_rate = getValue('pi_t5_t4_rate') / 100; // 0.2
                const pi_t4_t3_rate = getValue('pi_t4_t3_rate') / 100; // 0.3
                const pi_t3_t2_rate = getValue('pi_t3_t2_rate') / 100; // 1.0
                const pi_t2_t1_rate = getValue('pi_t2_t1_rate') / 100; // 2.0 (200% ì¦ê°€)
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ Tier ë°°ìœ¨ ë¡œì§ ì…ë ¥ê°’ (T6 ê¸°ì¤€, ì™„ë§Œí•œ ë°°ìœ¨)
                const lb_t6_t5_rate_mult = getValue('lb_t6_t5_rate') / 100; // 1.5 (ê¸°ë³¸ê°’, 150% ì¦ê°€)
                const lb_t5_t4_rate_mult = getValue('lb_t5_t4_rate') / 100; // 0.15
                const lb_t4_t3_rate_mult = getValue('lb_t4_t3_rate') / 100; // 0.2
                const lb_t3_t2_rate_mult = getValue('lb_t3_t2_rate') / 100; // 0.5
                const lb_t2_t1_rate_mult = getValue('lb_t2_t1_rate') / 100; // 1.0 (100% ì¦ê°€)
                
                // T7 í’€ í• ë‹¹ ë¹„ìœ¨ (ë¹„ì°¸ì—¬ì - 0%)
                const lb_t7_pool_rate_slider_el = document.getElementById('lb_t7_pool_rate_slider');
                const lb_t7_rate_percent = 0; // T7ì€ ë¹„ì°¸ì—¬ì, í•­ìƒ 0%
                const lb_t7_rate = 0; // 0%
                
                // Step 3 (T7 ì¸ì› ì…ë ¥, L1~L3ë¡œ ì¶•ì†Œ) - ë¹„ì°¸ì—¬ìì´ë¯€ë¡œ í•­ìƒ 0
                const lb_t7_counts = {
                    l1: getValue('lb_t7_l1') || 0, l2: getValue('lb_t7_l2') || 0, l3: getValue('lb_t7_l3') || 0
                };
                const lb_t7_countsArr = [lb_t7_counts.l1, lb_t7_counts.l2, lb_t7_counts.l3];

                
                // ---------------------
                // Phase 1.5: ë™ì  ë§¤ì¶œ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±
                // ---------------------
                const revenueScenarios = { base: {}, best: {}, worst: {} };
                // 1. Base ì‹œë‚˜ë¦¬ì˜¤ ê³„ì‚°
                revenueScenarios.base.p1 = base_p1_revenue_w;
                revenueScenarios.base.p2 = revenueScenarios.base.p1 * p2_retention;
                revenueScenarios.base.p3 = revenueScenarios.base.p2 * p3_retention;
                revenueScenarios.base.p4 = revenueScenarios.base.p3 * p4_retention;
                // 2. Best/Worst ì‹œë‚˜ë¦¬ì˜¤ ê³„ì‚°
                periods.forEach(p => {
                    revenueScenarios.best[p] = revenueScenarios.base[p] * best_multiplier;
                    revenueScenarios.worst[p] = revenueScenarios.base[p] * worst_multiplier;
                });


                // ---------------------
                // Phase 1: P&L ê³„ì‚° (ë™ì  ì‹œë‚˜ë¦¬ì˜¤ ì ìš©)
                // ---------------------
                
                // [MODIFIED] ê¸°ê°„ë‹¹ ìƒê°ë¹„ ê³„ì‚° (ì´ íˆ¬ìë¹„ / ê¸°ê°„)
                const periodAmortizedCost = (amortization_periods > 0) ? total_investment / amortization_periods : 0;

                // Step 1 ìƒë‹¨ UI ì—…ë°ì´íŠ¸
                // [MODIFIED] ì´ íˆ¬ìë¹„ í‘œì‹œ (ê°œë°œë¹„ + ë³´ë„ˆìŠ¤)
                const total_investment_display_value = total_investment_slider + launchBonusSlider;
                setText('total_investment_display', `${total_investment_display_value}ì–µì›`); 
                setText('launchBonusDisplay', `${launchBonusSlider}ì–µì›`);
                
                // MG ìŠ¬ë¼ì´ë” ê°’ ì½ê¸° ë° í‘œì‹œ
                const mgSliderValue = getValue('mg_slider'); // ì–µì› ë‹¨ìœ„
                const mgAmount = mgSliderValue * 100000000; // ì› ë‹¨ìœ„ë¡œ ë³€í™˜
                setText('mg_display', `${mgSliderValue}ì–µì›`);
                
                // P&L ì¶”ì • ì„¤ëª… í…ìŠ¤íŠ¸ ë³€ê²½
                const preLaunchCostOnly = total_investment_slider * 100000000;
                setText('amortization_desc', 
                    `ì´ íˆ¬ìë¹„ ${formatCurrencyBillion(total_investment)} (ì¶œì‹œì „ ê°œë°œë¹„ ${formatCurrencyBillion(preLaunchCostOnly)} + ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ${formatCurrencyBillion(totalLaunchBonusPool)})ì„ ${amortization_periods} Period ìƒê° (ê¸°ê°„ë‹¹ ${formatCurrencyBillion(periodAmortizedCost)})`
                );
                
                // P&L ìƒì„¸ ê³„ì‚° í•¨ìˆ˜ í˜¸ì¶œ (MG ê¸ˆì•¡ ì „ë‹¬)
                calculatePAndL(total_investment, periodAmortizedCost, amortization_periods, revenueScenarios[revenueScenarioKey], op_costs, mgAmount);


                // ---------------------
                // Phase 2: ì¸ì„¼í‹°ë¸Œ ì¬ì› ê³„ì‚°
                // ---------------------

                // P&L ê³„ì‚° í•¨ìˆ˜ì—ì„œ ì €ì¥ëœ, 'selectedPeriod'ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
                const operatingProfit = projectedProfits[selectedPeriod]?.profit || 0;
                
                // [MODIFIED] ROIì™€ ì¸ì„¼ ë¹„ìœ¨ì„ P&L ê³„ì‚° ê²°ê³¼ì—ì„œ ì§ì ‘ ê°€ì ¸ì˜´
                const calculatedROI_pct = projectedProfits[selectedPeriod]?.periodROI || 0;
                const incentiveRate = projectedProfits[selectedPeriod]?.incentiveRate || 0; 
                
                // [FIXED] P&Lì—ì„œ ê³„ì‚°ëœ ì¸ì„¼í‹°ë¸Œ ê¸ˆì•¡ì„ ì§ì ‘ ì‚¬ìš© (ROI êµ¬ê°„ë³„ ë¡œì§ ë°˜ì˜ë¨)
                const totalIncentivePool = projectedProfits[selectedPeriod]?.incentiveAmount || 0;
                
                // ê²€ì¦ ë¡œê·¸
                console.log('=== Step 3 ì¸ì„¼í‹°ë¸Œ ì¬ì› ê²€ì¦ ===');
                console.log(`ì„ íƒëœ ê¸°ê°„: ${selectedPeriod}`);
                console.log(`ì˜ì—…ì´ìµ: ${formatCurrencyBillion(operatingProfit)}`);
                console.log(`ROI: ${calculatedROI_pct.toFixed(1)}%`);
                console.log(`ì¸ì„¼ ë¹„ìœ¨: ${(incentiveRate * 100).toFixed(0)}%`);
                console.log(`ì´ ì¸ì„¼í‹°ë¸Œ ì¬ì› (P&Lì—ì„œ ê³„ì‚°ë¨): ${formatCurrencyBillion(totalIncentivePool)}`);
                console.log('================================');
                
                // ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡ ê³„ì‚°
                const leaderDiscretionRate = getValue('leaderDiscretionSlider') / 100; // 0 ~ 0.15
                const leaderDiscretionAmount = totalIncentivePool * leaderDiscretionRate;
                const distributionIncentivePool = totalIncentivePool - leaderDiscretionAmount; // ì‹¤ì œ ë°°ë¶„í•  ê¸ˆì•¡

                // Tierë³„ í‰ê·  ì›”ê¸‰ ê³„ì‚° (Step 3ì˜ employees ë°ì´í„° í™œìš©)
                const tierAverageMonthlySalary = {
                    t1: 0, t2: 0, t3: 0, t4: 0
                };
                const tierSalarySums = { t1: 0, t2: 0, t3: 0, t4: 0 };
                const tierCounts = { t1: 0, t2: 0, t3: 0, t4: 0 };
                
                employees.forEach(emp => {
                    const tierKey = 't' + emp.tier;
                    if (tierKey in tierSalarySums) {
                        tierSalarySums[tierKey] += emp.salary;
                        tierCounts[tierKey]++;
                    }
                });
                
                // í‰ê·  ì—°ë´‰ ê³„ì‚° í›„ ì›”ê¸‰ìœ¼ë¡œ ë³€í™˜
                ['t1', 't2', 't3', 't4'].forEach(tier => {
                    if (tierCounts[tier] > 0) {
                        const avgYearlySalary = tierSalarySums[tier] / tierCounts[tier];
                        tierAverageMonthlySalary[tier] = avgYearlySalary / 12;
                    }
                });


                
                // ---------------------
                // Phase 3: ë°°ë¶„ ê³„ì‚° (Tier ë°°ìœ¨ ë¡œì§)
                // ---------------------
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ í’€ ë¶„í•  (T7ì€ ë¹„ì°¸ì—¬ì, ë³„ë„ í’€ í• ë‹¹í•˜ì§€ ì•ŠìŒ - 0%)
                const lb_t7_pool = 0; // T7: ë¹„ì°¸ì—¬ì, ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¯¸ì§€ê¸‰
                const totalLaunchBonus_t1_t6 = totalLaunchBonusPool; // T1-T6: 100% í• ë‹¹

                // 1. ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ Tierë³„ ìŠ¹ìˆ˜(Multiplier) ê³„ì‚° (T6 ê¸°ì¤€ 1.0)
                const pi_multipliers = {
                    t6: 1.0, // T6 Base (ìµœí•˜ìœ„)
                    t5: 1.0 * (1 + pi_t6_t5_rate), // T6ì˜ 300% ì¦ê°€ = 4.0
                    t4: 1.0 * (1 + pi_t6_t5_rate) * (1 + pi_t5_t4_rate),
                    t3: 1.0 * (1 + pi_t6_t5_rate) * (1 + pi_t5_t4_rate) * (1 + pi_t4_t3_rate), 
                    t2: 1.0 * (1 + pi_t6_t5_rate) * (1 + pi_t5_t4_rate) * (1 + pi_t4_t3_rate) * (1 + pi_t3_t2_rate), 
                    t1: 1.0 * (1 + pi_t6_t5_rate) * (1 + pi_t5_t4_rate) * (1 + pi_t4_t3_rate) * (1 + pi_t3_t2_rate) * (1 + pi_t2_t1_rate) 
                };
                
                // 2. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ Tierë³„ ìŠ¹ìˆ˜(Multiplier) ê³„ì‚° (T6 ê¸°ì¤€ 1.0, ì™„ë§Œí•œ ë°°ìœ¨)
                const lb_multipliers = {
                    t6: 1.0, // T6 Base (ìµœí•˜ìœ„)
                    t5: 1.0 * (1 + lb_t6_t5_rate_mult), // T6ì˜ 150% ì¦ê°€ = 2.5
                    t4: 1.0 * (1 + lb_t6_t5_rate_mult) * (1 + lb_t5_t4_rate_mult),
                    t3: 1.0 * (1 + lb_t6_t5_rate_mult) * (1 + lb_t5_t4_rate_mult) * (1 + lb_t4_t3_rate_mult), 
                    t2: 1.0 * (1 + lb_t6_t5_rate_mult) * (1 + lb_t5_t4_rate_mult) * (1 + lb_t4_t3_rate_mult) * (1 + lb_t3_t2_rate_mult), 
                    t1: 1.0 * (1 + lb_t6_t5_rate_mult) * (1 + lb_t5_t4_rate_mult) * (1 + lb_t4_t3_rate_mult) * (1 + lb_t3_t2_rate_mult) * (1 + lb_t2_t1_rate_mult) 
                };

                // [v5.1.3b] L2 ìµœì†Œ ë³´ìƒ ë³´ì • ë¡œì§ (L3ê¹Œì§€ë§Œ ê³„ì‚°)
                // 1-1. ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ê¸°ì¤€ L3 ìœ ë‹› ê³„ì‚° (T1-T6 ì „ì²´ ì°¸ì—¬)
                const pi_unit_values_l3 = {
                    t6: pi_multipliers.t6 * weights.l3, // T6_L3 (ìµœí•˜ìœ„)
                    t5: pi_multipliers.t5 * weights.l3, // T5_L3
                    t4: pi_multipliers.t4 * weights.l3, // T4_L3
                    t3: pi_multipliers.t3 * weights.l3, // T3_L3
                    t2: pi_multipliers.t2 * weights.l3, // T2_L3
                    t1: pi_multipliers.t1 * weights.l3  // T1_L3
                };
                
                // 1-2. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ê¸°ì¤€ L3 ìœ ë‹› ê³„ì‚° (T1-T6 ì „ì²´ ì°¸ì—¬)
                const lb_unit_values_l3 = {
                    t6: lb_multipliers.t6 * weights.l3, // T6_L3 (ìµœí•˜ìœ„)
                    t5: lb_multipliers.t5 * weights.l3, // T5_L3
                    t4: lb_multipliers.t4 * weights.l3, // T4_L3
                    t3: lb_multipliers.t3 * weights.l3, // T3_L3
                    t2: lb_multipliers.t2 * weights.l3, // T2_L3
                    t1: lb_multipliers.t1 * weights.l3  // T1_L3
                };

                // 2-1. ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë³´ì • ìœ ë‹› ê³„ì‚° (L1, L2, L3) - T1-T6 ì „ì²´ ì°¸ì—¬
                const pi_final_reward_units_per_person = {
                    t6: {
                        l1: pi_multipliers.t6 * weights.l1,
                        l2: pi_multipliers.t6 * weights.l2, // T6ì€ ìµœí•˜ìœ„ì´ë¯€ë¡œ ë³´ì • ì—†ìŒ
                        l3: pi_unit_values_l3.t6
                    },
                    t5: {
                        l1: pi_multipliers.t5 * weights.l1,
                        l2: Math.max(pi_multipliers.t5 * weights.l2, pi_unit_values_l3.t6 * 1.1), // T5_L2 vs (T6_L3 * 1.1)
                        l3: pi_unit_values_l3.t5
                    },
                    t4: {
                        l1: pi_multipliers.t4 * weights.l1,
                        l2: Math.max(pi_multipliers.t4 * weights.l2, pi_unit_values_l3.t5 * 1.1), // T4_L2 vs (T5_L3 * 1.1)
                        l3: pi_unit_values_l3.t4
                    },
                    t3: {
                        l1: pi_multipliers.t3 * weights.l1,
                        l2: Math.max(pi_multipliers.t3 * weights.l2, pi_unit_values_l3.t4 * 1.1), // T3_L2 vs (T4_L3 * 1.1)
                        l3: pi_unit_values_l3.t3
                    },
                    t2: {
                        l1: pi_multipliers.t2 * weights.l1,
                        l2: Math.max(pi_multipliers.t2 * weights.l2, pi_unit_values_l3.t3 * 1.1), // T2_L2 vs (T3_L3 * 1.1)
                        l3: pi_unit_values_l3.t2
                    },
                    t1: {
                        l1: pi_multipliers.t1 * weights.l1,
                        l2: Math.max(pi_multipliers.t1 * weights.l2, pi_unit_values_l3.t2 * 1.1), // T1_L2 vs (T2_L3 * 1.1)
                        l3: pi_unit_values_l3.t1
                    }
                };
                
                // 2-2. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë³´ì • ìœ ë‹› ê³„ì‚° (L1, L2, L3) - T1-T6 ì „ì²´ ì°¸ì—¬
                const lb_final_reward_units_per_person = {
                    t6: {
                        l1: lb_multipliers.t6 * weights.l1,
                        l2: lb_multipliers.t6 * weights.l2, // T6ì€ ìµœí•˜ìœ„ì´ë¯€ë¡œ ë³´ì • ì—†ìŒ
                        l3: lb_unit_values_l3.t6
                    },
                    t5: {
                        l1: lb_multipliers.t5 * weights.l1,
                        l2: Math.max(lb_multipliers.t5 * weights.l2, lb_unit_values_l3.t6 * 1.1), // T5_L2 vs (T6_L3 * 1.1)
                        l3: lb_unit_values_l3.t5
                    },
                    t4: {
                        l1: lb_multipliers.t4 * weights.l1,
                        l2: Math.max(lb_multipliers.t4 * weights.l2, lb_unit_values_l3.t5 * 1.1), // T4_L2 vs (T5_L3 * 1.1)
                        l3: lb_unit_values_l3.t4
                    },
                    t3: {
                        l1: lb_multipliers.t3 * weights.l1,
                        l2: Math.max(lb_multipliers.t3 * weights.l2, lb_unit_values_l3.t4 * 1.1), // T3_L2 vs (T4_L3 * 1.1)
                        l3: lb_unit_values_l3.t3
                    },
                    t2: {
                        l1: lb_multipliers.t2 * weights.l1,
                        l2: Math.max(lb_multipliers.t2 * weights.l2, lb_unit_values_l3.t3 * 1.1), // T2_L2 vs (T3_L3 * 1.1)
                        l3: lb_unit_values_l3.t2
                    },
                    t1: {
                        l1: lb_multipliers.t1 * weights.l1,
                        l2: Math.max(lb_multipliers.t1 * weights.l2, lb_unit_values_l3.t2 * 1.1), // T1_L2 vs (T2_L3 * 1.1)
                        l3: lb_unit_values_l3.t1
                    }
                };
                // --- ---

                // 2. "ì´ ë³´ìƒ ìœ ë‹›" ê³„ì‚° (T1-T6 í•´ë‹¹) - L3ê¹Œì§€ë§Œ ê³„ì‚°
                let total_reward_units_t1_t6 = 0;
                const tiers = ['t1', 't2', 't3', 't4', 't5', 't6'];
                let tier_details = {}; // ì¤‘ê°„ ë°ì´í„° ì €ì¥

                tiers.forEach(tier => {
                    const tier_counts_l1 = t_counts[tier].l1;
                    const tier_counts_l2 = t_counts[tier].l2;
                    const tier_counts_l3 = t_counts[tier].l3;
                    const tier_total_count = tier_counts_l1 + tier_counts_l2 + tier_counts_l3;
                    
                    let tier_reward_units = 0;
                    // [MODIFIED] ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë³´ì • ìœ ë‹›(pi_final_reward_units_per_person)ì„ ì‚¬ìš©
                    tier_reward_units += tier_counts_l1 * pi_final_reward_units_per_person[tier].l1;
                    tier_reward_units += tier_counts_l2 * pi_final_reward_units_per_person[tier].l2;
                    tier_reward_units += tier_counts_l3 * pi_final_reward_units_per_person[tier].l3;
                    
                    total_reward_units_t1_t6 += tier_reward_units;
                    
                    tier_details[tier] = {
                        tier_total_count: tier_total_count,
                        tier_reward_units: tier_reward_units
                    };
                });
                
                // 3-1. ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ "ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡" ê³„ì‚° (ë¦¬ë” ì¬ëŸ‰ ê¸ˆì•¡ ì œì™¸ í›„ ë°°ë¶„)
                const master_base_value = (total_reward_units_t1_t6 > 0) ? (distributionIncentivePool / total_reward_units_t1_t6) : 0;
                
                // 3-2. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ "ì´ ë³´ìƒ ìœ ë‹›" ê³„ì‚° (ë…ë¦½ì ì¸ ë°°ìœ¨ ì‚¬ìš©)
                let lb_total_reward_units_t1_t6 = 0;
                tiers.forEach(tier => {
                    const tier_counts_l1 = t_counts[tier].l1;
                    const tier_counts_l2 = t_counts[tier].l2;
                    const tier_counts_l3 = t_counts[tier].l3;
                    
                    let lb_tier_reward_units = 0;
                    lb_tier_reward_units += tier_counts_l1 * lb_final_reward_units_per_person[tier].l1;
                    lb_tier_reward_units += tier_counts_l2 * lb_final_reward_units_per_person[tier].l2;
                    lb_tier_reward_units += tier_counts_l3 * lb_final_reward_units_per_person[tier].l3;
                    
                    lb_total_reward_units_t1_t6 += lb_tier_reward_units;
                });
                
                // 3-3. ëŸ°ì¹­ ë³´ë„ˆìŠ¤ "ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡" ê³„ì‚°
                const lb_master_base_value_t1_t6 = (lb_total_reward_units_t1_t6 > 0) ? (totalLaunchBonus_t1_t6 / lb_total_reward_units_t1_t6) : 0;

                // T7 ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ê³„ì‚° (ë¹„ì°¸ì—¬ì - 0ì›)
                const lb_t7_reward_units = 0;
                const lb_t7_master_base = 0; // T7ì€ ë¹„ì°¸ì—¬ì, ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¯¸ì§€ê¸‰


                // 4. UI ë Œë”ë§ì„ ìœ„í•œ ë°ì´í„° ì§‘ê³„ (L3ê¹Œì§€ë§Œ)
                let tierData = [];
                let total_headcount_t1_t6 = 0, total_incentive_t1_t6 = 0, total_lb_t1_t6 = 0;
                let total_incentive_t1_t2 = 0, total_headcount_t1_t2 = 0; 
                let total_lb_incentive_t1_t2 = 0, total_lb_headcount_t1_t2 = 0;

                tiers.forEach(tier => {
                    const { tier_total_count, tier_reward_units } = tier_details[tier];
                    const tier_counts_l1 = t_counts[tier].l1;
                    const tier_counts_l2 = t_counts[tier].l2;
                    const tier_counts_l3 = t_counts[tier].l3;
                    
                    const tier_total_incentive = master_base_value * tier_reward_units;
                    
                    // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ëŠ” ë³„ë„ì˜ reward units ê³„ì‚° í•„ìš” (ë…ë¦½ì ì¸ ë°°ìœ¨ ì‚¬ìš©)
                    let lb_tier_reward_units = 0;
                    lb_tier_reward_units += tier_counts_l1 * lb_final_reward_units_per_person[tier].l1;
                    lb_tier_reward_units += tier_counts_l2 * lb_final_reward_units_per_person[tier].l2;
                    lb_tier_reward_units += tier_counts_l3 * lb_final_reward_units_per_person[tier].l3;
                    const lb_tier_total_incentive = lb_master_base_value_t1_t6 * lb_tier_reward_units;

                    // 1ì¸ë‹¹ ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ì§€ê¸‰ì•¡ (ë³´ì •ëœ ìœ ë‹› ê¸°ì¤€)
                    const individual_values = {
                        l1: master_base_value * pi_final_reward_units_per_person[tier].l1,
                        l2: master_base_value * pi_final_reward_units_per_person[tier].l2,
                        l3: master_base_value * pi_final_reward_units_per_person[tier].l3
                    };
                    // 1ì¸ë‹¹ ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ì§€ê¸‰ì•¡ (ë³´ì •ëœ ìœ ë‹› ê¸°ì¤€)
                    const lb_individual_values = {
                        l1: lb_master_base_value_t1_t6 * lb_final_reward_units_per_person[tier].l1,
                        l2: lb_master_base_value_t1_t6 * lb_final_reward_units_per_person[tier].l2,
                        l3: lb_master_base_value_t1_t6 * lb_final_reward_units_per_person[tier].l3
                    };

                    tierData.push({ tier, tier_total_count, tier_total_incentive, individual_values, lb_tier_total_incentive, lb_individual_values });
                    
                    total_headcount_t1_t6 += tier_total_count;
                    total_incentive_t1_t6 += tier_total_incentive;
                    total_lb_t1_t6 += lb_tier_total_incentive; // (100-X)% í’€ í•©ê³„
                    
                    if (tier === 't1' || tier === 't2') {
                        total_headcount_t1_t2 += tier_total_count;
                        total_incentive_t1_t2 += tier_total_incentive;
                        
                        total_lb_headcount_t1_t2 += tier_total_count;
                        total_lb_incentive_t1_t2 += lb_tier_total_incentive;
                    }
                });
                
                // ---------------------
                // Phase 3.5: ì¸ì›ìˆ˜ ì œí•œ (Warning) ë¡œì§
                // ---------------------
                
                // T1-T6 ì´ ì¸ì› (total_headcount_t1_t6ëŠ” ì´ë¯¸ 1910ë¼ì¸ì—ì„œ ê³„ì‚°ë¨)
                const t1_total = tier_details['t1'].tier_total_count;
                const t2_total = tier_details['t2'].tier_total_count;
                const t3_total = tier_details['t3'].tier_total_count;
                const t123_total = t1_total + t2_total + t3_total;

                let warnings = [];
                if (total_headcount_t1_t6 > 0) {
                    const t1_perc = t1_total / total_headcount_t1_t6;
                    const t2_perc = t2_total / total_headcount_t1_t6;
                    const t3_perc = t3_total / total_headcount_t1_t6;
                    const t123_perc = t123_total / total_headcount_t1_t6;

                    if (t1_perc >= 0.05) {
                        warnings.push(`T1 ì¸ì› (${t1_total}ëª…, ${formatPercentage(t1_perc)})ì´ 5% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬ í•œë„: ${Math.floor(total_headcount_t1_t6 * 0.05 - 0.0001)}ëª…)`);
                    }
                    if (t2_perc >= 0.10) {
                        warnings.push(`T2 ì¸ì› (${t2_total}ëª…, ${formatPercentage(t2_perc)})ì´ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬ í•œë„: ${Math.floor(total_headcount_t1_t6 * 0.10 - 0.0001)}ëª…)`);
                    }
                    if (t3_perc >= 0.20) {
                        warnings.push(`T3 ì¸ì› (${t3_total}ëª…, ${formatPercentage(t3_perc)})ì´ 20% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬ í•œë„: ${Math.floor(total_headcount_t1_t6 * 0.20 - 0.0001)}ëª…)`);
                    }
                    if (t123_perc > 0.35) {
                        warnings.push(`T1-T3 í•©ê³„ ì¸ì› (${t123_total}ëª…, ${formatPercentage(t123_perc)})ì´ 35% ì´í•˜ì´ì–´ì•¼ í•©ë‹ˆë‹¤. (í˜„ì¬ í•œë„: ${Math.floor(total_headcount_t1_t6 * 0.35)}ëª…)`);
                    }
                }
                const warningEl = document.getElementById('headcountWarning');
                if (warnings.length > 0) {
                    warningEl.innerHTML = '<ul class="list-disc pl-5 space-y-1">' + warnings.map(w => `<li>${w}</li>`).join('') + '</ul>';
                    warningEl.style.display = 'block';
                } else {
                    warningEl.innerHTML = '';
                    warningEl.style.display = 'none';
                }


                // ---------------------
                // Phase 4: UI ë Œë”ë§ (Step 3)
                // ---------------------
                
                // KPI
                setText('totalIncentivePool', formatCurrencyBillion(totalIncentivePool));
                setText('leaderDiscretionAmountDisplay', formatCurrencyDisplay(leaderDiscretionAmount) + ` (${(leaderDiscretionRate * 100).toFixed(1)}%)`);
                setText('distributionIncentivePoolDisplay', formatCurrencyDisplay(distributionIncentivePool) + ` (${((1 - leaderDiscretionRate) * 100).toFixed(1)}%)`);
                setText('lb_total_incentive_distributed', formatCurrencyBillion(totalLaunchBonusPool)); // ìŠ¬ë¼ì´ë” ì´ì•¡
                setText('calculatedROI', calculatedROI_pct.toFixed(1) + '%');
                setText('calculatedIncentiveRate', (incentiveRate * 100).toFixed(0) + '%');
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ 3íšŒ ë¶„í•  ê¸ˆì•¡ ê³„ì‚° ë° í‘œì‹œ
                const lbPayment1 = totalLaunchBonusPool / 3; // 33.33%
                const lbPayment2 = totalLaunchBonusPool / 3; // 33.33%
                const lbPayment3 = totalLaunchBonusPool / 3; // 33.33%
                setText('lb_payment_1', formatCurrencyDisplay(lbPayment1));
                setText('lb_payment_2', formatCurrencyDisplay(lbPayment2));
                setText('lb_payment_3', formatCurrencyDisplay(lbPayment3));

                // ìš”ì•½ í…ìŠ¤íŠ¸ (T1-T6 ì°¸ì—¬ì)
                setText('dynamic_total_headcount', total_headcount_t1_t6.toLocaleString('ko-KR'));
                setText('dynamic_target_count', total_headcount_t1_t6.toLocaleString('ko-KR'));

                // ë””ë²„ê¹… ë¡œê·¸
                console.log('===== Step 3 ê³„ì‚° ê²°ê³¼ =====');
                console.log('ì´ ì¸ì„¼í‹°ë¸Œ í’€:', formatCurrencyDisplay(totalIncentivePool));
                console.log('ì´ ëŸ°ì¹­ ë³´ë„ˆìŠ¤ í’€:', formatCurrencyDisplay(totalLaunchBonusPool));
                console.log('T1-T6 ì´ ì¸ì›:', total_headcount_t1_t6);
                console.log('ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡:', master_base_value.toLocaleString('ko-KR'));
                console.log('ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë§ˆìŠ¤í„° ê¸°ì¤€ì•¡:', lb_master_base_value_t1_t6.toLocaleString('ko-KR'));
                console.log('ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ Multipliers:', pi_multipliers);
                console.log('ëŸ°ì¹­ ë³´ë„ˆìŠ¤ Multipliers:', lb_multipliers);
                console.log('ì„±ê³¼ T6â†’T5 ë¹„ìœ¨:', pi_t6_t5_rate);
                console.log('ì„±ê³¼ T5â†’T4 ë¹„ìœ¨:', pi_t5_t4_rate);
                console.log('ëŸ°ì¹­ T6â†’T5 ë¹„ìœ¨:', lb_t6_t5_rate_mult);
                console.log('ëŸ°ì¹­ T5â†’T4 ë¹„ìœ¨:', lb_t5_t4_rate_mult);
                console.log('T5 ì¸ì›:', t_counts.t5);
                console.log('===========================');

                // --- T6-L3 ê¸°ì¤€ê°’ ê³„ì‚° (ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ) ---
                const t6_l3_base_value = master_base_value * pi_final_reward_units_per_person.t6.l3; 
                
                // ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ í…Œì´ë¸” (T1-T4)
                tierData.forEach(tier => {
                    const { tier: tierName, tier_total_count, tier_total_incentive, individual_values } = tier;
                    setText(`${tierName}_total_count`, tier_total_count.toLocaleString('ko-KR'));
                    setText(`${tierName}_total_incentive`, formatCurrencyDisplay(tier_total_incentive));
                    
                    // T6-L3 ê¸°ì¤€ ëŒ€ë¹„ ë¹„ìœ¨ ê³„ì‚° í•¨ìˆ˜
                    function getPercentageString(value) {
                        if (t6_l3_base_value === 0) return '';
                        const absolutePercentage = (value / t6_l3_base_value * 100).toFixed(0);
                        return `(${absolutePercentage}%)`;
                    }
                    
                    const l1_value = individual_values.l1;
                    const l2_value = individual_values.l2;
                    const l3_value = individual_values.l3;
                    
                    // ì „ì—­ ë³€ìˆ˜ì— ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ ê°’ ì €ì¥ (Tab 3ì—ì„œ ì‚¬ìš©)
                    calculatedIncentiveValues[tierName] = {
                        l1: l1_value,
                        l2: l2_value,
                        l3: l3_value
                    };

                    setText(`${tierName}_l1_value`, formatCurrency(l1_value));
                    setText(`${tierName}_l1_perc`, getPercentageString(l1_value));
                    setText(`${tierName}_l2_value`, formatCurrency(l2_value));
                    setText(`${tierName}_l2_perc`, getPercentageString(l2_value));
                    setText(`${tierName}_l3_value`, formatCurrency(l3_value));
                    setText(`${tierName}_l3_perc`, getPercentageString(l3_value));
                });
                
                // T1+T2 KPI Footer
                const t1_t2_perc = (total_incentive_t1_t6 > 0) ? (total_incentive_t1_t2 / total_incentive_t1_t6 * 100) : 0;
                setText('total_ppl_t1_t2', total_headcount_t1_t2.toLocaleString('ko-KR'));
                setText('total_incentive_t1_t2', formatCurrencyDisplay(total_incentive_t1_t2));
                setText('total_incentive_t1_t2_perc', t1_t2_perc.toFixed(1) + '%');
                
                // <tfoot> Total
                setText('total_ppl_incentive', total_headcount_t1_t6.toLocaleString('ko-KR'));
                setText('total_incentive_distributed', formatCurrencyDisplay(total_incentive_t1_t6));
                
                
                // --- T6-L3 ê¸°ì¤€ê°’ ê³„ì‚° (ëŸ°ì¹­ ë³´ë„ˆìŠ¤) ---
                const lb_t6_l3_base_value = lb_master_base_value_t1_t6 * lb_final_reward_units_per_person.t6.l3;
                
                console.log('===== ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ê³„ì‚° =====');
                console.log('lb_master_base_value_t1_t6:', lb_master_base_value_t1_t6.toLocaleString('ko-KR'));
                console.log('totalLaunchBonus_t1_t6:', totalLaunchBonus_t1_t6.toLocaleString('ko-KR'));
                console.log('lb_total_reward_units_t1_t6:', lb_total_reward_units_t1_t6);
                console.log('tierData ê°œìˆ˜:', tierData.length);
                tierData.forEach((t, idx) => {
                    console.log(`Tier ${idx}: ${t.tier}, ì¸ì›: ${t.tier_total_count}, LB ì´ì•¡: ${t.lb_tier_total_incentive.toLocaleString('ko-KR')}`);
                    if (t.tier === 't5') {
                        console.log('  â†’ T5 ìƒì„¸:', {
                            l1_ì¸ì›: t_counts.t5.l1,
                            l2_ì¸ì›: t_counts.t5.l2,
                            l3_ì¸ì›: t_counts.t5.l3,
                            l1_ê¸ˆì•¡: t.lb_individual_values.l1.toLocaleString('ko-KR'),
                            l2_ê¸ˆì•¡: t.lb_individual_values.l2.toLocaleString('ko-KR'),
                            l3_ê¸ˆì•¡: t.lb_individual_values.l3.toLocaleString('ko-KR')
                        });
                    }
                });
                console.log('========================');
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ T1-T6 í…Œì´ë¸” ((100-X)% í’€ ì‚¬ìš©)
                tierData.forEach(tier => {
                    const { tier: tierName, tier_total_count, lb_tier_total_incentive, lb_individual_values } = tier;
                    
                    setText(`lb_${tierName}_total_count`, tier_total_count.toLocaleString('ko-KR'));
                    setText(`lb_${tierName}_total_incentive`, formatCurrencyDisplay(lb_tier_total_incentive));
                    
                    // T6-L3 ê¸°ì¤€ ëŒ€ë¹„ ë¹„ìœ¨ ê³„ì‚° í•¨ìˆ˜
                    function getLbPercentageString(value) {
                        if (lb_t6_l3_base_value === 0) return '';
                        const absolutePercentage = (value / lb_t6_l3_base_value * 100).toFixed(0);
                        return `(${absolutePercentage}%)`;
                    }
                    
                    const lb_l1_value = lb_individual_values.l1;
                    const lb_l2_value = lb_individual_values.l2;
                    const lb_l3_value = lb_individual_values.l3;
                    
                    // ì „ì—­ ë³€ìˆ˜ì— ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ê°’ ì €ì¥ (Tab 3ì—ì„œ ì‚¬ìš©)
                    calculatedBonusValues[tierName] = {
                        l1: lb_l1_value,
                        l2: lb_l2_value,
                        l3: lb_l3_value
                    };

                    setText(`lb_${tierName}_l1_value`, formatCurrency(lb_l1_value));
                    setText(`lb_${tierName}_l1_perc`, getLbPercentageString(lb_l1_value));
                    setText(`lb_${tierName}_l2_value`, formatCurrency(lb_l2_value));
                    setText(`lb_${tierName}_l2_perc`, getLbPercentageString(lb_l2_value));
                    setText(`lb_${tierName}_l3_value`, formatCurrency(lb_l3_value));
                    setText(`lb_${tierName}_l3_perc`, getLbPercentageString(lb_l3_value));
                });
                
                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ T1+T2 KPI Footer
                const lb_t1_t2_perc = (total_lb_t1_t6 > 0) ? (total_lb_incentive_t1_t2 / total_lb_t1_t6 * 100) : 0;
                setText('lb_total_ppl_t1_t2', total_lb_headcount_t1_t2.toLocaleString('ko-KR'));
                setText('lb_total_incentive_t1_t2', formatCurrencyDisplay(total_lb_incentive_t1_t2));
                setText('lb_total_incentive_t1_t2_perc', lb_t1_t2_perc.toFixed(1) + '%');
                
                // <tfoot> Total
                setText('lb_total_ppl_incentive', total_headcount_t1_t6.toLocaleString('ko-KR')); // T1-T6 ì´ ì¸ì›
                setText('lb_total_distributed', formatCurrencyDisplay(total_lb_t1_t6)); // T1-T6 ì´ ëŸ°ì¹­ë³´ë„ˆìŠ¤ ((100-X)% í’€)
                
                
                // --- T7-L3 ê¸°ì¤€ê°’ ê³„ì‚° (T7 ë¹„ì°¸ì—¬ì ëŸ°ì¹­ ë³´ë„ˆìŠ¤) ---
                const lb_t7_l3_base_value = lb_t7_master_base * weights.l3;

                // ëŸ°ì¹­ ë³´ë„ˆìŠ¤ T7 í…Œì´ë¸” (ë¹„ì°¸ì—¬ì - 0ì›)
                // ì´ ë°°ë¶„ì•¡ (footer)
                const lb_t7_total_incentive = 0;
                setText('lb_t7_total', formatCurrencyDisplay(lb_t7_total_incentive));

                function getLbT7PercentageString(value) {
                    return '(0%)'; // T7ì€ ë¹„ì°¸ì—¬ì, í•­ìƒ 0%
                }

                // 1ì¸ë‹¹ ì§€ê¸‰ì•¡ (T7ì€ ë¹„ì°¸ì—¬ì - 0ì›)
                const lb_t7_l1_value = 0;
                const lb_t7_l2_value = 0;
                const lb_t7_l3_value = 0;

                setText('lb_t7_l1_value', formatCurrency(lb_t7_l1_value));
                setText('lb_t7_l1_perc', getLbT7PercentageString(lb_t7_l1_value));
                
                setText('lb_t7_l2_value', formatCurrency(lb_t7_l2_value));
                setText('lb_t7_l2_perc', getLbT7PercentageString(lb_t7_l2_value));
                
                setText('lb_t7_l3_value', formatCurrency(lb_t7_l3_value));
                setText('lb_t7_l3_perc', getLbT7PercentageString(lb_t7_l3_value));
                
                // ì´ ì¸ì› (footer)
                const total_headcount_t7_calc = lb_t7_countsArr.reduce((a, b) => a + b, 0);
                setText('lb_t7_total_ppl', total_headcount_t7_calc.toLocaleString('ko-KR'));
                
                // T7 í’€ í• ë‹¹ ë¹„ìœ¨ UI ì—…ë°ì´íŠ¸
                setText('lb_t7_pool_rate_display', lb_t7_rate_percent + '%');
                
                // ë¦¬ë” ë·° KPI ì—…ë°ì´íŠ¸
                if (typeof updateLeaderViewKPIs === 'function') {
                    updateLeaderViewKPIs();
                }
                
                // ì£¼ì˜: Tab 3 í…Œì´ë¸” ì—…ë°ì´íŠ¸ëŠ” updateEmployeeTable()ì—ì„œ í˜¸ì¶œ
                // ë¬´í•œ ë£¨í”„ ë°©ì§€ë¥¼ ìœ„í•´ ì—¬ê¸°ì„œëŠ” í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
            }
            
            function formatPercentage(num) {
                return (num * 100).toFixed(1) + '%';
            }

            // ####################
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            // ####################

            // í˜ì´ì§€ ë‚´ì˜ ëª¨ë“  input, select, range ìš”ì†Œì˜ 'input' ì´ë²¤íŠ¸ì— ëŒ€í•´ ë‹¨ì¼ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš©
            document.body.addEventListener('input', (event) => {
                const target = event.target;
                
                // ë¦¬ë” ì¬ëŸ‰ ìŠ¬ë¼ì´ë” í‘œì‹œ ì—…ë°ì´íŠ¸
                if (target.matches('#leaderDiscretionSlider')) {
                    const value = target.value;
                    document.getElementById('leaderDiscretionDisplay').textContent = value + '%';
                }
                
                // MG ìŠ¬ë¼ì´ë” í‘œì‹œ ì—…ë°ì´íŠ¸
                if (target.matches('#mg_slider')) {
                    const value = target.value;
                    document.getElementById('mg_display').textContent = value + 'ì–µì›';
                }
                
                if (target.matches('input') || target.matches('select') || 
                    target.matches('#total_investment_slider') || target.matches('#launchBonusSlider') || 
                    target.matches('#mg_slider') || target.matches('#lb_t5_pool_rate_slider') || 
                    target.matches('#leaderDiscretionSlider') ||
                    target.matches('#roi_rate_0_100') || target.matches('#roi_rate_100_150') ||
                    target.matches('#roi_rate_150_200') || target.matches('#roi_rate_200_300') ||
                    target.matches('#roi_rate_300_plus')) {
                    calculateAll();
                }
            });

            // ROI ì¸ì„¼í‹°ë¸Œ ë¹„ìœ¨ ì…ë ¥ í•„ë“œì— change ì´ë²¤íŠ¸ë„ ì¶”ê°€ (ë”ë¸” ì²´í¬)
            document.body.addEventListener('change', (event) => {
                const target = event.target;
                if (target.matches('.rate-input')) {
                    calculateAll();
                }
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ DOMì´ ì™„ì „íˆ ì¤€ë¹„ëœ í›„ ê³„ì‚°
            // setTimeoutì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ìš”ì†Œê°€ ë Œë”ë§ëœ í›„ ì‹¤í–‰
            setTimeout(() => {
                calculateAll();
            }, 150);

            // ####################
            // Tab Management
            // ####################
            const tab1Button = document.getElementById('tab1-button');
            const tab2Button = document.getElementById('tab2-button');
            const tab1Content = document.getElementById('tab1-content');
            const tab2Content = document.getElementById('tab2-content');

            // Tab 2 ì•”í˜¸ ê´€ë¦¬
            let isTab2Unlocked = false;
            const TAB2_PASSWORD = 'Eodzb150!';

            function switchTab(tabNumber) {
                if (tabNumber === 1) {
                    tab1Button.classList.add('border-indigo-500', 'text-indigo-600');
                    tab1Button.classList.remove('border-transparent', 'text-gray-500');
                    tab2Button.classList.add('border-transparent', 'text-gray-500');
                    tab2Button.classList.remove('border-indigo-500', 'text-indigo-600');
                    tab1Content.classList.remove('hidden');
                    tab2Content.classList.add('hidden');
                } else {
                    tab2Button.classList.add('border-indigo-500', 'text-indigo-600');
                    tab2Button.classList.remove('border-transparent', 'text-gray-500');
                    tab1Button.classList.add('border-transparent', 'text-gray-500');
                    tab1Button.classList.remove('border-indigo-500', 'text-indigo-600');
                    tab2Content.classList.remove('hidden');
                    tab1Content.classList.add('hidden');
                }
            }

            function showPasswordModal() {
                const password = prompt('Tab 2 ì ‘ê·¼ì„ ìœ„í•œ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                
                if (password === null) {
                    // ì‚¬ìš©ìê°€ ì·¨ì†Œë¥¼ ëˆ„ë¥¸ ê²½ìš°
                    return false;
                }
                
                if (password === TAB2_PASSWORD) {
                    isTab2Unlocked = true;
                    return true;
                } else {
                    alert('ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                    return false;
                }
            }

            tab1Button.addEventListener('click', () => switchTab(1));
            tab2Button.addEventListener('click', () => {
                if (!isTab2Unlocked) {
                    if (showPasswordModal()) {
                        switchTab(2);
                    }
                } else {
                    switchTab(2);
                }
            });

            // ####################
            // Employee Management
            // ####################
            
            // Initialize date dropdowns
            const baseYear = document.getElementById('baseYear');
            const baseMonth = document.getElementById('baseMonth');
            const baseDay = document.getElementById('baseDay');

            // Get current date
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth() + 1;
            const currentDay = today.getDate();

            // Populate year dropdown (2020-2030)
            for (let year = 2020; year <= 2030; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'ë…„';
                if (year === currentYear) option.selected = true;
                baseYear.appendChild(option);
            }

            // Populate month dropdown
            for (let month = 1; month <= 12; month++) {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month + 'ì›”';
                if (month === currentMonth) option.selected = true;
                baseMonth.appendChild(option);
            }

            // Populate day dropdown
            function updateDays() {
                const year = parseInt(baseYear.value);
                const month = parseInt(baseMonth.value);
                const daysInMonth = new Date(year, month, 0).getDate();
                const currentSelectedDay = parseInt(baseDay.value) || currentDay;
                
                baseDay.innerHTML = '';
                for (let day = 1; day <= daysInMonth; day++) {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = day + 'ì¼';
                    // Keep the selected day if it exists in the new month, otherwise use the last day
                    if (day === Math.min(currentSelectedDay, daysInMonth)) {
                        option.selected = true;
                    }
                    baseDay.appendChild(option);
                }

                // Update employee table when date changes (only if employees are loaded)
                if (employees && employees.length > 0) {
                    updateEmployeeTable();
                }
            }

            // Employee data management
            let employees = [];

            // Load initial employee data from CSV
            const initialEmployees = [
                // CSV data loaded from í˜¸ë‘(í”„ë¡œì íŠ¸OQ)_Tier6_20251105.csv (2025-11-05)
                // Tier 6 System: T1-T6 (ì°¸ì—¬ì) + T7 (ë¹„ì°¸ì—¬ì, ëŸ°ì¹­ ë³´ë„ˆìŠ¤ ë¯¸ì§€ê¸‰)
                {id: "SP004", name: "ê¹€íš¨ì •", tier: 5, joinDate: "2022-04-01", salary: 61400000},
                {id: "SP025", name: "ê¹€ìœ¤ì¬", tier: 4, joinDate: "2025-07-23", salary: 52300000},
                {id: "SP028", name: "ìœ¤ì˜ì¤€", tier: 4, joinDate: "2024-07-15", salary: 68500000},
                {id: "SP041", name: "í™©í˜„ì‹", tier: 3, joinDate: "2025-07-23", salary: 106000000},
                {id: "SP042", name: "ìµœìµí•„", tier: 1, joinDate: "2022-04-01", salary: 136000000},
                {id: "SP048", name: "ìœ í˜¸ì˜", tier: 3, joinDate: "2025-07-23", salary: 119000000},
                {id: "SP052", name: "ëª¨ì„±ë¯¼", tier: 4, joinDate: "2025-07-23", salary: 49300000},
                {id: "SP071", name: "ì†¡ì§„ë¯¼", tier: 4, joinDate: "2025-07-23", salary: 81000000},
                {id: "SP075", name: "ê°•ë„í™", tier: 3, joinDate: "2022-04-01", salary: 52000000},
                {id: "SP083", name: "ì°¨ì¤€ì˜", tier: 3, joinDate: "2022-04-01", salary: 45000000},
                {id: "SP098", name: "ì¡°í¬ì„ ", tier: 2, joinDate: "2022-04-01", salary: 101000000},
                {id: "SP109", name: "ì´ê·¼ìˆ˜", tier: 4, joinDate: "2025-07-23", salary: 77000000},
                {id: "SP117", name: "ê¹€ë„ì—°", tier: 3, joinDate: "2025-07-23", salary: 85000000},
                {id: "SP164", name: "ì¥ê°€ëŒ", tier: 1, joinDate: "2022-04-01", salary: 57000000},
                {id: "SP190", name: "ìš°ìˆ˜ì§„", tier: 3, joinDate: "2022-04-01", salary: 64500000},
                {id: "SP224", name: "ì¡°ì‹ ìš°", tier: 3, joinDate: "2022-04-01", salary: 37500000},
                {id: "SP245", name: "ê¹€ë‹¤ì†œ", tier: 5, joinDate: "2025-01-20", salary: 62300000},
                {id: "SP249", name: "ê¹€ìˆ˜ì™„", tier: 3, joinDate: "2022-04-01", salary: 41000000},
                {id: "SP252", name: "ë°•íƒœì–‘", tier: 5, joinDate: "2025-07-23", salary: 42000000},
                {id: "SP264", name: "ìµœê·œí™˜", tier: 5, joinDate: "2024-10-23", salary: 57000000},
                {id: "SP267", name: "ì „í˜„ì¤€", tier: 5, joinDate: "2022-04-01", salary: 40000000},
                {id: "SP298", name: "ì¥ì§€ì—°", tier: 4, joinDate: "2022-04-01", salary: 39800000},
                {id: "SP299", name: "ì „ìˆ˜ë¯¼", tier: 5, joinDate: "2022-04-01", salary: 52000000},
                {id: "SP313", name: "ë°•ìƒë¯¼", tier: 3, joinDate: "2022-04-01", salary: 40500000},
                {id: "SP328", name: "í™ì„±ëª…", tier: 5, joinDate: "2022-04-01", salary: 36200000},
                {id: "SP345", name: "ì˜¤ì„±ê´‘", tier: 3, joinDate: "2025-07-23", salary: 47200000},
                {id: "SP346", name: "ìœ ê²½ë¯¼", tier: 3, joinDate: "2022-04-18", salary: 48000000},
                {id: "SP357", name: "ê¹€ì •ì—½", tier: 3, joinDate: "2022-04-18", salary: 38000000},
                {id: "SP363", name: "ìš©í™˜ë¯¼", tier: 5, joinDate: "2022-05-02", salary: 34600000},
                {id: "SP370", name: "ì •í˜œì˜", tier: 5, joinDate: "2022-05-16", salary: 39000000},
                {id: "SP371", name: "ê¹€ìƒì¡°", tier: 4, joinDate: "2022-05-16", salary: 47600000},
                {id: "SP380", name: "ì§€í˜œì–‘", tier: 5, joinDate: "2022-05-30", salary: 40500000},
                {id: "SP382", name: "ì •ìœ¤ì£¼", tier: 5, joinDate: "2025-07-23", salary: 45500000},
                {id: "SP401", name: "ê°•ì€í¬", tier: 5, joinDate: "2022-06-27", salary: 40400000},
                {id: "SP409", name: "ê¹€í˜•ì°¬", tier: 3, joinDate: "2022-07-04", salary: 51000000},
                {id: "SP418", name: "ì „í˜œì§€", tier: 5, joinDate: "2025-07-23", salary: 41100000},
                {id: "SP419", name: "ì´ê²½ì§„B", tier: 5, joinDate: "2025-07-23", salary: 37800000},
                {id: "SP430", name: "ì†¡ì¤€í˜¸", tier: 4, joinDate: "2025-07-23", salary: 103500000},
                {id: "SP491", name: "ì¶”ì—°ì±„", tier: 5, joinDate: "2024-10-23", salary: 54000000},
                {id: "SP504", name: "ì •í¬ì—°", tier: 5, joinDate: "2025-01-20", salary: 36000000},
                {id: "SP505", name: "ì´ì¤€í˜¸", tier: 5, joinDate: "2025-01-20", salary: 36200000},
                {id: "SP508", name: "ê¹€ì€í¬", tier: 5, joinDate: "2023-01-09", salary: 36000000},
                {id: "SP524", name: "ì„œì„±ì² ", tier: 4, joinDate: "2023-01-30", salary: 68500000},
                {id: "SP531", name: "ì´ì¬ì²­", tier: 6, joinDate: "2023-03-06", salary: 92500000},
                {id: "SP535", name: "ê¹€ì¬ê¸°", tier: 4, joinDate: "2025-07-23", salary: 92400000},
                {id: "SP536", name: "ì¡°í˜„ê¸°", tier: 3, joinDate: "2023-03-27", salary: 77500000},
                {id: "SP538", name: "ê¹€ì˜í•˜", tier: 4, joinDate: "2023-03-27", salary: 39000000},
                {id: "SP559", name: "ê¹€ì£¼ì—°", tier: 3, joinDate: "2023-05-15", salary: 37500000},
                {id: "SP564", name: "ë‚¨ë‹¤ìœ„", tier: 5, joinDate: "2023-05-30", salary: 75200000},
                {id: "SP574", name: "ì¡°ë™ì£¼", tier: 5, joinDate: "2023-06-12", salary: 42000000},
                {id: "SP584", name: "ë°•ì¸í™˜", tier: 1, joinDate: "2023-07-10", salary: 100000000},
                {id: "SP590", name: "ì´ì¼ê·œ", tier: 5, joinDate: "2025-07-21", salary: 43700000},
                {id: "SP592", name: "ìµœì§€ì—°", tier: 4, joinDate: "2023-09-11", salary: 47600000},
                {id: "SP597", name: "ì†¡ê¸°í˜„", tier: 5, joinDate: "2024-11-01", salary: 35400000},
                {id: "SP598", name: "ê¹€ì˜ì€", tier: 5, joinDate: "2023-09-25", salary: 35400000},
                {id: "SP606", name: "ì´ê²½ë¯¼", tier: 5, joinDate: "2023-10-23", salary: 47900000},
                {id: "SP607", name: "ê¹€í•´í˜„", tier: 5, joinDate: "2023-10-23", salary: 64900000},
                {id: "SP614", name: "ê¹€ìœ¤ì„ ", tier: 5, joinDate: "2023-10-30", salary: 42500000},
                {id: "SP625", name: "ì„œë¯¸ì •", tier: 4, joinDate: "2023-11-13", salary: 50500000},
                {id: "SP631", name: "ì¡°ìƒí˜¸", tier: 5, joinDate: "2023-11-27", salary: 62500000},
                {id: "SP638", name: "ì‹ ì§€í›ˆ", tier: 5, joinDate: "2025-07-23", salary: 42300000},
                {id: "SP643", name: "ê¸°íƒœì–‘", tier: 5, joinDate: "2024-01-02", salary: 35800000},
                {id: "SP644", name: "ìµœíš¨ì¬", tier: 4, joinDate: "2024-01-02", salary: 50100000},
                {id: "SP645", name: "ì„ì¬ì—½", tier: 5, joinDate: "2024-01-02", salary: 56300000},
                {id: "SP654", name: "ì•ˆì£¼í˜„", tier: 6, joinDate: "2024-01-22", salary: 55500000},
                {id: "SP656", name: "ìœ¤ë¯¼ìš°", tier: 3, joinDate: "2024-01-22", salary: 63500000},
                {id: "SP665", name: "ì •ê²½ì›", tier: 4, joinDate: "2024-03-11", salary: 42000000},
                {id: "SP668", name: "ì´ì¬í™˜", tier: 5, joinDate: "2024-03-18", salary: 59900000},
                {id: "SP669", name: "ê°•ì§„ì‹¤", tier: 5, joinDate: "2024-03-18", salary: 48000000},
                {id: "SP671", name: "ê°•ë™í˜¸", tier: 4, joinDate: "2024-04-15", salary: 70500000},
                {id: "SP672", name: "ê¹€ìˆ˜ì§„", tier: 5, joinDate: "2024-04-15", salary: 61300000},
                {id: "SP675", name: "ë°•ì •ê· ", tier: 4, joinDate: "2024-04-15", salary: 61700000},
                {id: "SP676", name: "ìœ ì°½ë¯¼", tier: 5, joinDate: "2024-04-22", salary: 48000000},
                {id: "SP677", name: "ì •ì£¼í›ˆ", tier: 4, joinDate: "2024-04-29", salary: 84100000},
                {id: "SP687", name: "ìœ¤í˜œì§€", tier: 4, joinDate: "2024-05-13", salary: 46000000},
                {id: "SP690", name: "ì´ì •íƒœ", tier: 4, joinDate: "2024-05-27", salary: 47000000},
                {id: "SP693", name: "ì†ì˜ë°°", tier: 5, joinDate: "2024-06-03", salary: 55000000},
                {id: "SP695", name: "ì´ì„±ìš°", tier: 5, joinDate: "2024-06-24", salary: 77500000},
                {id: "SP699", name: "ê¹€ë¯¼ì„", tier: 3, joinDate: "2024-07-08", salary: 86000000},
                {id: "SP700", name: "ì•ˆì°½ìš©", tier: 4, joinDate: "2024-07-08", salary: 47500000},
                {id: "SP704", name: "ìµœí¬ì¤€", tier: 5, joinDate: "2024-07-15", salary: 33900000},
                {id: "SP705", name: "ì±„ì¢…ìˆ˜", tier: 5, joinDate: "2024-07-15", salary: 33900000},
                {id: "SP706", name: "ê¹€ìˆ˜ì§„B", tier: 5, joinDate: "2024-07-15", salary: 33900000},
                {id: "SP707", name: "ì§„ì˜í›ˆ", tier: 5, joinDate: "2025-01-20", salary: 33900000},
                {id: "SP710", name: "ê¹€ì„ í™", tier: 5, joinDate: "2025-07-23", salary: 35500000},
                {id: "SP711", name: "ì´í˜„ë¯¼", tier: 5, joinDate: "2024-07-22", salary: 86100000},
                {id: "SP720", name: "ë°•ì—°í¬", tier: 5, joinDate: "2025-07-23", salary: 37000000},
                {id: "SP722", name: "ë…¸í˜•ì›", tier: 5, joinDate: "2024-09-09", salary: 53000000},
                {id: "SP728", name: "ê¹€ì£¼í˜•", tier: 5, joinDate: "2024-10-28", salary: 39000000},
                {id: "SP730", name: "ë°•í˜•ìš°", tier: 5, joinDate: "2024-11-04", salary: 59000000},
                {id: "SP731", name: "ì´ì¬í˜•", tier: 5, joinDate: "2024-11-04", salary: 55008000},
                {id: "SP735", name: "ì´ìš±ì„ ", tier: 4, joinDate: "2024-12-09", salary: 71000000},
                {id: "SP737", name: "ìœ¤í˜•ê¸°", tier: 5, joinDate: "2024-12-16", salary: 67500000},
                {id: "SP739", name: "ì˜¤ì„±í˜", tier: 5, joinDate: "2025-01-06", salary: 33000000},
                {id: "SP744", name: "ì´ì„í˜¸", tier: 3, joinDate: "2025-03-04", salary: 130000000},
                {id: "SP754", name: "ì¥ìˆ˜ë¯¼", tier: 2, joinDate: "2025-07-23", salary: 140000000},
                {id: "SP755", name: "ì†íš¨ì‹", tier: 5, joinDate: "2025-05-26", salary: 30000000},
                {id: "SP756", name: "ì´ì€ì„œ", tier: 5, joinDate: "2025-07-23", salary: 43000000},
                {id: "SP764", name: "ì´í˜¸ì§„", tier: 5, joinDate: "2025-07-21", salary: 42000000},
                {id: "SP765", name: "ë°•ì„±ì›", tier: 5, joinDate: "2025-07-21", salary: 62500000},
                {id: "SP766", name: "ì¡°ìœ ë¹ˆ", tier: 5, joinDate: "2025-07-28", salary: 70000000},
                {id: "SP767", name: "ë°•ì¤€ìƒ", tier: 5, joinDate: "2025-07-28", salary: 40000000},
                {id: "SP768", name: "ì˜¤ì§€í˜„", tier: 5, joinDate: "2025-08-04", salary: 44000000},
                {id: "SP769", name: "ê¹€ìœ ë¦¼", tier: 5, joinDate: "2025-08-11", salary: 37000000},
                {id: "SP770", name: "ìµœìƒí›ˆ", tier: 4, joinDate: "2025-08-18", salary: 80000000},
                {id: "SP771", name: "ìµœì„±ì€", tier: 5, joinDate: "2025-09-08", salary: 74000000},
                {id: "SP772", name: "ê¹€í¬ì• ", tier: 5, joinDate: "2025-10-13", salary: 71000000},
                {id: "SP773", name: "ê¹€ë¯¼ì•„", tier: 5, joinDate: "2025-10-13", salary: 60000000},
                {id: "SP774", name: "ì´ì£¼ì—°", tier: 5, joinDate: "2025-10-13", salary: 42000000},
                {id: "SP775", name: "ìœ ì§„ì›…", tier: 5, joinDate: "2025-10-20", salary: 50000000},
                {id: "SP776", name: "ì •ë‹¤ìŠ¬", tier: 5, joinDate: "2025-10-20", salary: 38000000}
            ];

            function calculateLevel(joinDate, baseDate) {
                // Convert dates to UTC to avoid timezone issues
                const utcJoinDate = new Date(Date.UTC(
                    joinDate.getFullYear(),
                    joinDate.getMonth(),
                    joinDate.getDate()
                ));
                const utcBaseDate = new Date(Date.UTC(
                    baseDate.getFullYear(),
                    baseDate.getMonth(),
                    baseDate.getDate()
                ));
                
                // Calculate months difference
                let months = (utcBaseDate.getFullYear() - utcJoinDate.getFullYear()) * 12 +
                           (utcBaseDate.getMonth() - utcJoinDate.getMonth());
                
                // Adjust for day of month
                if (utcBaseDate.getDate() < utcJoinDate.getDate()) {
                    months--;
                }
                
                // Return level based on months of experience
                if (months < 0) return 'L1'; // Future join date
                if (months < 6) return 'L1'; // Less than 6 months
                if (months < 12) return 'L2'; // 6-12 months
                return 'L3'; // 12+ months
            }

            function formatDate(date) {
                return date.toISOString().split('T')[0];
            }

            // ì´ì „ ê³ ì • ë¹„ìœ¨ í•¨ìˆ˜ë“¤ì€ ì‚­ì œë¨ - Step 2ì˜ Tier ë°°ìœ¨ ë¡œì§ì„ ì‚¬ìš©
            // Tab 3ëŠ” Step 2ì—ì„œ ê³„ì‚°ëœ calculatedIncentiveValuesì™€ calculatedBonusValuesë¥¼ ì°¸ì¡°

            /**
             * Tab 2ì˜ ì‚¬ì› ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Tier/Levelë³„ ì¸ì›ì„ ê³„ì‚°í•˜ì—¬ Step 2ì— ë°˜ì˜
             */
            function updateHeadcountFromEmployeeData() {
                // ê¸°ì¤€ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );
                
                // Tier/Levelë³„ ì¹´ìš´íŠ¸ ì´ˆê¸°í™” (T1-T6 ì°¸ì—¬ì)
                const counts = {
                    t1: { l1: 0, l2: 0, l3: 0 },
                    t2: { l1: 0, l2: 0, l3: 0 },
                    t3: { l1: 0, l2: 0, l3: 0 },
                    t4: { l1: 0, l2: 0, l3: 0 },
                    t5: { l1: 0, l2: 0, l3: 0 },
                    t6: { l1: 0, l2: 0, l3: 0 }
                };
                
                // ê° ì‚¬ì›ì˜ Tierì™€ Levelì„ ê³„ì‚°í•˜ì—¬ ì¹´ìš´íŠ¸
                employees.forEach(emp => {
                    const joinDate = new Date(emp.joinDate);
                    const level = calculateLevel(joinDate, baseDate);
                    const tierKey = 't' + emp.tier;
                    const levelKey = level.toLowerCase();
                    
                    if (counts[tierKey] && counts[tierKey][levelKey] !== undefined) {
                        counts[tierKey][levelKey]++;
                    }
                });
                
                // Step 2ì˜ ì…ë ¥ í•„ë“œì— ê°’ ì„¤ì •
                setValue('t1_l1', counts.t1.l1);
                setValue('t1_l2', counts.t1.l2);
                setValue('t1_l3', counts.t1.l3);
                
                setValue('t2_l1', counts.t2.l1);
                setValue('t2_l2', counts.t2.l2);
                setValue('t2_l3', counts.t2.l3);
                
                setValue('t3_l1', counts.t3.l1);
                setValue('t3_l2', counts.t3.l2);
                setValue('t3_l3', counts.t3.l3);
                
                setValue('t4_l1', counts.t4.l1);
                setValue('t4_l2', counts.t4.l2);
                setValue('t4_l3', counts.t4.l3);
                
                setValue('t5_l1', counts.t5.l1);
                setValue('t5_l2', counts.t5.l2);
                setValue('t5_l3', counts.t5.l3);
                
                setValue('t6_l1', counts.t6.l1);
                setValue('t6_l2', counts.t6.l2);
                setValue('t6_l3', counts.t6.l3);
                
                // Tierë³„ í•©ê³„ ê³„ì‚° ë° í‘œì‹œ
                const t1Count = counts.t1.l1 + counts.t1.l2 + counts.t1.l3;
                const t2Count = counts.t2.l1 + counts.t2.l2 + counts.t2.l3;
                const t3Count = counts.t3.l1 + counts.t3.l2 + counts.t3.l3;
                const t4Count = counts.t4.l1 + counts.t4.l2 + counts.t4.l3;
                const t5Count = counts.t5.l1 + counts.t5.l2 + counts.t5.l3;
                const t6Count = counts.t6.l1 + counts.t6.l2 + counts.t6.l3;
                
                setText('t1_total', t1Count);
                setText('t2_total', t2Count);
                setText('t3_total', t3Count);
                setText('t4_total', t4Count);
                setText('t5_total', t5Count);
                setText('t6_total', t6Count);
                
                // Levelë³„ í•©ê³„ ê³„ì‚° ë° í‘œì‹œ
                const l1Total = counts.t1.l1 + counts.t2.l1 + counts.t3.l1 + counts.t4.l1 + counts.t5.l1 + counts.t6.l1;
                const l2Total = counts.t1.l2 + counts.t2.l2 + counts.t3.l2 + counts.t4.l2 + counts.t5.l2 + counts.t6.l2;
                const l3Total = counts.t1.l3 + counts.t2.l3 + counts.t3.l3 + counts.t4.l3 + counts.t5.l3 + counts.t6.l3;
                
                setText('level_l1_total', l1Total);
                setText('level_l2_total', l2Total);
                setText('level_l3_total', l3Total);
                
                // ì „ì²´ ì´ ì¸ì› í‘œì‹œ
                const totalEmployees = employees.length;
                setText('headcount_grand_total', totalEmployees);
                
                // Tier ë¹„ìœ¨ ê²€ì¦ (Tier 6 ì‹œìŠ¤í…œ: T1 < 5%, T2 < 10%, T3 < 20%, T1+T2+T3 <= 35%)
                const t123Count = t1Count + t2Count + t3Count;
                
                const t1Percent = totalEmployees > 0 ? (t1Count / totalEmployees) * 100 : 0;
                const t2Percent = totalEmployees > 0 ? (t2Count / totalEmployees) * 100 : 0;
                const t3Percent = totalEmployees > 0 ? (t3Count / totalEmployees) * 100 : 0;
                const t4Percent = totalEmployees > 0 ? (t4Count / totalEmployees) * 100 : 0;
                const t5Percent = totalEmployees > 0 ? (t5Count / totalEmployees) * 100 : 0;
                const t6Percent = totalEmployees > 0 ? (t6Count / totalEmployees) * 100 : 0;
                const t123Percent = totalEmployees > 0 ? (t123Count / totalEmployees) * 100 : 0;
                
                // T1 ë¹„ìœ¨ ë° ê²€ì¦ í‘œì‹œ (< 5%)
                const t1ValidationSpan = document.getElementById('t1_validation');
                if (t1ValidationSpan) {
                    if (totalEmployees === 0) {
                        t1ValidationSpan.innerHTML = '-';
                        t1ValidationSpan.className = 'font-semibold';
                    } else if (t1Percent >= 5) {
                        const excess = t1Percent - 5;
                        t1ValidationSpan.innerHTML = `${t1Percent.toFixed(1)}% <span class="text-red-600">(${excess.toFixed(1)}% ì´ˆê³¼)</span>`;
                        t1ValidationSpan.className = 'font-semibold text-red-600';
                    } else {
                        t1ValidationSpan.innerHTML = `${t1Percent.toFixed(1)}% <span class="text-green-600">(ì ì •ì¸ì›)</span>`;
                        t1ValidationSpan.className = 'font-semibold text-green-600';
                    }
                }
                
                // T2 ë¹„ìœ¨ ë° ê²€ì¦ í‘œì‹œ (< 10%)
                const t2ValidationSpan = document.getElementById('t2_validation');
                if (t2ValidationSpan) {
                    if (totalEmployees === 0) {
                        t2ValidationSpan.innerHTML = '-';
                        t2ValidationSpan.className = 'font-semibold';
                    } else if (t2Percent >= 10) {
                        const excess = t2Percent - 10;
                        t2ValidationSpan.innerHTML = `${t2Percent.toFixed(1)}% <span class="text-red-600">(${excess.toFixed(1)}% ì´ˆê³¼)</span>`;
                        t2ValidationSpan.className = 'font-semibold text-red-600';
                    } else {
                        t2ValidationSpan.innerHTML = `${t2Percent.toFixed(1)}% <span class="text-green-600">(ì ì •ì¸ì›)</span>`;
                        t2ValidationSpan.className = 'font-semibold text-green-600';
                    }
                }
                
                // T3 ë¹„ìœ¨ ë° ê²€ì¦ í‘œì‹œ (< 20%)
                const t3ValidationSpan = document.getElementById('t3_validation');
                if (t3ValidationSpan) {
                    if (totalEmployees === 0) {
                        t3ValidationSpan.innerHTML = '-';
                        t3ValidationSpan.className = 'font-semibold';
                    } else if (t3Percent >= 20) {
                        const excess = t3Percent - 20;
                        t3ValidationSpan.innerHTML = `${t3Percent.toFixed(1)}% <span class="text-red-600">(${excess.toFixed(1)}% ì´ˆê³¼)</span>`;
                        t3ValidationSpan.className = 'font-semibold text-red-600';
                    } else {
                        t3ValidationSpan.innerHTML = `${t3Percent.toFixed(1)}% <span class="text-green-600">(ì ì •ì¸ì›)</span>`;
                        t3ValidationSpan.className = 'font-semibold text-green-600';
                    }
                }
                
                // T4 ë¹„ìœ¨ í‘œì‹œ (T4ëŠ” ê²€ì¦ ê¸°ì¤€ì´ ì—†ìœ¼ë¯€ë¡œ ë‹¨ìˆœíˆ ë¹„ìœ¨ë§Œ í‘œì‹œ)
                const t4ValidationSpan = document.getElementById('t4_validation');
                if (t4ValidationSpan) {
                    if (totalEmployees === 0) {
                        t4ValidationSpan.innerHTML = '-';
                        t4ValidationSpan.className = 'font-semibold';
                    } else {
                        t4ValidationSpan.innerHTML = `${t4Percent.toFixed(1)}%`;
                        t4ValidationSpan.className = 'font-semibold text-gray-600';
                    }
                }
                
                // T5 ë¹„ìœ¨ í‘œì‹œ (T5ëŠ” ê²€ì¦ ê¸°ì¤€ì´ ì—†ìœ¼ë¯€ë¡œ ë‹¨ìˆœíˆ ë¹„ìœ¨ë§Œ í‘œì‹œ)
                const t5ValidationSpan = document.getElementById('t5_validation');
                if (t5ValidationSpan) {
                    if (totalEmployees === 0) {
                        t5ValidationSpan.innerHTML = '-';
                        t5ValidationSpan.className = 'font-semibold';
                    } else {
                        t5ValidationSpan.innerHTML = `${t5Percent.toFixed(1)}%`;
                        t5ValidationSpan.className = 'font-semibold text-gray-600';
                    }
                }
                
                // T6 ë¹„ìœ¨ í‘œì‹œ (T6ëŠ” ê²€ì¦ ê¸°ì¤€ì´ ì—†ìœ¼ë¯€ë¡œ ë‹¨ìˆœíˆ ë¹„ìœ¨ë§Œ í‘œì‹œ)
                const t6ValidationSpan = document.getElementById('t6_validation');
                if (t6ValidationSpan) {
                    if (totalEmployees === 0) {
                        t6ValidationSpan.innerHTML = '-';
                        t6ValidationSpan.className = 'font-semibold';
                    } else {
                        t6ValidationSpan.innerHTML = `${t6Percent.toFixed(1)}%`;
                        t6ValidationSpan.className = 'font-semibold text-gray-600';
                    }
                }
                
                // T1+T2+T3 í•©ê³„ ë¹„ìœ¨ ë° ê²€ì¦ í‘œì‹œ (<= 35%)
                const t123ValidationSpan = document.getElementById('t123_validation');
                if (t123ValidationSpan) {
                    if (totalEmployees === 0) {
                        t123ValidationSpan.innerHTML = '-';
                        t123ValidationSpan.className = 'font-semibold';
                    } else if (t123Percent > 35) {
                        const excess = t123Percent - 35;
                        t123ValidationSpan.innerHTML = `T1+T2+T3: ${t123Percent.toFixed(1)}% <span class="text-red-600">(${excess.toFixed(1)}% ì´ˆê³¼)</span>`;
                        t123ValidationSpan.className = 'font-semibold text-red-600';
                    } else {
                        t123ValidationSpan.innerHTML = `T1+T2+T3: ${t123Percent.toFixed(1)}% <span class="text-green-600">(ì ì •ì¸ì›)</span>`;
                        t123ValidationSpan.className = 'font-semibold text-green-600';
                    }
                }
                
                // ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ (Tier 6 ì‹œìŠ¤í…œ)
                const warningDiv = document.getElementById('headcountWarning');
                let warningMessage = '';
                
                if (t1Percent >= 5) {
                    warningMessage += `âš ï¸ T1 ì¸ì›(${t1Count}ëª…, ${t1Percent.toFixed(1)}%)ì´ 5% ì´ìƒì…ë‹ˆë‹¤.\n`;
                }
                if (t2Percent >= 10) {
                    warningMessage += `âš ï¸ T2 ì¸ì›(${t2Count}ëª…, ${t2Percent.toFixed(1)}%)ì´ 10% ì´ìƒì…ë‹ˆë‹¤.\n`;
                }
                if (t3Percent >= 20) {
                    warningMessage += `âš ï¸ T3 ì¸ì›(${t3Count}ëª…, ${t3Percent.toFixed(1)}%)ì´ 20% ì´ìƒì…ë‹ˆë‹¤.\n`;
                }
                if (t123Percent > 35) {
                    warningMessage += `âš ï¸ T1+T2+T3 í•©ê³„(${t123Count}ëª…, ${t123Percent.toFixed(1)}%)ê°€ 35%ë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.\n`;
                }
                
                if (warningMessage && warningDiv) {
                    warningDiv.textContent = warningMessage.trim();
                    warningDiv.classList.remove('hidden');
                } else if (warningDiv) {
                    warningDiv.classList.add('hidden');
                }
            }

            function updateEmployeeTable() {
                // ë¨¼ì € ì‚¬ì› ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Step 2 ì¸ì› ì—…ë°ì´íŠ¸
                updateHeadcountFromEmployeeData();
                
                // Step 2ì˜ ì¸ì›ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìœ¼ë¯€ë¡œ ì „ì²´ ê³„ì‚° ì¬ì‹¤í–‰
                calculateAll();
                
                // ì´ì œ ê³„ì‚°ëœ ê°’ì„ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸” í‘œì‹œ ì—…ë°ì´íŠ¸
                const tbody = document.getElementById('employeeTableBody');
                if (!tbody) {
                    console.error('Employee table body not found');
                    return;
                }
                tbody.innerHTML = '';

                const baseDate = new Date(
                    parseInt(baseYear.value),
                    parseInt(baseMonth.value) - 1,
                    parseInt(baseDay.value)
                );

                // Get filter and sort values
                const searchName = document.getElementById('searchName')?.value.toLowerCase() || '';
                const tierFilter = document.getElementById('tierFilter')?.value || 'all';
                const sortOrder = document.getElementById('sortOrder')?.value || 'asc';

                // Filter employees
                let filteredEmployees = employees.filter(emp => {
                    const nameMatch = emp.name.toLowerCase().includes(searchName);
                    const tierMatch = tierFilter === 'all' || emp.tier === parseInt(tierFilter);
                    return nameMatch && tierMatch;
                });

                // Sort employees by tier
                if (sortOrder === 'asc') {
                    filteredEmployees.sort((a, b) => a.tier - b.tier);
                } else if (sortOrder === 'desc') {
                    filteredEmployees.sort((a, b) => b.tier - a.tier);
                }
                // sortOrder === 'none'ì´ë©´ ì •ë ¬í•˜ì§€ ì•ŠìŒ

                // Display search results
                const searchResultsDiv = document.getElementById('searchResults');
                const searchResultText = document.getElementById('searchResultText');
                
                if (searchName || tierFilter !== 'all') {
                    const totalCount = employees.length;
                    const filteredCount = filteredEmployees.length;
                    let resultText = `ê²€ìƒ‰ ê²°ê³¼: ${filteredCount}ëª…`;
                    
                    if (searchName) {
                        resultText += ` (ì´ë¦„: "${searchName}")`;
                    }
                    if (tierFilter !== 'all') {
                        resultText += ` (Tier: T${tierFilter})`;
                    }
                    resultText += ` / ì „ì²´ ${totalCount}ëª…`;
                    
                    if (searchResultText) searchResultText.textContent = resultText;
                    if (searchResultsDiv) searchResultsDiv.classList.remove('hidden');
                } else {
                    if (searchResultsDiv) searchResultsDiv.classList.add('hidden');
                }

                let totalSalary = 0;
                let totalMonthly = 0;
                let totalIncentive = 0;
                let totalBonus = 0;

                filteredEmployees.forEach((emp, displayIndex) => {
                    // Find original index for editing
                    const originalIndex = employees.indexOf(emp);
                    const tr = document.createElement('tr');
                    const joinDate = new Date(emp.joinDate);
                    const level = calculateLevel(joinDate, baseDate);
                    
                    // Step 2ì—ì„œ ê³„ì‚°ëœ Tier/Levelë³„ ì¸ì„¼í‹°ë¸Œì™€ ë³´ë„ˆìŠ¤ ê°’ ê°€ì ¸ì˜¤ê¸°
                    const tierKey = 't' + emp.tier;
                    const levelKey = level.toLowerCase();
                    
                    const incentive = calculatedIncentiveValues[tierKey]?.[levelKey] || 0;
                    const bonus = calculatedBonusValues[tierKey]?.[levelKey] || 0;
                    const monthlySalary = emp.salary / 12;
                    
                    // Calculate ratio: (ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ - ì›”ê¸‰) / ì›”ê¸‰ * 100
                    const ratio = ((incentive - monthlySalary) / monthlySalary * 100);
                    const ratioColor = ratio >= 0 ? 'text-green-600' : 'text-red-600';
                    const ratioSign = ratio >= 0 ? '+' : '';
                    
                    // Calculate bonus ratio: (ëŸ°ì¹­ ë³´ë„ˆìŠ¤ - ì›”ê¸‰) / ì›”ê¸‰ * 100
                    const bonusRatio = ((bonus - monthlySalary) / monthlySalary * 100);
                    const bonusRatioColor = bonusRatio >= 0 ? 'text-green-600' : 'text-red-600';
                    const bonusRatioSign = bonusRatio >= 0 ? '+' : '';
                    
                    // Calculate bonus payment splits (33.33% each)
                    const bonusPayment1 = bonus / 3;
                    const bonusPayment2 = bonus / 3;
                    const bonusPayment3 = bonus / 3;
                    
                    // Update totals
                    totalSalary += emp.salary;
                    totalMonthly += monthlySalary;
                    totalIncentive += incentive;
                    totalBonus += bonus;

                    tr.innerHTML = `
                        <td class="text-center">${displayIndex + 1}</td>
                        <td class="text-center">${emp.id}</td>
                        <td class="text-center">${emp.name}</td>
                        <td class="text-center">
                    <select class="input-base" onchange="updateEmployeeTier(${originalIndex}, this.value)">
                        ${[1,2,3,4,5,6,7].map(t => 
                            `<option value="${t}" ${emp.tier === t ? 'selected' : ''}>T${t}</option>`
                        ).join('')}
                    </select>
                        </td>
                        <td class="text-center">${formatDate(joinDate)}</td>
                        <td class="text-center">${level}</td>
                        <td class="text-right">${emp.salary.toLocaleString()}ì›</td>
                        <td class="text-right">${Math.round(monthlySalary).toLocaleString()}ì›</td>
                        <td class="text-right">${Math.round(incentive).toLocaleString()}ì›</td>
                        <td class="text-right bg-blue-50">${Math.round(bonus).toLocaleString()}ì›</td>
                        <td class="text-right bg-blue-50 text-sm">${Math.round(bonusPayment1).toLocaleString()}ì›</td>
                        <td class="text-right bg-blue-50 text-sm">${Math.round(bonusPayment2).toLocaleString()}ì›</td>
                        <td class="text-right bg-blue-50 text-sm">${Math.round(bonusPayment3).toLocaleString()}ì›</td>
                        <td class="text-right ${ratioColor} font-semibold">${ratioSign}${ratio.toFixed(1)}%</td>
                        <td class="text-right ${bonusRatioColor} font-semibold">${bonusRatioSign}${bonusRatio.toFixed(1)}%</td>
                        <td class="text-center">
                            <button onclick="deleteEmployee(${originalIndex})" 
                                    class="text-red-600 hover:text-red-800 transition-colors">
                                ì‚­ì œ
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                // Update totals in footer
                const totalSalaryEl = document.getElementById('total_salary');
                const totalMonthlyEl = document.getElementById('total_monthly');
                const totalIncentiveEl = document.getElementById('total_incentive');
                const totalBonusEl = document.getElementById('total_bonus');
                const totalBonusPayment1El = document.getElementById('total_bonus_payment1');
                const totalBonusPayment2El = document.getElementById('total_bonus_payment2');
                const totalBonusPayment3El = document.getElementById('total_bonus_payment3');
                const totalRatioEl = document.getElementById('total_ratio');
                const totalBonusRatioEl = document.getElementById('total_bonus_ratio');
                const displayedCountEl = document.getElementById('displayedCount');
                
                if (totalSalaryEl) totalSalaryEl.textContent = Math.round(totalSalary).toLocaleString() + 'ì›';
                if (totalMonthlyEl) totalMonthlyEl.textContent = Math.round(totalMonthly).toLocaleString() + 'ì›';
                if (totalIncentiveEl) totalIncentiveEl.textContent = Math.round(totalIncentive).toLocaleString() + 'ì›';
                if (totalBonusEl) totalBonusEl.textContent = Math.round(totalBonus).toLocaleString() + 'ì›';
                if (totalBonusPayment1El) totalBonusPayment1El.textContent = Math.round(totalBonus / 3).toLocaleString() + 'ì›';
                if (totalBonusPayment2El) totalBonusPayment2El.textContent = Math.round(totalBonus / 3).toLocaleString() + 'ì›';
                if (totalBonusPayment3El) totalBonusPayment3El.textContent = Math.round(totalBonus / 3).toLocaleString() + 'ì›';
                
                // Calculate total ratio (ì„±ê³¼ ì¸ì„¼í‹°ë¸Œ)
                if (totalRatioEl && totalMonthly > 0) {
                    const totalRatio = ((totalIncentive - totalMonthly) / totalMonthly * 100);
                    const ratioColor = totalRatio >= 0 ? 'text-green-600' : 'text-red-600';
                    const ratioSign = totalRatio >= 0 ? '+' : '';
                    totalRatioEl.className = `text-right font-bold ${ratioColor}`;
                    totalRatioEl.textContent = `${ratioSign}${totalRatio.toFixed(1)}%`;
                }
                
                // Calculate total bonus ratio (ëŸ°ì¹­ ë³´ë„ˆìŠ¤)
                if (totalBonusRatioEl && totalMonthly > 0) {
                    const totalBonusRatio = ((totalBonus - totalMonthly) / totalMonthly * 100);
                    const bonusRatioColor = totalBonusRatio >= 0 ? 'text-green-600' : 'text-red-600';
                    const bonusRatioSign = totalBonusRatio >= 0 ? '+' : '';
                    totalBonusRatioEl.className = `text-right font-bold ${bonusRatioColor}`;
                    totalBonusRatioEl.textContent = `${bonusRatioSign}${totalBonusRatio.toFixed(1)}%`;
                }
                
                // Update displayed count
                if (displayedCountEl) {
                    displayedCountEl.textContent = filteredEmployees.length;
                }
                
                // ì£¼ì˜: updateHeadcountFromEmployeeData()ì™€ calculateAll()ì€
                // í•¨ìˆ˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ ì´ë¯¸ í˜¸ì¶œë˜ì—ˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì¤‘ë³µ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
            }

            // Global functions for employee management
            window.updateEmployeeTier = function(index, newTier) {
                const newTierInt = parseInt(newTier);
                const oldTier = employees[index].tier;
                
                // Count employees in each tier
                const tierCounts = employees.reduce((acc, emp) => {
                    if (emp.tier === oldTier) acc[oldTier]--;
                    if (emp.tier === newTierInt) acc[newTierInt]++;
                    return acc;
                }, {1: 0, 2: 0, 3: 0, 4: 0});
                
                // Calculate percentages
                const totalEmployees = employees.length;
                const t1Percent = (tierCounts[1] / totalEmployees) * 100;
                const t2Percent = (tierCounts[2] / totalEmployees) * 100;
                const t3Percent = (tierCounts[3] / totalEmployees) * 100;
                const t123Percent = (tierCounts[1] + tierCounts[2] + tierCounts[3]) / totalEmployees * 100;
                
                // Validate tier change
                let errorMessage = '';
                if (t1Percent >= 10) {
                    errorMessage = 'T1ì€ ì „ì²´ ì¸ì›ì˜ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t2Percent >= 15) {
                    errorMessage = 'T2ëŠ” ì „ì²´ ì¸ì›ì˜ 15% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t3Percent >= 25) {
                    errorMessage = 'T3ëŠ” ì „ì²´ ì¸ì›ì˜ 25% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t123Percent > 50) {
                    errorMessage = 'T1+T2+T3 í•©ê³„ëŠ” ì „ì²´ ì¸ì›ì˜ 50% ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.';
                }
                
                if (errorMessage) {
                    alert(errorMessage);
                    // Reset the select element to the previous value
                    const select = document.querySelector(`select[onchange="updateEmployeeTier(${index}, this.value)"]`);
                    if (select) select.value = oldTier;
                    return;
                }
                
                employees[index].tier = newTierInt;
                updateEmployeeTable();
            };

            window.deleteEmployee = function(index) {
                const employee = employees[index];
                if (!employee) return;

                // Calculate tier percentages after deletion
                const tierCounts = employees.reduce((acc, emp, i) => {
                    if (i !== index) acc[emp.tier]++;
                    return acc;
                }, {1: 0, 2: 0, 3: 0, 4: 0});

                const totalEmployees = employees.length - 1;
                const t1Percent = (tierCounts[1] / totalEmployees) * 100;
                const t2Percent = (tierCounts[2] / totalEmployees) * 100;
                const t3Percent = (tierCounts[3] / totalEmployees) * 100;
                const t123Percent = (tierCounts[1] + tierCounts[2] + tierCounts[3]) / totalEmployees * 100;

                // Check if deletion would violate tier restrictions
                let errorMessage = '';
                if (t1Percent >= 10) {
                    errorMessage = 'T1 ì¸ì›ì´ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ T1 ì¸ì›ì„ ë¨¼ì € ì¡°ì •í•´ì£¼ì„¸ìš”.';
                } else if (t2Percent >= 15) {
                    errorMessage = 'T2 ì¸ì›ì´ 15% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ T2 ì¸ì›ì„ ë¨¼ì € ì¡°ì •í•´ì£¼ì„¸ìš”.';
                } else if (t3Percent >= 25) {
                    errorMessage = 'T3 ì¸ì›ì´ 25% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ T3 ì¸ì›ì„ ë¨¼ì € ì¡°ì •í•´ì£¼ì„¸ìš”.';
                } else if (t123Percent > 50) {
                    errorMessage = 'T1+T2+T3 í•©ê³„ê°€ 50% ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì¸ì›ì„ ë¨¼ì € ì¡°ì •í•´ì£¼ì„¸ìš”.';
                }

                if (errorMessage) {
                    alert(errorMessage);
                    return;
                }

                if (confirm(`ì •ë§ ${employee.name}(${employee.id}) ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    employees.splice(index, 1);
                    updateEmployeeTable();
                }
            };

            // Add new employee
            document.getElementById('addEmployee').addEventListener('click', () => {
                const id = document.getElementById('newEmpId').value.trim();
                const name = document.getElementById('newEmpName').value.trim();
                const tier = parseInt(document.getElementById('newEmpTier').value);
                const joinDate = document.getElementById('newEmpJoinDate').value;

                // Validate input fields
                if (!id || !name || !joinDate) {
                    alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // Validate employee ID format
                if (!/^SP\d{3}$/.test(id)) {
                    alert('ì‚¬ë²ˆì€ SPë¡œ ì‹œì‘í•˜ëŠ” 5ìë¦¬ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: SP001)');
                    return;
                }

                // Check for duplicate employee ID
                if (employees.some(emp => emp.id === id)) {
                    alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ë²ˆì…ë‹ˆë‹¤.');
                    return;
                }

                // Calculate tier percentages after addition
                const tierCounts = employees.reduce((acc, emp) => {
                    acc[emp.tier]++;
                    return acc;
                }, {1: 0, 2: 0, 3: 0, 4: 0});
                tierCounts[tier]++; // Add the new employee

                const totalEmployees = employees.length + 1;
                const t1Percent = (tierCounts[1] / totalEmployees) * 100;
                const t2Percent = (tierCounts[2] / totalEmployees) * 100;
                const t3Percent = (tierCounts[3] / totalEmployees) * 100;
                const t123Percent = (tierCounts[1] + tierCounts[2] + tierCounts[3]) / totalEmployees * 100;

                // Validate tier restrictions
                let errorMessage = '';
                if (t1Percent >= 10) {
                    errorMessage = 'T1 ì¸ì›ì´ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t2Percent >= 15) {
                    errorMessage = 'T2 ì¸ì›ì´ 15% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t3Percent >= 25) {
                    errorMessage = 'T3 ì¸ì›ì´ 25% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                } else if (t123Percent > 50) {
                    errorMessage = 'T1+T2+T3 í•©ê³„ê°€ 50% ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.';
                }

                if (errorMessage) {
                    alert(errorMessage);
                    return;
                }

                // Add the new employee
                employees.push({
                    id,
                    name,
                    tier,
                    joinDate,
                    salary: 50000000 // Default salary
                });

                // Clear input fields
                document.getElementById('newEmpId').value = '';
                document.getElementById('newEmpName').value = '';
                document.getElementById('newEmpTier').value = '4';
                document.getElementById('newEmpJoinDate').value = '';

                updateEmployeeTable();
            });

            // CSV íŒŒì‹± í—¬í¼ í•¨ìˆ˜ (ë”°ì˜´í‘œ ê³ ë ¤)
            function parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim());
                return result;
            }

            // CSV íŒŒì¼ ì²˜ë¦¬
            document.getElementById('importCSV').addEventListener('click', () => {
                const fileInput = document.getElementById('csvFile');
                const file = fileInput.files[0];
                
                if (!file) {
                    alert('CSV íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    const lines = text.split('\n');
                    
                    // Skip header row and empty lines
                    const newEmployees = lines
                        .slice(2) // Skip "â–  ì¬ì§ì í˜„í™©" and header rows
                        .filter(line => line.trim())
                        .map(line => {
                            const columns = parseCSVLine(line);
                            
                            // Parse salary (ì—°ë´‰ ì»¬ëŸ¼: index 6)
                            const salaryStr = columns[6] ? columns[6].replace(/[" ,]/g, '') : '';
                            const salary = parseInt(salaryStr) || 50000000;
                            
                            return {
                                id: columns[1],
                                name: columns[2],
                                tier: parseInt(columns[3]),
                                joinDate: columns[5], // OQ í•©ë¥˜ì¼ ì‚¬ìš©
                                salary: salary
                            };
                        })
                        .filter(emp => emp.id && emp.name && !isNaN(emp.tier));

                    if (newEmployees.length === 0) {
                        alert('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }

                    // Validate tier restrictions
                    const tierCounts = newEmployees.reduce((acc, emp) => {
                        acc[emp.tier] = (acc[emp.tier] || 0) + 1;
                        return acc;
                    }, {1: 0, 2: 0, 3: 0, 4: 0});

                    const totalEmployees = newEmployees.length;
                    const t1Percent = (tierCounts[1] / totalEmployees) * 100;
                    const t2Percent = (tierCounts[2] / totalEmployees) * 100;
                    const t3Percent = (tierCounts[3] / totalEmployees) * 100;
                    const t123Percent = (tierCounts[1] + tierCounts[2] + tierCounts[3]) / totalEmployees * 100;

                    let errorMessage = '';
                    if (t1Percent >= 10) {
                        errorMessage = 'T1 ì¸ì›ì´ 10% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                    } else if (t2Percent >= 15) {
                        errorMessage = 'T2 ì¸ì›ì´ 15% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                    } else if (t3Percent >= 25) {
                        errorMessage = 'T3 ì¸ì›ì´ 25% ë¯¸ë§Œì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                    } else if (t123Percent > 50) {
                        errorMessage = 'T1+T2+T3 í•©ê³„ê°€ 50% ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.';
                    }

                    if (errorMessage) {
                        alert('CSV íŒŒì¼ì˜ Tier ë¶„í¬ê°€ ì œí•œì„ ìœ„ë°˜í•©ë‹ˆë‹¤:\n' + errorMessage);
                        return;
                    }

                    // Replace existing employees with new ones
                    employees = newEmployees;
                    updateEmployeeTable();
                    
                    // Clear file input
                    fileInput.value = '';
                    
                    alert(`${newEmployees.length}ëª…ì˜ ì¸ì› ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
                };
                
                reader.onerror = function() {
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                };
                
                reader.readAsText(file);
            });

            // Initialize table with CSV data
            employees = initialEmployees;
            
            // ì´ˆê¸° ë¡œë“œ ì‹œ ì‚¬ì› ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì¸ì› ê³„ì‚° ë° í…Œì´ë¸” í‘œì‹œ
            updateDays();
            updateEmployeeTable();
            
            // Add event listeners for date changes
            baseYear.addEventListener('change', updateDays);
            baseMonth.addEventListener('change', updateDays);
            baseDay.addEventListener('change', updateEmployeeTable);
            
            // Add event listeners for search, filter, and sort
            const searchNameInput = document.getElementById('searchName');
            const tierFilterSelect = document.getElementById('tierFilter');
            const sortOrderSelect = document.getElementById('sortOrder');
            const resetFiltersBtn = document.getElementById('resetFilters');
            
            if (searchNameInput) {
                searchNameInput.addEventListener('input', updateEmployeeTable);
            }
            if (tierFilterSelect) {
                tierFilterSelect.addEventListener('change', updateEmployeeTable);
            }
            if (sortOrderSelect) {
                sortOrderSelect.addEventListener('change', updateEmployeeTable);
            }
            
            // Reset filters button
            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', () => {
                    if (searchNameInput) searchNameInput.value = '';
                    if (tierFilterSelect) tierFilterSelect.value = 'all';
                    if (sortOrderSelect) sortOrderSelect.value = 'none';
                    updateEmployeeTable();
                });
            }
            
            // Initial population
            updateDays();
        });
    </script>
</body>
</html>

